/*! Copyright (c) 2015 WhatsApp Inc.  All Rights Reserved. */
webpackJsonp([0],Array(1270).concat([function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e){window.history.pushState({},"",window.location.href)}function s(){if(!Store.Conn.connected)return!1;var e=n(1445),t=Store.Msg.some(function(e){return 0===e.ack&&e.local&&e.isSentByMe}),i=Store.Chat.some(function(e){return!!e.composeContents.text});return t||i||e.hasText}var r=n(2),o=i(r),l=n(47),c=i(l),u=n(112),d=i(u),p=n(110),h=i(p),f=n(1672),m=i(f),g=n(8),v=n(44);_.defaults(window.Store,n(1639));var y=n(58),E=n(9),b=n(16),C=n(29),M=n(1506),S=n(1568),T=n(454),w=n(1653),k=n(1487),P=n(156),N=n(10),x=n(12),D=n(161),O=n(244),R=n(1652),I=n(1538),A=n(154),L=n(153),F=n(94),U=n(1663),G=n(1626),j=n(1605),B=n(0),V=n(1),q=n(236),H=q.parseCmd,z=q.Cmd,W=n(229),Y=n(93),K=n(92),Q=n(46),X=n(45),Z=n(1584),J=n(20),$=n(95);$&&!function(){var e=n(243),t=n(242);Store.ProfilePicThumb.on("change:tag",function(n){n.tag||e.request(navigator.serviceWorker.controller,t.REMOVE_PP,n.id)["catch"](function(){})})}();var ee=[[document,"mousemove"],[document,"scroll"],[document,"keydown"],[window,"focus"],[window,"blur"],[window,"resize"]],te=g.createClass({displayName:"Main",mixins:[P,L,F,A],propTypes:{apiCmd:g.PropTypes.array,apiCmdHandled:g.PropTypes.func.isRequired,animate:g.PropTypes.bool},statics:{hasPending:s},getInitialState:function(){return this.onBlur=this.safeDebounce(function(){if(document.activeElement===document.body){var e=Y.Manager.top;e&&e.uie.requestFocus()}},10),{drawerActive:!1}},componentWillMount:function(){var e=this;d["default"].uiActive=!0,d["default"].markAvailable(),this.regNativeListener(window,"click",function(t){var n=t.target;if(n&&"A"===n.nodeName&&n.hasAttribute("href")){var i=H(n.getAttribute("href"));e.execApiCmd(i)&&t.preventDefault()}},!0)},componentWillReceiveProps:function(e){e.apiCmd&&this.execApiCmd(e.apiCmd)},componentWillUnmount:function(){this.onBlur=null,U.trigger(R.Event+":"+R.Events.LOGGED_OUT),Q.canMuckHistory()&&window.history.back(),d["default"].uiActive=!1,this.clearIdleMonitor(),this.clearServerPropsQueryLoop()},componentDidMount:function(){if(U.trigger(R.Event+":"+R.Events.LOGGED_IN),this.props.apiCmd&&this.execApiCmd(this.props.apiCmd),Q.canMuckHistory()&&(window.history.pushState({},"",window.location.href),this.regNativeListener(window,"popstate",a)),this.beginIdleMonitor(!0),this.beginServerPropsQueryLoop(),this.addObserverAndRun(Store.Conn,"change:tos",this.showTOS),K.focus(v.findDOMNode(this)),y.isSafari){var e=C.getNUX(E.NUX.SAFARI_LIMITED_SUPPORT);(!e||e<e.maxViews)&&(this.safeDelay(function(){var e=l10n.t("whatsapp_safari_limited").replace("__chrome_homepage__",E.BROWSER_LINK.CHROME).replace("__firefox_homepage__",E.BROWSER_LINK.FIREFOX).replace("__opera_homepage__",E.BROWSER_LINK.OPERA);N.openModal(g.createElement(T,{onOK:N.closeModal.bind(N),okText:l10n.t("ok_got_it")},g.createElement("div",{dangerouslySetInnerHTML:{__html:e}})))},250),C.setNUX(E.NUX.SAFARI_LIMITED_SUPPORT,{views:1,maxViews:1}))}},execApiCmd:function(e){var t=(0,c["default"])(e,2),n=t[0],i=t[1];switch(V.log("main:execApiCmd:"+n)(i),this.props.apiCmdHandled(),n){case z.GROUP_INVITE:return N.openModal(g.createElement(j,{groupCode:i.code})),!0;case z.MSG_SEND:var a=i.text,s=i.phone;if(s){var r=J.numberToWid(s);X.queryExist(r).then(function(e){return 200===e.status?Store.Chat.find(e.jid):o["default"].reject("Invalid number")}).then(function(e){return e.active&&a?void N.pasteChatTextInput(e,a):(a&&e.setComposeContents({text:a}),N.openChatFromUnread(e).then(function(t){t&&N.focusChatTextInput(e)}))})["catch"](function(e){N.openModal(g.createElement(T,{onOK:N.closeModal.bind(N),okText:l10n.t("web_ok")},l10n.t("msg_send_error")))})}else N.openModal(g.createElement(Z,{msgText:a}),"modal-flow");return!0;default:return!1}},beginIdleMonitor:function(e){var t=this;e=e?E.IDLE_TIMEOUT:0,this.idleMonitor=o["default"].loop(function(){return o["default"].delay(e).addCancelControl().then(function(){d["default"].markUnavailable(3e4);var n=void 0,i=new o["default"](function(e){n=e});return ee.forEach(function(e){var i=(0,c["default"])(e,2),a=i[0],s=i[1];t.regNativeListener(a,s,n)}),i.addCancelControl()["finally"](function(){ee.forEach(function(e){var i=(0,c["default"])(e,2),a=i[0],s=i[1];t.unregNativeListener(a,s,n)})}).then(function(){d["default"].markAvailable(),e=E.IDLE_TIMEOUT})})})["finally"](function(){t.idleMonitor=null})["catch"](o["default"].CancellationError,_.noop).endWithControls("cancel")},clearIdleMonitor:function(){this.idleMonitor&&this.idleMonitor.control.cancel()},beginServerPropsQueryLoop:function(){var e=this;this.serverPropsQueryLoop=D.setTimeout(function(){Store.Props.fetch()["catch"](x.WapDrop,_.noop),e.beginServerPropsQueryLoop()},B().add("1","days").valueOf())},clearServerPropsQueryLoop:function(){D.clearTimeout(this.serverPropsQueryLoop)},calculateConversationPaneScale:function(){if(!(this.refs.chatlist&&this.refs.container&&this.refs.conversation))return null;var e=v.findDOMNode(this.refs.chatlist),t=v.findDOMNode(this.refs.conversation),n=v.findDOMNode(this.refs.container);return t.clientWidth/(n.clientWidth-e.clientWidth)},onRightDrawerIn:function(){this.rightDrawerOut=!1,N.onPanesWillChange(3),this.setState({drawerActive:!0},N.onPanesDidChange.bind(N,3));var e=this.calculateConversationPaneScale();null!==e&&this.animateConversationPane(e)},onRightDrawerOut:function(){this.rightDrawerOut=!0;var e=this.calculateConversationPaneScale();null!==e&&this.animateConversationPane(e),1!==e&&(N.onPanesWillChange(2),this.setState({drawerActive:!1},N.onPanesDidChange.bind(N,2)))},onRightDrawerAnimationComplete:function(){this.state.drawerActive&&this.rightDrawerOut&&this.setState({drawerActive:!1})},animateConversationPane:function(e){Velocity(v.findDOMNode(this.refs.conversation),{scaleX:[1,e]},{duration:300,easing:[.1,.82,.25,1]})},onRotateFocus:function(e){var t=this,n=1;e&&(e.stopPropagation(),e.preventDefault(),n=e.shiftKey?-1:1,h["default"].flashFocus=Date.now());var i=_.toArray(v.findDOMNode(this).querySelectorAll("[data-tab]"));if(N.existsDrawerLeft(function(e){if(e){var n=v.findDOMNode(t.refs.chatlist);i=_.reject(i,function(e){return n.contains(e)})}}),N.existsDrawerMid(function(e){if(e){var n=v.findDOMNode(t.refs.conversation);n&&(i=_.reject(i,function(e){return n.contains(e)}))}}),i.length){i=_.sortBy(i,function(e){return parseInt(e.getAttribute("data-tab"),10)||0});var a=0,s=document.activeElement;s&&(a=O.ring(_.findIndex(i,function(e){return e.contains(s)})+n,i));var r=i[a];h["default"].flashFocus=Date.now(),r.restoreFocus?r.restoreFocus():K.focus(r)}},showTOS:function(){switch(Store.Conn.tos){case 1:case 2:N.openModal(g.createElement(G,null),void 0,void 0,!0);break;case 3:b.logout()}},render:function(){var e=this.state.drawerActive?"app three":"app two";this.props.animate||(e+=" no-animation"),y.isSafari&&(e+=" safari-fix");var t={tab:this.onRotateFocus,"shift+tab":this.onRotateFocus};return g.createElement(W,{state:W.State.INACTIVE,ref:"container",displayName:"Main"},g.createElement(h["default"],{handlers:t,className:e,onBlur:this.onBlur},g.createElement(w,null),g.createElement(k,null),g.createElement(m["default"],null),g.createElement("div",{className:"drawer-manager"},g.createElement(S,{direction:S.Dir.LEFT}),g.createElement(S,{direction:S.Dir.MID}),g.createElement(S,{direction:S.Dir.RIGHT,ref:"rightDrawer",onDrawerIn:this.onRightDrawerIn,onDrawerOut:this.onRightDrawerOut,onDrawerAnimationComplete:this.onRightDrawerAnimationComplete})),g.createElement(M,{ref:"chatlist",className:"pane pane-one"}),g.createElement(I,{ref:"conversation",animate:this.props.animate})))}});e.exports=te},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){switch(t){case"text":return e.type===u["default"].TYPE.CHAT&&"url"!==e.subtype;case"image":return e.type===u["default"].TYPE.IMAGE;case"video":return e.type===u["default"].TYPE.VIDEO&&!e.isGif;case"gif":return e.type===u["default"].TYPE.VIDEO&&e.isGif;case"audio":return e.type===u["default"].TYPE.AUDIO;case"ptt":return e.type===u["default"].TYPE.PTT;case"document":return e.type===u["default"].TYPE.DOCUMENT;case"location":return e.type===u["default"].TYPE.LOCATION;case"vcard":return e.type===u["default"].TYPE.VCARD||e.type===u["default"].TYPE.MULTI_VCARD;case"url":return e.type===u["default"].TYPE.CHAT&&"url"===e.subtype;case void 0:return!1;default:return!1}}Object.defineProperty(t,"__esModule",{value:!0}),t.ChatProxy=void 0;var s=n(1271),r=i(s),o=n(2),l=i(o),c=n(453),u=i(c),d=n(464),p=n(487),h=i(p),f=n(112),m=i(f),g=n(470),v=i(g),y=n(466),E=n(8),b=n(9),C=n(1),M=n(1473),S=n(1385),T=n(1472),w=n(1471),k=n(1470),P=n(1428),N=n(75),x=n(10),D=n(45),O=n(29),R=n(76),I=n(12),A=n(30),L=n(20),F=n(473),U=n(111).ActionToast,G=n(111).ActionType,j=n(459),B=3e5,V={GROUP:"group",BROADCAST:"broadcast",CHAT:"chat"},q={Collection:"Chat",props:{id:"string",t:"number",unreadCount:{type:"number","default":0},archive:"boolean",isReadOnly:"boolean",modifyTag:"number",muteExpiration:{type:"number","default":0},name:"string",notSpam:"boolean"},session:{createdLocally:"boolean",pendingAction:"number",formattedTitle:"string",active:"boolean",pausedTimerId:"number",presenceResendTimerId:"number",recording:"boolean",typing:"boolean",unreadDivider:"object",colors:"object",composeContents:{type:"object","default":function(){return{}}},popupPanels:"object",popupPositionChange:"number",squelch:"number",pendingSeenCount:{type:"number","default":0},markedUnread:"boolean",trusted:"boolean",canSend:"boolean",promises:{type:"object","default":function(){return{}}},ftsCache:{type:"object","default":function(){return{}}},composeQuotedMsg:"object",groupMetadata:"object",presence:"object",mute:"object",contact:"object"},initialize:function(){if(M.prototype.initialize.call(this),this._addQueue=new h["default"],this._sendQueue=new h["default"],this.msgs.msgLoadState.contextLoaded=!0,this.isVisible||(this.msgs.msgLoadState.noEarlierMsgs=!0),this.addChild("presence",Store.Presence.gadd(this.id)),this.addChild("mute",Store.Mute.gadd({id:this.id,expiration:this.muteExpiration})),this.addChild("contact",Store.Contact.gadd(this.id)),this.name&&!this.contact.name&&(this.contact.name=this.name),this.listenTo(this.contact,"change:name",this.updateTitle),this.isGroup&&(this.trusted=!0),this.isGroup||this.isBroadcast){var e;this.isBroadcast&&!Store.GroupMetadata.get(this.id)&&(e=!0),this.addChild("groupMetadata",Store.GroupMetadata.gadd(this.id)),this.listenTo(this.groupMetadata,"change:stale",this.updateReadOnly),this.listenTo(this.groupMetadata,"change:trusted change:stale",this.isTrusted),this.listenTo(this.groupMetadata.participants,"add remove reset",this.updateReadOnly),this.listenTo(this.groupMetadata.participants,"change:contact.formattedShortName",this.updateTitle),this.updateReadOnly();var t=this.id;this.listenTo(this,"change:isReadOnly",function(){this.isTrusted(),this.updateCanSend(),Store.ProfilePicThumb.update(t)["catch"](I.WapDrop,_.noop),Store.GroupMetadata.update(t)["catch"](I.WapDrop,_.noop)}),e&&Store.GroupMetadata.update(t)["catch"](I.WapDrop,_.noop)}else this.listenTo(this.presence,"change:isOnline",this._presenceOnlineChanged),this.listenTo(this.contact,"change:isMyContact",this.isTrusted),this.listenTo(Store.Blocklist,"add remove reset",this.updateCanSend);Store.Chat.notSpam[this.id]&&!this.notSpam&&this.sendNotSpam()["catch"](_.noop),Store.Chat.notSpam[this.id]=!!this.notSpam,this.notSpam||this.listenTo(this,"change:notSpam",this.onNotSpamChange),this.updateTitle(),this.isTrusted(),this.updateCanSend(),this.listenTo(this.msgs,"add",this.onNewMsg),this.listenTo(this.msgs,"remove",this.updateSortTime),this.listenTo(this.msgs,"bulk_add",this.addMediaMsgs),this.listenTo(this,"change:msgs",this.resetMediaMsgs),this._saveAssignedColors=_.debounce(this.saveAssignedColors,1e3),this.listenTo(this,"change:active",this.onActiveUpdate),this.pendingAction=0,this.listenTo(this,"change:pendingAction",this.onPendingActionUpdate),this.listenTo(this,"change:t change:modifyTag",this._clearFtsCache)},derived:{kind:{fn:function(){return L.isGroup(this.id)?V.GROUP:L.isBroadcast(this.id)?V.BROADCAST:L.isUser(this.id)?V.CHAT:void C.log("chat:unknown kind id:"+this.id)()}},isGroup:{fn:function(){return L.isGroup(this.id)}},isBroadcast:{fn:function(){return L.isBroadcast(this.id)}},isUser:{fn:function(){return L.isUser(this.id)}},isPSA:{fn:function(){return L.isPSA(this.id)}},hasUnread:{deps:["unreadCount"],fn:function(){return 0!==this.unreadCount}},isVisible:{deps:["createdLocally","msgs","msgsLength"],fn:function(){return!!this._isVisibleLatched||!L.isStatusV3(this.id)&&(this._isVisibleLatched=!this.createdLocally||this.msgs.some(function(e){return e.type!==u["default"].TYPE.E2E_NOTIFICATION}),this._isVisibleLatched)}},previewMessage:{deps:["msgs","msgsChanged"],fn:function(){for(var e=this.msgs.length-1;e>=0;e--){var t=this.msgs.at(e);if(t&&t.type!==u["default"].TYPE.E2E_NOTIFICATION)return t}return this.msgs.last()}}},addPendingAction:function(e){var t=this;if(e.isPending()){var n=function(){t.pendingAction--};e.then(n,n),this.pendingAction++}},addAndSendMsg:function(e){var t=this,n=arguments.length<=1||void 0===arguments[1]?void 0:arguments[1],i=l["default"].resolve(e),a=this._addQueue.enqueue(i).then(function(e){var n=window.Store.Msg.add(e);return n.waitForPrep().then(function(){return t.msgs.add(n)})}),s=n?a.then(n)["return"](a):a,r=this.sendMsg(s);return[a,r]},sendMsg:function(e){return this._sendQueue.enqueue(e).then(function(e){return window.Store.Msg.send(e)})},onActiveUpdate:function(){this.isGroup&&this.active&&(this.squelch=-1),this.presence.chatActive=this.active},onPendingActionUpdate:function(){this.pendingAction<0&&(C.log("chat:onPendingActionUpdate pendingAction value is invalid")(),this.pendingAction=0)},onNotSpamChange:function(){Store.Chat.notSpam[this.id]=this.notSpam,this.isTrusted(),this.notSpam&&this.stopListening(this,"change:notSpam")},hasMaybeSentMsgToChat:function(){return _.some(this.getAllMsgs(),function(e){return e.isSentByMe})},isTrusted:function(){var e=void 0;return this.isGroup?e=N.supportsFeature(N.F.SPAM)?this.isReadOnly||this.notSpam||this.groupMetadata.isTrusted():this.groupMetadata.isTrusted():this.isBroadcast?e=!0:this.isUser&&(e=!N.supportsFeature(N.F.SPAM)||(this.notSpam||this.contact.isMyContact)),!e&&this.hasMaybeSentMsgToChat()&&(e=!0),this.trusted=e},updateTitle:function(){this.isBroadcast?this.formattedTitle=this.contact.name||this.groupMetadata.participants.map(function(e){return e.contact.formattedShortName}).join(", "):this.isUser?this.formattedTitle=this.contact.getFormattedUser():this.isGroup&&(this.formattedTitle=this.contact.name)},title:function(){return this.isGroup?this.formattedTitle||l10n.t("unknown_subject"):this.formattedTitle},sendExit:function(){var e=this;if(!this.isGroup)return l["default"].reject(new I.ActionError);if(this.promises.sendExit)return this.promises.sendExit;this.promises.sendExit=D.leaveGroup(this.id);var t=new G(l10n.t("action_group_exiting")),n=this.promises.sendExit.then(function(e){return 200===e.status?new G(l10n.t("action_group_exited")):e.status>=400?new G(l10n.t("action_group_exit_failed")):void 0})["catch"](function(e){return C.error("models:chat:sendExit dropped")(e),new G(l10n.t("action_group_exit_failed"),l10n.t("action_try_again"),this.sendExit.bind(this))});return x.openToast(E.createElement(U,{id:U.genId(),initialAction:t,pendingAction:n})),this.promises.sendExit.bind(this).then(function(e){200!==e.status||e._duplicate||this.exit()})["finally"](function(){e.promises.sendExit=null})},canExit:function(){return N.supportsFeature(N.F.GROUP_EXIT)},exit:function(){this.isGroup&&(this.groupMetadata.participants.remove(Store.Conn.me),this.isReadOnly=!0)},sendDelete:function(){var e=this;if(this.promises.sendDelete)return this.promises.sendDelete;var t=this.msgs.last(),n=t?t.id:void 0;this.promises.sendDelete=D.sendConversationDelete(this.id,n);var i,a=this.kind;switch(a){case V.GROUP:i=l10n.t("action_group_deleting");break;case V.BROADCAST:i=l10n.t("action_broadcast_deleting");break;case V.CHAT:i=l10n.t("action_chat_deleting")}i=new G(i);var s=this.promises.sendDelete.bind(this).then(function(e){if(200===e.status)switch(a){case V.GROUP:return new G(l10n.t("action_group_deleted"));case V.BROADCAST:return new G(l10n.t("action_broadcast_deleted"));case V.CHAT:return new G(l10n.t("action_chat_deleted"))}else if(e.status>=400)switch(a){case V.GROUP:return new G(l10n.t("action_group_delete_failed"));case V.BROADCAST:return new G(l10n.t("action_broadcast_delete_failed"));case V.CHAT:return new G(l10n.t("action_chat_delete_failed"))}})["catch"](function(e){C.error("models:chat:sendDelete dropped")(e);var t=void 0;switch(a){case V.GROUP:t=l10n.t("action_group_delete_failed");break;case V.BROADCAST:t=l10n.t("action_broadcast_delete_failed");break;case V.CHAT:t=l10n.t("action_chat_delete_failed")}return new G(t,l10n.t("action_try_again"),this.sendDelete.bind(this))});return x.openToast(E.createElement(U,{id:U.genId(),initialAction:i,pendingAction:s})),this.promises.sendDelete.bind(this).then(function(e){if(200===e.status&&!e._duplicate){var n=this.msgs.last();t===n?this["delete"](!0):this.deleteMsgsBeforeMsgInclusive(t)}})["finally"](function(){e.promises.sendDelete=null})},updateCanSend:function(){return this.isReadOnly?this.canSend=!1:this.isUser?this.canSend=!(this.contact.isBlocked()||this.isPSA):this.canSend=!0},canDelete:function(){return N.supportsFeature(N.F.DELETE)},canClear:function(){return N.supportsFeature(N.F.CHAT_CLEAR)},sendClear:function(e){var t=this;if(this.promises.sendClear)return this.promises.sendClear;var n=this.msgs.last(),i=n?n.id:void 0;this.promises.sendClear=D.sendConversationClear(this.id,i,!e);var a=new G(l10n.t("action_chat_clearing")),s=this.promises.sendClear.then(function(e){return 200===e.status?new G(l10n.t("action_chat_cleared")):e.status>=400?new G(l10n.t("action_chat_clear_failed")):void 0})["catch"](function(n){return C.error("models:chat:sendClear dropped")(n),new G(l10n.t("action_chat_clear_failed"),l10n.t("action_try_again"),t.sendClear.bind(t,e))});return x.openToast(E.createElement(U,{id:U.genId(),initialAction:a,pendingAction:s})),this.promises.sendClear.then(function(i){200!==i.status||i._duplicate||t.deleteMsgsBeforeMsgInclusive(n,e)})["finally"](function(){t.promises.sendClear=null})},"delete":function(e){M.prototype["delete"].call(this),Store.Chat.remove(this.id),this.cancelPendingPromises(),this.presence["delete"](),this.mute["delete"](),this.deleteMsgs(),x.clearChat(this),this.groupMetadata&&this.groupMetadata["delete"](),this.mediaMsgs&&this.mediaMsgs["delete"](),this.linkMsgs&&this.linkMsgs["delete"](),this.docMsgs&&this.docMsgs["delete"](),this.starredMsgs&&(this.starredMsgs["delete"](),this.starredMsgs.stopListening(),this.starredMsgs.reset())},isDirty:function(){return 0!==this.unreadCount},resetMediaMsgs:function(){this.mediaMsgs&&(this.mediaMsgs["delete"](),this.mediaMsgs.queryMedia(this)),this.linkMsgs&&(this.linkMsgs["delete"](),this.linkMsgs.queryLinks(this)),this.docMsgs&&(this.docMsgs["delete"](),this.docMsgs.queryDocs(this))},addMediaMsgs:function(e,t){if(e){var n=_.isArray(e)?e:[e],i=[],a=[],s=[];n.forEach(function(e){e.createLinks(),e.isMedia&&i.push(e),e.hasLink&&a.push(e),e.isDoc&&s.push(e)}),this.mediaMsgs&&i.length&&this.mediaMsgs.add(i,t),this.linkMsgs&&a.length&&this.linkMsgs.add(a,t),this.docMsgs&&s.length&&this.docMsgs.add(s,t)}},onNewMsg:function(e){if(e&&"i"!==e.eventType){var t={};if(t.t=e.t,this.promises.updateSortTime&&this.promises.updateSortTime.cancel(),this.archive&&(t.archive=!1),e.isSentByMe||(this.presence.handle({id:this.id,participant:e.author,type:"available"}),"a"!==e.eventType&&"d"!==e.eventType||(t.unreadCount=this.unreadCount+1||1)),this.set(t),!e.isSentByMe)switch(e.eventType){case"d":case"a":"d"===e.eventType&&x.alertNewMsg(e),this.msgs.length<b.MSG_PRELOAD_THRESHOLD&&this.loadEarlierMsgs()["catch"](I.E404,_.noop)["catch"](function(e){C.log("chat:onNewMsg failed")(),C.log(e)()});break;case"s":if("gp2"===e.type&&"add"===e.subtype&&_.head(e.recipients)===Store.Conn.me&&!this.contact.name)return;x.alertNewMsg(e)}}},setArchive:function(e,t){var n=this;if(this.archive===e)return l["default"].reject(new I.ActionError);if(this.promises.setArchive)return this.promises.setArchive;var i=this.lastReceivedKey,a=D.sendConversationArchive(this.id,e,i),s=new G(e?l10n.t("action_chat_archiving"):l10n.t("action_chat_unarchiving"));t=t||U.genId();var r=a.then(function(i){var a=void 0;return 200===i.status?(a=e?l10n.t("action_chat_archived"):l10n.t("action_chat_unarchived"),new G(a,l10n.t("action_undo"),n.setArchive.bind(n,!e,t))):i.status>=400?new G(e?l10n.t("action_chat_archive_failed"):l10n.t("action_chat_unarchive_failed")):void 0})["catch"](function(i){C.error("models:chat:setArchive dropped")(i);var a=e?l10n.t("action_chat_archive_failed"):l10n.t("action_chat_unarchive_failed");return new G(a,l10n.t("action_try_again"),n.setArchive.bind(n,e,t))});return x.openToast(E.createElement(U,{id:t,initialAction:s,pendingAction:r})),this.promises.setArchive=a.bind(this).then(function(t){200!==t.status||t._duplicate||(this.archive=e)})["finally"](function(){n.promises.setArchive=null})},canArchive:function(){return this.isBroadcast?N.supportsFeature(N.F.ARCHIVE_BROADCAST):N.supportsFeature(N.F.ARCHIVE)},sendSeen:function(){if(this.markedUnread||0===this.unreadCount)return l["default"].resolve();if(!m["default"].available)return this.listenTo(m["default"],"change:available",this.sendSeen),l["default"].resolve();this.stopListening(m["default"],"change:available",this.sendSeen);var e=this.unreadCount-this.pendingSeenCount,t=this.unreadCount===-1&&e===-1;if(e<=0&&!t)return l["default"].resolve();this.disableUnreadAnchor=!0,this.pendingSeenCount=this.unreadCount;var n=this,i=function(){n.pendingSeenCount=n.pendingSeenCount-e,n.pendingSeenCount<0&&(C.error("models:chat:sendSeen unread "+n.unreadCount+" pending: "+n.pendingSeenCount+" delta: "+e)(),n.pendingSeenCount=0)},a=this.lastReceivedKey;return N.gte([0,4])?D.sendConversationSeen(this.id,a,e).bind(this).then(function(t){return i(),200!==t.status||t._duplicate||this.markSeen(e),t})["catch"](I.WapDrop,function(e){i(),C.error("models:chat:sendConversationSeen dropped")()}):(i(),this.markSeen(e),D.sendConversationSeen(this.id,a,e).bind(this).then(function(e){return e})["catch"](I.WapDrop,function(e){C.error("models:chat:sendConversationSeen dropped")()}))},markSeen:function(e){e&&"number"==typeof e?e>0&&e<=this.unreadCount?this.unreadCount=this.unreadCount-e:e===-1&&this.unreadCount<=0&&(this.unreadCount=0):this.unreadCount=0,this.unreadMsgAnchor=void 0,this.markedUnread=!1},markUnread:function(e,t){var n=this;if(e?this.active&&(this.markedUnread=!0):this.markedUnread=!1,this.promises.markUnread)return this.promises.markUnread;this.promises.markUnread=e?this.sendUnseen():this.sendSeen();var i=new G(e?l10n.t("action_chat_marking_unread"):l10n.t("action_chat_marking_read"));t=t||U.genId();var a=this.promises.markUnread.then(function(i){if(200===i.status){var a=e?l10n.t("action_chat_marked_unread"):l10n.t("action_chat_marked_read");return new G(a,l10n.t("action_undo"),n.markUnread.bind(n,!e,t))}if(i.status>=400)return new G(e?l10n.t("action_chat_mark_unread_failed"):l10n.t("action_chat_mark_read_failed"))})["catch"](function(i){var a=e?l10n.t("action_chat_mark_unread_failed"):l10n.t("action_chat_mark_read_failed");return new G(a,l10n.t("action_try_again"),n.markUnread.bind(n,e,t))});return x.openToast(E.createElement(U,{id:t,initialAction:i,pendingAction:a})),this.promises.markUnread["finally"](function(){n.promises.markUnread=null})},canMarkUnseen:function(){return N.supportsFeature(N.F.CHAT_MARK_UNSEEN)},sendUnseen:function(){var e=this,t=this.msgs.last(),n=t?t.id:void 0;return D.sendConversationUnseen(this.id,n).then(function(t){return 200===t.status?e.markUnseen():e.markedUnread=!1,t})},markUnseen:function(){this.active&&(this.markedUnread=!0),this.unreadCount=-1},markRecording:function(){if((this.presence.isOnline||this.isGroup)&&!this.recording){var e=this.id;D.sendChatstateRecording(e).then(function(t){t.status>=400&&C.error("models:chat send presence recording error "+e)()})["catch"](I.WapDrop,_.noop),this.presenceResendTimerId=_.delay(this._resendPresence.bind(this),b.PRESENCE_RESEND_WAIT)}this.pausedTimerId&&(clearTimeout(this.pausedTimerId),this.unset("pausedTimerId")),this.recording=!0,this.typing=!1},markComposing:function(){if((this.presence.isOnline||this.isGroup)&&!this.typing){var e=this.id;D.sendChatstateComposing(e).then(function(t){t.status>=400&&C.error("models:chat send presence composing error "+e)()})["catch"](I.WapDrop,_.noop),this.presenceResendTimerId=_.delay(this._resendPresence.bind(this),b.PRESENCE_RESEND_WAIT)}this.typing=!0,this.pausedTimerId&&clearTimeout(this.pausedTimerId),this.pausedTimerId=_.delay(this.markPaused.bind(this),b.SEND_PAUSED_WAIT)},markPaused:function(){if((this.presence.isOnline||this.isGroup)&&(this.typing||this.recording)){var e=this.id;D.sendChatstatePaused(e).then(function(t){t.status>=400&&C.error("models:chat send presence paused error "+e)()})["catch"](I.WapDrop,_.noop)}this.presenceResendTimerId&&(clearTimeout(this.presenceResendTimerId),this.unset("presenceResendTimerId")),this.pausedTimerId&&(clearTimeout(this.pausedTimerId),this.unset("pausedTimerId")),this.typing=this.recording=!1},_resendPresence:function(){var e=this.id;if(this.recording)D.sendChatstateRecording(e).then(function(t){t.status>=400&&C.error("models:chat send presence resend recording error "+e)()})["catch"](I.WapDrop,_.noop);else{if(!this.typing)return void this.unset("presenceResendTimerId");D.sendChatstateComposing(e).then(function(t){t.status>=400&&C.error("models:chat send presence resend composing error "+e)()})["catch"](I.WapDrop,_.noop)}this.presenceResendTimerId=_.delay(this._resendPresence.bind(this),b.PRESENCE_RESEND_WAIT)},_messageSent:function(){this.presenceResendTimerId&&(clearTimeout(this.presenceResendTimerId),this.unset("presenceResendTimerId")),this.pausedTimerId&&(clearTimeout(this.pausedTimerId),this.unset("pausedTimerId")),this.typing=!1},_presenceOnlineChanged:function(){this.presence.isOnline?this._resendPresence():this.presenceResendTimerId&&(clearTimeout(this.presenceResendTimerId),this.unset("presenceResendTimerId"))},handleGroupAction:function(e,t,n){var i;switch(e){case"subject":return void(this.contact.name=n.subject);case"add":case"promote":case"demote":var a="promote"===e;return i=_.map(n.participants,function(e){return{id:e,isAdmin:a}}),void this.groupMetadata.participants.add(i,{merge:!0});case"remove":return i=this.groupMetadata.participants,void _.each(n.participants,function(e){i.remove(e)});case"modify":return;default:return}},setComposeContents:function(e){this.composeContents=e},preload:function(){1===this.msgs.length&&this.loadEarlierMsgs()["catch"](I.E404,_.noop)["catch"](function(e){C.log("chat:preload failed")(),C.log(e)()})},onEmptyMRM:function(){C.log("models:Chat:removeMsg 0 messages left, querying...")(),this.loadEarlierMsgs()["catch"](I.E404,_.noop)["catch"](function(e){C.log("chat:onEmptyMRM failed")(),C.log(e)()})},loadEarlierMsgs:function(e){return e||(e=this.msgs),e.msgLoadState.noEarlierMsgs?l["default"].resolve():e.msgLoadState.isLoadingEarlierMsgs?e.loadEarlierPromise:this._loadMsgs("before",e).then(function(t){return _.isArray(t)&&t.length<b.PAGE_SIZE&&(e.msgLoadState.noEarlierMsgs=!0),t})},isMostRecentCMC:function(e){return this.msgs===e},loadRecentMsgs:function(e){return e||(e=this.msgs),this.isMostRecentCMC(e)?l["default"].resolve():e.msgLoadState.isLoadingRecentMsgs?e.loadRecentPromise:this._loadMsgs("after",e)},_loadMsgs:function(e,t){var n;n="after"===e?t.last():t.head();var i={};return n?i=n.id.clone():i.remote=this.id,i.count=b.PAGE_SIZE,i.direction=e,this._loadMsgsPromise(n,t,Store.Msg.findQuery(i),e)},_loadMsgsPromise:function(e,t,n,i){"after"===i?t.msgLoadState.isLoadingRecentMsgs=!0:"before"===i?t.msgLoadState.isLoadingEarlierMsgs=!0:"around"===i&&(t.msgLoadState.isLoadingAroundMsgs=!0);var a=this.regCancellablePromise(n)["finally"](function(){var n=e&&e.msgChunk!==t;t.msgLoadState.contextLoaded=!0,n&&(e.msgChunk.msgLoadState.contextLoaded=!0),"after"===i?t.msgLoadState.isLoadingRecentMsgs=!1:"before"===i?t.msgLoadState.isLoadingEarlierMsgs=!1:"around"===i&&(t.msgLoadState.isLoadingAroundMsgs=!1)})["catch"](function(e){return C.error("chat:loadMsgs:error "+e)(),404===e?l["default"].reject(new I.E404):l["default"].reject(e)});return"after"===i?t.loadRecentPromise=a:"before"===i?t.loadEarlierPromise=a:"around"===i&&(t.loadAroundPromise=a),a},getSearchContext:function(e,t){var n=this,i=void 0,a=void 0;e instanceof u["default"]?i=e:e instanceof A&&(a=e);var s=i?i.msgChunk:void 0,o=(0,r["default"])(b.PAGE_SIZE/3*2);if(!s||!s.msgLoadState.contextLoaded){s||(s=new S,this.msgChunks.push(s),i&&s.add(i));var l=i?i.id.clone():a.clone();l.count=o;var c=function(){if(i)return i.msgChunk;var e=Store.Msg.get(a);return e&&e.msgChunk?e.msgChunk:s};this._loadMsgsPromise(i,s,Store.Msg.getContext(l,c),"around").then(function(e){var t=c();t!==s&&n.notifyMsgCollectionMerge(t,s,t);var r=e[0],l=a?Store.Msg.get(a):i;l&&_.isArray(r)&&r.length<o&&(l.msgChunk.msgLoadState.noEarlierMsgs=!0,l.msgChunk!==s&&(s.msgLoadState.noEarlierMsgs=!0))})["catch"](function(){t&&(t.isQuotedMsgAvailable=!1)})}return{collection:s,msg:i,key:a,highlightMsg:!0}},sendStarMsgs:function(e,t,n){var i=this;if(!e)return l["default"].reject(new I.ActionError);if(_.some(e,function(e){return!e.id}))return l["default"].reject(new I.ActionError);if(this.promises.sendStarMsgs)return this.promises.sendStarMsgs;this.promises.sendStarMsgs=D.sendMessageStarred(this.id,_.map(e,function(e){return e.id}),t);var a=_.size(e),s={count:a,_plural:a},r=new G(t?l10n.t("action_message_starring",s):l10n.t("action_message_unstarring",s));n=n||U.genId();var o=this.promises.sendStarMsgs.then(function(a){if(200===a.status){var r=t?l10n.t("action_message_starred",s):l10n.t("action_message_unstarred",s);return new G(r,l10n.t("action_undo"),i.sendStarMsgs.bind(i,e,!t,n))}if(a.status>=400)return new G(t?l10n.t("action_message_star_failed",s):l10n.t("action_message_unstar_failed",s))})["catch"](function(a){C.error("models:chat:sendStarMsgs dropped")(a);var r=t?l10n.t("action_message_star_failed",s):l10n.t("action_message_unstar_failed",s);return new G(r,l10n.t("action_try_again"),i.sendStarMsgs.bind(i,e,t,n))});return x.openToast(E.createElement(U,{id:n,initialAction:r,pendingAction:o})),this.promises.sendStarMsgs.then(function(n){200===n.status&&(_.forEach(e,function(e){e.set("star",t)}),t?Store.AllStarredMsgs.add(e):Store.AllStarredMsgs.remove(e))})["finally"](function(){i.promises.sendStarMsgs=null})},sendNotSpam:function(e,t){var n=this;if(!N.supportsFeature(N.F.SPAM))return l["default"].resolve();if(this.notSpam)return l["default"].resolve();if(this.notSpam=!0,this.promises.sendNotSpam)return this.promises.sendNotSpam;if(this.promises.sendNotSpam=D.sendConversationNotSpam(this.id),e){var i=new G(l10n.t("action_mark_as_not_spam"));t=t||U.genId();var a=this.promises.sendNotSpam.then(function(e){return 200===e.status?new G(l10n.t("action_marked_as_not_spam")):e.status>=400?new G(l10n.t("action_mark_as_not_spam_failed")):void 0})["catch"](function(i){return C.error("models:chat:sendNotSpam dropped")(i),new G(l10n.t("action_mark_as_not_spam_failed"),l10n.t("action_try_again"),n.sendNotSpam(e,t))});x.openToast(E.createElement(U,{id:t,initialAction:i,pendingAction:a}))}return this.promises.sendNotSpam["finally"](function(){n.promises.sendNotSpam=null})},sendSpamReport:function(e){var t=this;if(this.promises.sendSpamReport)return this.promises.sendSpamReport;this.promises.sendSpamReport=D.sendSpamReport(this.id);var n=new G(l10n.t("action_spam_report"));
e=e||U.genId();var i=this.promises.sendSpamReport.then(function(e){return 200===e.status?new G(l10n.t("action_spam_reported")):e.status>=400?new G(l10n.t("action_spam_report_failed")):void 0})["catch"](function(n){return C.error("models:chat:sendSpamReport dropped")(n),new G(l10n.t("action_spam_report_failed"),l10n.t("action_try_again"),t.sendSpamReport.bind(t,e))});return x.openToast(E.createElement(U,{id:e,initialAction:n,pendingAction:i})),this.promises.sendSpamReport["finally"](function(){t.promises.sendSpamReport=null})},sendDeleteMsgs:function(e,t){var n=this;if(!e)return l["default"].reject(new I.ActionError);if(_.some(e,function(e){return!e.id}))return l["default"].reject(new I.ActionError);if(this.promises.sendDeleteMsgs)return this.promises.sendDeleteMsgs;this.promises.sendDeleteMsgs=D.sendMessageDelete(this.id,_.map(e,function(e){return e.id}),!0);var i=_.size(e),a={count:i,_plural:i},s=new G(l10n.t("action_message_deleting",a));t=t||U.genId();var r=this.promises.sendDeleteMsgs.then(function(e){return 200===e.status?new G(l10n.t("action_message_deleted",a)):e.status>=400?new G(l10n.t("action_message_delete_failed",a)):void 0})["catch"](function(i){return C.error("models:chat:sendDeleteMsgs dropped")(i),new G(l10n.t("action_message_delete_failed",a),l10n.t("action_try_again"),n.sendDeleteMsgs.bind(n,e,t))});return x.openToast(E.createElement(U,{id:t,initialAction:s,pendingAction:r})),this.promises.sendDeleteMsgs.then(function(t){200===t.status&&_.forEach(e,function(e){e["delete"]()})})["finally"](function(){n.promises.sendDeleteMsgs=null})},deleteMsgs:function(e,t){var n=this;this.getAllCMCs().forEach(function(i){i.filter(function(e){return!t||a(e,t)}).filter(function(t){return(e||!t.star)&&!t.isPersistent}).forEach(function(e){e["delete"]()}),0===i.length&&i!==n.msgs&&n.removeMsgsCollection(i)}),this.unreadCount=0},deleteMsgsOlderThan:function(e,t,n){var i=this.msgs,s=_.head(i.models);if(s&&!(s.t>=e)){if(s=_.last(i.models),s.t<e)return void this.deleteMsgs(t,n);var r=function(i){return i&&(n&&!a(i,n)||i.star&&!t||i.t>=e||i.isPersistent)};this.deleteMsgsPartial(r)}},deleteMsgsBeforeMsgInclusive:function(e,t){if(e&&this.msgs.get(e.id)){var n=this.msgs.indexOf(e),i=function(e,i){return e.msgChunk===this.msgs&&i>n||t&&e.star||e.isPersistent};this.deleteMsgsPartial(i)}},deleteMsgsPartial:function(e){var t=this,n=this.unreadCount,i=_.flatten(this.getAllCMCs().map(function(n){return n.filter(function(n,i,a){return!e.apply(t,[n,i,a])})}));if(i.forEach(function(e){e["delete"]()}),_.clone(this.msgChunks).forEach(function(e){0===e.length&&t.removeMsgsCollection(e)}),this.msgs.length>0){var a=n>this.msgs.length?this.msgs.length:n;this.unreadCount=a,this.msgs.msgLoadState.noEarlierMsgs=!0}},getFirstMsgWithStatus:function(){return _.find(this.msgs.models,function(e){return!e.isNotification&&(e.isSentByMe||e.type===u["default"].TYPE.PTT)})},getFirstMsgFromMe:function(){return _.find(this.msgs.models,function(e){return!e.isNotification&&e.isSentByMe})},getLastReceivedMsg:function(){for(var e=this.msgs.length-1;e>=0;e--){var t=this.msgs.at(e);if(t&&(!t.local||t.ack>0))return t}},getLastTimestampMsg:function(){for(var e=this.msgs.length-1;e>=0;e--){var t=this.msgs.at(e);if(t&&"i"!==t.eventTypeFromMsgType())return t}},createMessageFromText:function(e){if(e=_.trim(e),""===e)return null;var t=this.id,n=Store.Conn.me,i=new A({from:n,to:t,id:u["default"].newTag(),participant:void 0,selfDir:"out"}),a={id:i,body:e,type:"chat",subtype:null,t:R.globalUnixTime(),from:n,to:t,self:"out",local:!0,ack:0};return new u["default"](a)},sendMessage:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],n=arguments[2],i=arguments[3];if(e=_.trim(e),""===e)return l["default"].resolve();this._messageSent();var a=this.id,s=Store.Conn.me,r=new A({from:s,to:a,id:u["default"].newTag(),participant:void 0,selfDir:"out"}),o=n&&n.contextInfo(this.id),c=_.defaults({id:r,body:e,type:"chat",subtype:t&&!_.isEmpty(t)?"url":null,t:R.globalUnixTime(),from:s,to:a,self:"out",local:!0,ack:0},t,o,{mentionedJidList:i}),d=new u["default"](c),p=Store.Msg.send(d);return this.msgs.add(d),p},sendContact:function(e){var t=j.cleanValue(e.formattedName),n="BEGIN:VCARD\nVERSION:3.0\nN:"+j.getName(e)+"\nFN:"+t+"\nTEL;type=CELL;waid="+e.userid+":"+L.formattedUser(e.userid)+"\nEND:VCARD",i={ack:0,body:n,from:Store.Conn.me,id:new A({from:Store.Conn.me,to:this.id,id:u["default"].newTag(),participant:void 0,selfDir:"out"}),local:!0,self:"out",subtype:e.formattedName,t:R.globalUnixTime(),to:this.id,type:"vcard",isNewMsg:!0};this.addAndSendMsg(i)},forwardMessages:function(e){var t=this,n=this.id,i=this.contact;if(i.isUser&&i.isBlocked())return l["default"].reject(new I.ContactBlocked("Forwarded to contact is blocked",i));var a=[];return l["default"].each(e,function(e){if(e.isMMS)return(0,d.forwardMediaMsg)(e,t);var i=_.omit(e.toJSON(),"quotedMsg"),a=new A({from:Store.Conn.me,to:n,id:u["default"].newTag(),participant:void 0,selfDir:"out"});return _.assign(i,{id:a,from:Store.Conn.me,t:R.globalUnixTime(),to:n,ack:0,participant:void 0,local:!0,self:"out",isNewMsg:!0,star:!1}),t.addAndSendMsg(i)})["return"](a)},updateReadOnly:function(){this.isGroup&&!this.groupMetadata.stale&&(this.isReadOnly=!this.groupMetadata.participants.get(Store.Conn.me)),this.isBroadcast&&this.updateTitle()},sortMsgs:function(e){var t=_.map(e,function(e){var t=e.msgChunk;return{msg:e,chunkT:t.models[0].t,index:t.indexOf(e)}});return _(t).orderBy(["chunkT","index"]).map("msg").value()},_updateAssignedColor:function(){if(this.colors){var e=this.groupMetadata.participants;if(0!==e.size){var t=this.colors,n=_.difference(_.keys(t),e.map("id").map(F));n.forEach(function(e){delete t[e]}),n.length&&this._saveAssignedColors()}}},loadAssignedColors:function(){return this.groupMetadata&&this.listenTo(this.groupMetadata.participants,"remove reset",this._updateAssignedColor),O.getGroupParticipantAssignedColor(this.id)||{}},saveAssignedColors:function(){var e=this.colors;e&&O.setGroupParticipantAssignedColor(this.id,e)},assignedColor:function(e){var t,n=this,i=this.colors||(this.colors=this.loadAssignedColors()),a=F(e);if(t=i[a])return t;var s=function(){var e={};_.forEach(i,function(t,n){e[t]?e[t].push(n):e[t]=[n]});for(var s=Number.POSITIVE_INFINITY,r=1;r<b.NUM_COLORS;r++){if(!e[r]){t=r;break}e[r].length<s&&(s=e[r].length,t=r)}return i[a]=t,n._saveAssignedColors(),{v:t}}();return"object"==typeof s?s.v:void 0},setSubject:function(){var e=this,t=arguments.length<=0||void 0===arguments[0]?"":arguments[0],n=arguments[1];if(t=t.trim(),!t)return l["default"].reject(new I.ActionError);if(t===this.contact.name)return l["default"].reject(new I.ActionError);var i=D.changeSubject(this.id,t),a=this.contact.name,s=new G(l10n.t("action_group_renaming"));n=n||U.genId();var r=i.then(function(i){return 200===i.status?new G(l10n.t("action_group_renamed",{subject:t}),l10n.t("action_undo"),e.setSubject.bind(e,a,n)):i.status>=400?new G(l10n.t("action_group_rename_failed")):void 0})["catch"](function(i){return C.error("models:chat:setSubject dropped")(i),new G(l10n.t("action_group_rename_failed"),l10n.t("action_try_again"),e.setSubject.bind(e,t,n))});return x.openToast(E.createElement(U,{id:n,initialAction:s,pendingAction:r})),i.then(function(n){200!==n.status||n._duplicate||(e.contact.name=t)})},unstarAll:function(){this.getAllMsgs().forEach(function(e){e&&(e.star=!1)}),Store.AllStarredMsgs.remove(this.getAllMsgs())},constructMediaMsgs:function(e){if(!e)return this.getMediaMsgs();var t=void 0;return this.getMediaMsgs().contains(e)||e.msgChunk===this.msgs?(t=this.getMediaMsgs(),t.hasMediaAfter=!1):t=new T,t.contains(e)||(e.msgChunk?t.add(e.msgChunk.filter(function(e){return e.isMedia})):t.add(e)),t},fts:function(e){var t=this,n=arguments.length<=1||void 0===arguments[1]?1:arguments[1],i=arguments[2];if(1===n){var a=this.ftsCache[e];if(a)return a;var s=Store.Msg.search(e,n,i,this.id);this.ftsCache[e]=s;var r=function(){t.ftsCache[e]=null};return _.delay(r,B),s["catch"](r),s}return Store.Msg.search(e,n,i,this.id)},_clearFtsCache:function(){this.ftsCache={}},updateSortTime:function(){var e=this;this.promises.updateSortTime||(this.promises.updateSortTime=this.regCancellablePromise(l["default"].delay(0)).then(function(){var t=e.getLastTimestampMsg();return t?(e.t=t.t,l["default"].resolve()):e.msgs.msgLoadState.noEarlierMsgs?(e.t=void 0,l["default"].resolve()):e.pendingMsgs?l["default"].resolve():e.loadEarlierMsgs()}).then(function(t){if(t){var n=e.getLastTimestampMsg();e.t=n?n.t:void 0}})["catch"](_.noop)["finally"](function(){e.promises.updateSortTime=void 0}))},removeFromCollection:function(e){e.star&&this.starredMsgs&&this.starredMsgs.remove(e),e.isMedia&&this.mediaMsgs?this.mediaMsgs.remove(e):e.hasLink&&this.linkMsgs?this.linkMsgs.remove(e):e.isDoc&&this.docMsgs&&this.docMsgs.remove(e)},getMediaMsgs:function(){return this.mediaMsgs||(this.mediaMsgs=new T),this.mediaMsgs},getLinkMsgs:function(){return this.linkMsgs||(this.linkMsgs=new w),this.linkMsgs},getDocMsgs:function(){return this.docMsgs||(this.docMsgs=new k),this.docMsgs},getStarredMsgs:function(){var e=this;return this.starredMsgs||(this.starredMsgs=new P,this.starredMsgs.parent=this,this.starredMsgs.add(Store.AllStarredMsgs.filter(function(t){return t.chat===e}))),this.starredMsgs}},H=(0,y.genMirrorMask)(q),z=M.extend(q,{mirrorMask:H});z.KIND=V,t["default"]=z;t.ChatProxy=(0,v["default"])(q,H)},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){var n=arguments.length<=2||void 0===arguments[2]?{found:!1}:arguments[2];if(e===t)return n.found=!0,"";if(e instanceof HTMLImageElement)return e.alt;if(e.nodeType===Node.TEXT_NODE)return e.nodeValue;for(var i=O.formatDelim(e)||"",s="",r=0;r<e.childNodes.length&&(s+=a(e.childNodes[r],t,n),!n.found);)r++;return i?""+i+s+i:s}function s(e,t,n,i,a,r){if(i<n)return-1;var o,l=Math.round((n+i)/2),c=e[l],u=c.offsetLeft-a;if(u>=t)o=r;else{if(u+c.clientWidth>t)return l;o=!r}return o?s(e,t,n,l-1,a,r):s(e,t,l+1,i,a,r)}function r(e,t){for(var n=0,i=e.childNodes,a=0;a<i.length;a++){var s=i[a];if(s===t)break;n+=s.clientWidth}return n}var o=n(234),l=i(o),c=n(8),u=n(44),d=n(159),p=n(58),h=n(154),f=n(153),m=n(94),g=n(156),v=n(43),y=n(1267),E=n(75),b=n(489),C=n(1665),M=n(468),S=n(1483),T=n(474),w=n(475),k=n(477),P=n(478),N=n(1484),x=n(476),D=n(1667),O=n(1409),R=4096,I={SMALL:"small",LARGE:"large"},A=c.createClass({displayName:"EmojiText",mixins:[m,f,h,g,y],statics:{EMOJI_SIZE:I},propTypes:{text:c.PropTypes.string,highlight:c.PropTypes.array,highlightBounary:c.PropTypes.bool,mention:c.PropTypes.object,emojiSize:c.PropTypes.oneOf(_.values(I)),element:c.PropTypes.string,className:c.PropTypes.oneOfType([c.PropTypes.string,c.PropTypes.arrayOf(c.PropTypes.string),c.PropTypes.objectOf(c.PropTypes.bool)]),direction:c.PropTypes.string,linkify:c.PropTypes.bool,titlify:c.PropTypes.bool,ellipsify:c.PropTypes.bool,selectable:c.PropTypes.bool,format:c.PropTypes.bool,wbr:c.PropTypes.number,dirMismatch:c.PropTypes.bool,noMentionClick:c.PropTypes.bool},getInitialState:function(){var e=this.props.text;return this.debouncedRecompute=this.safeDebounce(this.recompute,20),this.reged=!1,{ellipsified:null,text:d.removeFEOF(e)}},getDefaultProps:function(){return{emojiSize:I.SMALL,element:"span",noMentionClick:!1}},componentWillMount:function(){p.isWebkit&&this.props.ellipsify&&this.containsEmoji()&&this.regResizeListener()},componentWillReceiveProps:function(e){var t=d.removeFEOF(e.text);if(p.isWebkit&&this.props.ellipsify&&t!==this.state.text){var n=(t||"").substring(0,R);d.containsEmoji(n)?(this.recompute(),this.regResizeListener()):(this.setState({ellipsified:null}),this.unregResizeListener())}this.setState({text:t})},containsEmoji:function(){var e=(this.state.text||"").substring(0,R);return d.containsEmoji(e)},regResizeListener:function(){this.reged||(this.regNativeListener(window,"resize",this.debouncedRecompute),this.regCmd("resize",this.debouncedRecompute),this.reged=!0)},unregResizeListener:function(){this.reged&&(this.unregNativeListener(window,"resize",this.debouncedRecompute),this.unregCmd("resize",this.debouncedRecompute),this.reged=!1)},recompute:function(){this.setState({ellipsified:null},this.ellipsify)},ellipsifyCheck:function(){this.isMounted()&&this.containsEmoji()&&this.ellipsify()},componentDidMount:function(){p.isWebkit&&this.props.ellipsify&&this.uiIdle(this.ellipsifyCheck)},ellipsify:function(){var e=u.findDOMNode(this);if(e){var t=e.querySelectorAll("img");if(0!==t.length){var n,i=0;if(n=e.clientWidth){if(n===e.scrollWidth)return;i=0}else{var o=e.parentNode;if(i=r(o,e),n=o.clientWidth-i,o.clientWidth===o.scrollWidth)return}var l=l10n.isRTL()===this.props.dirMismatch,c=s(t,l?n:0,0,t.length-1,l?i:0,l);if(!(c<0)){var d=t[c],p=10;p-=Math.floor(p/4);var h=s(t,l?n-p:p,0,c,l?i:0,l);h>-1&&(d=t[h]),this.setState({ellipsified:a(e,d)})}}}},render:function(){if(!this.state.text)return null;var e=this.state.ellipsified;e||(e=this.props.ellipsify?(this.state.text||"").substring(0,R):this.state.text);var t=this.props.selectable?"selectable-text":void 0,n=new l["default"];n.set("default",{className:t}),n.set(S,{size:this.props.emojiSize}),n.set("mentionUseOnClick",!this.props.noMentionClick);var i=[],a=E.supportsFeature(E.F.RICH_TEXT)&&this.props.format;a&&i.push(new M),this.props.linkify&&i.push(new w),a&&(i.push(new P),i.push(new T),i.push(new k)),this.props.wbr&&i.push(new C(this.props.wbr)),i.push(new S);var s=this.props.highlight;s&&s.length>0&&i.push(new N(s,this.props.highlightBounary)),this.props.mention&&i.push(new x(this.props.mention));var r=b.parse(e,i),o=b.serialize(r,new D(n)),u=v(this.props.className,{emojitext:!this.props.className,ellipsify:this.props.ellipsify,"inverse-text-direction":this.props.dirMismatch,"selectable-text":this.props.selectable}),d={className:u,dir:this.props.direction};this.props.titlify&&(d.title=this.state.text);var p=this.props.element;return c.createElement(p,d,o,this.state.ellipsified?"…":null)}});e.exports=A},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(21),s=i(a),r=n(114),o=i(r),l=n(230),c=i(l),u=n(479),d=i(u),p=n(47),h=i(p),f=n(1),m=n(12),g=n(10),v=n(23),y={async:function(e,t){var n=e.split(".").slice(-1),i=(0,h["default"])(n,1),a=i[0];return this._asyncKey(a,e,t)},asyncState:function(e,t){var n=this,i=v.mapValues(e,function(e,t){return n._asyncKey(t,e)});for(var a in t)void 0===i[a]&&(i[a]=t[a]);return i},_asyncKey:function(e,t){var n=arguments.length<=2||void 0===arguments[2]?this.props:arguments[2],i=t.split("."),a=this._getAsyncIndex(i),s=i.slice(0,a),r=(0,d["default"])(s),o=r[0],l=r.slice(1),c=i.slice(a+1),u=n[i[0]];return a&&(u=this._getObservable(e,o,l,n,i[a])),u?v.isFunction(u.on)||v.isFunction(u.off)?this._asyncObserver(e,i,l,u,c):f.trace("asyncMixin path resolved to non-observable: "+t):f.trace("asyncMixin path resolved to nonexistent state! path: "+t)},_getObservable:function(e,t,n,i,a){var s=n.length?i[t].getp(n):i[t];return s?Store[a].get(s):null},_asyncObserver:function(e,t,n,i,a){var s=this;i.stale&&this._loadStale(i);var r="change:"+a.join("."),o=function(){return s.setOrQueueState((0,c["default"])({},e,i.getp(a)))};return i.on(r,o),i.isState&&i._uiObservers++,this._asyncs=this._asyncs||{},this._asyncs[e]={key:e,splitPath:t,basePath:n,observable:i,callback:o,eventKey:r},i.getp(a)},_loadStale:function(e){var t=this;g.uiBusy?!function(){var n=t._waAsyncIdle||(t._waAsyncIdle=[]),i=function a(){e.getCollection().find(e.id)["catch"](m.WapDrop,v.noop),t._waAsyncIdle&&(v.pull(t._waAsyncIdle,a),0===t._waAsyncIdle.length&&(t._waAsyncIdle=null))};g.once("ui_idle",i),n.push(i)}():e.getCollection().find(e.id)["catch"](m.WapDrop,v.noop)},componentWillMount:function(){this.__willMount=!0,this.__stateQueue&&(this.setState(v.assign.apply(v,[{}].concat((0,o["default"])(this.__stateQueue)))),this.__stateQueue=void 0)},setOrQueueState:function(e){this.__willMount?this.setState(e):(this.__stateQueue=this.__stateQueue||[],this.__stateQueue.push(e))},_observersMatch:function(e,t,n,i){return n[e]===i[e]&&(!t.length||n[e].getp(t)===i[e].getp(t))},componentWillReceiveProps:function(e){var t=this;if(this._asyncs){var n={};v.forIn(this._asyncs,function(i,a){var s=i.splitPath,r=i.basePath,o=(0,h["default"])(s,1),l=o[0];if(!t._observersMatch(l,r,t.props,e)){var c=i.observable,u=i.callback,d=i.eventKey;c.off(d,u),c.isState&&c._uiObservers--,n[a]=t._asyncKey(a,s.join("."),e)}}),(0,s["default"])(n).length&&this.setOrQueueState(n)}},componentWillUnmount:function(){this._waAsyncUnmount=!0,this._waAsyncIdle&&v.forIn(this._waAsyncIdle,function(e){g.off("ui_idle",e)}),this._asyncs&&v.forIn(this._asyncs,function(e){var t=e.observable,n=e.callback,i=e.eventKey;t.off(i,n),t.isState&&t._uiObservers--})},_getAsyncIndex:function(e){for(var t=1;t<e.length;++t)if(e[t].charAt(0).toLowerCase()!==e[t].charAt(0))return t;return 0}};e.exports=y},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e){if(e.dataTransfer){try{if(!e.dataTransfer.dropEffect)return}catch(e){return}e.dataTransfer.effectAllowed&&(e.nativeEvent.dataTransfer.dropEffect="copy")}}var s=n(230),r=i(s),o=n(8),l=n(43),c={LEFT:"left",MID:"mid",RIGHT:"right"},u=o.createClass({displayName:"Drawer",propTypes:{children:o.PropTypes.node.isRequired,id:o.PropTypes.string,variant:o.PropTypes.string,noContainer:o.PropTypes.bool,position:o.PropTypes.oneOf(_.values(c)),onDragLeave:o.PropTypes.func,onDrop:o.PropTypes.func,onDragOver:o.PropTypes.func},getDefaultProps:function(){return{position:"left"}},statics:{RIGHT:"right",LEFT:"left",MID:"mid"},getInitialState:function(){return{isDragging:!1}},isDragDropDrawer:function(){return this.props.onDragOver&&this.props.onDragLeave&&this.props.onDrop},onDragOver:function(e){e.preventDefault(),this.isDragDropDrawer()&&(a(e),this.state.isDragging||(this.props.onDragOver(e),this.setState({isDragging:!0})))},onDrop:function(e){e.preventDefault(),e.stopPropagation(),this.setState({isDragging:!1}),this.props.onDrop(e)},onDragLeave:function(e){e.preventDefault(),e.stopPropagation(),this.state.isDragging&&(this.setState({isDragging:!1}),this.props.onDragLeave(e))},render:function(){var e,t=this.props,n=l(this.props.className,"drawer",(0,r["default"])({},"drawer-"+t.id,!!t.id));if(this.isDragDropDrawer()){var i=this.state.isDragging?{}:{display:"none"};e=o.createElement("div",{key:"mask",className:"drag-drop-mask",style:i,onDragLeave:this.onDragLeave,onDrop:this.onDrop})}return o.createElement("div",{className:n,onDragOver:this.onDragOver},e,t.children)}});u.Position=c,e.exports=u},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(158),s=i(a),r=n(160),o=i(r),l=n(8),c=n(43),u=l.createClass({displayName:"DrawerBody",propTypes:{classes:l.PropTypes.string,info:l.PropTypes.bool,wide:l.PropTypes.bool},getDefaultProps:function(){return{info:!1,wide:!1}},render:function(){var e=this.props,t=e.classes,n=e.info,i=e.wide,a=(0,o["default"])(e,["classes","info","wide"]),r=c("drawer-body",t,{"drawer-body-info":n,"drawer-body-wide":i});return l.createElement("div",(0,s["default"])({className:r},a),this.props.children)}});e.exports=u},function(e,t,n){"use strict";var i=n(8),a=n(458),s=n(43),r=n(1393),o=r.MenuBar,l=n(109),c={SMALL:"small",LARGE:"large",POPUP:"popup",OFFSET:"offset"},u=i.createClass({displayName:"DrawerHeader",propTypes:{children:i.PropTypes.node,title:i.PropTypes.string,onBack:i.PropTypes.func,onCancel:i.PropTypes.func,a8n:i.PropTypes.string,type:i.PropTypes.oneOf(_.values(c)).isRequired,menu:i.PropTypes.element},render:function(){var e=this.props,t=e.title,n=e.onBack,r=e.onCancel,u=e.type,d=e.children,p=null;if(t){var h=void 0,f=null,m={textAlign:"initial"};u===c.SMALL?(h={fontWeight:400,fontSize:16,lineHeight:"21px"},m.width=54):u===c.LARGE?(h={fontWeight:500,fontSize:19,lineHeight:"normal"},f={backgroundColor:"transparent",padding:"0px"},m.width=54):(h={fontWeight:500,fontSize:19,lineHeight:"19px"},m.width=48,m.opacity=.7);var g=s("icon btn-close-drawer",{"icon-back":u===c.SMALL,"icon-back-light":u!==c.SMALL}),v=n?i.createElement("span",{className:g,"data-a8n":a.key("btn-closer-drawer"),onClick:n}):null,y=s("icon btn-close-drawer",{"icon-x":u===c.SMALL,"icon-x-light":u!==c.SMALL}),E=r?i.createElement("span",{className:y,"data-a8n":a.key("btn-closer-drawer"),onClick:r}):null,_=s({"pane-header":u===c.LARGE},"drawer-title"),b=this.props.menu?i.createElement("span",{className:"pane-list-controls"},i.createElement(o,{key:"drawer-header"},i.createElement(l,{transitionName:"btn"},this.props.menu))):null;p=i.createElement("div",{className:_,style:f},i.createElement("div",{style:m,className:"drawer-title-action"},v,E),i.createElement("span",{"data-a8n":a.key(this.props.a8n),className:"drawer-title-body",style:h},t),b)}var C=s({"drawer-header":u===c.LARGE,"drawer-header-small":u===c.SMALL,"drawer-header-offset":u===c.OFFSET,"drawer-header-popup":u===c.POPUP});return i.createElement("header",{className:C},p,d)}});u.Type=c,e.exports=u},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(12),o={rejectOnUnmount:function(){var e=this;return this._reject?this._reject:(this._reject=new s["default"](function(t,n){e._rejectFn=n}),this._reject["catch"](_.noop),this._isMounted===!1&&this._rejectFn(new r.Unmount),this._reject)},componentWillUnmount:function(){this._isMounted=!1,this._rejectFn&&this._rejectFn(new r.Unmount)}};e.exports=o},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(15),s=i(a),r=n(5),o=i(r),l=n(6),c=i(l),u=n(19),d=i(u),p=n(18),h=i(p),f=n(1377),m=i(f),g=n(1427),v=(i(g),n(1362)),y=i(v),E=n(43),_=n(8),b=n(155),C=n(20),M=n(12),S=n(461),T={SMALL:"SMALL",MEDIUM:"MEDIUM",LARGE:"LARGE",AUTO:"AUTO",NONE:"NONE"},w={LOW:"LOW",HIGH:"HIGH"},k=function(e){function t(e){(0,o["default"])(this,t);var n=(0,d["default"])(this,(0,s["default"])(t).call(this,e));n.state={loading:!0},n.onLoad=function(e){n.state.loading&&n.setState({loading:!1}),n.props.onLoad&&n.props.onLoad()},n.onError=function(e){e instanceof M.ServerStatusError&&n.props.profilePicThumb.onError(e.status),n.state.loading&&n.setState({loading:!1})};var i=e.profilePicThumb.imgFull;return i&&S.isCached(i)&&(n.state={loading:!1}),n}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"render",value:function(){var e=this.props,t=e.profilePicThumb,n=e.loader,i=this.state.loading,a=E("avatar-image",{"is-loaded":!i}),s=void 0;return n&&i&&(t.stale||t.imgFull)&&(s=_.createElement("div",{className:"avatar-spinner-container"},_.createElement(b,{size:50,stroke:3}))),_.createElement("div",{className:"avatar-body"},_.createElement(m["default"],{src:t.imgFull,hasPrivacyChecks:!0,crossOrigin:!1,className:a,onLoad:this.onLoad,onError:this.onError}),s)}}]),t}(_.PureComponent);k.CONCERNS={profilePicThumb:["imgFull","stale"]};var P=(0,y["default"])(k),N=function(e){function t(e){(0,o["default"])(this,t);var n=(0,d["default"])(this,(0,s["default"])(t).call(this,e));n.state={loading:!0},n.onLoad=function(e){n.state.loading&&n.setState({loading:!1}),n.props.onLoad&&n.props.onLoad()},n.onError=function(e){e instanceof M.ServerStatusError&&n.props.profilePicThumb.onError(e.status),n.state.loading&&n.setState({loading:!1})};var i=e.profilePicThumb.img;return i&&S.isCached(i)&&(n.state={loading:!1}),n}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"render",value:function(){var e=this.props,t=e.profilePicThumb,n=e.loader,i=this.state.loading,a=E("avatar-image",{"is-loaded":!i}),s=void 0;return n&&i&&(t.stale||t.img)&&(s=_.createElement("div",{className:"avatar-spinner-container"},_.createElement(b,{size:50,stroke:3}))),_.createElement("div",{className:"avatar-body"},_.createElement(m["default"],{src:t.img,hasPrivacyChecks:!0,crossOrigin:!1,className:a,onLoad:this.onLoad,onError:this.onError}),s)}}]),t}(_.PureComponent);N.CONCERNS={profilePicThumb:["img","stale"]};var x=(0,y["default"])(N),D=function(e){switch(e){case T.SMALL:return 49;case T.MEDIUM:return 100;case T.LARGE:return 200;case T.NONE:return;default:return e}},O=function(e){var t=e.id,n=e.size,i=e.quality,a=e.className,s=e.loader,r=e.onClick,o=e.onLoad,l=e.quoted;n=n||T.SMALL,i=i||w.LOW;var c={height:D(n),width:D(n)};r&&(c.cursor="pointer");var u=E("avatar",a,{"icon-user-default":C.isUser(t),"icon-user-default-square":C.isUser(t)&&l,"icon-group-default":C.isGroup(t),"icon-broadcast-default":C.isBroadcast(t),"icon-psa-default":C.isPSA(t)}),d=null,p=Store.ProfilePicThumb.get(t);return p&&(d=i===w.HIGH?_.createElement(P,{profilePicThumb:p,loader:s,onLoad:o}):_.createElement(x,{profilePicThumb:p,loader:s,onLoad:o})),_.createElement("div",{className:u,style:c,onClick:r},d)};e.exports=O,e.exports.Size=T,e.exports.Quality=w},function(e,t,n){"use strict";function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function a(e){return e&&e.__esModule?e:{"default":e}}function s(e,t){var n={};return(0,k["default"])(e).forEach(function(i){function a(e){s.call(this,e)}var s=r(i);if(!s)throw new Error("Attempting to generate whitelisted proxy for: "+i+". Check the ProxyStates file for definitions.");var o={};e[i].forEach(function(e){o[e]={enumerable:!0,get:function(){return this._ProxyState$state.get(e)},set:function(t){this._ProxyState$state.set(e,t)}}}),o._ProxyState$ComponentName={get:function(){return t}},o.proxyBitMask={value:(0,I.genBitMask)(s.prototype.mirrorMask,e[i])},a.prototype=(0,T["default"])(s.prototype,o),a.prototype.constructor=a,n[i]=a}),n}function r(e){return U[""+e[0].toUpperCase()+e.slice(1)+"Proxy"]}function o(e,t){return t instanceof r(e)?t._ProxyState$state:t}Object.defineProperty(t,"__esModule",{value:!0});var l=n(230),c=a(l),u=n(158),d=a(u),p=n(15),h=a(p),f=n(5),m=a(f),g=n(6),v=a(g),y=n(19),E=a(y),_=n(18),b=a(_),C=n(117),M=a(C),S=n(79),T=a(S),w=n(21),k=a(w),P=n(8),N=a(P),x=n(1371),D=a(x),O=n(77),R=a(O),I=n(466),A=n(1406),L=a(A),F=n(1646),U=i(F);t["default"]=function(e){var t,n,i,a=e.CONCERNS,r=e.WEAK_CONCERNS,l=(0,M["default"])({},r,a),u=e.name,p=s(l,u);return n=t=function(t){function n(e){(0,m["default"])(this,n);var t=(0,E["default"])(this,(0,h["default"])(n).call(this,e));return i.call(t),(0,k["default"])(l).forEach(function(e){t.state[e]=t.createConcern(e,t.props)}),t}return(0,b["default"])(n,t),(0,v["default"])(n,[{key:"componentWillReceiveProps",value:function(e){var t=this,n={};(0,k["default"])(l).forEach(function(i){t.props[i]!==e[i]&&(t.destroyConcern(i,t.props),n[i]=t.createConcern(i,e))}),(0,k["default"])(n).length&&this.setState(n)}},{key:"componentWillUnmount",value:function(){var e=this;(0,k["default"])(l).forEach(function(t){e.destroyConcern(t)})}},{key:"createConcern",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?this.props:arguments[1],n=o(e,t[e]);if(!n)throw new Error("Attempting to create ProxyState: "+e+" without the backing model. Check the props of "+u+".");if(!(n instanceof R["default"]))throw new Error("Attempting to create ProxyState: "+e+" with an invlaid object: "+n+". Check the props of "+u+".");var i=!a[e]&&!!r[e];n.incObservers(i);var s=new p[e](n);return n.mirror.addListener(this.rr,s.proxyBitMask,e,n),s}},{key:"render",value:function(){return N["default"].createElement(e,(0,d["default"])({ref:x.HOCRef},this.props,this.state))}}]),n}(D["default"]),t.displayName="State("+(0,L["default"])(e)+")",i=function(){var e=this;this.state={},this.rr=function(t,n){e.setState((0,c["default"])({},t,new p[t](n)))},this.destroyConcern=function(t){var n=arguments.length<=1||void 0===arguments[1]?e.props:arguments[1],i=o(t,n[t]);if(!i)throw new Error("Attempting to destroy ProxyState: "+t+" without the backing model. Check the props of "+u+".");if(!(i instanceof R["default"]))throw new Error("Attempting to destroy ProxyState: "+t+" with an invlaid object: "+i+". Check the props of "+u+".");i.decObservers(),i.mirror.removeListener(e.rr)}},n}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){return t?e+" · "+l10n.t("status_v3"):e}var s=n(453),r=i(s),o=n(8),l=n(1373),c=n(1355),u=n(10),d=n(20),p=n(43),h=n(1),f=function(e){var t=e.msg,n=e.chat,i=e.displaySelf,s=e.className,f=e.disableClick,m=e.quoted,g=n||t.chat;h.assert(g,"author-with-no-chat")();var v=g?g.assignedColor(t.sender):1,y=t.senderObj,E=p("message-author color-"+v,s,{"title-number":!y.name,"message-author-image":(t.type===r["default"].TYPE.VIDEO||t.type===r["default"].TYPE.IMAGE)&&!m,"message-author-location":t.type===r["default"].TYPE.LOCATION&&!m}),b=f?_.noop:function(){Store.Chat.find(t.sender).then(function(e){u.openChatFromUnread(e).then(function(t){t&&u.focusChatTextInput(e)})})},C=f?null:"text-clickable",M=void 0;return i?M=o.createElement(c,{text:a(l10n.t("web_you"),t.isStatusV3)}):y.name?M=o.createElement("span",{className:C,onClick:b},o.createElement(c,{text:a(y.name,t.isStatusV3)})):(M=[o.createElement("span",{className:p("number",C),key:t.id+"-number",onClick:b},a(d.formattedUser(y.id),t.isStatusV3))],t.isStatusV3||M.push(o.createElement("span",{className:p("ellipsify","screen-name",C),key:t.id+"-push-name",onClick:b},o.createElement(c,{className:"screen-name-text",direction:"auto",text:y.notifyName})))),o.createElement("h3",{className:E},o.createElement(l,null,M))};f.shouldRender=function(e){return!e.isSentByMe&&e.isGroupMsg},f.propTypes={msg:o.PropTypes.instanceOf(r["default"]).isRequired,displaySelf:o.PropTypes.bool,disableClick:o.PropTypes.bool,quoted:o.PropTypes.bool,className:o.PropTypes.string},e.exports=f},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(){return++m}var s=n(230),r=i(s),o=n(1),l=n(8),c=n(43),u=n(109),d=n(93),p=n(229),h={DEFAULT_PUSH:"flow-transition-drawer-push",DEFAULT_POP:"flow-transition-drawer-pop",NONE:"none"},f={PUSH:"push",POP:"pop"},m=0,g={getInitialState:function(){return{_stack:[],_activeKey:void 0,_transition:void 0}},defaultTransition:function(e){var t,n=_.isFunction(this.getDefaultTransition)?this.getDefaultTransition():{};return _.assign((t={},(0,r["default"])(t,f.PUSH,h.DEFAULT_PUSH),(0,r["default"])(t,f.POP,h.DEFAULT_POP),t),n)[e]},push:function(e){var t=arguments.length<=1||void 0===arguments[1]?this.defaultTransition(f.PUSH):arguments[1],n=this.state._stack.concat(e),i=a();this.setState({_stack:n,_transition:t,_activeKey:i})},pop:function(){var e=arguments.length<=0||void 0===arguments[0]?this.defaultTransition(f.POP):arguments[0],t=_.dropRight(this.state._stack);if(t.length){var n=a();this.setState({_stack:t,_transition:e,_activeKey:n})}else this.endFlow()},endFlow:function(e){this.context.uim.uie.requestDismiss(e)},render:function(){var e=this,t=this.state,n=t._stack,i=t._transition,a=t._activeKey,s=_.last(n);o.assert(!!s,"empty-flow",s)(),s=l.createElement(p,{displayName:"FlowDrawer"+a,key:a,escapable:!0,requestDismiss:function(){return e.pop()}},s);var r=c("flow-drawer-container");return l.createElement(u,{transitionName:i,className:r},s)}};g.Transition=h,g.Dir=f,g.contextTypes={uim:l.PropTypes.instanceOf(d)},e.exports=g},function(e,t,n){"use strict";function i(e,t){this.list=e,this.selected=_.reduce(e,function(e,t,n){return e[n]=!1,e},{}),this.getter=t||function(e){return e}}var a=n(61);_.assign(i.prototype,a,{init:function(){var e=this,t=arguments.length<=0||void 0===arguments[0]?[]:arguments[0];if(!_.isEmpty(this.selected)){if(_.isEmpty(t))return void this.unsetAll();var n=_.reduce(t,function(t,n,i){var a=e.list.indexOf(n);t[i]=a>-1&&e.selected[a]},{});this.selected=n,this.list=t}},unsetAll:function(){var e=this;_.forEach(this.selected,function(t,n){t&&e.set(n,!1)})},reset:function(){var e=this,t=arguments.length<=0||void 0===arguments[0]||arguments[0];_.forEach(this.selected,function(n,i){n&&e.trigger(e.getter(e.list[i]),!0,!0,t)})},set:function(e){var t=arguments.length<=1||void 0===arguments[1]||arguments[1],n=arguments.length<=2||void 0===arguments[2]||arguments[2];
if(this.list.length){var i=Math.min(Math.max(e,-1),this.list.length-1),a=i>-1?this.list[i]:void 0;a&&(this.selected[i]&&!t||!this.selected[i]&&t)&&(this.selected[i]=t,this.trigger(this.getter(a),t,n))}},setVal:function(e){var t=arguments.length<=1||void 0===arguments[1]||arguments[1],n=arguments.length<=2||void 0===arguments[2]||arguments[2],i=_.indexOf(this.list,e);i===-1&&(i=this.list.length,this.list.push(e),this.selected[i]=!1),this.set(i,t,n)},setFirst:function(){var e=arguments.length<=0||void 0===arguments[0]||arguments[0];_.isEmpty(this.list)||this.set(0,!0,e)},setLast:function(){var e=arguments.length<=0||void 0===arguments[0]||arguments[0];_.isEmpty(this.list)||this.set(this.list.length-1,!0,e)},getSelected:function(){var e=this;return _.reduce(this.list,function(t,n,i){return e.selected[i]&&t.push(n),t},[])},isSelected:function(e){return!!this.selected[this.list.indexOf(e)]}}),e.exports=i},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.Component=void 0;var a=n(15),s=i(a),r=n(5),o=i(r),l=n(6),c=i(l),u=n(19),d=i(u),p=n(18),h=i(p),f=n(1368),m=i(f),g=n(1671),v=i(g),y=n(8),E=n(44),_=n(43),b=n(10),C=n(23),M=n(1516),S=72,T="data-list-scroll-container",w="data-list-scroll-offset",k=function(e){function t(e){(0,o["default"])(this,t);var n=(0,d["default"])(this,(0,s["default"])(t).call(this,e));return n.scrollTop=0,n.offsetTop=0,n.bodyHeight=0,n.pointerEvents=!0,n.enablePointerEvents=C.debounce(function(){b.setUiBusy(!1),n.pointerEvents=!1,E.findDOMNode(n.refs.viewport).style.pointerEvents="auto",n.props.onPointerEventsOn&&n.props.onPointerEventsOn()},150),n.onScroll=function(){n.animationFrame?n.hanging=!0:(n.hanging=!1,n.animationFrame=window.requestAnimationFrame(n._onScroll))},n._onScroll=function(){var e=n.state.scrollTarget;n.disablePointerEvents(),e&&(n.scrollTop=e.scrollTop);var t=n.getPhysicalIndexes(n.props),i=t.firstPhysicalIndex,a=t.lastPhysicalIndex,s=void 0;for(s=i;s<a;s++){var r=n.props.data[s].key;if(!n.renderedItems[r])break}return s===a?(n.animationFrame=void 0,void(n.hanging&&n.onScroll())):void n.setState({firstPhysicalIndex:i,lastPhysicalIndex:a},function(){n.animationFrame=void 0,n.hanging&&n.onScroll()})},n.state={scrollTarget:void 0,firstPhysicalIndex:0,lastPhysicalIndex:0},n}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"componentWillReceiveProps",value:function(e){if(void 0!==e.scrollTop&&this.state.scrollTarget&&(this.state.scrollTarget.scrollTop=e.scrollTop),this.props.scrollTarget!==e.scrollTarget||this.props.height!==e.height||this.props.data.length!==e.data.length)this.initialize(e);else{var t=this.state,n=t.firstPhysicalIndex,i=t.lastPhysicalIndex,a=this.getFirstVisibleIndex(e.height);(a<n||a>i)&&this.setState(this.getPhysicalIndexes(e))}}},{key:"componentDidMount",value:function(){var e=this;this.props.listeners.addAndRun(window,"resize",function(){return e.initialize()})}},{key:"componentWillUnmount",value:function(){this.cancelScroll(),this.enablePointerEvents.cancel()}},{key:"initialize",value:function(e){var t=e?e:this.props;if(this.cancelScroll(),this.state.scrollTarget){var n=v["default"]?{passive:!0}:void 0;this.props.listeners.remove(this.state.scrollTarget,"scroll",this.onScroll,n)}for(var i=E.findDOMNode(this),a=void 0,s=i,r=0;r<5;r++){if(s instanceof HTMLElement&&s.hasAttribute(T)){a=s;break}s=s&&s.parentNode}var o=void 0;s=i;for(var l=0;l<r;l++){if(s instanceof HTMLElement&&s.hasAttribute(w)){o=s;break}s=s&&s.parentNode}if(!a)throw new Error("list scroll container not found");var c=v["default"]?{passive:!0}:void 0;this.props.listeners.add(a,"scroll",this.onScroll,c),this.scrollTop=a.scrollTop,this.offsetTop=o?o.offsetTop:0,this.bodyHeight=a.clientHeight;var u=this.getPhysicalIndexes(t),d=u.firstPhysicalIndex,p=u.lastPhysicalIndex;return this.renderedItems={},this.setState({scrollTarget:a,firstPhysicalIndex:d,lastPhysicalIndex:p}),a}},{key:"getFirstVisibleIndex",value:function(e){return Math.floor(Math.max(this.scrollTop-this.offsetTop,0)/e)}},{key:"getPhysicalIndexes",value:function(e){var t=this.getFirstVisibleIndex(e.height),n=Math.max(this.offsetTop-this.scrollTop,0),i=Math.max(this.bodyHeight-n,0),a=Math.min(Math.ceil(i/e.height),e.data.length),s=Math.max(t-e.extraItems,0),r=Math.min(t+a+e.extraItems,e.data.length);return{firstPhysicalIndex:s,lastPhysicalIndex:r}}},{key:"cancelScroll",value:function(){this.animationFrame&&(window.cancelAnimationFrame(this.animationFrame),this.animationFrame=void 0,this.hanging=!1)}},{key:"disablePointerEvents",value:function(){this.enablePointerEvents(),this.pointerEvents||(this.props.onPointerEventsOff&&this.props.onPointerEventsOff(),E.findDOMNode(this.refs.viewport).style.pointerEvents="none",b.setUiBusy(!0),this.pointerEvents=!0)}},{key:"getComponents",value:function(){var e=this,t=this.props,n=t.height,i=t.data,a=this.state,s=a.firstPhysicalIndex,r=a.lastPhysicalIndex,o={};return C(i).forEach(function(e,t){o[e.key]=t}).slice(s,r).forEach(function(t){e.renderedItems[t.key]=t}),C.sortBy(this.renderedItems,"key").map(function(e){return y.createElement(M,{key:e.key,rowHeight:n,className:0===o[e.key]?"first":void 0,zIndex:i.length-o[e.key]-1,rowNumber:o[e.key]},e)})}},{key:"render",value:function(){var e=this.props,t=e.data,n=e.height,i=e.className,a=e.animate,s={container:{},viewport:{height:t.length*n}},r={container:_("infinite-list",i,{"infinite-list-animate":a&&!this.animationFrame}),viewport:"infinite-list-viewport"};return y.createElement("div",{className:r.container,style:s.container},y.createElement("div",{className:r.viewport,ref:"viewport",style:s.viewport},this.getComponents()))}}]),t}(y.Component);k.defaultProps={animate:!1,scrollTarget:null,className:null,data:null,height:S,extraItems:30},k.DEFAULT_HEIGHT=S,k.SCROLL_ATTR=T,k.SCROLL_OFFSET_ATTR=w;t.Component=k;t["default"]=(0,m["default"])(k)},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(453),s=i(a),r=n(8),o=n(1373),l=n(1557),c=n(43),u=n(76),d=n(10),p=n(75),h=r.createClass({displayName:"Meta",propTypes:{msg:r.PropTypes.instanceOf(s["default"]).isRequired},openInfoDrawer:function(){d.msgInfoDrawer(this.props.msg)},render:function(){var e,t,n=this.props.msg,i=n.broadcast||n.star?(n.type===s["default"].TYPE.IMAGE||n.type===s["default"].TYPE.VIDEO||n.type===s["default"].TYPE.AUDIO)&&!n.caption:null;if(n.broadcast){var a=c("icon-s",{"icon-broadcast-light":i,"icon-broadcast":!i});e=r.createElement("span",{className:a})}if(n.star){var d=c("icon-s",{"icon-star-light":i,"icon-star":!i&&n.isSentByMe,"icon-star-in":!i&&!n.isSentByMe});t=r.createElement("span",{className:d})}var h=n.isSentByMe?r.createElement(l,{msg:this.props.msg}):null,f=n.isSentByMe&&p.supportsFeature(p.F.MESSAGE_INFO);return r.createElement("div",{className:f?"message-meta text-clickable":"message-meta",onClick:f?this.openInfoDrawer:null},t,e,r.createElement(o,null,r.createElement("span",{className:"message-datetime"},n.t?u.timestampStr(n.t):null)),h)}});e.exports=h},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t,n,i,a){this.hasEngaged=!1,this.hasDisengaged=!1,this.source=e,this.cb=n,this.capture=i,this.wrapper=a,"function"==typeof e.on?(this.useOnOff=!0,this.event=t):(this.useOnOff=!1,this.event=_["default"].prefix(t,e))}Object.defineProperty(t,"__esModule",{value:!0});var s=n(158),r=i(s),o=n(15),l=i(o),c=n(19),u=i(c),d=n(18),p=i(d),h=n(5),f=i(h),m=n(6),g=i(m);t["default"]=function(e){var t,n;return n=t=function(t){function n(){var e,t,i,a;(0,f["default"])(this,n);for(var s=arguments.length,r=Array(s),o=0;o<s;o++)r[o]=arguments[o];return t=i=(0,u["default"])(this,(e=(0,l["default"])(n)).call.apply(e,[this].concat(r))),i.listeners=new k(function(){i.setState({})}),a=t,(0,u["default"])(i,a)}return(0,p["default"])(n,t),(0,g["default"])(n,[{key:"componentDidMount",value:function(){this.listeners._markMounted()}},{key:"componentWillUnmount",value:function(){this.listeners._markUnmounted()}},{key:"render",value:function(){return y["default"].createElement(e,(0,r["default"])({},this.props,{listeners:this.listeners}))}}]),n}(y["default"].Component),t.displayName="Listener("+(0,w["default"])(e)+")",n};var v=n(8),y=i(v),E=n(235),_=i(E),b=n(1),C=i(b),M=n(10),S=i(M),T=n(1406),w=i(T);a.prototype={engage:function(){if(!this.hasEngaged&&!this.hasDisengaged){this.hasEngaged=!0;var e=this.source,t=this.event,n=this.wrapper||this.cb;this.useOnOff?(e.on(t,n),"function"==typeof e.incObservers&&e.incObservers()):e.addEventListener(t,n,this.capture)}},disengage:function(){if(!this.hasDisengaged&&(this.hasDisengaged=!0,this.hasEngaged)){var e=this.source,t=this.event,n=this.wrapper||this.cb;this.useOnOff?(e.off(this.event,n),"function"==typeof e.decObservers&&e.decObservers()):e.removeEventListener(t,n,this.capture)}},represents:function(e,t,n,i){if(this.source!==e)return!1;if(this.event!==t)return!1;if(this.cb!==n)return!1;if(i&&"object"==typeof i){var a=this.capture;return!(!a||"object"!=typeof a)&&(a.passive===i.passive&&a.capture===i.capture)}return this.capture===i}};var k=function(){function e(t){(0,f["default"])(this,e),this._mounted=!1,this._unmounted=!1,this._listeners=null,this._rerender=t}return(0,g["default"])(e,[{key:"_add",value:function(e){return this._unmounted?void C["default"].warn("Listener added after unmounting")():(this._listeners?this._listeners.push(e):this._listeners=[e],void(this._mounted&&e.engage()))}},{key:"_markMounted",value:function(){this._mounted=!0;var e=this._listeners;if(e)for(var t=0;t<e.length;t++)e[t].engage()}},{key:"_markUnmounted",value:function(){this._unmounted=!0;var e=this._listeners;if(e)for(var t=0;t<e.length;t++)e[t].disengage()}},{key:"add",value:function(e,t,n,i){this._add(new a(e,t,n,i,n?void 0:this._rerender))}},{key:"addOnce",value:function(e,t,n,i){var s=arguments,r=this,o=new a(e,t,n,i,function(){o.disengage(),n?n.apply(null,s):r._rerender()});this._add(o)}},{key:"addAndRun",value:function(e,t,n,i){this.add(e,t,n,i),this._unmounted||n()}},{key:"remove",value:function(e,t,n,i){var a=this._listeners;if(a){for(var s=0;s<a.length;s++){var r=a[s];r.represents(e,t,n,i)&&r.disengage()}this._listeners=a.filter(function(e){return!e.hasDisengaged})}}},{key:"uiIdle",value:function(e){var t=this;S["default"].uiBusy?!function(){var n=new a(S["default"],"ui_idle",e,(void 0),function(){n.disengage(),e()});t._add(n)}():e()}}]),e}()},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(110),s=i(a),r=n(8),o=n(44),l=n(458),c=n(154),u=n(43),d=n(93),p=r.createClass({displayName:"MenuItem",mixins:[c],propTypes:{children:r.PropTypes.node.isRequired,a8n:r.PropTypes.string.isRequired,action:r.PropTypes.func,tooltip:r.PropTypes.node,filePickerMimes:r.PropTypes.string,onFilePick:r.PropTypes.func},getInitialState:function(){return{hover:!1,focus:!1}},componentWillMount:function(){this.props.filePickerMimes&&this.regNativeListener(window,"focus",this.onWindowFocus)},onMouseEnter:function(){this.setState({hover:!0})},onMouseLeave:function(){this.setState({hover:!1})},onFocus:function(){this.setState({focus:!0})},onBlur:function(){this.setState({focus:!1})},preventDefault:function(e){e.preventDefault()},onAction:function(e){if(e.isTrusted&&!e.repeat){var t=this.props,n=t.action,i=t.filePickerMimes;if(n){var a=n(e);if(i)return void(this.active=!0);var s=this.context.uim;s&&(a===!1&&s.pop(!1,!1),s.uie.requestDismiss())}}},triggerInput:function(){o.findDOMNode(this.refs.filePicker).click()},onWindowFocus:function(e){this.active&&this.onFilePick()},onFilePick:function(e){if(this.props.onFilePick){this.props.onFilePick(e);var t=this.context.uim;t&&t.uie.requestDismiss()}},render:function(){var e=this.props,t=e.children,n=e.tooltip,i=e.filePickerMimes,a=this.state,o=a.hover,c=a.focus;n=(o||c)&&n?n:null;var d={enter:this.onAction},p=u("menu-item menu-shortcut",{"highlighted-menu-item":o||c}),f=void 0;return i&&(f=r.createElement(h,{mime:i,ref:"filePicker",onPick:this.onFilePick})),_.isString(t)&&(t=r.createElement("a",{className:"ellipsify",title:t},t)),r.createElement(s["default"],{component:"li",className:p,handlers:d,"data-a8n":l.key(this.props.a8n),onContextMenu:this.preventDefault,onMouseDown:this.preventDefault,onClick:this.onAction,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,onFocus:this.onFocus,onBlur:this.onBlur},t,n,f)}});p.contextTypes={uim:r.PropTypes.instanceOf(d)};var h=r.createClass({displayName:"FilePicker",propTypes:{mime:r.PropTypes.string.isRequired,multiple:r.PropTypes.bool,onPick:r.PropTypes.func.isRequired},getDefaultProps:function(){return{multiple:!0}},render:function(){return r.createElement("input",{accept:this.props.mime,type:"file",multiple:this.props.multiple,style:{display:"none"},onClick:function(e){return e.stopPropagation()},onChange:this.props.onPick})}});e.exports=p},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(158),s=i(a),r=n(160),o=i(r),l=n(8),c=n(155),u=n(43),d=n(1355),p=function(e){var t=e.className,n=u("empty-icon",t);return l.createElement("div",{className:"empty-icon-container"},l.createElement("span",{className:n}))},h=function(e){var t=e.icon,n=e.title,i=e.text,a=e.className,r=e.children,c=(0,o["default"])(e,["icon","title","text","className","children"]),p=n?l.createElement("div",{className:"empty-title"},n):null,h=i?l.createElement(d,{element:"div",className:"empty-text",text:i}):null,f=u("empty",a);return l.createElement("div",(0,s["default"])({className:f},c),t,p,h,r)},f=function(){var e=l.createElement(p,{className:"icon-empty-blocked"});return l.createElement(h,{icon:e,title:l10n.t("blocked_empty"),text:l10n.t("add_blocked_description")})},m=function(){var e=l.createElement(p,{className:"icon-empty-archived"});return l.createElement(h,{icon:e,title:l10n.t("archived_empty")})},g=function(){return l.createElement(h,{className:"empty-top",text:l10n.t("search_no_chats_or_contacts")})},v=function(){return l.createElement(h,{className:"empty-top",text:l10n.t("searching_chats_contacts_messages")})},y=function(){return l.createElement(h,{className:"empty-top",text:l10n.t("searching_messages")})},E=function(){return l.createElement(h,{className:"empty-top",text:l10n.t("search_no_contacts")})},_=function(){return l.createElement(h,{className:"empty-top",text:l10n.t("search_no_groups")})},b=function(){return l.createElement(h,{className:"empty-top",text:l10n.t("search_no_messages")})},C=function(){return l.createElement(h,{text:l10n.t("no_chats")})},M=function(){return l.createElement(h,{text:l10n.t("no_contacts")})},S=function(){return l.createElement(h,{text:l10n.t("no_groups")})},T=function(e){return l.createElement(h,{className:"empty-top",text:l10n.t("chat_search_prompt",{chatName:e})})},w=function(){return l.createElement(h,{text:l10n.t("all_chats_archived")})},k=function(){return l.createElement(h,{text:l10n.t("no_starred_messages")})},P=function(){return l.createElement(h,{text:l10n.t("no_media")})},N=function(){return l.createElement(h,{text:l10n.t("no_links")})},x=function(){return l.createElement(h,{text:l10n.t("no_docs")})},D=function(){return l.createElement(h,null,l.createElement(c,{size:50,stroke:4}))};e.exports={Blocked:f,Archived:m,Search:g,SearchContacts:E,SearchGroups:_,SearchMessages:b,ListChats:C,ListContacts:M,ListGroups:S,AllArchived:w,StarredMsgs:k,MediaMsgs:P,LinkMsgs:N,DocMsgs:x,Loading:D,Searching:v,SearchingMessages:y,BeforeSearchMessages:T}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){return function(n){n?"function"==typeof n._getComponent?t[e]=n._getComponent():t[e]=n:t[e]=void 0}}Object.defineProperty(t,"__esModule",{value:!0}),t.HOCRef=void 0;var s=n(15),r=i(s),o=n(5),l=i(o),c=n(6),u=i(c),d=n(19),p=i(d),h=n(18),f=i(h);t.GetRef=a;var m=n(8),g=(t.HOCRef="component",function(e){function t(){return(0,l["default"])(this,t),(0,p["default"])(this,(0,r["default"])(t).apply(this,arguments))}return(0,f["default"])(t,e),(0,u["default"])(t,[{key:"_getComponent",value:function(){var e=this.refs.component;return"function"==typeof e._getComponent?e._getComponent():e}}]),t}(m.Component));t["default"]=g},function(e,t,n){"use strict";function i(e,t){this.list=e,this.index=-1,this.value=void 0,this.getter=t||function(e){return e}}var a=n(61);_.assign(i.prototype,a,{init:function(){var e=arguments.length<=0||void 0===arguments[0]?[]:arguments[0],t=!(arguments.length<=1||void 0===arguments[1])&&arguments[1],n=void 0,i=void 0;if(this.list=e,this.value){if(_.isEmpty(e))return void this.unset();if(n=_.indexOf(e,this.value),n>-1){if(n===this.index)return;i=!0,t=!1}else n=t&&this.index>-1?Math.min(Math.max(this.index,0),e.length-1):-1,i=n>-1;this.set(n,t,i)}},unset:function(){this.value&&this.trigger(this.getter(this.value),!1),this.value=void 0,this.index=-1},reset:function(){var e=arguments.length<=0||void 0===arguments[0]||arguments[0];this.index<0||this.value&&this.trigger(this.getter(this.value),"focus",e)},set:function(e){var t=arguments.length<=1||void 0===arguments[1]||arguments[1],n=arguments.length<=2||void 0===arguments[2]||arguments[2];if(this.list.length){var i=Math.min(Math.max(e,-1),this.list.length-1),a=this.value,s=i>-1?this.list[i]:void 0;s?(this.trigger(this.getter(s),t?"focus":"select"),this.value=s):n&&(this.value=void 0),n&&a&&a!==s&&this.trigger(this.getter(a),!1),this.index=i}},getVal:function(){return this.value},setVal:function(e){var t=arguments.length<=1||void 0===arguments[1]||arguments[1],n=_.indexOf(this.list,e);n>-1?this.set(n,t):(this.unset(),this.value=e)},setFirst:function(){var e=arguments.length<=0||void 0===arguments[0]||arguments[0];_.isEmpty(this.list)||this.set(0,e)},setLast:function(){var e=arguments.length<=0||void 0===arguments[0]||arguments[0];_.isEmpty(this.list)||this.set(this.list.length-1,e)},setPrev:function(){var e=arguments.length<=0||void 0===arguments[0]||arguments[0];_.isEmpty(this.list)||this.set(this.prev(),e)},setNext:function(){var e=arguments.length<=0||void 0===arguments[0]||arguments[0];_.isEmpty(this.list)||this.set(this.next(),e)},prev:function(){return _.isEmpty(this.list)?-1:this.index===-1?-1:this.index-1},next:function(){return _.isEmpty(this.list)?-1:Math.min(this.index+1,this.list.length-1)}}),e.exports=i},function(e,t,n){"use strict";var i=n(8),a=i.createClass({displayName:"HiddenToken",propTypes:{children:i.PropTypes.node.isRequired},render:function(){return i.createElement("span",{className:"hidden-token"},"⁠⁠⁠⁠",this.props.children,"⁠⁠⁠⁠⁠")}});e.exports=a},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.StatusV3Proxy=void 0;var a=n(2),s=i(a),r=n(453),o=i(r),l=n(470),c=i(l),u=n(466),d=n(1473),p=n(9),h=n(1),f=n(45),m={Collection:"StatusV3",props:{id:"string",t:"number",unreadCount:"number",totalCount:"number",pic:"object",_msgs:{type:"array","default":function(){return[]}}},session:{readKeys:{type:"object","default":function(){return{}}},contact:"object"},derived:{renderedThumbnail:{deps:["msgsChanged","pic","totalCount"],fn:function(){if(this.msgs.length===this.totalCount)for(var e=this.msgs.length-1;e>=0;e--){var t=this.msgs.at(e);if(t&&(t.type===o["default"].TYPE.IMAGE||t.type===o["default"].TYPE.VIDEO)&&t.body)return delete this.pic,"data:image/jpeg;base64,"+t.body}if(this.pic){var n=new Blob(this.pic,{type:"image/jpeg"});return URL.createObjectURL(n)}return null}}},initialize:function(){d.prototype.initialize.call(this),this.addChild("contact",Store.Contact.gadd(this.id)),this._msgs.length>0&&(Store.StatusV3.addStatusMessages(this.id,this._msgs),this._msgs=[])},"delete":function(){d.prototype["delete"].call(this),Store.StatusV3.remove(this.id)},onEmptyMRM:function(){var e=this;h.log("models:StatusV3:removeMsg 0 messages left, querying...")(),this.loadMore()["catch"](function(t){404===t&&e["delete"]()})},loadMore:function(){var e=this;return this.msgs.msgLoadState.noEarlierMsgs?s["default"].resolve():this.msgs.msgLoadState.isLoadingEarlierMsgs?this.msgs.loadEarlierPromise:Store.StatusV3.loadMore(this.id,p.PAGE_SIZE,this.msgs.last()).then(function(t){return _.isArray(t)&&t.length<p.PAGE_SIZE&&(e.msgs.msgLoadState.noEarlierMsgs=!0),t})["catch"](function(t){404===t&&e["delete"]()})},handleReadStatus:function(e){this.readKeys[e]||(this.readKeys[e]=!0,this.unreadCount>0?this.unreadCount--:h.error("statusv3:"+this.id+":new read key but unreadCount 0")())},sendReadStatus:function(e){var t=this;return f.sendStatusSeen(e).then(function(n){200===n.status&&t.handleReadStatus(e)})},sendMute:function(e){var t=this;return f.sendStatusMute(this.id,e).then(function(n){200===n.status&&(t.contact.statusMute=e)})}},g=(0,u.genMirrorMask)(m),v=d.extend(m,{mirrorMask:g});t["default"]=v;t.StatusV3Proxy=(0,c["default"])(m,g)},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(15),s=i(a),r=n(5),o=i(r),l=n(6),c=i(l),u=n(19),d=i(u),p=n(18),h=i(p),f=n(8),m=n(1355),g=n(155),v=n(109),y=n(43),E=function(e){function t(e){(0,o["default"])(this,t);var n=(0,d["default"])(this,(0,s["default"])(t).call(this,e));return n.state={hover:!1,contextMenu:!1},n.onMenuClick=function(e){var t=n.props,i=t.contextEnabled,a=t.onContext;i()&&(e.stopPropagation(),e.preventDefault(),a&&a({anchor:e.target}))},n.onContextMenu=function(e){var t=n.props,i=t.contextEnabled,a=t.onContext;i()&&(e.stopPropagation(),e.preventDefault(),a&&a({event:e}))},n.openContextMenu=function(){n.props.contextEnabled()&&n.setState({contextMenu:!0},function(){n.refs.context.click()})},n.mouseOver=function(){n.state.hover||n.props.contextMenu||!n.props.contextEnabled()||n.setState({hover:!0})},n.mouseEnter=function(){n.state.hover||n.props.contextMenu||!n.props.contextEnabled()||n.setState({hover:!0})},n.mouseLeave=function(){n.state.hover&&n.setState({hover:!1})},n}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"componentWillUpdate",value:function(e){this.props.contextMenu&&this.state.contextMenu&&!e.contextMenu&&this.setState({contextMenu:!1})}},{key:"onMenuMouseDown",value:function(e){e.stopPropagation()}},{key:"render",value:function(){var e=this.props.contextMenu||this.state.contextMenu,t=e||this.state.hover,n=y(this.props.className,{chat:!0,hover:t}),i=null,a=null;this.props.pendingAction?a=f.createElement("div",{className:"btn-context icon-spinner"},f.createElement(g,{size:18,stroke:6})):t&&(i=f.createElement("span",{className:"icon icon-down btn-context",key:"icon-context",ref:"context",onMouseDown:this.onMenuMouseDown,onClick:this.onMenuClick}));var s=this.props.detail?f.createElement("div",{className:"chat-body chat-detail"},this.props.detail):null,r=null,o="chat-title";this.props.isVerified&&(r=f.createElement("span",{className:"icon-psa-verified"}),o+=" chat-title-verified");var l=this.props.primary?f.createElement("div",{className:o},f.createElement(m,{text:this.props.primary,direction:"auto",highlight:this.props.searchText?[this.props.searchText]:null,titlify:!0,ellipsify:!0}),r):null,c=f.createElement(v,{transitionName:"pop"},a),u=f.createElement(v,{transitionName:"pop-fast-chat",className:"context-container"},t?i:null),d=void 0,p=void 0;return this.props.secondary?(d=f.createElement("div",{className:"chat-main"},l,this.props.primaryDetail),p=f.createElement("div",{className:"chat-secondary"},this.props.secondary,f.createElement("div",{className:"chat-meta"},this.props.secondaryDetail,c,u))):(d=f.createElement("div",{className:"chat-main"},l,this.props.primaryDetail,c,u),p=this.props.secondaryDetail?f.createElement("div",{className:"chat-secondary"},f.createElement("div",{className:"chat-status"}),f.createElement("div",{className:"chat-meta"},this.props.secondaryDetail)):null),f.createElement("div",{className:n,style:this.props.style,onClick:this.props.onClick,onMouseDown:this.props.onMouseDown,onContextMenu:this.props.contextEnabled()?this.onContextMenu:null,onMouseEnter:this.state.hover?null:this.mouseEnter,onMouseOver:this.state.hover?null:this.mouseOver,onMouseLeave:this.state.hover?this.mouseLeave:null},this.props.image,f.createElement("div",{className:"chat-body"},d,p),s)}}]),t}(f.PureComponent);e.exports=E},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(232),s=i(a),r=n(110),o=i(r),l=n(8),c=n(44),u=n(1375),d=n(1361),p=n(1500),h=n(1356),f=n(153),m=n(43),g=n(1355),v=n(1386),y=n(92),E=n(9),b={SMALL:"small",DEFAULT:"default"},C=l.createClass({displayName:"Contact",mixins:[h,f],propTypes:{contact:l.PropTypes.instanceOf(s["default"]).isRequired,onClick:l.PropTypes.func,mouseDownAsClick:l.PropTypes.bool,onDelete:l.PropTypes.func,onContext:l.PropTypes.func,contextEnabled:l.PropTypes.func,contextMenu:l.PropTypes.bool,admin:l.PropTypes.bool,active:l.PropTypes.object,className:l.PropTypes.string,secondary:l.PropTypes.node,type:l.PropTypes.oneOf(_.values(b)),showNotifyName:l.PropTypes.bool,searchText:l.PropTypes.string},getInitialState:function(){var e=this.props.contact,t=this.props.active,n={formattedName:this.async("contact.formattedName"),pendingAction:this.async("contact.pendingAction"),active:!!t&&t.value===e,contextMenu:!1};return this.props.showNotifyName&&(n.notifyName=this.async("contact.notifyName")),n},componentWillMount:function(){this.props.active&&this.addObserver(this.props.active,this.props.contact.id.toString(),this.onActiveChange)},onActiveChange:function(e,t){if("focus"===e){var n=c.findDOMNode(this);y.focus(n),t&&v.scrollIntoViewIfNeeded(n)}this.setState({active:!!e})},contextEnabled:function(){return!1},onDelete:function(e){e.stopPropagation(),this.props.onDelete(e,this.props.contact)},onClick:function(e){_.isFunction(this.props.onClick)&&this.props.onClick(e,this.props.contact)},onMouseDown:function(e){0===e.button&&this.onClick(e)},onEnter:function(e){e.preventDefault(),e.stopPropagation(),this.onClick(e)},onContext:function(e){return this.state.contextMenu?void this.setState({contextMenu:!1}):(this.props.onContext(e,this.props.contact,this.onContextClose),void this.setState({contextMenu:!0}))},onContextClose:function(){this.setState({contextMenu:!1})},indicateFocus:function(e){if(!(Date.now()-(o["default"].flashFocus||0)>200)){var t=c.findDOMNode(this.refs.cell);Velocity(t,"stop"),Velocity(t,{backgroundColor:["#e9eaeb","#cbdde7"]},{duration:1300,easing:[.19,.69,.01,.99],complete:this.onBlur})}},onBlur:function(e){var t=c.findDOMNode(this.refs.cell);t&&(Velocity(t,"stop"),t.style.backgroundColor="")},render:function(){var e=this.props,t=e.contact,n=e.secondary,i=e.onContext,a=e.onDelete,s=e.contextEnabled,r=e.contextMenu,c=e.admin,h=e.showNotifyName,f=e.className;f=m("contact",f,{active:!!this.state.active});var v=void 0,y=void 0,_=void 0;if(!t.name&&h&&this.state.notifyName&&(_=l.createElement("span",{className:"ellipsify screen-name"},l.createElement(g,{className:"screen-name-text",direction:"auto",text:this.state.notifyName}))),c&&(y=l.createElement("div",{className:"chat-meta"},l.createElement("div",{className:"chat-marker chat-marker-admin"},l10n.t("web_group_admin")))),a){var C=m("icon",{"icon-x-alt-small":this.props.type===b.SMALL,"icon-x-alt":this.props.type!==b.SMALL});v=l.createElement("div",{className:"chat-controls"},l.createElement("button",{className:C,onClick:this.onDelete}))}n||(n=E.STATUS_V2?l.createElement(p,{status:t.status}):null),i&&(i=this.onContext);var M=this.props.type===b.SMALL?26:d.Size.DEFAULT,S=l.createElement("div",{className:"chat-avatar"},l.createElement(d,{id:t.id,size:M})),T={enter:this.onEnter},w=this.props.mouseDownAsClick;return l.createElement(o["default"],{handlers:T,onFocus:this.indicateFocus,onBlur:this.onBlur},l.createElement(u,{id:t.id,ref:"cell",className:f,contextEnabled:s||this.contextEnabled,contextMenu:r,pendingAction:this.state.pendingAction,detail:v,image:S,primary:this.state.formattedName,searchText:this.props.searchText,primaryDetail:y,secondary:n,secondaryDetail:_,onClick:w?null:this.onClick,onMouseDown:w?this.onMouseDown:null,onContext:i}))}});C.Type=b,e.exports=C},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t,n,i){this.key=e,this.src=t,this.crossOrigin=n,this.noXHR=i,this.isHttp="/"===t[0]||N.isHttp(t),this.hasPrivacyChecks=!0,this.promise=null,this.retainCount=0,this.generation=0}function s(e){var t=e.src,n=e.crossOrigin,i=e.noXHR,s=e.hasPrivacyChecks;n=!!n,i=!!i;var r="CO:"+(n?"y":"n")+",XHR:"+(i?"y":"n")+","+t,l=A[r];if(l)return l.retainCount++,l.generation=0,s||(l.hasPrivacyChecks=!1),l;var u=new a(r,t,n,i);return A[r]=u,u.retainCount++,u.promise=c["default"].loop(function(e){var n=u.generation++;if(n>I)throw new P.GaveUpRetry("Too many image retries "+u.src);return c["default"].delay(Math.floor(1e3*x.expBackoff(n,60,0))).then(function(){return u.hasPrivacyChecks&&!b["default"].phoneActive&&n>0?w.waitForBBEvent(b["default"],"change:phoneActive",R.matches({phoneActive:!0})):T.waitForOnline}).cancellable().then(function(){return!(0!==n&&u.isHttp&&!u.noXHR)||k.get(t).timeout(3e4,"imageTagRetryTimeout").then(function(e){var t=e.status;if(t>=200&&t<400)return!0;if(t>=500)return!1;throw new P.ServerStatusError(null,u.src,t)},function(){return!1})}).then(function(t){if(t)return O.loadImage(u.src,u.crossOrigin).then(function(t){t.src="",e()})["catch"](function(){if(!u.isHttp)throw new P.ImageError("Invalid Data URI",u.src)})})}).cancellable()["finally"](function(){o(u)}),u}function r(e){--e.retainCount<=0&&(o(e),e.promise.cancel())}function o(e){e===A[e.key]&&delete A[e.key]}Object.defineProperty(t,"__esModule",{value:!0}),t.Component=void 0;var l=n(2),c=i(l),u=n(15),d=i(u),p=n(5),h=i(p),f=n(6),m=i(f),g=n(19),v=i(g),y=n(18),E=i(y),_=n(112),b=i(_),C=n(1456),M=i(C),S=n(8),T=n(78),w=n(38),k=n(96),P=n(12),N=n(46),x=n(62),D=n(9),O=n(461),R=n(23),I=10,A={},L=function(e){function t(e){(0,h["default"])(this,t);var n=(0,v["default"])(this,(0,d["default"])(t).call(this,e));return n.state=n._initSrc(e),n}return(0,E["default"])(t,e),(0,m["default"])(t,[{key:"componentWillReceiveProps",value:function(e){this.props.src!==e.src&&this.setState(this._initSrc(e))}},{key:"_initSrc",value:function(e){var t=e.src;if(t){if(O.isCached(t))return{src:t};this.ensureLoaded(e)}return{src:null}}},{key:"componentWillUnmount",value:function(){this.ensureLoadedQuery&&r(this.ensureLoadedQuery)}},{key:"ensureLoaded",value:function(e){var t=this,n=this.ensureLoadedQuery,i=this.ensureLoadedQuery=s(e);n&&r(n),n!==i&&i.promise.checkpoint(this.props.rejectOnUnmount()).then(function(){i===t.ensureLoadedQuery&&(t.setState({src:t.props.src}),t.props.onLoaded&&t.props.onLoaded())})["catch"](P.ImageError,P.ServerStatusError,P.GaveUpRetry,function(e){i===t.ensureLoadedQuery&&(t.props.rejectOnUnmount().isRejected()||t.props.onError&&t.props.onError(e))})["catch"](P.Unmount,c["default"].CancellationError,R.noop)}},{key:"render",value:function(){var e=this.state.src,t=this.props,n=t.onLoad,i=t.alt,a=t.onClick,s=t.onMouseMove,r=t.style,o=t.className,l=t.draggable;return e||(e=D.ONE_BY_ONE_TRANS_GIF,n=void 0),l=!!l,S.createElement("img",{src:e,alt:i,onLoad:n,onClick:a,onMouseMove:s,style:r,draggable:l,className:o})}}]),t}(S.Component);L.defaultProps={crossOrigin:!0};t.Component=L;t["default"]=(0,M["default"])(L)},function(e,t,n){"use strict";var i=n(8),a=n(44),s=n(154),r=n(43),o={CONTAIN:"contain",COVER:"cover",SCALE_DOWN:"scaleDown",ZOOM_IN:"zoomIn"},l=i.createClass({displayName:"ObjectFit",mixins:[s],propTypes:{children:i.PropTypes.node.isRequired,type:i.PropTypes.oneOf(_.values(o)).isRequired,size:i.PropTypes.shape({width:i.PropTypes.number.isRequired,height:i.PropTypes.number.isRequired}),style:i.PropTypes.object,zoomIn:i.PropTypes.shape({factor:i.PropTypes.number,translateX:i.PropTypes.number,translateY:i.PropTypes.number}),onObjectLoad:i.PropTypes.func},statics:{TYPES:o},getInitialState:function(){return{style:this.props.size,className:"object-fit",computed:!1}},componentDidMount:function(){if(!this.shouldUseNativeObjectFit()){this.initialize();
var e=this;this.regNativeListener(window,"resize",function(){e.initialize()})}},componentWillReceiveProps:function(e){this.initialize(e)},initialize:function(e){var t=this;this.shouldUseNativeObjectFit()||(e=e||this.props,e.size&&this.setState(this[e.type](e.size.width,e.size.height,e.zoomIn),function(){_.isFunction(t.props.onObjectLoad)&&t.props.onObjectLoad(t.refs.object.firstChild)}))},shouldUseNativeObjectFit:function(){return!1},cover:function(e,t){var n=a.findDOMNode(this),i=n.clientWidth,s=n.clientHeight,r=e,o=t,l=0,c=0;return r!==i&&(o*=i/r,r=i,o>s&&(l=s/2-o/2)),o<s&&(r*=s/o,o=s,r>i&&(c=i/2-r/2)),{style:{width:r,height:o,top:l,left:c,position:"absolute"},className:"object-fit object-fit-cover",computed:!0}},contain:function(e,t){var n=a.findDOMNode(this),i=n.clientWidth,s=n.clientHeight,r=e,o=t,l=0,c=0,u=r/i,d=o/s;return u>d?(o*=i/r,r=i,o<s&&(l=s/2-o/2)):(r*=s/o,o=s,r<i&&(c=i/2-r/2)),{style:{width:r,height:o,top:l,left:c,position:"absolute"},className:"object-fit object-fit-contain",computed:!0}},scaleDown:function(e,t){var n=a.findDOMNode(this),i=n.clientWidth,s=n.clientHeight,r=t,o=e;return r>s&&(r=s,o=e*(s/t)),o>i&&(o=i,r=t*(i/e)),{style:{width:o,height:r},className:"object-fit object-fit-scaledown",computed:!0}},zoomIn:function(e,t,n){var i=this.scaleDown(e,t);return i.className+=" object-fit-zoomin",i.style.transition="transform 300ms cubic-bezier(.1,.82,.25,1)",n&&(i.style.transform="translateX("+n.translateX+"px) translateY("+n.translateY+"px) scale("+n.factor+")"),i},render:function(){if(this.shouldUseNativeObjectFit())return i.createElement("div",{className:"native-scale-down"},this.props.children);var e=this.state.computed?this.state.style:{visibility:"hidden"};return i.createElement("div",{style:this.props.style,className:r(this.state.className)},i.createElement("div",{style:e,ref:"object"},this.props.children))}});e.exports=l},function(e,t,n){"use strict";var i=n(8),a=n(154),s=n(43),r=i.createClass({displayName:"CheckBox",mixins:[a],propTypes:{checked:i.PropTypes.bool.isRequired,onChange:i.PropTypes.func.isRequired,disabled:i.PropTypes.bool},onToggle:function(e){e&&e.stopPropagation(),this.props.onChange()},render:function(){var e=s("checkbox",{checked:this.props.checked,unchecked:!this.props.checked,disabled:this.props.disabled});return i.createElement("div",{className:"checkbox-container",onClick:this.onToggle},i.createElement("div",{className:e,ref:"checkbox"},i.createElement("div",{className:"checkmark"})))}});e.exports=r},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(158),s=i(a),r=n(160),o=i(r),l=n(8),c=n(10),u=n(93),d=l.createClass({displayName:"UIEMenu",propTypes:{contextMenu:l.PropTypes.object.isRequired},componentDidMount:function(){var e=this,t=this.props.contextMenu,n=t.menu,i=(0,o["default"])(t,["menu"]);c.openContextMenu(n,(0,s["default"])({},i),this.context.uim,function(t){return e.element=t})},componentWillUnmount:function(){c.closeContextMenu(this.context.uim)},getElement:function(){return this.element},render:function(){return null}});d.contextTypes={uim:l.PropTypes.instanceOf(u)},e.exports=d},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(158),s=i(a),r=n(160),o=i(r),l=n(8),c=n(458),u=n(1416),d=n(43),p=l.createClass({displayName:"DrawerSection",propTypes:{children:l.PropTypes.node.isRequired,title:l.PropTypes.node,subtitle:l.PropTypes.node,titleOnClick:l.PropTypes.func,footer:l.PropTypes.node,classes:l.PropTypes.string,onMouseDown:l.PropTypes.func,noContainer:l.PropTypes.bool,a8n:l.PropTypes.string},getDefaultProps:function(){return{noContainer:!1}},render:function(){var e=this.props,t=e.children,n=e.title,i=e.subtitle,a=e.footer,r=e.classes,p=e.onMouseDown,h=e.noContainer,f=e.titleOnClick,m=e.a8n,g=(0,o["default"])(e,["children","title","subtitle","footer","classes","onMouseDown","noContainer","titleOnClick","a8n"]),v=d(r,"drawer-section",{well:!!n});if(!n)return l.createElement("div",{className:v},t);var y=i?i:null,E=t;return!h&&E&&(E=l.createElement("div",{className:"drawer-section-body"},t)),l.createElement("div",(0,s["default"])({className:v,onMouseDown:p},g),l.createElement(u,{classes:"drawer-section-title",side:y,ellipsify:!0,"data-a8n":c.key(m),onClick:f},n),E,a)}});e.exports=p},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(453),s=i(a),r=n(8),o=n(10),l=n(454),c=r.createClass({displayName:"MediaMissingModal",propTypes:{msg:r.PropTypes.instanceOf(s["default"]).isRequired},render:function(){var e=void 0,t=void 0;switch(this.props.msg.type){case s["default"].TYPE.VIDEO:e=l10n.t("missing_video_title"),t=l10n.t("missing_video_text");break;case s["default"].TYPE.AUDIO:e=l10n.t("missing_audio_title"),t=l10n.t("missing_audio_text");break;case s["default"].TYPE.IMAGE:e=l10n.t("missing_photo_title"),t=l10n.t("missing_photo_text");break;case s["default"].TYPE.DOCUMENT:e=l10n.t("missing_document_title"),t=l10n.t("missing_document_text")}return r.createElement(l,{title:e,onOK:o.closeModal.bind(o),okText:l10n.t("web_ok")},t)}});e.exports=c},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(230),s=i(a),r=n(8),o=n(43),l=r.createClass({displayName:"Modal",propTypes:{type:r.PropTypes.oneOf(["compact","box","tower"]),classes:r.PropTypes.string,title:r.PropTypes.string,children:r.PropTypes.node.isRequired},getDefaultProps:function(){return{classes:"",type:"compact"}},statics:{COMPACT:"compact",BOX:"box",TOWER:"tower"},render:function(){var e=this.props.title?r.createElement("div",{className:"popup-title",dir:"auto"},this.props.title):null,t=o("popup",this.props.classes,(0,s["default"])({},"popup-"+this.props.type,this.props.type!==l.COMPACT));return r.createElement("div",{className:"backdrop"},r.createElement("div",{className:"popup-container"},r.createElement("div",{className:t},r.createElement("div",{className:"popup-body"},e,r.createElement("div",{className:"popup-contents"},this.props.children)))))}});e.exports=l},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(453),s=i(a),r=n(8),o=n(454),l=n(10),c=r.createClass({displayName:"RemoteUpload",propTypes:{msg:r.PropTypes.instanceOf(s["default"]).isRequired},render:function(){var e,t;switch(this.props.msg.type){case s["default"].TYPE.IMAGE:e=l10n.t("retry_upload_photo_title"),t=l10n.t("retry_upload_photo_text");break;case s["default"].TYPE.VIDEO:e=l10n.t("retry_upload_video_title"),t=l10n.t("retry_upload_video_text");break;case s["default"].TYPE.AUDIO:case s["default"].TYPE.PTT:e=l10n.t("retry_upload_audio_title"),t=l10n.t("retry_upload_audio_text");break;case s["default"].TYPE.DOCUMENT:e=l10n.t("retry_upload_doc_title"),t=l10n.t("retry_upload_doc_text");break;default:e=l10n.t("retry_upload_media_title"),t=l10n.t("retry_upload_media_text")}return r.createElement(o,{title:e,onOK:l.closeModal.bind(l),okText:l10n.t("web_ok")},t)}});e.exports=c},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(453),s=i(a),r=n(77),o=n(455),l=(0,r.defineState)("MsgLoad",{props:{noEarlierMsgs:"boolean",isLoadingEarlierMsgs:"boolean",isLoadingRecentMsgs:"boolean",isLoadingAroundMsgs:"boolean",contextLoaded:"boolean"}}),c=l.MsgLoad,u=l.MsgLoadProxy,d=o.extend({model:s["default"],initialize:function(){o.prototype.initialize.call(this),this.msgLoadState=new c({noEarlierMsgs:!1,isLoadingEarlierMsgs:!1,isLoadingRecentMsgs:!1,isLoadingAroundMsgs:!1,contextLoaded:!1}),this.listenTo(this,"add remove reset sort",this.triggerChangeLast)},"delete":function(){this.stopListening(),o.prototype["delete"].call(this),this.msgLoadState["delete"]()},triggerChangeLast:function(){var e=this.last();this._last!==e&&(this._last=e,this.trigger("change:last",e))},add:function(e,t){var n=this,i=o.prototype.add.apply(this,arguments),a=Store.Msg.add(i,t);return _.isArray(a)?a.forEach(function(e){n.isModel(e)&&(e.msgChunk=n)}):this.isModel(a)&&(a.msgChunk=this),i&&this.trigger("bulk_add",i,t),i},replace:function(e){var t=this;this.msgLoadState=e.msgLoadState,this.loadRecentPromise=e.loadRecentPromise,this.loadEarlierPromise=e.loadEarlierPromise,this.loadAroundPromise=e.loadAroundPromise,this.set(e.models,{silent:!0,merge:!1}),e.models.forEach(function(e){t.isModel(e)&&(e.msgChunk=t)}),this.trigger("bulk_add",e.models)}});d.MsgLoad=c,d.MsgLoadProxy=u,e.exports=d},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r={scrollIntoViewIfNeeded:function(e){var t=arguments.length<=1||void 0===arguments[1]||arguments[1],n=arguments[2];if(_.isFunction(e.scrollIntoViewIfNeeded))return e.scrollIntoViewIfNeeded(t);n=n||e.parentNode;var i=window.getComputedStyle(n,null),a=parseInt(i.getPropertyValue("border-top-width")),s=e.offsetTop-n.offsetTop<n.scrollTop,r=e.offsetTop-n.offsetTop+e.clientHeight-a>n.scrollTop+n.clientHeight,o=s&&!r;return(s||r)&&t&&(n.scrollTop=e.offsetTop-n.offsetTop-n.clientHeight/2-a+e.clientHeight/2),!s&&!r||t||e.scrollIntoView(o),!(s||r)},scrollIntoView:function(e){var t=arguments.length<=1||void 0===arguments[1]||arguments[1],n=arguments[2];n=n||e.parentNode;var i=window.getComputedStyle(n,null),a=parseInt(i.getPropertyValue("border-top-width")),s=e.offsetTop-n.offsetTop<n.scrollTop,r=e.offsetTop-n.offsetTop+e.clientHeight-a>n.scrollTop+n.clientHeight,o=s&&!r;return t?n.scrollTop=e.offsetTop-n.offsetTop-n.clientHeight/2-a+e.clientHeight/2:e.scrollIntoView(o),!(s||r)},scrollAt:function(e,t,n){n=n||{};var i=n.pos||"center",a=n.duration||1e3;switch(t=t||e.offsetParent,i){case"top":return t.scrollTop=e.offsetTop,s["default"].resolve();case"bottom":return t.scrollTop=e.offsetTop+e.clientHeight-t.clientHeight,s["default"].resolve();case"center":return n.animate?(Velocity(e,"stop"),Velocity(t,"stop"),Velocity(e,"scroll",{duration:a,container:t,offset:(e.clientHeight-t.clientHeight)/2,easing:n.easing})):(t.scrollTop=e.offsetTop+e.clientHeight/2-t.clientHeight/2,s["default"].resolve());case"offset":var r=n.offset||0;return n.animate?(Velocity(e,"stop"),Velocity(t,"stop"),Velocity(e,"scroll",{duration:a,container:t,offset:-r,easing:n.easing})):(t.scrollTop=e.offsetTop-r,s["default"].resolve())}return s["default"].resolve()}};e.exports=r},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(8),s=i(a),r=n(1452),o=i(r),l=n(1422),c=i(l),u=n(109),d=i(u),p=n(462),h=i(p),f=n(43),m=i(f),g=n(155),v=i(g),y=n(1411),E=i(y),_=n(110),b=i(_),C=n(229),M=i(C),S=n(1380),T=i(S),w=s["default"].createClass({displayName:"TextInput",propTypes:{placeholder:s["default"].PropTypes.string,value:s["default"].PropTypes.string,error:s["default"].PropTypes.string,lowProfile:s["default"].PropTypes.bool,multiline:s["default"].PropTypes.bool,supportsEmoji:s["default"].PropTypes.bool,onChange:s["default"].PropTypes.func.isRequired,onBlur:s["default"].PropTypes.func,onFocus:s["default"].PropTypes.func,onEnter:s["default"].PropTypes.func,onFiles:s["default"].PropTypes.func,maxLength:s["default"].PropTypes.number,showRemaining:s["default"].PropTypes.bool,editable:s["default"].PropTypes.bool,spellCheck:s["default"].PropTypes.bool,focusOnMount:s["default"].PropTypes.bool,className:s["default"].PropTypes.oneOfType([s["default"].PropTypes.string,s["default"].PropTypes.arrayOf(s["default"].PropTypes.string),s["default"].PropTypes.objectOf(s["default"].PropTypes.bool)]),lockable:s["default"].PropTypes.bool,pending:s["default"].PropTypes.bool,onCancel:s["default"].PropTypes.func,onSave:s["default"].PropTypes.func,onError:s["default"].PropTypes.func,validate:s["default"].PropTypes.func},getDefaultProps:function(){return{maxLength:25,editable:!0}},getInitialState:function(){return{active:!1,locked:this.props.lockable,emojiPicker:!1}},componentDidMount:function(){this.props.focusOnMount&&this.restoreFocus()},onEmojiPicker:function(e){e&&(e.preventDefault(),e.stopPropagation());var t=s["default"].createElement(c["default"],{onEmoji:this.onEmoji,onFocusRelease:this.restoreFocus});this.setState({emojiPicker:{menu:t,menuDirection:{y:h["default"].Direction.Y.TOP},type:h["default"].Type.EMOJI_PICKER,anchor:e.target}}),this.restoreFocus()},emojiPickerClose:function(){this.setState({emojiPicker:!1})},restoreEmojiPickerFocus:function(){this.refs.emojiPickerUIE&&this.refs.emojiPickerUIE.getRef()&&this.refs.emojiPickerUIE.getRef().getElement()&&this.refs.emojiPickerUIE.getRef().getElement().restoreFocus()},onEmoji:function(e){this.refs.inputLine.restoreFocus(!1),this.refs.inputLine.replaceSelection(e)},onEnter:function(){this.props.lockable&&this.onSaveAndLock(),this.props.onEnter&&!this.props.multiline&&this.props.onEnter()},onChange:function(e){this.props.onChange&&this.props.onChange(e)},restoreFocus:function(){this.refs.inputLine&&this.refs.inputLine.restoreFocus()},onBlur:function(e){this.state.active&&this.setState({active:!1}),this.props.onBlur&&this.props.onBlur(e)},onFocus:function(e){e.stopPropagation(),this.state.active||this.setState({active:!0}),this.props.onFocus&&this.props.onFocus(e);var t=this.refs.uiTextInput;t&&t.raiseToTop()},onUnlock:function(e){this.setState({locked:!1})},onSaveAndLock:function(e){var t=!(!this.props.lowProfile&&this.props.error);this.props.validate&&t&&(t=this.props.validate(this.props.value)),t?(this.props.onSave&&this.props.onSave(),this.setState({locked:!0})):this.props.onError&&this.props.onError()},onCancel:function(){this.props.onCancel&&this.props.onCancel(),this.setState({locked:!0})},render:function(){var e=this.props.editable&&!this.state.locked,t=e&&!!this.props.error&&!this.props.lowProfile,n=E["default"].multibyteLength(this.props.value||""),i=this.props.maxLength-n<50&&e,a={container:(0,m["default"])("text-input",this.props.className,{"no-placeholder":!this.props.placeholder,active:e}),label:(0,m["default"])("label-text",{"label-text-float":!!this.props.value}),inputWrapper:(0,m["default"])("input-wrapper",{"input-text-error":t,"input-text-active":this.state.active,locked:this.state.locked}),infoWrapper:(0,m["default"])("input-info-strip",{"input-text-error":t,"input-text-active":this.state.active})},r=this.props.showRemaining?s["default"].createElement("div",{className:"control-button-container char-counter"},s["default"].createElement("div",{className:"char-counter"},i?this.props.maxLength-n:null)):null,l=e&&this.props.supportsEmoji?s["default"].createElement("button",{className:"icon icon-emoji icon-emoji-input",onClick:this.onEmojiPicker}):void 0,c=void 0;this.props.lockable&&(this.props.pending?c=s["default"].createElement("div",{className:"icon icon-spinner"},s["default"].createElement(v["default"],{size:18,stroke:6})):this.state.locked?this.props.editable&&(c=s["default"].createElement("span",{className:"lock-icon icon icon-pencil",onClick:this.onUnlock,key:"btn-edit",title:l10n.t("edit_button")})):c=s["default"].createElement("span",{className:"lock-icon icon icon-checkmark",onClick:this.onSaveAndLock,key:"btn-done",title:l10n.t("click_to_save_esc_to_cancel")}),c=s["default"].createElement(d["default"],{transitionName:"pop",component:"div",className:"control-button-container"},c));var u=this.props.lowProfile?null:s["default"].createElement("div",{className:a.infoWrapper},s["default"].createElement("div",{className:"error-text"},t?this.props.error:null)),p=void 0;if(this.props.lockable&&!this.state.locked){var h=void 0;this.state.emojiPicker&&(h=s["default"].createElement(M["default"],{displayName:"EmojiPicker",escapable:!0,popable:!0,ref:"emojiPickerUIE",requestDismiss:this.emojiPickerClose,requestFocus:this.restoreEmojiPickerFocus},s["default"].createElement(T["default"],{contextMenu:this.state.emojiPicker}))),p=s["default"].createElement(M["default"],{displayName:"TextInput",escapable:!0,requestFocus:this.restoreFocus,requestDismiss:this.onCancel},s["default"].createElement("div",null,h))}else!this.props.lockable&&this.state.emojiPicker&&(p=s["default"].createElement(M["default"],{displayName:"EmojiPicker",escapable:!0,popable:!0,ref:"emojiPickerUIE",requestDismiss:this.emojiPickerClose,requestFocus:this.restoreEmojiPickerFocus},s["default"].createElement(T["default"],{contextMenu:this.state.emojiPicker})));return s["default"].createElement(b["default"],{className:a.container,onFocus:this.restoreFocus},s["default"].createElement("span",{className:a.label},this.props.placeholder),s["default"].createElement("div",{className:"input-spacer"}),s["default"].createElement("div",{className:a.inputWrapper,"data-trump-dominateparent":"click"},s["default"].createElement(o["default"],{ref:"inputLine",value:this.props.value,className:"input-text",multiline:this.props.multiline,onChange:this.onChange,onFocus:this.onFocus,onBlur:this.onBlur,onEnter:this.onEnter,onFiles:this.props.onFiles,focusOnChange:!1,spellCheck:this.props.spellCheck,maxLength:this.props.maxLength,showRemaining:this.props.showRemaining,editable:this.props.editable&&!this.state.locked}),s["default"].createElement("div",{className:"textinput-controls"},c,s["default"].createElement(d["default"],{transitionName:"pop",component:"div",className:"control-button-container"},l),r)),u,p)}});e.exports=w},function(e,t,n){"use strict";var i=n(8),a=n(43),s=n(458),r=i.createClass({displayName:"DrawerListItem",propTypes:{onClick:i.PropTypes.func,iconClass:i.PropTypes.string,className:i.PropTypes.string,a8n:i.PropTypes.string.isRequired},render:function(){var e=this.props,t=e.onClick,n=e.iconClass,r=e.className,o=e.children,l=n?i.createElement("div",{className:"chat-avatar"},i.createElement("div",{className:"avatar"},i.createElement("span",{className:a("icon",n)}))):null;return i.createElement("div",{className:a("chat",r),"data-ignore-capture":"any"},i.createElement("div",{className:"chat-cell",onClick:t,"data-a8n":s.key(this.props.a8n)},l,i.createElement("div",{className:"chat-body"},i.createElement("div",{className:"chat-main"},i.createElement("div",{className:"chat-title"},i.createElement("span",{className:"emojitext ellipsify",dir:"auto"},o))))))}});e.exports=r},function(e,t,n){"use strict";var i=n(8),a=n(9),s=n(454),r=n(10),o=n(58),l={GUIDE_ALLOW:"guide-allow",GUIDE_UNBLOCK:"guide-unblock",GUIDE_NONE:"guide-none"},c={CHROME_MEDIA_ERROR:"__chrome_media_error__",FIREFOX_LOCK:"__firefox_lock__",OPERA_MEDIA:"__opera_media__"},u=i.createClass({displayName:"GuidePopup",propTypes:{title:i.PropTypes.string.isRequired,desc:i.PropTypes.string.isRequired,browserPrefixDesc:i.PropTypes.bool.isRequired,type:i.PropTypes.oneOf(_.values(l)).isRequired,onConfirm:i.PropTypes.func,onCancel:i.PropTypes.func},statics:{TYPE:l},getDefaultProps:function(){return{browserPrefixDesc:!0,type:l.GUIDE_NONE,onConfirm:r.closeModal.bind(r)}},componentDidMount:function(){var e=this.getDescription(),t=this.refs.description;e.indexOf(c.CHROME_MEDIA_ERROR)>-1&&(t.innerHTML=t.innerHTML.replace(c.CHROME_MEDIA_ERROR,'<span class="chrome-media-icon"></span>')),e.indexOf(c.FIREFOX_LOCK)>-1&&(t.innerHTML=t.innerHTML.replace(c.FIREFOX_LOCK,'<span class="firefox-lock-icon"></span>')),e.indexOf(c.OPERA_MEDIA)>-1&&(t.innerHTML=t.innerHTML.replace(c.OPERA_MEDIA,'<span class="opera-media-icon"></span>'))},getDescription:function(){var e=this.props.desc+"_"+o.browser;return this.props.browserPrefixDesc&&l10n.hasT(e)?l10n.t(e):l10n.t(this.props.desc)},render:function(){var e="popup-guide";if(o.browser===a.BROWSER_TYPE.CHROME)switch(o.os){case a.OS_TYPE.MAC:e+=" popup-guide-mac";break;case a.OS_TYPE.CHROMEOS:e+=" popup-guide-chrome";break;case a.OS_TYPE.WINDOWS:}var t=null;this.props.type!==l.GUIDE_NONE&&o.browser===a.BROWSER_TYPE.CHROME&&(t=i.createElement("div",{className:"round"},i.createElement("div",{className:"round-body "+this.props.type})));var n=this.props.onCancel?l10n.t("learn_more"):void 0;return i.createElement(s,{title:l10n.t(this.props.title),classes:e,onOK:this.props.onConfirm,okText:l10n.t("ok_got_it"),onCancel:this.props.onCancel,cancelText:n},t,i.createElement("div",{className:"text text-tip",ref:"description"},this.getDescription()))}});e.exports=u},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.Mode=void 0;var a=n(15),s=i(a),r=n(5),o=i(r),l=n(6),c=i(l),u=n(19),d=i(u),p=n(18),h=i(p),f=n(1354),m=(i(f),n(1417)),g=i(m),v=n(1497),y=i(v),E=n(1362),_=i(E),b=n(1368),C=i(b),M=n(110),S=i(M),T=n(1432),w=i(T),k=n(1493),P=i(k),N=n(1371),x=n(23),D=i(x),O=n(8),R=n(44),I=n(1375),A=n(1361),L=n(1438),F=n(1508),U=n(1435),G=n(1517),j=n(1436),B=n(9),V=n(10),q=n(43),H=n(1386),z=n(1481),W=n(12),Y=n(1380),K=n(229),Q=n(92),X=n(463),Z=n(157),J=t.Mode={LAST:"last",INFO:"info"},$=function(e){function t(e){(0,o["default"])(this,t);var n=(0,d["default"])(this,(0,s["default"])(t).call(this,e));ee.call(n);var i=e.active,a=e.chat;return n.state={active:!!i&&i.value===a,dragging:!1,contextMenu:void 0},n}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"componentWillMount",value:function(){var e=this.props,t=e.active,n=e.chat;t&&this.props.listeners.add(t,n.id,this.onActiveChange)}},{key:"render",value:function(){var e=this.props,t=e.chat,n=e.mode,i=e.secondary,a=e.className;a=q(a,{unread:t.hasUnread,active:!!this.state.active,"chat-drag":this.state.dragging});var s=void 0,r=void 0,o=void 0;switch(n){case J.LAST:s=O.createElement(w["default"],{chat:t}),i||(i=O.createElement(P["default"],{chat:t}),r=O.createElement(y["default"],{chat:t,mute:t.mute})),o={enter:this.onEnter},o[Z.LR("right","left")]=this.openContextMenu;break;case J.INFO:i||(i=t.isGroup?O.createElement(j,{presence:t.presence,groupMetadata:t.groupMetadata,location:"list"}):O.createElement(g["default"],{presence:t.presence,chatstate:t.presence.chatstate,location:m.Location.LIST})),o={enter:this.onEnter}}var l=O.createElement("div",{className:"chat-avatar"},O.createElement(A,{id:t.id,size:A.Size.NONE})),c=this.props.mouseDownAsClick,u=void 0;this.state.contextMenu&&(u=O.createElement(K,{displayName:"ChatContextMenu",escapable:!0,popable:!0,requestDismiss:this.removeContext},O.createElement(Y,{contextMenu:this.state.contextMenu})));var d=t.contact&&t.contact.isVerified;return O.createElement(S["default"],{handlers:o,onFocus:this.indicateFocus,onBlur:this.onBlur,className:"chat-drag-cover",onDragEnter:this.onDragEnter,onDragLeave:this.onDragLeave,onDrop:this.onDrop},O.createElement(I,{id:t.id,ref:(0,N.GetRef)("cell",this),className:a,contextEnabled:this.contextEnabled,pendingAction:t.pendingAction,contextMenu:!!this.state.contextMenu,image:l,primary:t.title(),searchText:this.props.searchText,primaryDetail:s,secondary:i,secondaryDetail:r,isVerified:t.isPSA||d,onClick:c?void 0:this.onClick,onMouseDown:c?this.onMouseDown:void 0,onContext:this.onMenu}),u)}}]),t}(O.PureComponent);$.CONCERNS={chat:["id","formattedTitle","hasUnread","isReadOnly","isGroup","pendingAction","canSend","isPSA","contact","presence","groupMetadata","mute"]},$.defaultProps={mode:J.LAST};var ee=function(){var e=this;this.hoverCounter=0,this.onActiveChange=function(t,n){if("focus"===t){var i=R.findDOMNode(e);Q.focus(i),n&&H.scrollIntoViewIfNeeded(i)}e.setState({active:!!t})},this.contextEnabled=function(){var t=e.props,n=t.chat,i=t.noContext;return!i&&(n.mute.canMute()||n.canArchive()||n.canDelete()||n.canExit())},this.onMenu=function(t){if(e.state.contextMenu)return void e.setState({contextMenu:void 0});var n=e.props.chat,i=[];n.canArchive()&&i.push(O.createElement(F,{key:"archive",onArchive:e.onArchive,chat:n._ProxyState$state})),n.mute.canMute()&&i.push(O.createElement(L,{key:"mute",onMute:e.onMute,chat:n._ProxyState$state})),n.canDelete()&&i.push(O.createElement(U,{key:"delete",onDeleteOrExit:e.onDeleteOrExit,chat:n._ProxyState$state})),n.canMarkUnseen()&&i.push(O.createElement(G,{key:"mark_unread",onMarkUnread:e.onMarkUnread,chat:n._ProxyState$state})),t.event&&t.event.persist(),e.setState({contextMenu:{menu:i,event:t.event,anchor:t.anchor}})},this.removeContext=function(){e.setState({contextMenu:void 0})},this.onMute=function(t){V.muteChat(Store.Chat.get(e.props.chat.id),t,e)},this.onArchive=function(t){V.archiveChat(Store.Chat.get(e.props.chat.id),t)},this.onDeleteOrExit=function(){V.deleteOrExitChat(Store.Chat.get(e.props.chat.id),e)},this.onMarkUnread=function(t){V.markChatUnread(Store.Chat.get(e.props.chat.id),t)},this.onClick=function(t){D["default"].isFunction(e.props.onClick)&&e.props.onClick(t,Store.Chat.get(e.props.chat.id))},this.onMouseDown=function(t){0===t.button&&e.onClick(t)},this.onEnter=function(t){t.preventDefault(),t.stopPropagation(),S["default"].flashFocus=Date.now(),e.onClick(t)},this.onDragEnter=function(t){if(e.props.chat.canSend){var n=t.dataTransfer;D["default"].includes(n.types,B.DRAG_TYPE_FILE)&&(0===e.hoverCounter&&e.setState({dragging:!0}),e.hoverCounter+=1)}},this.onDragLeave=function(t){if(e.props.chat.canSend){var n=t.dataTransfer;D["default"].includes(n.types,B.DRAG_TYPE_FILE)&&(e.hoverCounter-=1,0===e.hoverCounter&&e.setState({dragging:!1}))}},this.onDrop=function(t){var n=e.props.chat;if(n.canSend){e.setState({dragging:!1});var i=t.dataTransfer;(D["default"].includes(i.types,B.DRAG_TYPE_FILE)||D["default"].includes(i.types,"text/uri-list")||D["default"].includes(i.types,"text/html"))&&z.getFiles(t,0).then(function(e){V.openChatFromUnread(Store.Chat.get(n.id)).then(function(t){t&&V.attachMediaDrawer(Store.Chat.get(n.id),e)})})["catch"](W.MediaDragDropError,function(e){V.openChatFromUnread(Store.Chat.get(n.id)).then(function(t){t&&V.pasteChatTextInput(Store.Chat.get(n.id),e.src)})})}},this.indicateFocus=function(t){if(!(Date.now()-(S["default"].flashFocus||0)>200)){var n=R.findDOMNode(e.cell);X(n,"stop"),X(n,{backgroundColor:["#e9eaeb","#cbdde7"]},{duration:1300,easing:[.19,.69,.01,.99],complete:e.onBlur})}},this.onBlur=function(t){var n=R.findDOMNode(e.cell);n&&(X(n,"stop"),n.style.backgroundColor="")},this.openContextMenu=function(){e.cell.openContextMenu()}};t["default"]=(0,C["default"])((0,_["default"])($))},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.Component=void 0;var a=n(15),s=i(a),r=n(5),o=i(r),l=n(6),c=i(l),u=n(19),d=i(u),p=n(18),h=i(p),f=n(8),m=n(44),g=n(1588),v=n(155),y=n(229),E=n(92),_=n(157),b=n(43),C=n(109),M=function(e){function t(){var e,n,i,a;(0,o["default"])(this,t);for(var r=arguments.length,l=Array(r),c=0;c<r;c++)l[c]=arguments[c];return n=i=(0,d["default"])(this,(e=(0,s["default"])(t)).call.apply(e,[this].concat(l))),i.state={searchText:"",isSearching:!1},i.onBlur=function(){return i.props.setTimeout(function(){i.state.searchText||i.onCancel()},0)},i.onChange=function(e){e.target instanceof HTMLInputElement&&!function(){var t=e.target.value;i.setState({searchText:t},function(){i.props.onSearch(t)})}()},i.onCancel=function(){i.refs.input.blur(),i.setState({searchText:"",isSearching:!1}),i.props.onSearch("")},i.onReset=function(e){e.stopPropagation(),i.focus(),i.setState({searchText:""}),i.props.onSearch("")},i.onSearchOn=function(){i.setState({isSearching:!0}),i.props.setTimeout(i.focus,0)},i.focus=function(){E.focus(i.refs.input)},a=n,(0,d["default"])(i,a)}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"componentWillReceiveProps",value:function(e){this.state.isSearching&&!this.state.searchText&&(m.findDOMNode(this).contains(document.activeElement)||this.onCancel())}},{key:"componentWillUnmount",value:function(){this.onCancel()}},{key:"isAtBeginning",value:function(){var e=this.refs.input;return 0===e.selectionStart&&0===e.selectionEnd}},{key:"isAtEnd",value:function(){var e=this.refs.input,t=e.value.length;return e.selectionStart===t&&e.selectionEnd===t}},{key:"render",value:function(){var e=this.props,t=e.loading,n=e.placeholder,i=e.spellCheck,a=this.state,s=a.isSearching,r=a.searchText,o=null;s&&(t?o=f.createElement("button",{className:"btn-context icon-spinner icon-x-alt",key:"icon-clear-search",onClick:this.onReset},f.createElement(v,{size:20,stroke:5})):r.length&&(o=f.createElement("button",{className:"icon icon-x-alt",key:"icon-clear-search",onClick:this.onReset})));var l=void 0;s&&(l=f.createElement(y,{displayName:"ListSearch",escapable:!0,requestDismiss:this.onCancel,requestFocus:this.focus}));var c=s?this.onCancel:this.onSearchOn,u=b("pane-subheader","pane-list-subheader","subheader-search",{active:s});return f.createElement("div",{className:u},f.createElement("button",{className:"icon icon-search-morph",onMouseDown:c},f.createElement("div",{className:"icon icon-back-blue"}),f.createElement("div",{className:"icon icon-search"})),f.createElement(C,{transitionName:"pop"},o),f.createElement("div",{className:"input-placeholder"},r?null:n),f.createElement("label",{htmlFor:"input-chatlist-search",className:"cont-input-search"},f.createElement("input",{type:"text",ref:"input",className:"input input-search","data-tab":2,dir:"auto",spellCheck:i,title:n,value:r,onBlur:this.onBlur,onFocus:s?null:this.onSearchOn,onChange:s?this.onChange:null})),l)}}]),t}(f.Component);M.defaultProps={placeholder:_.t("search_or_start_new_chat")};t.Component=M;t["default"]=g(M)},function(e,t,n){"use strict";var i=n(8),a=n(1373),s=n(155),r=i.createClass({displayName:"Pending",render:function(){return i.createElement("div",{className:"media-state-controls"},i.createElement("button",{className:"icon-media icon-media-disabled"},i.createElement(s,{size:50,stroke:3})))}}),o=i.createClass({displayName:"PendingCancel",render:function(){return i.createElement("div",{className:"media-state-controls"},i.createElement("button",{className:"icon-xl icon-media-cancel"},i.createElement(s,{size:50,stroke:3})))}}),l=i.createClass({displayName:"Cancel",render:function(){return i.createElement("div",{className:"media-state-controls"},i.createElement("button",{className:"icon-xl icon-media-download"}))}}),c=i.createClass({displayName:"Download",propTypes:{filesize:i.PropTypes.number,onClick:i.PropTypes.func},render:function(){var e=this.props.onClick||null,t=this.props.filesize||0;return t>0?i.createElement("div",{className:"media-state-controls"},i.createElement("button",{className:"btn-meta",onClick:e},i.createElement("span",{className:"icon-xl icon-media-download-noborder"}),i.createElement(a,null,l10n.filesize(this.props.filesize)))):i.createElement("div",{className:"media-state-controls"},i.createElement("button",{className:"icon-xl icon-media-download",onClick:e}))}}),u=i.createClass({displayName:"Upload",propTypes:{filesize:i.PropTypes.number.isRequired},render:function(){return this.props.filesize>0?i.createElement("div",{className:"media-state-controls"},i.createElement("button",{className:"btn-meta"},i.createElement("span",{className:"icon-xl icon-media-upload-noborder"}),i.createElement(a,null,l10n.filesize(this.props.filesize)))):i.createElement("div",{className:"media-state-controls"},i.createElement("button",{className:"icon-xl icon-media-upload"}))}}),d=i.createClass({displayName:"Play",render:function(){return i.createElement("div",{className:"media-state-controls"},i.createElement("button",{className:"icon-xl icon-media-play"}))}}),p=i.createClass({displayName:"Missing",render:function(){var e;switch(this.props.msg.type){case"image":e=l10n.t("missing_photo_title");break;case"video":e=l10n.t("missing_video_title");break;case"audio":e=l10n.t("missing_audio_title")}return i.createElement("div",{className:"media-state-controls"},i.createElement("button",{className:"btn-meta missing-text"},e))}});e.exports={Pending:r,Cancel:l,PendingCancel:o,Download:c,Upload:u,Play:d,Missing:p}},function(e,t,n){"use strict";var i=n(8),a=n(109),s=n(458),r=n(43),o=n(229),l=i.createClass({displayName:"MenuBar",propTypes:{children:i.PropTypes.node},render:function(){return i.createElement("div",{className:"menu menu-horizontal"},this.props.children)}}),c=i.createClass({displayName:"MenuBarItem",propTypes:{icon:i.PropTypes.string.isRequired,title:i.PropTypes.string.isRequired,children:i.PropTypes.node,transitionName:i.PropTypes.string,onClick:i.PropTypes.func,a8n:i.PropTypes.string.isRequired},getDefaultProps:function(){return{transitionName:"dropdown"
}},getInitialState:function(){return{active:!1}},onOpen:function(e){this.setState({active:!0})},onClose:function(e){this.setState({active:!1})},clickHandler:function(e){this.props.onClick&&this.props.onClick(e),e.isDefaultPrevented()||this.state.active||this.onOpen(e)},render:function(){var e=this,t=this.props,n=t.children,l=t.icon,c=t.transitionName,u=t.title,d=this.state.active,p=void 0;n&&d&&(p=i.createElement(o,{displayName:"MenuBarMenuItem",escapable:!0,popable:!0,requestDismiss:function(){return e.onClose()}},i.Children.only(n)));var h={container:r("menu-item",{active:d}),icon:"icon icon-"+l};return i.createElement("div",{"data-a8n":s.key(this.props.a8n),className:h.container},i.createElement("button",{className:h.icon,onMouseDown:this.clickHandler,title:u}),i.createElement(a,{transitionName:c},p))}});e.exports={MenuBar:l,MenuBarItem:c}},function(e,t){"use strict";e.exports=function(e){return!e.getModifierState("Shift")&&!e.getModifierState("Alt")&&!e.getModifierState("Control")}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(){switch(l["default"].SHOW_GIF_SEARCH){case"giphy":return u;case"tenor":default:return d}}Object.defineProperty(t,"__esModule",{value:!0}),t.BRAND_NAMES=t.GifInfo=t.TENOR=t.GIPHY=t.GAP_SIZE=t.TARGET_GIF_HEIGHT=void 0;var s=n(5),r=i(s);t.gifProvider=a;var o=n(9),l=i(o),c=t.TARGET_GIF_HEIGHT=130,u=(t.GAP_SIZE=6,t.GIPHY="giphy"),d=t.TENOR="tenor",p=0;t.GifInfo=function h(e,t,n,i,a,s,o){(0,r["default"])(this,h),this.rank=e,this.gifId=++p,this.url=t,this.previewUrl=n||t,this.nonVideoUrl=i,this.width=a,this.widthStr=a+"px",this.ratioStr=Math.ceil(100*c/a)+"%",this.attribution=s,this.trending=o},t.BRAND_NAMES={giphy:"GIPHY",tenor:"Tenor"}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.PresenceProxy=t["default"]=t.ChatstateProxy=t.Chatstate=void 0;var a=n(2),s=i(a),r=n(77),o=i(r),l=n(9),c=n(1),u=n(20),d=n(465),p=n(45),h=n(76),f=1500,m=2e3,g=(0,r.defineState)("Chatstate",{props:{id:"string",type:{type:"string",values:["available","unavailable","composing","recording"]},t:{type:"number",allowNull:!0},deny:"boolean"},session:{updateTime:"number",_expireTimerId:["number",!1,0]}}),v=g.Chatstate,y=g.ChatstateProxy;t.Chatstate=v,t.ChatstateProxy=y;var E=d.extend({model:v}),b=(0,r.defineState)("Presence",{Collection:"Presence",props:{id:"string"},session:{isOnline:"boolean",stale:["boolean",!1,!0],hasData:["boolean",!1,!1],isSubscribed:["boolean",!1,!1],withholdDisplay:["boolean",!1,!0],forceDisplay:["boolean",!1,!1],chatActive:["boolean",!1,!1],withholdDisplayTimer:"number",forceDisplayTimer:"number"},children:{chatstate:v},collections:{chatstates:E},derived:{isGroup:{fn:function(){return u.isGroup(this.id)}},isUser:{fn:function(){return u.isUser(this.id)}}},initialize:function(){o["default"].prototype.initialize.call(this),this.isGroup?(this.chatstate.set({id:"",type:"unavailable"}),this.listenTo(this.chatstates,"add change",_.debounce(function(){var e,t=!1;this.chatstates.forEach(function(n){"composing"!==n.type&&"recording"!==n.type||e&&!(e.updateTime<n.updateTime)||(e=n),t=t||"unavailable"!==n.type}),this.set({isOnline:t,chatstate:{id:e?e.id:"",type:e?e.type:"unavailable"}})}))):(this.chatstate.set({id:this.id}),this.listenTo(this.chatstate,"change:type",function(){this.isOnline="unavailable"!==this.chatstate.type})),this.listenTo(this,"change:chatActive",this.onChatActiveChange)},"delete":function(){o["default"].prototype["delete"].call(this),Store.Presence.remove(this.id),this.chatstate["delete"](),this.chatstates.forEach(function(e){e["delete"]()})},handle:function(e){"undefined"==typeof e.type?e.type=this.chatstate.type||"unavailable":"paused"===e.type&&(e.type="available"),this.isGroup&&"available"!==e.type&&(e.updateTime=Date.now());var t;if(this.isGroup){if(e.id=e.participant,e.participant=void 0,!e.id)return;t=this.chatstates.add(e,{merge:!0})}else t=this.chatstate.set(e);t._expireTimerId&&clearTimeout(t._expireTimerId),"composing"===t.type||"recording"===t.type?t._expireTimerId=_.delay(this._expireComposing,l.PRESENCE_COMPOSING_TIMEOUT,t):t._expireTimerId=0;var n=this.forceDisplay||this.isOnline||this.isUser&&!this.chatstate.deny;this.set({hasData:!0,forceDisplay:n})},_expireComposing:function(e){var t=e.type;"composing"===t||"recording"===t?e.type="available":c.error("models:presence:expireComposing "+t)()},reset:function(){this.hasData=!1,this.isGroup?this.chatstates.forEach(function(e){e.type="unavailable"}):this.isUser&&(this.chatstate.unset("t"),this.chatstate.unset("deny")),this.chatstate.set({id:this.isGroup?"":this.id,type:"unavailable",t:void 0,deny:void 0})},isActive:function(){var e=this.chatstate.type;return this.hasData&&("composing"===e||"recording"===e)},getFormattedString:function(){if(!this.hasData)return null;if(this.isGroup){var e=this.chatstate.id;if(!e)return null;var t=Store.Contact.get(e);if(!t)return null;var n=t.formattedShortName;return"composing"===this.chatstate.type?l10n.t("web_conversation_name_is_composing",{participant:n}):l10n.t("web_conversation_name_is_recording",{participant:n})}if(!this.isUser)return null;var i=this.chatstate;switch(i.type){case"available":return l10n.t("web_conversation_contact_online");case"composing":return l10n.t("web_conversation_is_composing");case"recording":return l10n.t("web_conversation_is_recording");case"unavailable":return i.deny||!i.t?null:h.lastSeenStr(i.t)}},onChatActiveChange:function(){var e=this.chatActive;e?(this.hasData?this.withholdDisplay=!1:this.withholdDisplayTimer=_.delay(function(e){e.set({withholdDisplay:!1,withholdDisplayTimer:0})},f,this),this.forceDisplayTimer=_.delay(function(e){e.set({forceDisplay:!0,forceDisplayTimer:0})},m,this)):(this.withholdDisplayTimer&&(clearTimeout(this.withholdDisplayTimer),this.withholdDisplayTimer=0),this.forceDisplayTimer&&(clearTimeout(this.forceDisplayTimer),this.forceDisplayTimer=0))},subscribe:function(){return this.isSubscribed?s["default"].resolve():this.isUser?this.update():this.isGroup?(this.isSubscribed=!0,s["default"].all([this.update(),p.presenceSubscribe(this.id)]).bind(this)["catch"](function(e){return this.isSubscribed=!1,s["default"].reject(e)})):s["default"].resolve()}}),C=b.Presence,M=b.PresenceProxy;t["default"]=C,t.PresenceProxy=M},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(8),o=n(10),l=n(12),c=n(1389),u=n(1),d={start:function(e){var t=this;if("camera"!==e&&"microphone"!==e)return void u.error("mediaCapture:start incompatible type given")();var n=new s["default"](function(i,a){var s=!1;t.timeout=setTimeout(function(){var t="camera"===e?"guide_desktop_camera_title":"guide_desktop_mic_title",n="camera"===e?"guide_desktop_camera_description":"guide_desktop_mic_description";s=!0,o.openModal(r.createElement(c,{title:t,desc:n,type:c.TYPE.GUIDE_ALLOW}))},1e3);var u="camera"===e?{video:!0}:{audio:!0};navigator.getUserMedia(u,function(e){s&&o.closeModal(),clearTimeout(t.timeout),i(e)},function(e){var i=_.isString(e)?e:e.name,r=l.GUM[i]||l.GUM.GUMError;clearTimeout(t.timeout),a(new r),n&&!n.isPending()&&s&&o.closeModal()})});return n},stop:function(e){if(_.isFunction(e.stop))e.stop();else for(var t=e.getTracks(),n=0;n<t.length;n++)t[n].stop()}};e.exports=d},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(15),s=i(a),r=n(5),o=i(r),l=n(6),c=i(l),u=n(19),d=i(u),p=n(18),h=i(p),f=n(8),m=i(f),g=n(1),v=i(g),y=n(453),E=i(y),_=n(1362),b=i(_),C=function(e){function t(){return(0,o["default"])(this,t),(0,d["default"])(this,(0,s["default"])(t).apply(this,arguments))}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"getClasses",value:function(){var e=this.props.msg;switch(e.type){case"location":case"video":case"audio":case"vcard":case"document":case"ciphertext":case"unknown":case"image":return"icon icon-status icon-status-"+(e.isGif?"gif":e.type);case E["default"].TYPE.CALL_LOG:return"miss_video"===e.subtype?"icon icon-status icon-status-miss_video":"icon icon-status icon-status-miss";case"ptt":var t=4===e.ack?"blue":e.isSentByMe?"gray":"green";return"icon icon-status icon-status-"+e.type+"-"+t;default:v["default"].log('chat:getClasses Invalid msg type:"'+e.type+'"')()}return""}},{key:"render",value:function(){return m["default"].createElement("span",{className:this.getClasses()})}}]),t}(m["default"].PureComponent);C.CONCERNS={msg:["ack","isGif","type","subtype","isSentByMe"]},t["default"]=(0,b["default"])(C)},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(15),s=i(a),r=n(5),o=i(r),l=n(6),c=i(l),u=n(19),d=i(u),p=n(18),h=i(p),f=n(1368),m=i(f),g=n(1354),v=(i(g),n(453)),y=(i(v),n(1472)),E=(i(y),n(1371)),_=n(8),b=n(9),C=n(23),M=n(43),S=n(231),T=n(10),w=n(1382),k=n(155),P=n(1437),N=n(1370),x=(n(1365),n(157)),D=function(e){function t(){var e,n,i,a;(0,o["default"])(this,t);for(var r=arguments.length,l=Array(r),c=0;c<r;c++)l[c]=arguments[c];return n=i=(0,d["default"])(this,(e=(0,s["default"])(t)).call.apply(e,[this].concat(l))),i.onScroll=function(e){i.handleScroll(e.target)},i.handleScroll=C.throttle(function(e){var t=i.props.mediaMsgs;t.hasMediaBefore&&e.scrollTop+b.SCROLL_FUDGE>e.scrollHeight-e.clientHeight&&i.queryMedia(C.head(t.models))},100),a=n,(0,d["default"])(i,a)}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"componentWillMount",value:function(){this.props.mediaMsgs.hasMediaBefore&&this.queryMedia()}},{key:"componentDidMount",value:function(){this.props.listeners.add(this.props.mediaMsgs,"add remove reset"),this.props.listeners.add(this.props.mediaMsgs,"query_media_before")}},{key:"queryMedia",value:function(e){var t=this,n=this.props.mediaMsgs;n.hasMediaBefore&&this.props.listeners.uiIdle(function(){n.queryMedia(t.props.chat,e)})}},{key:"render",value:function(){var e=this,t=this.props.mediaMsgs,n=this.props,i=n.fullCollection,a=n.selectedMessages,s=t.map(function(n,s){var r=null;return!e.props.fullCollection&&s>=t.length-6&&s<=t.length-4&&(r="media-canvas-second-row"),_.createElement(I,{msg:n,hoverEvent:i,selectable:e.props.selectable,selectedMessages:a,onMessageSelect:e.props.onMessageSelect,className:r,key:n.id})});s.reverse(),i||(s=C.slice(s,0,6));var r=M("media-gallery",{"drawer-media-gallery":i,"media-gallery-empty":0===t.length});if(t.queryMediaBefore&&(i||s.length<6)){var o=M("more","media-canvas-component",{"media-canvas-second-row":!i&&s.length>=3,"media-canvas-first":0===t.length});s.push(_.createElement("div",{className:o,key:"spinner"},_.createElement(k,{stroke:6,size:24,className:"spinner-muted"})))}if(0===t.length){if(i)return t.queryMediaBefore?_.createElement("div",{className:"drawer-media-gallery drawer-body"},_.createElement(N.Loading,null)):_.createElement(N.MediaMsgs,null);t.queryMediaBefore||t.hasMediaBefore||(r=M(r,"media-gallery-empty"),s=[x.t("no_media")])}else for(var l=0;l<6;l++)s.push(_.createElement("div",{className:"media-canvas-empty",key:"empty"+l}));return _.createElement("div",{onScroll:this.onScroll,className:r},s)}}]),t}(_.Component),O=function(e){function t(){(0,o["default"])(this,t);var e=(0,d["default"])(this,(0,s["default"])(t).apply(this,arguments));R.call(e);var n=e.props,i=n.msg,a=n.selectedMessages;return e.state={selected:!(!a||!a.isSelected(i))},e}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"componentDidMount",value:function(){this.props.selectedMessages&&this.props.listeners.add(this.props.selectedMessages,this.props.msg.id.toString(),this.onSelectChange)}},{key:"render",value:function(){var e=this.props.msg,t=e.mediaData,n=t.type===S.TYPE.IMAGE&&t.renderableUrl?this.onDragStart:null,i=M("media-canvas-component",this.props.className);return _.createElement(P,{classes:i,onClick:this.onClick,hoverEvent:this.props.hoverEvent,selectable:this.props.selectable,selected:this.state.selected,onMessageSelect:this.props.onMessageSelect,onDragStart:n,msg:e,imgRef:(0,E.GetRef)("img",this)})}}]),t}(_.Component),R=function(){var e=this;this.onSelectChange=function(t){e.state.selected!==t&&e.setState({selected:t})},this.onClick=function(t){var n=e.props,i=n.msg,a=n.selectable,s=n.onMessageSelect,r=i.mediaData;if(a&&s)return void s(i,!e.state.selected);if(r.mediaStage===S.STAGE.ERROR_MISSING)return void T.openModal(_.createElement(w,{msg:i}));t&&t.stopPropagation();var o=void 0,l=i.id;r.type===S.TYPE.IMAGE&&!function(){var t=e.img;o=function(e){return l.equals(e)&&t?t:null}}(),T.mediaViewerModal(i,o)},this.onDragStart=function(t){t.nativeEvent.dataTransfer.setData(b.DRAG_TYPE_LOCAL_IMAGE,!0),t.nativeEvent.dataTransfer.setData("text/uri-list",e.props.msg.mediaData.renderableUrl)}},I=(0,m["default"])(O);e.exports=(0,m["default"])(D)},function(e,t){"use strict";e.exports=function(e,t){for(var n=e.childNodes,i=0;i<n.length;++i)if(n[i]===t)return i;return-1}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1429),s=i(a),r=(0,s["default"])({FORWARD:void 0,BACKWARD:void 0});e.exports=function(e,t){var n=window.getSelection();if(!n||!n.rangeCount)return null;var i=n.getRangeAt(0);if(!i.collapsed)return null;var a=i.startContainer,s=i.startOffset;if(a===e){var o=a.childNodes,l=o.length;if(t===r.FORWARD&&s>l||t===r.BACKWARD&&!s)return null;var c=t===r.BACKWARD?1:0,u=o[s-c];return u instanceof Element?u:null}var d=a.length===s;if(t===r.BACKWARD&&s)return null;if(t===r.FORWARD&&!d)return null;var p=t===r.BACKWARD?"previousSibling":"nextSibling",h=a[p];return h instanceof Element?h:null},e.exports.Direction=r},function(e,t,n){"use strict";var i=n(8),a=i.createClass({displayName:"SectionHeader",propTypes:{header:i.PropTypes.string.isRequired},render:function(){return i.createElement("div",{className:"list-title"},this.props.header)}});e.exports=a},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(453),s=i(a),r=n(23),o=n(8),l=n(44),c=n(16),u=n(94),d=n(154),p=n(156),h=n(10),f=n(58),m=n(9),g=o.createClass({displayName:"VideoTag",mixins:[u,d,p],propTypes:{msg:o.PropTypes.instanceOf(s["default"]).isRequired,poster:o.PropTypes.string,style:o.PropTypes.object,className:o.PropTypes.string,controls:o.PropTypes.bool,width:o.PropTypes.number,height:o.PropTypes.number,onClick:o.PropTypes.func,onPlay:o.PropTypes.func,onError:o.PropTypes.func,autoPlay:o.PropTypes.bool,loop:o.PropTypes.bool,muted:o.PropTypes.bool,onLoad:o.PropTypes.func,onResize:o.PropTypes.func,startTime:o.PropTypes.number},componentDidMount:function(){var e=l.findDOMNode(this),t=this.props.msg.mediaData;t.isGif||(this.regNativeListener(e,"playing",this.onPlaying),this.regCmd("mediaPlaying",this.onOtherPlaying)),this.regNativeListener(e,"error",this.onPlayerError,!0),(f.isGecko||f.isSafari)&&(this.props.autoPlay?this.startCheckForSuccess():this.regNativeListener(e,"play",this.startCheckForSuccess)),this.props.msg.canSendPlayed()&&this.regNativeListener(e,"timeupdate",this.onTimeUpdate),this.regNativeListener(e,"loadedmetadata",this.setStartTime)},componentDidUpdate:function(e){e.startTime!==this.props.startTime&&this.setStartTime()},onTimeUpdate:function(){var e=l.findDOMNode(this);(e.currentTime/e.duration>.5||e.currentTime>10)&&(this.props.msg.sendPlayed(),this.unregNativeListener(e,"timeupdate",this.onTimeUpdate))},startCheckForSuccess:function(){this.checkIteration=0,this.checkForSuccessInterval=this.safeInterval(this.checkForSuccess,250)},clearCheckForSuccess:function(){this.checkForSuccessInterval&&(this.clearSafeInterval(this.checkForSuccessInterval),delete this.checkForSuccessInterval,delete this.checkIteration)},checkForSuccess:function(){if(c.state===c.STATE.CONNECTED){if(this.checkIteration++,this.checkIteration>240)return void this.onPlayerError({target:{src:this.props.src,error:{code:window.MediaError.MEDIA_ERR_NETWORK}}});var e=l.findDOMNode(this),t=e.buffered;t&&t.length&&t.end(0)>0&&this.onPlaying({target:e})}},onPlayerError:function(e){this.clearCheckForSuccess(),this.props.onError&&this.props.onError(e)},onOtherPlaying:function(e){e!==this&&l.findDOMNode(this).pause()},onPlaying:function(e){this.clearCheckForSuccess(),h.mediaPlaying(this),this.props.onPlay&&this.props.onPlay(e)},setStartTime:function(){if((0,r.isNumber)(this.props.startTime)){var e=l.findDOMNode(this);e.currentTime=this.props.startTime}},render:function(){var e=this.props.msg.mediaData,t=e.streamable&&!e.renderableUrl?m.VIDEO_STREAM_URL+"?key="+this.props.msg.id.toString():e.renderableUrl;return o.createElement("video",{src:t,poster:this.props.poster,style:this.props.style,width:this.props.width,height:this.props.height,className:this.props.className,onClick:this.props.onClick,controls:this.props.controls,autoPlay:this.props.autoPlay,loop:this.props.loop,muted:this.props.muted,onEnded:this.props.onEnded,onLoadStart:this.props.onLoad},this.props.children)}});e.exports=g},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(453),s=i(a),r=n(8),o=n(1419),l=n(1361),c=n(153),u=n(1360),d=l.Size,p=r.createClass({displayName:"ProfileImage",mixins:[c,u],propTypes:{size:r.PropTypes.oneOfType([r.PropTypes.number,r.PropTypes.oneOf(_.values(d))]),waid:r.PropTypes.string,thumb:r.PropTypes.string,className:r.PropTypes.string,quoted:r.PropTypes.bool},componentWillMount:function(){var e=this,t=this.props.waid;t&&Store.ProfilePicThumb.find(t).checkpoint(this.rejectOnUnmount()).then(function(t){e.addObserverAndRun(t,"change:img",function(){e.setState({img:t.img})})})["catch"](_.noop)},render:function(){return this.state.img?r.createElement(l,{id:this.props.waid,className:this.props.className,quoted:this.props.quoted,size:this.props.size}):r.createElement(o,{className:this.props.className,thumb:this.props.thumb,type:s["default"].TYPE.VCARD,quoted:this.props.quoted,shade:!1})}});p.Size=d,e.exports=p},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(158),s=i(a),r=n(2),o=i(r),l=n(453),c=i(l),u=n(8),d=n(44),p=n(1386),h=n(1),f=n(153),m=n(231),g=n(10),v=n(94),y=n(454),E=n(1355),b=n(1423),C=n(1369),M=n(1384),S=n(1379),T=n(1546),w=n(1450),k=n(1420),P=n(1550),N=n(460),x=new(n(468)),D=n(1365),O=n(1380),R=n(229),I=n(1268),A=n(43),L=n(75),F=n(9),U=n(109),G={FRONT:"front",MID:"mid",END:"end",SINGLE:"single"},j=u.createClass({displayName:"Wrapper",mixins:[f,v],propTypes:{msg:u.PropTypes.instanceOf(c["default"]).isRequired,position:u.PropTypes.oneOf(_.values(G)),displayType:u.PropTypes.oneOf(_.values(F.DISP_TYPE)),isMsgVisible:u.PropTypes.func,hideMsgInfo:u.PropTypes.bool,selectable:u.PropTypes.bool,selectedMessages:u.PropTypes.instanceOf(D),current:u.PropTypes.bool,onMessageSelect:u.PropTypes.func,tailOverride:u.PropTypes.oneOf(["left","right"]),isFocusedMsg:u.PropTypes.bool},getDefaultProps:function(){return{displayType:F.DISP_TYPE.CONVERSATION}},getInitialState:function(){return{contextMenu:!1,hover:!1,highlighting:!1,selected:!!this.props.selectedMessages&&this.props.selectedMessages.isSelected(this.props.msg)}},componentWillReceiveProps:function(e){this.props.isFocusedMsg&&!e.isFocusedMsg&&(this.unregCmd("scroll_to_focused_msg",this.scrollMsg),this.unregCmd("flash_focused_msg",this.flashFocusedMsg)),!this.props.isFocusedMsg&&e.isFocusedMsg&&(this.regCmd("scroll_to_focused_msg",this.scrollMsg),this.regCmd("flash_focused_msg",this.flashFocusedMsg))},shouldComponentUpdate:function(e,t){return I(this,e,t)},componentWillMount:function(){var e=this,t=this.props.msg;t.mayFail()&&(L.supportsFeature(L.F.RESEND_ICON)||t.type===c["default"].TYPE.PTT)&&(this.addObserver(t,"change:isFailed",function(){return e.forceUpdate()}),this.addObserver(t,"change:mediaData.mediaStage",function(){return e.forceUpdate()})),this.props.isFocusedMsg&&(this.regCmd("scroll_to_focused_msg",this.scrollMsg),this.regCmd("flash_focused_msg",this.flashFocusedMsg)),t.typeCanChange()&&this.addObserver(t,"change:type",function(){return e.forceUpdate()}),"video"===t.type&&t.mayBeForwardable()&&!t.canForward()&&this.addObserver(t,"change:ack",function(){return e.forceUpdate()})},componentDidMount:function(){this.props.selectedMessages&&this.addObserver(this.props.selectedMessages,this.props.msg.id.toString(),this.onSelectChange)},componentWillUnmount:function(){var e=this.refs.bubble;e&&Velocity(d.findDOMNode(e),"stop",!0)},scrollMsg:function(e,t){var n=d.findDOMNode(this);p.scrollAt(n,null,t).then(e)},flashFocusedMsg:function(e){this.highlight(e)},highlight:function(e){var t=this,n=this.refs.highlightTail,i=this.refs.bubble;if(n&&i){this.setState({highlighting:!0});var a=d.findDOMNode(n),s=d.findDOMNode(i),r=250;Velocity(a,"stop",!0),Velocity(a,{opacity:[1,0]},{duration:r}),Velocity(a,{opacity:[0,1]},{duration:r,delay:r});var o=this.props.msg.isSentByMe?"#dcf8c6":"#ffffff",l=this.props.msg.isSentByMe?"#b3cba1":"#cccccc";Velocity(s,"stop",!0),Velocity(s,{backgroundColor:[l,o]},{duration:r}),Velocity(s,{backgroundColor:[o,l]},{duration:r,delay:r,complete:function(){t.onHighlightComplete(e)}})}},onHighlightComplete:function(e){this.setState({highlighting:!1},function(){e&&e()})},resend:function(){var e=this.props.msg;return e.isMMS&&!L.supportsFeature(L.F.MEDIA_RETRY)?void g.openModal(u.createElement(M,{msg:e})):void e.resend()["catch"](function(e){h.log("wrapper:resend failure: "+e)()})},openSingleForwardFlow:function(){return this._openForwardFlow(!1)},openForwardFlow:function(){return this._openForwardFlow(!0)},_openForwardFlow:function(e){var t,n=this.props.msg;if(n.type===c["default"].TYPE.CIPHERTEXT?t=l10n.t("err_unsent_forward_text_decrypting"):n.type===c["default"].TYPE.REVOKED?t=l10n.t("err_unsent_forward_text_revoked"):n.isUnsentMedia&&(t=l10n.t("err_unsent_forward_text")),t)g.openModal(u.createElement(y,{title:l10n.t("err_unsent_forward_title"),onOK:g.closeModal.bind(g),okText:l10n.t("web_ok")},t));else{if(e&&this.props.displayType===F.DISP_TYPE.CONVERSATION)return void this.onSelectClick();g.openModal(u.createElement(b,{msgs:[this.props.msg]}),"modal-flow")}},openInfoDrawer:function(){g.msgInfoDrawer(this.props.msg)},openContactChat:function(){Store.Chat.find(this.props.msg.author).then(function(e){g.openChatFromUnread(e).then(function(t){t&&g.focusChatTextInput(e)})})},mouseEnter:function(){!this.state.hover&&this.contextEnabled()&&this.setState({hover:!0})},mouseLeave:function(){this.state.hover&&this.contextEnabled()&&this.setState({hover:!1})},contextMenu:function(e){e.stopPropagation()},contextEnabled:function(){return!this.props.msg.isNotification},removeContext:function(){this.setState({contextMenu:!1})},onDeleteMessage:function(){var e=this,t=function(){g.closeModal(),e.props.msg.chat.sendDeleteMsgs([e.props.msg])},n=l10n.t("delete_message_confirmation");g.openModal(u.createElement(y,{onOK:t,okText:l10n.t("web_delete"),onCancel:g.closeModal.bind(g),cancelText:l10n.t("web_cancel")},u.createElement(E,{text:n})))},onReplyMessage:function(){var e=this.props.msg,t=e.chat;t.composeQuotedMsg=e,g.focusChatTextInput(t)},onPrivateReplyMessage:function(){var e=this.props.msg;Store.Chat.find(e.sender).then(function(e){return o["default"].props({ok:g.openChatBottom(e),chat:e})}).then(function(t){var n=t.ok,i=t.chat;n&&(i.composeQuotedMsg=e,g.focusChatTextInput(i))})},onDownload:function(){N.initDownload(this.props.msg)},onStarMessage:function(){this.props.msg.chat.sendStarMsgs([this.props.msg],!0)},onUnstarMessage:function(){this.props.msg.chat.sendStarMsgs([this.props.msg],!1)},onMenu:function(e){if(e.stopPropagation(),e.preventDefault(),e.isTrusted&&this.state.contextMenu)return void this.setState({contextMenu:!1});var t=this.props.msg,n=[];t.isSentByMe&&L.supportsFeature(L.F.MESSAGE_INFO)&&this.props.displayType!==F.DISP_TYPE.MSG_INFO&&n.push(u.createElement(C,{key:"info",a8n:"mi-msg-info",action:this.openInfoDrawer},l10n.t("message_info"))),t.canReply()&&n.push(u.createElement(C,{key:"reply",a8n:"mi-msg-reply",action:this.onReplyMessage},l10n.t("reply"))),t.mediaData&&t.mediaData.renderableUrl&&n.push(u.createElement(C,{key:"download",a8n:"mi-msg-download",action:this.onDownload},l10n.t("web_button_download"))),t.canForward()&&n.push(u.createElement(C,{key:"forward",a8n:"mi-msg-forward",action:this.openForwardFlow},l10n.t("forward_message"))),L.supportsFeature(L.F.STARRED)&&(t.star?n.push(u.createElement(C,{key:"star",a8n:"mi-msg-unstar",action:this.onUnstarMessage},l10n.t("unstar_message"))):n.push(u.createElement(C,{key:"star",a8n:"mi-msg-star",action:this.onStarMessage},l10n.t("star_message")))),L.supportsFeature(L.F.MESSAGE_DELETE)&&n.push(u.createElement(C,{key:"delete",a8n:"mi-msg-delete",action:this.onDeleteMessage},l10n.t("delete_message"))),t.isGroupMsg&&t.author&&!t.isSentByMe&&n.push(u.createElement(C,{key:"author",a8n:"mi-msg-author",action:this.openContactChat},l10n.t("message_author",{author:t.displayName()}))),this.setState({contextMenu:{menu:n,anchor:e.target,classes:"dropdown-compact"}})},contextOpen:function(){var e=this.refs.context;e&&e.click()},contextClose:function(){this.setState({contextMenu:!1})},getMsgComponent:function(){var e=this.props,t=e.msg,n=e.position,i=e.displayType,a=e.isMsgVisible,s=i!==F.DISP_TYPE.STARRED_MSGS&&!!t.quotedMsg||!(n===G.MID||n===G.END),r=void 0;if(L.supportsFeature(L.F.REPLIES_IN)){var o=t.quotedMsgObj();o&&(r=u.createElement(k,{msg:o,key:o.id.toString(),rootMsg:t,displayType:i,chat:t.chat}))}return u.createElement(w,{msg:t,ref:"component",quotedMsg:r,displayAuthor:s,displayType:i,isMsgVisible:a})},onSelectClick:function(e){e&&e.stopPropagation(),this.props.onMessageSelect(this.props.msg,!this.state.selected)},onSelectChange:function(e){this.state.selected!==e&&this.setState({selected:e})},onDoubleClick:function(e){var t=this.props.msg;if(t.canReply()&&!this.props.selectable){var n=function(e,t){for(var n=t.parentNode;null!==n;){if(n===e)return!0;n=n.parentNode}return!1};n(this.refs.bubble,e.target)||(t.chat.composeQuotedMsg=t,g.focusChatTextInput(t.chat),this.highlight())}},render:function(){var e,t=this.props,n=t.msg,i=t.position,a=t.displayType,r=a===F.DISP_TYPE.CONVERSATION;(this.state.hover&&!this.state.highlighting||this.props.current||this.state.contextMenu)&&(e=u.createElement(P,(0,s["default"])({},this.props,{key:"icon-context",ref:"context",onClick:this.onMenu})));var o,l=n.mediaData?n.mediaData.mediaStage:"NA";n.type===c["default"].TYPE.PTT&&n.isFailed&&l===m.STAGE.PREPARING?o=u.createElement(T,{onResend:_.noop,errMsg:l10n.t("ptt_failed")}):L.supportsFeature(L.F.RESEND_ICON)&&r&&n.isFailed&&l!==m.STAGE.REMOTE_UPLOADING?o=u.createElement(T,{onResend:this.resend,errMsg:l10n.t("resend_message")}):!n.isUnsentMedia||l!==m.STAGE.ERROR_MISSING&&l!==m.STAGE.ERROR_UNSUPPORTED||(o=u.createElement(T,{onResend:_.noop,errMsg:l10n.t("send_failed")}));var d=!n.isNotification&&this.props.selectable?u.createElement("div",{className:"msg-select",onClick:this.onSelectClick},u.createElement(S,{onChange:this.onSelectClick,checked:this.state.selected})):null,p=i===G.MID||i===G.END,h=x.match(n.body),f=n.type===c["default"].TYPE.CHAT&&1===h.length&&_.first(h)[0].length===n.body.length,g="message-"+(n.mediaData&&n.mediaData.isGif?c["default"].TYPE.IMAGE:n.type),v=n.type===c["default"].TYPE.CIPHERTEXT||n.type===c["default"].TYPE.REVOKED||n.type===c["default"].TYPE.UNKNOWN,y=n.type===c["default"].TYPE.CHAT&&!n.linkPreview,E=n.chat&&n.chat.isPSA,b={wrapper:A("msg",{"msg-continuation":i===G.FRONT||i===G.MID,"msg-group":n.isGroupMsg&&!p,"msg-psa":a!==F.DISP_TYPE.STARRED_MSGS&&E,selected:this.state.selected}),container:A("message "+g,{"message-system":n.isNotification,"message-out":!n.isNotification&&n.isSentByMe,"message-in":!n.isNotification&&!n.isSentByMe,hover:this.state.contextMenu||this.state.hover,tail:!(E||this.props.tailOverride||i!==G.FRONT&&i!==G.SINGLE),"tail-override-left":"left"===this.props.tailOverride,"tail-override-right":"right"===this.props.tailOverride,"message-chat":y||v,"message-code":f,"message-placeholder":v})},C=void 0;C=this.state.contextMenu?"none":"rtl"===n.dir||void 0===n.dir&&l10n.isRTL()?"pop-fast-reverse":"pop-fast";var M=u.createElement("span",{className:"tail-container highlight",ref:"highlightTail"}),w=void 0;this.state.contextMenu&&(w=u.createElement(R,{displayName:"MsgContextMenu",escapable:!0,popable:!0,requestDismiss:this.contextClose},u.createElement(O,{contextMenu:this.state.contextMenu})));var k=void 0;return r&&!this.props.selectable&&n.canForward()&&(n.isMedia||n.linkPreview)&&(k=u.createElement("div",{className:"icon icon-forward-chat btn-forward-chat",onClick:this.openSingleForwardFlow})),u.createElement("div",{className:b.wrapper,onDoubleClick:this.onDoubleClick},u.createElement(U,{transitionName:"delay-leave"},d),u.createElement("div",{className:b.container,ref:"bubble"},u.createElement("div",{onContextMenu:this.contextMenu,onMouseOver:this.mouseEnter,onMouseEnter:this.mouseEnter,onMouseLeave:this.mouseLeave},u.createElement("span",{className:"tail-container"}),"  ",M,"                      ",o,this.getMsgComponent(),u.createElement(U,{transitionName:C},e)),k),w)}});j.Position=G,e.exports=j},function(e,t){"use strict";function n(e){return"string"==typeof e?e:e?e.displayName||e.name||"Component":"Component"}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=n},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.GroupMetadataProxy=t["default"]=void 0;var a=n(2),s=i(a),r=n(232),o=i(r),l=n(77),c=i(l),u=n(8),d=n(1),p=n(465),h=n(469),f=n(45),m=n(10),g=n(75),v=n(12),y=n(9),E=n(456),_=n(111).ActionToast,b=n(111).ActionType,C=(0,l.defineState)("Participant",{props:{id:"string",isAdmin:"boolean"},session:{contact:"object"},initialize:function(){c["default"].prototype.initialize.call(this),this.addChild("contact",Store.Contact.gadd(this.id))},"delete":function(){c["default"].prototype["delete"].call(this)}}),M=C.Participant,S=p.extend(h,{model:M,comparator:function(e,t){return o["default"].Comparator(e.contact,t.contact)},initialize:function(){this.listenTo(this,"change:contact.name",this.sort),this.listenTo(m,"locale_change",this.sort)},"delete":function(){this.invokeMap("delete"),this.stopListening(),this.reset()},addParticipant:function(e,t){var n=this;if(this.get(e.id))return m.openToast(u.createElement(E,{id:E.genId(),msg:l10n.t("action_participant_failed_already_added",{participant:e.formattedShortName})})),s["default"].reject(new v.ActionError);if(!this.canAdd())return s["default"].reject(new v.ActionError);var i=f.addParticipant(this.parent.id,e.id),a=new b(l10n.t("action_participant_adding",{participant:e.formattedShortName}));t=t||_.genId();var r=i.then(function(t){return 200===t.status?new b(l10n.t("action_participant_added",{participant:e.formattedShortName})):404===t.status?new b(l10n.t("action_participant_add_failed")+" "+l10n.t("action_participant_failed_404")):401===t.status?new b(l10n.t("action_participant_add_failed")+" "+l10n.t("action_participant_failed_401")):403===t.status?new b(l10n.t("action_participant_add_failed")+" "+l10n.t("action_participant_failed_403")):void 0})["catch"](function(i){return d.error("models:groupMetadata:participantCollection:addParticipant dropped")(i),new b(l10n.t("action_participant_add_failed"),l10n.t("action_try_again"),n.addParticipant.bind(n,e,t))});return m.openToast(u.createElement(_,{id:t,initialAction:a,pendingAction:r})),i},removeParticipant:function(e,t){var n=this;if(!this.canRemove(e))return s["default"].reject(new v.ActionError);var i=f.removeParticipant(this.parent.id,e.id),a=new b(l10n.t("action_participant_removing",{participant:e.contact.formattedShortName}));t=t||_.genId();var r=i.then(function(t){return 200===t.status?new b(l10n.t("action_participant_removed",{participant:e.contact.formattedShortName})):404===t.status?new b(l10n.t("action_participant_remove_failed")+" "+l10n.t("action_participant_failed_404")):401===t.status?new b(l10n.t("action_participant_remove_failed")+" "+l10n.t("action_participant_failed_401")):403===t.status?new b(l10n.t("action_participant_remove_failed")+" "+l10n.t("action_participant_failed_403")):void 0;
})["catch"](function(i){return d.error("models:groupMetadata:participantCollection:removeParticipant dropped")(i),new b(l10n.t("action_participant_remove_failed"),l10n.t("action_try_again"),n.removeParticipant.bind(n,e,t))});return m.openToast(u.createElement(_,{id:t,initialAction:a,pendingAction:r})),i},promoteParticipant:function(e,t){var n=this;if(!this.canPromote(e))return s["default"].reject(new v.ActionError);var i=f.promoteParticipant(this.parent.id,e.id),a=new b(l10n.t("action_participant_promoting",{participant:e.contact.formattedShortName}));t=t||_.genId();var r=i.then(function(t){return 200===t.status?new b(l10n.t("action_participant_promoted",{participant:e.contact.formattedShortName})):404===t.status?new b(l10n.t("action_participant_promote_failed")+" "+l10n.t("action_participant_failed_404")):401===t.status?new b(l10n.t("action_participant_promote_failed")+" "+l10n.t("action_participant_failed_401")):403===t.status?new b(l10n.t("action_participant_promote_failed")+" "+l10n.t("action_participant_failed_403")):void 0})["catch"](function(i){return d.error("models:groupMetadata:participantCollection:removeParticipant dropped")(i),new b(l10n.t("action_participant_promote_failed"),l10n.t("action_try_again"),n.promoteParticipant.bind(n,e,t))});return m.openToast(u.createElement(_,{id:t,initialAction:a,pendingAction:r})),i},canAdd:function(){return!!g.supportsFeature(g.F.GROUP_ADD_PARTICIPANT)&&!!this.iAmAdmin()},canPromote:function(e){return!!g.supportsFeature(g.F.GROUP_PROMOTE_PARTICIPANT)&&(!!e&&(Store.Conn.me!==e.id&&(!!this.iAmAdmin()&&!e.isAdmin)))},canRemove:function(e){return!!g.supportsFeature(g.F.GROUP_REMOVE_PARTICIPANT)&&(!!e&&(Store.Conn.me!==e.id&&!!this.iAmAdmin()))},canVerifyIdentity:function(e){return!!g.supportsFeature(g.F.QUERY_IDENTITY)&&(!!e&&(Store.Conn.me!==e.id&&!!e.contact.plaintextDisabled))},iAmMember:function(){return 1===this.where({id:Store.Conn.me}).length},iAmAdmin:function(){return 1===this.where({id:Store.Conn.me,isAdmin:!0}).length}}),T=(0,l.defineState)("GroupMetadata",{Collection:"GroupMetadata",props:{id:"string",creation:"number",owner:"string"},session:{stale:["boolean",!1,!0],trusted:["boolean",!1,!0],inviteCode:"string",promises:{type:"object","default":function(){return{}}}},derived:{groupInviteLink:{deps:["inviteCode"],fn:function(){return this.inviteCode?""+y.GROUP_INVITE_LINK_URL+this.inviteCode:null}}},collections:{participants:S},"delete":function(){c["default"].prototype["delete"].call(this),Store.GroupMetadata.remove(this.id),this.participants["delete"]()},canSetSubject:function(){return!!g.supportsFeature(g.F.GROUP_SET_SUBJECT)&&!!this.participants.iAmMember()},initialize:function(){c["default"].prototype.initialize.call(this),this.listenTo(this.participants,"change:isAdmin change:contact.isMyContact sort remove reset",this.isTrusted),this.listenTo(this,"change:owner",this.isTrusted),this.isTrusted(),this.listenTo(this.participants,"add remove reset",this.onParticipantChange)},isTrusted:function(){if(this.stale)return this.trusted;if(!this.owner)return this.trusted=!1;if(this.owner===Store.Conn.me)return this.trusted=!0;var e=Store.Contact.get(this.owner);if(e&&e.isMyContact)return this.trusted=!0;for(var t=this.participants.models,n=0,i=t.length;n<i;++n){var a=t[n];if(a.isAdmin&&a.id!==Store.Conn.me&&a.contact.isMyContact)return this.trusted=!0}return this.trusted=!1},onParticipantChange:function(){Store.Contact.get(this.id).unset("_capabilities"),Store.GroupMetadata.trigger("group_participant_change",this.id)},groupInviteCode:function(){var e=this;return this.promises.groupInviteCode?this.promises.groupInviteCode:this.promises.groupInviteCode=f.groupInviteCode(this.id).then(function(t){var n=t.status,i=t.code;return 200===n&&(e.inviteCode=i),n})["finally"](function(){e.promises.groupInviteCode=null})},revokeGroupInvite:function(){var e=this;return this.promises.revokeGroupInvite?this.promises.revokeGroupInvite:this.promises.revokeGroupInvite=f.revokeGroupInvite(this.id).then(function(t){var n=t.status,i=t.code;return 200===n&&(e.inviteCode=i),n})["finally"](function(){e.promises.revokeGroupInvite=null})}}),w=T.GroupMetadata,k=T.GroupMetadataProxy;t["default"]=w,t.GroupMetadataProxy=k},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StatusProxy=t["default"]=void 0;var i=n(77),a=(0,i.defineState)("Status",{Collection:"Status",props:{id:"string",status:"string"},session:{stale:["boolean",!1,!0]}}),s=a.Status,r=a.StatusProxy;t["default"]=s,t.StatusProxy=r},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(e=e.replace(E,""),e=e.replace(x,""),e=e.replace(I,"$1"),e=e.replace(A,"$1"),!O.test(e)&&D.test(e)){for(var n,i=t.getRangeAt(0).startContainer,a=0;a<5&&!(n=i.getAttribute&&i.getAttribute("data-id"));a++)i=i.parentNode;var s=Store.Msg.get(n);if(s){var r="["+g.timeStr(s.t)+"]",o=s.senderObj.formattedUser;e=S+r+" "+o+": "+T+e}}e=e.replace(R,"");var l=e.match(D);return l&&1===l.length&&(e=e.replace(D,"")),e=e.replace(D,"\n$1"),"\n"===e.charAt(0)&&(e=e.slice(1)),e}function s(e){var t=_.range(e.rangeCount).map(function(t){return e.getRangeAt(t).cloneContents()}).map(l).join("");return a(t,e)}function r(e){var t={},n=_.range(e.rangeCount).map(function(t){return e.getRangeAt(t).cloneContents()}).map(function(e){return c(e,t)}).join("");return(0,h["default"])({text:a(n,e),jids:t})}function o(e){var t=_.range(e.rangeCount).map(function(t){return e.getRangeAt(t).cloneContents()}).map(l).join("");if(t.indexOf(b)>-1){var n=_.compact(t.match(M));if(n.length)return n.join("\n").replace(C,"")}return t}function l(e){return e instanceof HTMLImageElement?e.alt:e.nodeType===Node.TEXT_NODE?e.nodeValue:_.map(e.childNodes,l).join("")}function c(e,t){if(e instanceof HTMLImageElement)return e.alt;if(e.nodeType===Node.TEXT_NODE)return e.nodeValue;if(d(e)){var n=e.getAttribute("data-jid");return t[n]=!0,"@"+f.user(n)}var i=u(e)||"",a=_.map(e.childNodes,function(e){return c(e,t)}).join("");return i?""+i+a+i:a}function u(e){switch(e.tagName){case"CODE":return"```";case"STRONG":return"*";case"EM":return"_";case"DEL":return"~";default:return""}}function d(e){return e&&e instanceof HTMLSpanElement&&e.hasAttribute("data-jid")&&e.getAttribute("data-display")===m.NodeToEmoji(e)}var p=n(24),h=i(p),f=n(20),m=n(159),g=n(76),v="​",y="⁠",E=new RegExp(v,"g"),b=""+v+y+v,C=new RegExp(""+b),M=new RegExp("(?:"+b+"|^)(.+?)(?:"+b+"|$)","g"),S=y+y,T=y+y+y,w=S+"([^"+y+"]+)"+T,k=y+y+y+y,P=y+y+y+y+y,N=k+"[^"+y+"]+"+P,x=new RegExp(N,"g"),D=new RegExp(w,"g"),O=new RegExp("^"+w),R=new RegExp(w+"$"),I=new RegExp("^[^"+y+"]+"+P+"(.*)","g"),A=new RegExp("(.*)"+k+"[^"+y+"]+$","g");e.exports={asPlainText:s,asRichText:r,formatDelim:u,extractIsolatedBlocks:o}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){for(var n=0,i=e[n];n<e.length;i=e[++n])if("text/plain"===i.type)return i;return null}var s=n(2),r=i(s),o=n(5),l=i(o),c=n(6),u=i(c),d=/\r\n/g,p=function(){function e(t){var n=this;(0,l["default"])(this,e),this.hasText=function(){return n.types.some(function(e){return"text/plain"===e})},this.hasType=function(e){return n.types.indexOf(e)!==-1},this.data=t,this.types=t.types?Array.prototype.slice.call(t.types):[]}return(0,u["default"])(e,[{key:"getItems",value:function(){var e=this;if(this.data.items)return Array.prototype.slice.call(this.data.items);var t=this._getFileTypes();return this.types.map(function(n){return{type:n,data:e.data.getData(n),kind:t.indexOf(n)>=0?"string":"file"}})}},{key:"_getFileTypes",value:function(){return Array.prototype.slice.call(this.data.files).map(function(e){var t=e.type;return t})}},{key:"getText",value:function(){return this._getText().then(function(e){return e?e.replace(d,"\n"):null})}},{key:"_getText",value:function(){var e=this.data;if(e.getData)return r["default"].resolve(e.getData("text/plain"));var t=this.data.items,n=a(t,"text/plain");return n?new r["default"](function(e){return n.getAsString(e)}):r["default"].resolve()}},{key:"getFiles",value:function(){return this.data.items?Array.prototype.slice.call(this.data.items).filter(function(e){var t=e.kind;return"file"===t}).map(function(e){return e.getAsFile()}).filter(function(e){return!!e}):Array.prototype.slice.call(this.data.files||[])}},{key:"hasFiles",value:function(){return this.data.items?Array.prototype.slice.call(this.data.items).some(function(e){var t=e.kind;return"file"===t}):!!Array.prototype.slice.call(this.data.files||[]).length}}]),e}();e.exports=p},function(e,t,n){"use strict";var i=n(480),a={multibyteLength:function(e){return i.ucs2.decode(e).length},multibyteSubstr:function(e,t,n){var a=i.ucs2.decode(e);if("undefined"==typeof n)a=a.slice(t);else{if(n<=0)return"";a=a.slice(t,t+n)}return i.ucs2.encode(a)}};e.exports=a},function(e,t,n){"use strict";var i=n(8),a=n(43),s=n(113).MIMETYPES,r=_.pickBy(s,function(e){return"document"===e.msgType}),o=i.createClass({displayName:"AttachMediaTypeFile",propTypes:{mimeType:i.PropTypes.string,filename:i.PropTypes.string},render:function(){var e=this.props,t=e.mimeType,n=e.filename,s="icon-doc";return r[t]&&(s=a(s,r[t].icon)),i.createElement("div",{className:"media-element-container"},i.createElement("div",{className:"media-element"},i.createElement("div",{className:"media-document"},i.createElement("div",{className:s}),i.createElement("div",{className:"media-document-text"},n))))}});e.exports=o},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(15),s=i(a),r=n(5),o=i(r),l=n(6),c=i(l),u=n(19),d=i(u),p=n(18),h=i(p),f=n(8),m=i(f),g=n(453),v=(i(g),n(43)),y=i(v),E=n(1362),_=i(E),b=function(e){function t(){return(0,o["default"])(this,t),(0,d["default"])(this,(0,s["default"])(t).apply(this,arguments))}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"render",value:function(){var e=this.props.msg.ack,t=(0,y["default"])("icon icon-ack",{"icon-status-time":e<1,"icon-status-check":1===e,"icon-status-dblcheck":2===e,"icon-status-dblcheck-ack":e>2});return m["default"].createElement("span",{className:t})}}]),t}(m["default"].PureComponent);b.CONCERNS={msg:["ack"]},t["default"]=(0,_["default"])(b)},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1377),s=i(a),r=n(162),o=i(r),l=n(8),c=n(1369),u=n(1536),d=n(1463),p=n(1378),h=n(1383),f=n(1578),m=n(458),g=n(155),v=n(454),y=n(229),E=n(1380),b=n(1),C=n(154),M=n(10),S=n(43),T=n(109),w={GROUP:"group",PROFILE:"profile"},k=l.createClass({displayName:"PhotoPicker",mixins:[C],propTypes:{startImage:l.PropTypes.string,type:l.PropTypes.oneOf(_.values(w)).isRequired,id:l.PropTypes.string,pending:l.PropTypes.bool,className:l.PropTypes.oneOfType([l.PropTypes.string,l.PropTypes.arrayOf(l.PropTypes.string),l.PropTypes.objectOf(l.PropTypes.bool)]),readOnly:l.PropTypes.bool,onImageSet:l.PropTypes.func.isRequired},statics:{Type:w},getInitialState:function(){return{img:this.props.startImage,hover:!1,contextMenu:!1}},componentWillReceiveProps:function(e){e.startImage&&this.props.startImage!==e.startImage?this.setState({img:e.startImage}):this.props.startImage!==e.startImage&&this.setState({img:e.startImage,imageSize:void 0})},onUpload:function(e){var t=this.refs.imageInput;return t.click(),!0},removeImage:function(){this.props.onImageSet(),M.closeModal()},onRemove:function(e){var t=this.props.type===w.GROUP?l10n.t("remove_group_icon"):l10n.t("remove_profile_photo");M.openModal(l.createElement(v,{onOK:this.removeImage,okText:l10n.t("remove"),onCancel:M.closeModal.bind(M),cancelText:l10n.t("web_cancel")},t))},onView:function(){var e=this.refs.imageContainer,t=function(t){t(e)};M.openModalMedia(l.createElement(d,{contact:Store.Contact.get(this.props.id),animateBorderRadius:!0,getZoomNode:t}),"profile-viewer")},onImageReceived:function(e,t){var n=this;return e?void o["default"].loadImage(e).then(function(i){n.setState({img:e}),n.props.onImageSet(e,t)})["catch"](function(e){b.error("PhotoPicker:onImageReceived failed to load image: "+e)();var t=n.props.type===w.GROUP?l10n.t("action_group_icon_set_failed"):l10n.t("action_profile_set_failed");M.openModal(l.createElement(v,{onOK:M.closeModal.bind(M)},t))}):void this.setState({img:null,imageSize:void 0})},onImagePick:function(e){var t=this;this.contextClose();var n=e.target.files[0];if(!n)return!1;var i=new FileReader,a=function s(){o["default"].loadImage(i.result).then(function(e){M.openModal(l.createElement(h,{type:h.BOX},l.createElement(f,{img:i.result,onFinished:t.onImageReceived})))})["catch"](function(e){var n=t.props.type===w.GROUP?l10n.t("action_group_icon_set_failed"):l10n.t("action_profile_set_failed");M.openModal(l.createElement(v,{onOK:M.closeModal.bind(M)},n))}),t.unregNativeListener(i,"load",s)};this.regNativeListener(i,"load",a),i.readAsDataURL(n),e.target.value=""},onImageClick:function(e){if(this.props.readOnly)return void(this.state.img&&this.onView());e.stopPropagation(),e.preventDefault();var t=[];this.props.id&&this.state.img&&t.push(l.createElement(c,{a8n:"mi-view-photo",key:"view",action:this.onView},l10n.t("view_photo"))),navigator.getUserMedia&&t.push(l.createElement(u,{key:"take",onImageTake:this.onImageReceived})),t.push(l.createElement(c,{a8n:"mi-upload-photo",key:"upload",action:this.onUpload},l10n.t("upload_photo"))),this.state.img&&t.push(l.createElement(c,{a8n:"mi-remove-photo",key:"remove",action:this.onRemove},l10n.t("remove_photo"))),e.persist(),this.setState({contextMenu:{menu:t,event:e}})},contextClose:function(){this.setState({contextMenu:!1})},onMouseOver:function(e){this.state.hover||this.setState({hover:!0})},onMouseEnter:function(e){this.state.hover||this.setState({hover:!0})},onMouseLeave:function(e){this.state.hover&&this.setState({hover:!1})},onLoad:function(e){var t=e.target.clientWidth,n=e.target.clientHeight;this.setState({imageSize:{width:t,height:n}})},render:function(){var e;this.state.img&&(e=l.createElement(p,{type:p.TYPES.COVER,size:this.state.imageSize},l.createElement(s["default"],{src:this.state.img,crossOrigin:!1,style:{height:"100%",width:"100%"},onLoad:this.onLoad})));var t;(this.props.pending||this.state.img&&!this.state.imageSize)&&(t=l.createElement("div",{className:"avatar-spinner-container"},l.createElement(g,{size:50,stroke:3})));var n=null;if(!this.props.pending&&!this.props.readOnly&&(!this.state.img||this.state.imageSize)&&(!this.state.img||this.state.contextMenu||this.state.hover)){var i;switch(this.props.type){case w.GROUP:i=this.state.img?l10n.t("change_group_icon"):l10n.t("add_group_icon");break;case w.PROFILE:i=this.state.img?l10n.t("change_profile_photo"):l10n.t("add_profile_photo")}n=l.createElement("div",{className:"avatar-overlay",key:"avatar-overlay"},l.createElement("span",{className:"icon icon-camera-light"}),l.createElement("div",{"data-a8n":m.key("avatar-text"),className:"avatar-overlay-text"},i))}var a=S("avatar","avatar-l","draggable-container",{"icon-group-default":this.props.type!==w.PROFILE,"icon-user-default":this.props.type===w.PROFILE}),r=this.props.readOnly||this.props.pending||!this.state.imageSize&&this.state.img?_.noop:this.onImageClick,o=void 0;this.state.contextMenu&&(o=l.createElement(y,{displayName:"PhotoPickerContextMenu",escapable:!0,popable:!0,requestDismiss:this.contextClose},l.createElement(E,{contextMenu:this.state.contextMenu})));var c=S("avatar-picker",this.props.className);return l.createElement("div",{className:c},l.createElement("div",{className:a,onClick:r,onMouseOver:this.onMouseOver,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,ref:"imageContainer",dir:"ltr"},l.createElement("div",{className:"avatar-body"},e),l.createElement(T,{transitionName:"fade"},t,n)),l.createElement("input",{ref:"imageInput",type:"file",accept:"image/gif,image/jpeg,image/jpg,image/png",style:{display:"none"},onChange:this.onImagePick}),o)}});e.exports=k},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(114),s=i(a),r=n(234),o=i(r),l=n(5),c=i(l),u=n(6),d=i(u),p=function(){},h=function(){function e(){(0,c["default"])(this,e),this.internalHandlers=new o["default"]}return(0,d["default"])(e,[{key:"initialize",value:function(e){this.ctx=e}},{key:"registerHandler",value:function(e,t){this.internalHandlers.set(e,t)}},{key:"unregisterHandler",value:function(e){this.internalHandlers["delete"](e)}},{key:"handle",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?[]:arguments[1];return(this.internalHandlers.get(e)||p).apply(void 0,(0,s["default"])(t))}}]),e}();e.exports=h},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(158),s=i(a),r=n(160),o=i(r),l=n(8),c=n(43),u=l.createClass({displayName:"Row",propTypes:{side:l.PropTypes.node,ellipsify:l.PropTypes.bool,classes:l.PropTypes.string,onClick:l.PropTypes.func},getDefaultProps:function(){return{ellipsify:!1}},render:function(){var e=this.props,t=e.onClick,n=e.side,i=e.ellipsify,a=e.classes,r=e.children,u=(0,o["default"])(e,["onClick","side","ellipsify","classes","children"]),d=c("row",a,{clickable:t}),p=c("row-main",{ellipsify:i}),h=n?l.createElement("div",{className:"row-side"},n):null;return l.createElement("div",(0,s["default"])({className:d,onClick:t},u),l.createElement("div",{className:"row-body"},l.createElement("div",{className:p},r),h))}});e.exports=u},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.Location=void 0;var a=n(15),s=i(a),r=n(5),o=i(r),l=n(6),c=i(l),u=n(19),d=i(u),p=n(18),h=i(p),f=n(8),m=i(f),g=n(1355),v=i(g),y=n(1362),E=i(y),_=n(1396),b=(i(_),t.Location={LIST:"list",TITLE:"title"},function(e){function t(){return(0,o["default"])(this,t),(0,d["default"])(this,(0,s["default"])(t).apply(this,arguments))}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"render",value:function(){var e=this.props.presence,t=void 0;return"list"===this.props.location?(t=e.getFormattedString(),t?m["default"].createElement(v["default"],{ellipsify:!0,titlify:!0,text:t}):null):(t=e.withholdDisplay?this.props.placeholder:e.getFormattedString()||(e.forceDisplay?"":this.props.placeholder),t?m["default"].createElement("div",{className:"chat-status ellipsify"},m["default"].createElement(v["default"],{ellipsify:!0,titlify:!0,text:t})):null)}}]),t}(m["default"].PureComponent));b.CONCERNS={presence:["withholdDisplay","forceDisplay","hasData"],chatstate:["type","deny","t"]},t["default"]=(0,E["default"])(b)},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(453),s=i(a),r=n(8),o=n(1355),l=n(1448),c=r.createClass({displayName:"Caption",propTypes:{msg:r.PropTypes.instanceOf(s["default"]).isRequired},render:function(){var e=this.props.msg,t=e.mentionMap();return r.createElement("div",{className:"image-caption message-text","data-id":e.id},r.createElement(l,{msg:e}),r.createElement(o,{direction:e.dir,dirMismatch:!(!e.dir||e.rtl===l10n.isRTL()),selectable:!0,text:e.caption,linkify:!0,mention:t,format:!0,wbr:15}))}});e.exports=c},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(230),s=i(a),r=n(453),o=i(r),l=n(8),c=n(1373),u=n(76),d=n(43),p=n(46),h=l.createClass({displayName:"PreviewImage",propTypes:{duration:l.PropTypes.oneOfType([l.PropTypes.string,l.PropTypes.number]),shade:l.PropTypes.bool,thumb:l.PropTypes.string,className:l.PropTypes.string,type:l.PropTypes.oneOf([o["default"].TYPE.AUDIO,o["default"].TYPE.LOCATION,o["default"].TYPE.VIDEO,o["default"].TYPE.PTT,o["default"].TYPE.VCARD]).isRequired,quoted:l.PropTypes.bool},getDefaultProps:function(){return{shade:!0}},getIconClassNames:function(){if(this.props.type===o["default"].TYPE.VIDEO)return"icon-sm icon-video-inv"},getClassNames:function(){if(this.props.type===o["default"].TYPE.AUDIO)return null;var e=this.props.type===o["default"].TYPE.VCARD||this.props.type===o["default"].TYPE.PTT;return d("preview",this.props.className,(0,s["default"])({"icon-user-default":e,"icon-user-default-square":e&&this.props.quoted},"preview-"+this.props.type+" no-image",!this.props.thumb))},getStyles:function(){var e=this.props.thumb;return e?p.isHttp(e)?{backgroundImage:'url("'+e+'")'}:{backgroundImage:'url("data:image/jpeg;base64,'+e+'")'}:{}},render:function(){var e=u.durationStr(this.props.duration),t=this.props.shade?l.createElement("span",{className:"shade"}):null,n=this.props.type===o["default"].TYPE.AUDIO?l.createElement("div",{className:"icon icon-audio-file preview"}):l.createElement("div",{className:"preview-image",style:this.getStyles()});return l.createElement("div",{className:this.getClassNames()},n,t,l.createElement("span",{className:"meta meta-audio"},l.createElement("span",{className:this.getIconClassNames()}),l.createElement(c,null,e)))}});e.exports=h},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(453),s=i(a),r=n(1354),o=i(r),l=n(1398),c=i(l),u=n(8),d=n(10),p=n(1373),h=n(457),f=n(1363),m=n(1267),g=n(1355),v=n(1404),y=n(76),E=n(459),_=n(1356),b=n(43),C=n(109),M=n(9),S=n(1450),T=n(229),w=s["default"].TYPE,k=w.CHAT,P=w.IMAGE,N=w.VIDEO,x=w.LOCATION,D=w.DOCUMENT,O=w.VCARD,R=w.AUDIO,I=w.MULTI_VCARD,A=u.createClass({displayName:"QuotedMsg",mixins:[_,m],propTypes:{msg:u.PropTypes.instanceOf(s["default"]).isRequired,chat:u.PropTypes.instanceOf(o["default"]).isRequired,onOmit:u.PropTypes.func,rootMsg:u.PropTypes.instanceOf(s["default"]),displayType:u.PropTypes.string},getInitialState:function(){var e={hover:!1,quotedMsgPreview:!1};return this.props.msg.isMMS&&(e.renderableUrl=this.async("msg.mediaData.renderableUrl"),e.preview=this.async("msg.mediaData.preview")),e},onClick:function(){var e=this.props,t=e.rootMsg,n=e.msg;if(!n.isStatusV3){if(t&&!t.isQuotedMsgAvailable)return void this.setState({quotedMsgPreview:!0});var i=n.id,a=n.chat,s=a.getSearchContext(Store.Msg.get(i)||i,t);s&&(s.slideToMsg=!0),d.openChatAt(a,s)}},onMouseOver:function(e){this.hoverable()&&this.setState({hover:!0})},onMouseEnter:function(e){this.hoverable()&&this.setState({hover:!0})},onMouseLeave:function(e){this.state.hover&&this.setState({hover:!1})},hoverable:function(){return!this.state.hover&&this.props.rootMsg&&!this.props.msg.isStatusV3},render:function(){var e=this,t=this.props,n=t.msg,i=t.displayType,a=t.chat,s=a.assignedColor(n.sender),r=i===M.DISP_TYPE.CONVERSATION,o=u.createElement(f,{msg:n,className:"quoted-msg-bubble-ptt-author",chat:a,quoted:!0,displaySelf:n.sender===Store.Conn.me,disableClick:!0}),l=[];n.hasSymbol()&&l.push(u.createElement(c["default"],{msg:n,key:"msg-symbol"})),[N,R].indexOf(n.type)>-1&&!n.isGif&&!n.caption&&l.push(y.durationStr(n.duration)+" "),[P,N,k].indexOf(n.type)>-1?l.push(u.createElement(g,{format:!0,mention:n.mentionMap(),text:h.msgText(n,!1),direction:"auto",key:"status"})):l.push(u.createElement(g,{format:!0,text:h.msgText(n),direction:"auto",key:"status"}));var d=null,m=this.props.rootMsg;if(this.state.quotedMsgPreview&&m){var _=b("quoted-msg-preview",m.isSentByMe?"right":"left",{"chat-msg":n.type===k});d=u.createElement(T,{displayName:"QuotedMsgPreview",escapable:!0,popable:!0,requestDismiss:function(){return e.setState({quotedMsgPreview:!1})}},u.createElement("div",{className:_},u.createElement(S,{msg:n}),u.createElement("div",{className:"nib-wrapper"},u.createElement("div",{className:"nib"}))))}var w=void 0,A="quoted-msg-image";switch(n.type){case P:case N:case D:var L=n.mediaData,F=L.type===P&&L.renderableUrl?L.renderableUrl:L.preview&&L.preview.url();F&&(w=u.createElement("div",{style:{backgroundImage:"url("+F+")"},className:A}));break;case x:n.body&&(w=u.createElement("div",{style:{backgroundImage:"url(data:image/jpeg;base64,"+n.body+")"},className:A}));break;case k:n.thumbnail&&(w=u.createElement("div",{style:{backgroundImage:'url("data:image/jpeg;base64,'+n.thumbnail+'")'},className:A}));break;case O:w=u.createElement(v,{waid:n.getVCardThumbnailWAid(),size:v.Size.NONE,thumb:n.body&&E.thumbnail(n.body),quoted:!0,className:A});break;case I:w=u.createElement(v,{className:A,quoted:!0})}var U=b("quoted-msg",{"quoted-msg-hover":this.state.hover}),G=this.props.onOmit?u.createElement("div",{style:{display:"flex",flex:"0 0 auto"}},w,u.createElement("div",{className:"btn-background"},u.createElement("button",{className:"icon icon-x",onClick:this.props.onOmit}))):w&&u.createElement("div",{className:"quoted-msg-image-wrapper"},w);return u.createElement("div",{onMouseOver:r?this.onMouseOver:null,onMouseEnter:r?this.onMouseEnter:null,onMouseLeave:r?this.onMouseLeave:null},u.createElement(C,{transitionName:"quoted-msg-preview",className:"quoted-msg-preview-wrapper"},d),u.createElement("div",{className:U,onClick:r?this.onClick:null},u.createElement("div",{className:"quoted-msg-status"},u.createElement("span",{className:"bg-color-"+s+" quoted-msg-color-bar"}),u.createElement("div",{className:"quoted-msg-info"},u.createElement("div",null,o,u.createElement("div",{className:"message-text quoted-msg-text"},u.createElement(p,null,l))))),G))}});e.exports=A},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(453),s=i(a),r=n(110),o=i(r),l=n(8),c=n(44),u=n(153),d=n(1405),p=n(43),h=n(76),f=n(1355),m=n(1386),g=n(1361),v=n(20),y=n(92),E=n(1365),_=n(9),b=l.createClass({displayName:"StarredMsg",mixins:[u],propTypes:{msg:l.PropTypes.instanceOf(s["default"]).isRequired,isMsgVisible:l.PropTypes.func,selectable:l.PropTypes.bool,selectedMessages:l.PropTypes.instanceOf(E),onMessageSelect:l.PropTypes.func,currSelection:l.PropTypes.object,activeSelection:l.PropTypes.object,onClickMsg:l.PropTypes.func.isRequired,multiMedia:l.PropTypes.bool},getInitialState:function(){var e=this.props.currSelection,t=this.props.activeSelection,n=this.props.msg;return{hover:!1,current:!!e&&e.value===n,active:!!t&&t.value===n,focus:!1}},componentWillMount:function(){var e=this.props.msg,t=this.props.currSelection;t&&this.addObserver(t,e.id.toString(),this.onSelectionChange);var n=this.props.activeSelection;n&&this.addObserver(n,e.id.toString(),this.onActiveChange)},onSelectionChange:function(e,t){var n="focus"===e;if(n){var i=c.findDOMNode(this);y.focus(i),t&&m.scrollIntoViewIfNeeded(i)}this.setState({current:n})},onActiveChange:function(e){if("focus"===e){var t=c.findDOMNode(this);y.focus(t),m.scrollIntoViewIfNeeded(t)}this.setState({active:!!e})},mouseOver:function(){this.state.hover||this.setState({hover:!0})},mouseEnter:function(){this.state.hover||this.setState({hover:!0})},mouseLeave:function(){this.state.hover&&this.setState({hover:!1})},onEnter:function(e){e.stopPropagation(),e.preventDefault(),this.props.onClickMsg(this.props.msg)},openContextMenu:function(e){this.refs.wrapper.contextOpen()},onFocus:function(e){this.setState({focus:!0}),this.indicateFocus(e)},onBlur:function(e){this.finishFocusIndication(e),this.setState({focus:!1})},indicateFocus:function(e){if(!(Date.now()-(o["default"].flashFocus||0)>200)){var t=this.refs.row,n=this.state.active?"#d6d7d8":"#e2e3e3";Velocity(t,"stop"),Velocity(t,{backgroundColor:[n,"#cbdde7"]},{duration:1300,easing:[.19,.69,.01,.99],complete:this.finishFocusIndication})}},finishFocusIndication:function(e){var t=this.refs.row;t&&(Velocity(t,"stop"),t.style.backgroundColor="")},render:function(){var e=this,t=this.props,n=t.msg,i=t.selectedMessages,a=n.senderObj.formattedName,s=n.chat.isUser?Store.Contact.get(n.to).formattedName?Store.Contact.get(n.to).formattedName:v.formattedUser(n.to):n.chat.title(),r=p("starred-msg-wrapper",{hover:this.state.hover,current:this.state.current&&this.state.focus,active:this.state.active}),c=this.props.multiMedia?null:l.createElement("div",{className:"starred-msg-title"},l.createElement("div",{className:"starred-title-main"},l.createElement(g,{id:n.senderObj.id,size:26}),l.createElement(f,{className:"starred-msg-author",text:a,direction:"auto",ellipsify:!0,titlify:!0}),l.createElement("span",{className:"starred-title-divider"}),l.createElement(f,{className:"starred-msg-chat",text:s,direction:"auto",ellipsify:!0,titlify:!0})),l.createElement("div",{className:"starred-title-meta"},h.relativeStr(n.t)),l.createElement("div",{className:"icon icon-chevron-right-alt"})),u={enter:this.onEnter};u[l10n.LR("right","left")]=this.openContextMenu;var m=!1;return l.createElement(o["default"],{handlers:u,onFocus:this.onFocus,onBlur:this.onBlur},l.createElement("div",{ref:"row",className:r,onClick:function(){return e.props.onClickMsg(n,i&&!i.isSelected(n))},onMouseEnter:this.state.hover?null:this.mouseEnter,onMouseOver:this.state.hover?null:this.mouseOver,onMouseLeave:this.state.hover?this.mouseLeave:null},c,l.createElement(d,{msg:n,key:n.id,ref:"wrapper",current:this.state.current&&this.state.focus,displayType:_.DISP_TYPE.STARRED_MSGS,isMsgVisible:this.props.isMsgVisible,selectable:m,selectedMessages:i,onMessageSelect:this.props.onMessageSelect,position:d.Position.END,tailOverride:"left"})))}});e.exports=b},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(8),s=i(a),r=n(44),o=i(r),l=n(43),c=i(l),u=n(29),d=i(u),p=n(109),h=i(p),f=n(39),m=i(f),g=n(153),v=i(g),y=n(1570),E=i(y),b=n(1454),C=n(92),M=n(1386),S=i(M),T=n(1569),w=i(T),k=n(110),P=i(k),N=n(1395),x=1e3,D=100,O=85,R=40,I=50,A=31,L=52,F=33,U=s["default"].createClass({displayName:"EmojiPanel",mixins:[v["default"]],propTypes:{onEmoji:s["default"].PropTypes.func.isRequired,onGif:s["default"].PropTypes.func,onFocusRelease:s["default"].PropTypes.func},lastScrollTop:0,lastClickTime:0,lastFocusedSection:null,getInitialState:function(){var e=this.props.onGif?b.ExtendedTabs:b.TabsOrdered,t=void 0;return t=this.props.onGif&&b.Tab[d["default"].getLastEmojiTab()]===b.Tab.GIFS?b.Tab.GIFS:b.Tab.RECENT,{tabs:e,selected:t,searchText:null,showSearchInput:!0}},componentWillMount:function(){this.handleScroll=_.throttle(this._handleScroll,D)},componentDidMount:function(){this.uiIdle(this.restoreFocus);var e=this.state.selected.key;this.uiIdle(function(){new m["default"].WebcEmojiOpen({webcEmojiOpenTab:e}).commit()})},componentWillUnmount:function(){d["default"].setLastEmojiTab(this.state.selected.key),this.handleScroll.cancel()},shouldComponentUpdate:function(e,t){var n=this.state;return t.tabs!==n.tabs||t.selected!==n.selected||t.searchText!==n.searchText||t.showSearchInput!==n.showSearchInput},getCurrentTabFromScroll:function(e){var t=this;return _.findLast(b.TabsOrdered,function(n){var i=o["default"].findDOMNode(t.refs[n.key]);return e.scrollTop+O>=i.offsetTop})},onScroll:function(){this.handleScroll()},_handleScroll:function(){if(!(this.state.selected!==b.Tab.GIFS&&this.state.searchText||Date.now()-this.lastClickTime<x)){var e=this.refs.scrollContainer,t=this.state.selected===b.Tab.GIFS?b.Tab.GIFS:this.getCurrentTabFromScroll(e),n=e.scrollTop;n>this.lastScrollTop?n>R&&this.setState({showSearchInput:!1,selected:t}):this.setState({showSearchInput:!0,selected:t}),this.state.selected===b.Tab.GIFS&&this.refGifPanel.animateOnScroll(e),this.lastScrollTop=n}},scrollToPanel:function(e){var t=!(arguments.length<=1||void 0===arguments[1])&&arguments[1],n=arguments.length<=2||void 0===arguments[2]?0:arguments[2],i=this.refs[e.key];if(i){var a=o["default"].findDOMNode(i);t?(S["default"].scrollAt(a,a.parentNode,{pos:"offset",duration:300,animate:!0,easing:[.99,.13,.13,.99],offset:n}),this.lastScrollTop=a.offsetTop):S["default"].scrollAt(a,a.parentNode,{pos:"offset",offset:n})}},onSelectTab:function(e){this.lastClickTime=Date.now();var t=this.state.tabs.indexOf(this.state.selected),n=this.state.tabs.indexOf(e),i=n<=t||!!this.state.searchText||e===b.Tab.GIFS,a=0;n<=t&&this.emojiSearchEnabled()&&(a=I),this.state.selected===b.Tab.GIFS||e===b.Tab.GIFS||this.state.searchText||this.scrollToPanel(e,!0,a),this.setState({selected:e,showSearchInput:i})},onEmoji:function(e){this.props.onEmoji(e),Store.RecentEmoji.increment(e)},restoreFocus:function(){if(this.lastFocusedSection)this.lastFocusedSection.restoreFocus();else if(this.refs.searchInput)this.focusSearchInput();else{
var e=this.getSectionToFocus();e&&e.focusFirstRow(0),this.lastFocusedSection=e}},onRotateFocus:function(e){var t=!1;e&&(this.stopEvent(e),t=!!e.shiftKey,P["default"].flashFocus=Date.now()),this.searchInputHasFocus()?this.state.selected===b.Tab.GIFS?t?this.onSelectTab(b.Tab.RECENT):this.props.onFocusRelease():t?this.props.onFocusRelease():this.onSelectTab(b.Tab.GIFS):this.focusSearchInput()},setRefGifPanel:function(e){this.refGifPanel=e},getPanelContent:function(){var e=this;return this.state.selected===b.Tab.GIFS?s["default"].createElement(E["default"],{ref:this.setRefGifPanel,onGif:this.props.onGif,searchText:this.state.searchText}):this.state.searchText?s["default"].createElement("div",{className:"emoji-panel-section",key:b.Tab.SEARCH_RESULT.key,ref:b.Tab.SEARCH_RESULT.key},s["default"].createElement(w["default"],{tab:b.Tab.SEARCH_RESULT,ref:"emojiTab-SEARCH_RESULT",searchText:this.state.searchText,focusPrevSection:this.focusPrevSection,onFocusRelease:this.props.onFocusRelease,scrollEmojiIntoViewIfNeeded:this.scrollEmojiIntoViewIfNeeded,onEmoji:this.onEmoji})):_.map(b.TabsOrdered,function(t){return s["default"].createElement("div",{className:"emoji-panel-section",key:t.key,ref:t.key},s["default"].createElement(w["default"],{tab:t,ref:"emojiTab-"+t.key,onEmoji:e.onEmoji,scrollEmojiIntoViewIfNeeded:e.scrollEmojiIntoViewIfNeeded,focusPrevSection:e.focusPrevSection,focusNextSection:e.focusNextSection,onFocusRelease:e.props.onFocusRelease,onSetSearchText:e.onSetSearchText}))})},componentDidUpdate:function(e,t){var n=this.emojiSearchEnabled(),i=0;n&&(i=I),t.selected===this.state.selected&&t.searchText!==this.state.searchText?this.state.searchText?this.refs.scrollContainer.scrollTop=0:(this.lastClickTime=Date.now(),this.selectedTabBeforeSearch!==this.state.selected?this.scrollToPanel(this.state.selected,!1,i):this.refs.scrollContainer.scrollTop=this.scrollTopBeforeSearch):t.selected!==b.Tab.GIFS||this.state.searchText||this.scrollToPanel(this.state.selected,!1,i)},stopEvent:function(e){e&&(e.preventDefault(),e.stopPropagation())},searchInputHasFocus:function(){var e=document.activeElement;return!!e&&e===this.refs.searchInput},focusSearchInput:function(){if(this.refs.searchInput&&!(this.searchInputHasFocus()||((0,C.focus)(this.refs.searchInput),Date.now()-(P["default"].flashFocus||0)>200))){var e=o["default"].findDOMNode(this.refs.searchContainer);Velocity(e,"stop"),Velocity(e,{backgroundColor:["#e0e1e2","#d9f3ff"]},{duration:1300,easing:[.24,.91,.01,.99]})}},onSearchDown:function(){var e=this.getSectionToFocus();e.focusRow(this.getEmojiRowNumberToFocus(e)),this.lastFocusedSection=e},getEmojiRowNumberToFocus:function(e){var t=o["default"].findDOMNode(e),n=this.refs.scrollContainer.scrollTop-t.offsetTop-A;return this.state.showSearchInput&&(n=n+L+F),n<0?0:Math.floor(n/b.EMOJI_HEIGHT)},onSearchEnter:function(e){var t=this.getSectionToFocus();t.keyboardSelectRow(e,this.getEmojiRowNumberToFocus(t)),this.lastFocusedSection=t},getSectionToFocus:function(){return this.state.searchText?this.refs["emojiTab-SEARCH_RESULT"]:this.state.selected===b.Tab.RECENT?this.getFirstSectionWithEmoji():this.refs["emojiTab-"+this.state.selected.key]},getFirstSectionWithEmoji:function(){if(this.state.searchText)return this.refs["emojiTab-SEARCH_RESULT"];var e=this.refs["emojiTab-RECENT"];return e.getEmojiList().length?e:this.refs["emojiTab-SMILEYS_PEOPLE"]},scrollEmojiIntoViewIfNeeded:function(e){e.offsetTop-this.refs.scrollContainer.scrollTop<L&&S["default"].scrollIntoView(e,!0,this.refs.scrollContainer)},focusPrevSection:function(e,t){var n=_.findIndex(this.state.tabs,e);if(n--,n>=0){var i=this.state.tabs[n],a=this.refs["emojiTab-"+i.key];a.getEmojiList().length>0?(a&&a.focusLastRow(t),this.lastFocusedSection=a):(P["default"].flashFocus=Date.now(),this.focusSearchInput())}else P["default"].flashFocus=Date.now(),this.focusSearchInput()},focusNextSection:function(e,t){var n=_.findIndex(this.state.tabs,e);if(n++,n<this.state.tabs.length){var i=this.state.tabs[n],a=this.refs["emojiTab-"+i.key];a&&a.focusFirstRow(t),this.lastFocusedSection=a}},clearSearchText:function(){this.setState({searchText:null})},emojiSearchEnabled:function(){return"en"===l10n.getLocale()},getSearchBox:function(){if(this.state.selected!==b.Tab.GIFS&&!this.emojiSearchEnabled())return null;var e=void 0;if(this.state.showSearchInput){var t=void 0,n=void 0;this.state.selected===b.Tab.GIFS?(t=l10n.t("search_gifs",{service:N.BRAND_NAMES[(0,N.gifProvider)()]}),n={}):(t=l10n.t("search_emoji"),n={enter:this.onSearchEnter,down:this.onSearchDown});var i=null;this.state.searchText&&(i=s["default"].createElement("span",{className:"icon icon-x-alt-small",onClick:this.clearSearchText})),e=s["default"].createElement(P["default"],{handlers:n,"data-tab":4,className:"emoji-search-row",key:this.state.showSearchInput,onFocus:this.focusSearchInput},s["default"].createElement("label",{ref:"searchContainer",className:"emoji-search-row-input"},s["default"].createElement("div",{className:"input-container"},s["default"].createElement("input",{ref:"searchInput",className:"input input-search input-emoji-search",type:"text",dir:"auto",value:this.state.searchText||"",title:t,placeholder:t,onMouseDown:function(e){e.stopPropagation()},onChange:this.onSearch}),i)))}else e=null;return s["default"].createElement(h["default"],{transitionName:"emoji-search-slide-away"},e)},onSearch:function(e){this.stopEvent(e);var t=e.target.value;0===t.length&&(t=null),null===this.state.searchText&&(this.scrollTopBeforeSearch=this.refs.scrollContainer.scrollTop,this.selectedTabBeforeSearch=this.state.selected),this.setState({searchText:t})},preventBlur:function(e){this.stopEvent(e),this.restoreFocus()},render:function(){var e=this,t=this.state.tabs,n=t.indexOf(this.state.selected),i=t.map(function(t){var n=(0,c["default"])("menu-tab",{active:e.state.selected===t});return s["default"].createElement("button",{className:n,onClick:function(){return e.onSelectTab(t)},key:t.key,title:t.title()},s["default"].createElement("span",{className:"icon "+t.css}))}),a=l10n.isRTL()?-1:1,r={width:100/i.length+"%",transform:"translateX("+100*n*a+"%)"},o=this.getSearchBox(),l=this.getPanelContent(),u=(0,c["default"])("emoji-panel-body-container",{hasSearchBox:!!o}),d={tab:this.onRotateFocus,"shift+tab":this.onRotateFocus};return s["default"].createElement(P["default"],{handlers:d},s["default"].createElement("div",{className:"emoji-panel k"},s["default"].createElement("div",{className:"menu-tabs menu-tabs-emoji emoji-panel-header","data-active-tab":this.state.selected.key},s["default"].createElement("div",{style:r,className:"menu-tabs-marker"}),i),s["default"].createElement("div",{className:u,onMouseDown:this.preventBlur},o,s["default"].createElement("div",{className:"emoji-panel-body",onScroll:this.onScroll,ref:"scrollContainer"},l))))}});e.exports=U},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(230),o=i(r),l=n(453),c=i(l),u=n(8),d=n(1364),p=n(454),h=n(10),f=n(1424),m=u.createClass({displayName:"ForwardMessageFlow",mixins:[d],propTypes:{msgs:u.PropTypes.arrayOf(u.PropTypes.instanceOf(c["default"])).isRequired,onFoward:u.PropTypes.func},getDefaultTransition:function(){var e;return e={},(0,o["default"])(e,d.Dir.PUSH,d.Transition.NONE),(0,o["default"])(e,d.Dir.POP,d.Transition.NONE),e},componentWillMount:function(){var e=l10n.t("forward_message_to",{_plural:this.props.msgs.length||1}),t=_.head(this.props.msgs)&&_.head(this.props.msgs).chat;this.push(u.createElement(f,{onChat:this.onForwardConfirmed,excludeChat:t,title:e}))},checkCanForward:function(){return s["default"].map(this.props.msgs,function(e){return s["default"].props({message:e,canForward:e.canForward()})})},onForwardConfirmed:function(e){var t=this,n=this.checkCanForward();s["default"].map(e,function(e){var t=void 0;return t=e.isUser&&e.contact.isBlocked()?e.contact.setBlock(!1):s["default"].resolve(!0),s["default"].all([n,t]).spread(function(t,n){var i=_.map(_.filter(t,{canForward:!0}),"message"),a=_.map(_.filter(t,{canForward:!1}),"message");return s["default"].props({chat:e,undelivered:e.forwardMessages(i),canForward:i,cannotForward:a})})}).then(function(e){var n=_.compact(e.map(function(e){var n=e.chat,i=e.undelivered,a=e.canForward,s=e.cannotForward,r=null;return(i.length||s.length)&&(r=t.getForwardFailReason(n,i,a,s)),r?{chat:n,reason:r}:null}));n.length&&t.showMediaSendError(n)}),this.endFlow(),_.isFunction(this.props.onForward)&&this.props.onForward(this.props.msgs),h.openChatFromUnread(_.head(e))},getForwardFailReason:function(e,t,n,i){var a=n.length-t.length,s=void 0;if(a){var r=i.length+t.length;s=t.length?i.length?e.isUser?l10n.t("cannot_forward_media_missing_and_capability_contact",{count:r,_plural:r,contact:e.formattedTitle}):l10n.t("cannot_forward_media_missing_and_capability_group",{count:r,_plural:r}):l10n.t("cannot_forward_media_missing",{count:r,_plural:r}):e.isUser?l10n.t("cannot_forward_capability_contact",{count:r,_plural:r,contact:e.formattedTitle}):l10n.t("cannot_forward_capability_group",{count:r,_plural:r})}else s=t.length?i.length?e.isUser?l10n.t("cannot_forward_media_missing_and_capability_contact_none",{contact:e.formattedTitle}):l10n.t("cannot_forward_media_missing_and_capability_group_none"):l10n.t("cannot_forward_media_missing_none"):e.isUser?l10n.t("cannot_forward_capability_contact_none",{contact:e.formattedTitle}):l10n.t("cannot_forward_capability_group_none");return s},showMediaSendError:function(e){var t=e.map(function(e){var t=e.chat,n=e.reason;return u.createElement("p",{key:t.id},t.formattedTitle," : ",n)});h.openModal(u.createElement(p,{onOK:h.closeModal.bind(h),okText:l10n.t("web_ok")},t),void 0)}});e.exports=m},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(15),o=i(r),l=n(5),c=i(l),u=n(6),d=i(u),p=n(19),h=i(p),f=n(18),m=i(f),g=n(1391),v=i(g),y=n(1354),E=(i(y),n(232)),_=i(E),b=n(1366),C=i(b),M=n(110),S=i(M),T=n(8),w=n(44),k=n(463),P=n(23),N=window.Store,x=n(1383),D=n(10),O=n(1357),R=n(1359),I=n(1358),A=n(1494),L=n(1370),F=n(1402),U=n(1372),G=n(1365),j=n(92),B=n(157),V=n(75),q=n(1502),H=n(1371),z=H.GetRef,W=function(e){function t(){var e,n,i,a;(0,c["default"])(this,t);for(var r=arguments.length,l=Array(r),u=0;u<r;u++)l[u]=arguments[u];return n=i=(0,h["default"])(this,(e=(0,o["default"])(t)).call.apply(e,[this].concat(l))),i.filteredData=null,i.state={searchText:""},i.handleSelect=function(e,t){i.selectedChats.setVal(e,t),i.active.setVal(e)},i.onCancelSelection=function(){i.selectedChats.unsetAll()},i.onSearch=function(e){i.filteredData=null,i.setState({searchText:e})},i.onFocusList=function(e){e.preventDefault(),e.stopPropagation(),S["default"].flashFocus=Date.now(),i.active.setFirst()},i.indicateSearchFocus=function(e){if(i.active.unset(),!(Date.now()-(S["default"].flashFocus||0)>200)&&i.search){var t=w.findDOMNode(i.search);k(t,"stop"),k(t,{backgroundColor:["#fbfbfb","#D9F3FF"]},{duration:1600,easing:[.19,.69,.01,.99]})}},i.onNext=function(e){e.preventDefault(),e.stopPropagation(),i.active.setNext()},i.onPrev=function(e){e.stopPropagation(),e.preventDefault();var t=i.active.prev();t>-1?i.active.setPrev():(i.active.unset(),S["default"].flashFocus=Date.now(),j.focus(i.search))},i.onChat=function(){s["default"].map(i.selectedChats.getSelected(),function(e){return e instanceof _["default"]?N.Chat.find(e.id):e}).then(function(e){i.props.onChat(e)})},a=n,(0,h["default"])(i,a)}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"componentWillMount",value:function(){this.active=new U(this.getData(),function(e){return e.id}),this.selectedChats=new G([],function(e){return e.id})}},{key:"getFrequentContacts",value:function(){var e=this.state.searchText;return e||!V.supportsFeature(V.F.FREQUENT_CONTACTS)?[]:N.Contact.frequentContacts(null,this.props.excludeChat)}},{key:"getFilteredChats",value:function(){var e=this.state.searchText;return e?(e=B.accentFold(e),N.Chat.filter(function(t){return t.canSend&&t.isVisible&&t.contact.searchMatch(e)})):N.Chat.filter(function(e){return e.canSend&&e.isVisible})}},{key:"getFilteredContacts",value:function(){var e=N.Contact.getFilteredContacts(),t=this.state.searchText;return t?(t=B.accentFold(t),e.filter(function(e){return e.searchMatch(t)})):e}},{key:"getFilteredData",value:function(){if(this.filteredData)return this.filteredData;var e={},t=P.compact(P.map(this.getFrequentContacts(),function(t){var n=t.isGroup?N.Chat.get(t.id):t;return n&&(e[n.id]=!0),n})),n=P.compact(P.map(this.getFilteredChats(),function(t){var n=t.isGroup?t:t.contact;return e[n.id]?null:(e[n.id]=!0,n)})),i=P.compact(P.map(this.getFilteredContacts(),function(t){return e[t.id]?null:t}));return this.filteredData={frequentContactsData:t,chatsData:n,contactsData:i}}},{key:"getFilteredItems",value:function(){var e=this,t=[],n=this.getFilteredData(),i=n.frequentContactsData,a=n.chatsData,s=n.contactsData;return i.length&&t.push(T.createElement(F,{key:"frequent-contacts-header",header:B.t("web_frequent_contacts")})),P.forEach(i,function(n){t.push(T.createElement(A,{key:n.id,chat:n,active:e.active,selections:e.selectedChats,onSelect:e.handleSelect}))}),a.length&&t.push(T.createElement(F,{key:"chat-header",header:B.t("web_recent_chats")})),P.forEach(a,function(n){t.push(T.createElement(A,{key:n.id,chat:n,active:e.active,selections:e.selectedChats,onSelect:e.handleSelect}))}),s.length&&t.length&&t.push(T.createElement(F,{key:"contact-header",header:B.t("web_other_contacts")})),P.forEach(s,function(n){t.push(T.createElement(A,{key:n.id,chat:n,active:e.active,selections:e.selectedChats,onSelect:e.handleSelect}))}),t}},{key:"getData",value:function(){var e=this.getFilteredData(),t=e.frequentContactsData,n=e.chatsData,i=e.contactsData;return P.concat(t,n,i)}},{key:"getList",value:function(){var e=this.getFilteredItems();return 0===e.length?null:T.createElement(C["default"],{data:e,height:72,extraItems:4})}},{key:"onCancel",value:function(){D.closeModal()}},{key:"render",value:function(){var e=this.getList();this.active.init(this.getData()),e||(e=this.state.searchText?T.createElement(L.Search,null):T.createElement(L.ListChats,null));var t={down:this.onFocusList},n={down:this.onNext,up:this.onPrev};return T.createElement(x,{type:x.TOWER},T.createElement(O,{key:"chat-modal",onCancel:this.onCancel},T.createElement(R,{title:this.props.title,type:R.Type.POPUP,onCancel:this.onCancel}),T.createElement(S["default"],{handlers:t,onFocus:this.indicateSearchFocus},T.createElement(v["default"],{ref:z("search",this),onSearch:this.onSearch,placeholder:B.t("search")})),T.createElement(I,{"data-list-scroll-container":!0},T.createElement(S["default"],{handlers:n,className:"column"},T.createElement("div",{className:"chatlist column"},e))),T.createElement(q,{selections:this.selectedChats,onForward:this.onChat})))}}]),t}(T.Component);e.exports=W},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(232),s=i(a),r=n(8),o=n(1462),l=n(1372),c=n(1376),u=n(1402),d=n(1370),p=n(153),h=n(43),f=r.createClass({displayName:"ContactsModal",mixins:[p],propTypes:{title:r.PropTypes.string.isRequired,contacts:r.PropTypes.arrayOf(r.PropTypes.instanceOf(s["default"])),filter:r.PropTypes.func,onCancel:r.PropTypes.func.isRequired,onSelect:r.PropTypes.func.isRequired},getDefaultProps:function(){return{filter:function(e){return Store.Contact.isFilteredContact(e)}}},getInitialState:function(){return this.selection=new l([],function(e){return e.id}),{searchFilter:void 0}},componentWillMount:function(){this.props.contacts||this.addObserver(Store.Contact,"add remove change:name")},onSelect:function(e,t){var n=t.props.contact;this.props.filter(n)===!0&&this.props.onSelect(n)},onSearch:function(e){this.setState({searchFilter:e})},render:function(){var e=this.props,t=e.title,n=e.onCancel,i=e.filter,a=e.onSelect,s=l10n.accentFold(this.state.searchFilter),l=this.props.contacts||Store.Contact,p=l.filter(function(e){return i(e)&&(!s||s&&e.searchMatch(s))}),f=[];if(p.length){this.selection.init(p.filter(function(e){return i(e)===!0}));for(var m=void 0,g=void 0,v=p.length>10,y=0;y<p.length;y++){m=p[y],v&&m.header!==g&&f.push(r.createElement(u,{key:m.header,header:m.header}));var E=_.isString(i(m)),b=void 0;y<p.length-1&&p[y+1].header!==m.header&&(b="last");var C=void 0;E&&(C=r.createElement("div",{className:"chat-status ellipsify",title:i(m)},i(m)),b=h(b,"member")),f.push(r.createElement(c,{contact:m,active:this.selection,className:b,secondary:C,onClick:E?void 0:_.once(a.bind(null,m)),key:m.id})),g=m.header}}else f=r.createElement(d.SearchContacts,null);return r.createElement(o,{title:t,selection:this.selection,onSearch:this.onSearch,searchPlaceholder:l10n.t("search_contacts"),onSelect:this.onSelect,onCancel:n},f)}});e.exports=f},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.MuteProxy=t["default"]=void 0;var a=n(2),s=i(a),r=n(77),o=i(r),l=n(8),c=n(1),u=n(20),d=n(45),p=n(10),h=n(75),f=n(12),m=n(161),g=n(111).ActionToast,v=n(111).ActionType,y=n(0),E=(0,r.defineState)("Mute",{props:{id:"string",expiration:{type:"number","default":0}},session:{_unmuteTimer:"string",promises:{type:"object","default":function(){return{}}}},derived:{isMuted:{deps:["expiration"],fn:function(){return!!this.expiration}}},initialize:function(){o["default"].prototype.initialize.call(this),this.expiration&&this.mute(this.expiration)},setMute:function(e,t){(e||this.expiration)&&e!==this.expiration&&(e?this.mute(e,t):this.unmute(t))},mute:function M(e,t,n){var i=this;if(!_.isNumber(e))return c.log("models:Mute:mute called with invalid expiration "+e)(),s["default"].reject(new f.ActionError);e=Math.round(e),e>2e9&&c.log("models:Mute:mute called with wrong units?"+this.id+" exp:"+e)();var M=function(){this.isMuted&&this._clearUnmuteTimer();var t=e-y().unix();c.log("models:Mute:mute "+this.id+" duration:"+t)(),this._unmuteTimer=m.setTimeout(this.unmute.bind(this),1e3*e),this.set({expiration:e})}.bind(this),a=u.isGroup(this.id);if(t){if(this.promises.mute)return this.promises.mute;this.promises.mute=d.sendConversationMute(this.id,e,this.expiration);var r=new v(a?l10n.t("action_group_muting"):l10n.t("action_chat_muting"));n=n||g.genId();var o=this.promises.mute["catch"](function(s){c.error("models:Mute:mute dropped")(s);var r=a?l10n.t("action_group_mute_failed"):l10n.t("action_chat_mute_failed");throw new v(r,l10n.t("action_try_again"),i.mute.bind(i,e,t,n))}).then(function(e){if(200===e.status){var s=a?l10n.t("action_group_muted"):l10n.t("action_chat_muted");return new v(s,l10n.t("action_undo"),i.unmute.bind(i,t,n))}if(e.status>=400)throw new v(a?l10n.t("action_group_mute_failed"):l10n.t("action_chat_mute_failed"))});return p.openToast(l.createElement(g,{id:n,initialAction:r,pendingAction:o})),this.promises.mute.then(function(e){200!==e.status||e._duplicate||M()})["finally"](function(){i.promises.mute=null})}return M(),s["default"].resolve()},canMute:function(){return h.supportsFeature(h.F.MUTE)&&u.isGroup(this.id)||h.supportsFeature(h.F.MUTE_1_1)&&u.isUser(this.id)},_clearUnmuteTimer:function(){m.clearTimeout(this._unmuteTimer),this.unset("_unmuteTimer"),this.expiration=0},unmute:function S(e,t){var n=this,S=function(){c.log("models:Mute:unmute "+this.id)(),this._clearUnmuteTimer()}.bind(this),i=u.isGroup(this.id);if(e){if(this.promises.unmute)return this.promises.unmute;this.promises.unmute=d.sendConversationMute(this.id,!1,this.expiration);var a=new v(i?l10n.t("action_group_unmuting"):l10n.t("action_chat_unmuting"));t=t||g.genId();var r=this.promises.unmute["catch"](function(a){c.error("models:Mute:unmute dropped")(a);var r=i?l10n.t("action_group_unmute_failed"):l10n.t("action_chat_unmute_failed");return s["default"].reject(new v(r,l10n.t("action_try_again"),n.unmute.bind(n,e,t)))}).then(function(e){if(200===e.status)return new v(i?l10n.t("action_group_unmuted"):l10n.t("action_chat_unmuted"));if(e.status>=400)throw new v(i?l10n.t("action_group_unmute_failed"):l10n.t("action_chat_unmute_failed"))});return p.openToast(l.createElement(g,{id:t,initialAction:a,pendingAction:r})),this.promises.unmute.then(function(e){200!==e.status||e._duplicate||S()})["finally"](function(){n.promises.unmute=null})}return S(),s["default"].resolve()},"delete":function(){o["default"].prototype["delete"].call(this),Store.Mute.remove(this.id),this._clearUnmuteTimer()}}),b=E.Mute,C=E.MuteProxy;t["default"]=b,t.MuteProxy=C},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.ProfilePicThumbProxy=t["default"]=void 0;var a=n(2),s=i(a),r=n(77),o=n(8),l=n(9),c=n(1),u=n(45),d=n(75),p=n(12),h=n(46),f=n(20),m=n(10),g=n(111).ActionToast,v=n(111).ActionType,y=n(95),E=n(29),_={SINGLE:"SINGLE",GROUP:"GROUP"},b=(0,r.defineState)("ProfilePicThumb",{Collection:"ProfilePicThumb",props:{id:"string",tag:"string",raw:"string",eurl:"string"},session:{stale:["boolean",!1,!0]},derived:{img:{deps:["tag","raw","stale","eurl"],fn:function(){if(this.raw)return"data:image/jpeg;base64,"+this.raw;if(!this.tag&&this.stale)return null;if(this.tag)return this.generateUrl("s")}},imgFull:{deps:["tag","raw","stale","eurl"],fn:function(){if((this.raw||!this.tag)&&this.stale)return null;if(!this.raw&&this.tag)return this.generateUrl("l")}},fallbackType:{deps:["id"],fn:function(){return f.isUser(this.id)?_.SINGLE:f.isGroup(this.id)?_.GROUP:_.GROUP}}},onError:function(e){switch(e){case 410:this.update()}},generateUrl:function(e){var t={t:e,u:this.id,i:this.tag};return y&&(this.eurl&&(t.e=this.eurl),t.ref=E.ref,t.tok=E.tok),h.build(l.PP_URL,t)},canSet:function(){return!(!f.isGroup(this.id)||!d.supportsFeature(d.F.GROUP_SET_PIC))||!(!f.isUser(this.id)||this.id!==Store.Conn.me||!d.supportsFeature(d.F.SET_PROFILE_PIC))},setPicture:function(e,t,n){var i=this;if(!this.canSet())return s["default"].reject(new p.ActionError);var a=u.sendSetPicture(this.id,e,t),r=new v(this.id===Store.Conn.me?l10n.t("action_profile_setting"):l10n.t("action_group_icon_setting"));n=n||g.genId();var l=a["catch"](function(e){throw c.error("models:ProfilePicThumb:setPicture dropped")(e),new v(i.id===Store.Conn.me?l10n.t("action_profile_set_failed"):l10n.t("action_group_icon_set_failed"))}).then(function(a){if(200===a.status)return new v(i.id===Store.Conn.me?l10n.t("action_profile_set"):l10n.t("action_group_icon_set"));if(a.status>=400){var s=i.id===Store.Conn.me?l10n.t("action_profile_set_failed"):l10n.t("action_group_icon_set_failed");return new v(s,l10n.t("action_try_again"),i.setPicture.bind(i,e,t,n))}});return m.openToast(o.createElement(g,{id:n,initialAction:r,pendingAction:l})),a.bind(this).then(function(e){200!==e.status||e._duplicate||(this.tag=e.tag)})},canDelete:function(){return!!(f.isGroup(this.id)&&d.supportsFeature(d.F.GROUP_SET_PIC)&&this.tag)||!!(f.isUser(this.id)&&this.id===Store.Conn.me&&d.supportsFeature(d.F.SET_PROFILE_PIC)&&this.tag)},deletePicture:function(e){var t=this;if(!this.canDelete())return s["default"].reject(new p.ActionError);var n=u.deletePicture(this.id),i=new v(this.id===Store.Conn.me?l10n.t("action_profile_removing"):l10n.t("action_group_icon_removing"));e=e||g.genId();var a=n["catch"](function(e){throw c.error("models:ProfilePicThumb:deletePicture dropped")(e),new v(t.id===Store.Conn.me?l10n.t("action_profile_remove_failed"):l10n.t("action_group_icon_remove_failed"))}).then(function(n){if(200===n.status)return new v(t.id===Store.Conn.me?l10n.t("action_profile_removed"):l10n.t("action_group_icon_removed"));if(n.status>=400){var i=t.id===Store.Conn.me?l10n.t("action_profile_remove_failed"):l10n.t("action_group_icon_remove_failed");return new v(i,l10n.t("action_try_again"),t.deletePicture.bind(t,e))}});return m.openToast(o.createElement(g,{id:e,initialAction:i,pendingAction:a})),n.bind(this).then(function(e){200!==e.status||e._duplicate||(this.tag=void 0)})}}),C=b.ProfilePicThumb,M=b.ProfilePicThumbProxy;C.FALLBACK=_,t["default"]=C,t.ProfilePicThumbProxy=M},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(453),o=i(r),l=n(455),c=n(16),u=n(75),d=n(1),p=n(9),h=l.extend({model:o["default"],initialize:function(){var e=this;l.prototype.initialize.call(this),this.isSynced=!1,this.syncPromise=null,this.listenTo(c,"change:stream",function(){c.stream===c.STREAM.DISCONNECTED?e.isSynced=!1:c.stream===c.STREAM.CONNECTED&&e["delete"]()})},comparator:function(e,t){return t.t-e.t},process:function(e,t,n,i){i?this["delete"]():this.update(e,t,n)},sync:function(e){if(this.isSynced)return s["default"].resolve();if(this.syncPromise)return this.syncPromise;if(!u.supportsFeature(u.F.FULL_TEXT_SEARCH))return s["default"].resolve();var t=this;if(u.supportsFeature(u.F.STARRED_PAGINATION)){var n=this.last()&&this.last().id;this.syncPromise=Store.Msg.getStarred(e,p.PAGE_SIZE,n).then(function(e){e.length&&t.add(e,{silent:!0}),e.length<p.PAGE_SIZE&&(t.isSynced=!0),t.trigger("sync")})["catch"](function(e){d.error("starred msg sync error: ",e)()})["finally"](function(){t.syncPromise=null})}else this.syncPromise=Store.Msg.getStarred().then(function(e){t.set(e),t.synced=!0,t.trigger("sync")})["catch"](function(e){d.error("starred msg sync error: ",e)()})["finally"](function(){t.syncPromise=null});return this.trigger("sync"),this.syncPromise},update:function(e,t,n){var i=this;if(this.isSynced){var a=this.syncPromise||s["default"].resolve();this.syncPromise=a.then(function(){if(e){var a=t.length>0?Store.Msg.incrementalStarredUpdate(t):s["default"].resolve([]);return a.then(function(e){i.add(e.concat(n),{silent:!0}),_.forEach(t,function(e){e.chat.starredMsgs&&e.chat.starredMsgs.add(e)}),i.trigger("sync")})["catch"](function(e){d.error("models:starred:update:error: ",e)()})}return i.filter(function(e){return!e.star}).forEach(function(e){i.remove(e.id),e.chat.starredMsgs&&e.chat.starredMsgs.remove(e.id)}),s["default"].resolve()})["finally"](function(){i.syncPromise=null})}},add:function(e,t){this.isModel(e)&&this.get(e)||(l.prototype.add.call(this,e,t),!this.parent&&e&&(Array.isArray(e)?_.forEach(e,function(e){return e.chat.starredMsgs&&e.chat.starredMsgs.add(e)}):e.chat.starredMsgs&&e.chat.starredMsgs.add(e)),Store.StarredGifMsgs.add(e))},remove:function(e,t){this.isModel(e)&&!this.get(e)||(l.prototype.remove.call(this,e,t),this.parent?Store.AllStarredMsgs.remove(e,t):e&&(Array.isArray(e)?_.forEach(e,function(e){return e.chat.starredMsgs&&e.chat.starredMsgs.remove(e)}):e.chat.starredMsgs&&e.chat.starredMsgs.remove(e)),Store.StarredGifMsgs.remove(e))},"delete":function(){this.synced=!1,l.prototype["delete"].call(this)}});e.exports=h},function(e,t){"use strict";function n(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=n);return t}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=n},,function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a,s,r=n(15),o=i(r),l=n(5),c=i(l),u=n(6),d=i(u),p=n(19),h=i(p),f=n(18),m=i(f),g=n(8),v=i(g),y=n(43),E=i(y),_=n(232),b=(i(_),n(1355)),C=i(b),M=n(1362),S=i(M);t["default"]=(0,S["default"])((s=a=function(e){function t(){return(0,c["default"])(this,t),(0,h["default"])(this,(0,o["default"])(t).apply(this,arguments))}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"render",value:function(){var e=this.props.contact,t=(0,E["default"])("chat-status-name",{number:!e.name});return v["default"].createElement(C["default"],{text:e.formattedShortName,direction:"auto",className:t})}}]),t}(v["default"].PureComponent),a.CONCERNS={contact:["formattedShortName","name"]},s))},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(15),s=i(a),r=n(5),o=i(r),l=n(6),c=i(l),u=n(19),d=i(u),p=n(18),h=i(p),f=n(8),m=i(f),g=n(1354),v=(i(g),n(453)),y=(i(v),n(76)),E=i(y),_=n(0),b=i(_),C=n(1368),M=i(C),S=n(1362),T=i(S),w=n(10),k=i(w),P=function(e){function t(){var e,n,i,a;(0,o["default"])(this,t);for(var r=arguments.length,l=Array(r),c=0;c<r;c++)l[c]=arguments[c];return n=i=(0,d["default"])(this,(e=(0,s["default"])(t)).call.apply(e,[this].concat(l))),i.state={updater:!1},i.listening=!1,i.rerender=function(){i.setState({updater:!i.state.updater})},a=n,(0,d["default"])(i,a)}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"componentWillMount",value:function(){this.maybeRegMidnight()}},{key:"componentWillReceiveProps",value:function(){this.maybeRegMidnight()}},{key:"maybeRegMidnight",value:function(){var e=this.props,t=e.listeners,n=e.msg,i=(0,b["default"])().startOf("day").subtract(7,"day");n.t>=i.unix()?this.listening||(this.listening=!0,t.add(k["default"],"midnight",this.rerender)):this.listening&&(this.listening=!1,t.remove(k["default"],"midnight",this.rerender))}},{key:"render",value:function(){return m["default"].createElement("div",{className:"chat-meta"},m["default"].createElement("span",{className:"chat-time"},E["default"].relativeStr(this.props.msg.t)))}}]),t}(m["default"].PureComponent);P.CONCERNS={msg:["t"]};var N=(0,M["default"])((0,T["default"])(P)),x=function(e){function t(){return(0,o["default"])(this,t),(0,d["default"])(this,(0,s["default"])(t).apply(this,arguments))}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"render",value:function(){var e=this.props.chat;return e.previewMessage?m["default"].createElement(N,{msg:e.previewMessage}):null}}]),t}(m["default"].PureComponent);x.CONCERNS={chat:["previewMessage"]};var D=(0,T["default"])(x);t["default"]=function(e){var t=e.chat,n=e.msg;return t?m["default"].createElement(D,{chat:t}):n?m["default"].createElement(N,{msg:n}):void 0}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1366),s=i(a),r=n(110),o=i(r),l=n(8),c=n(44),u=n(1376),d=n(1402),p=n(1372),h=l.createClass({displayName:"ContactList",propTypes:{contacts:l.PropTypes.array.isRequired,onClick:l.PropTypes.func,onFocusSearch:l.PropTypes.func},componentWillMount:function(){this.selection=new p(this.props.contacts,function(e){return e.id})},componentWillReceiveProps:function(e){this.selection.init(e.contacts)},onFocusGain:function(e){e.target===c.findDOMNode(this)&&(this.selection.index<0?this.focusFirst():this.selection.reset())},focusFirst:function(){this.selection.setFirst()},onNextContact:function(e){e.preventDefault(),e.stopPropagation(),this.selection.setNext()},onPrevContact:function(e){e.preventDefault(),e.stopPropagation();var t=this.selection.prev();t>-1?this.selection.setPrev():(this.selection.unset(),this.props.onFocusSearch(e))},render:function(){for(var e,t=this.props.contacts,n=[],i=t.length>10,a="XXX",r=0;r<t.length;r++){var c=t[r];if(e=null,i){var p=c.header;r<t.length-1&&p!==t[r+1].header&&(e="last"),p!==a&&(n.push(l.createElement(d,{key:p,header:p})),a=p)}var h=c.id,f=void 0;c.isBlocked()&&(f=l10n.t("contact_list_blocked_contact")),n.push(l.createElement(u,{contact:c,active:this.selection,className:e,onClick:this.props.onClick,secondary:f,key:h}))}var m={down:this.onNextContact,up:this.onPrevContact};return l.createElement(o["default"],{handlers:m,onFocus:this.onFocusGain,"data-tab":3},l.createElement(s["default"],{className:"chatlist",data:n,height:72,extraItems:4}))}});e.exports=h},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(453),s=i(a),r=n(8),o=n(44),l=n(16),c=n(94),u=n(154),d=n(156),p=n(10),h=n(58),f=r.createClass({displayName:"AudioTag",mixins:[c,u,d],propTypes:{msg:r.PropTypes.instanceOf(s["default"]).isRequired,className:r.PropTypes.string,controls:r.PropTypes.bool,preload:r.PropTypes.string,type:r.PropTypes.string,onClick:r.PropTypes.func,onPlay:r.PropTypes.func,onError:r.PropTypes.func,autoPlay:r.PropTypes.bool},componentDidMount:function(){var e=o.findDOMNode(this);this.regNativeListener(e,"error",this.onPlayerError,!0),this.regNativeListener(e,"playing",this.onPlaying),this.regCmd("mediaPlaying",this.onOtherPlaying),(h.isGecko||h.isSafari)&&(this.props.autoPlay?(this.checkIteration=0,
this.checkForSuccessInterval=this.safeInterval(this.checkForSuccess,250)):this.props.autoPlay?this.startCheckForSuccess():this.regNativeListener(e,"play",this.startCheckForSuccess))},startCheckForSuccess:function(){this.checkIteration=0,this.checkForSuccessInterval=this.safeInterval(this.checkForSuccess,250)},clearCheckForSuccess:function(){this.checkForSuccessInterval&&(this.clearSafeInterval(this.checkForSuccessInterval),delete this.checkForSuccessInterval,delete this.checkIteration)},checkForSuccess:function(){if(l.state===l.STATE.CONNECTED){if(this.checkIteration++,this.checkIteration>40)return void this.onPlayerError({target:{src:this.state.src,error:{code:window.MediaError.MEDIA_ERR_NETWORK}}});var e=o.findDOMNode(this),t=e.buffered;t&&t.length&&t.end(0)>0&&this.onPlaying({target:e})}},onPlayerError:function(e){this.clearCheckForSuccess(),this.props.onError&&this.props.onError(e.target.src)},onOtherPlaying:function(e){e!==this&&o.findDOMNode(this).pause()},onPlaying:function(e){this.clearCheckForSuccess(),p.mediaPlaying(this),this.props.onPlay&&this.props.onPlay(e)},render:function(){return r.createElement("audio",{src:this.props.msg.mediaData.renderableUrl,className:this.props.className,onClick:this.props.onClick,controls:this.props.controls,preload:this.props.preload,type:this.props.type,autoPlay:this.props.autoPlay},this.props.children)}});e.exports=f},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1354),s=i(a),r=n(8),o=n(1356),l=n(1369),c=r.createClass({displayName:"DeleteMenuItem",mixins:[o],propTypes:{chat:r.PropTypes.instanceOf(s["default"]).isRequired,onDeleteOrExit:r.PropTypes.func.isRequired},getInitialState:function(){return{isReadOnly:this.async("chat.isReadOnly")}},render:function(){var e;switch(this.props.chat.kind){case s["default"].KIND.GROUP:e=this.props.chat.isReadOnly?l10n.t("web_delete_group"):l10n.t("web_exit_group");break;case s["default"].KIND.BROADCAST:e=l10n.t("web_delete_list");break;case s["default"].KIND.CHAT:e=l10n.t("delete_chat")}return r.createElement(l,{a8n:"mi-delete",action:this.props.onDeleteOrExit,shortcut:"x"},e)}});e.exports=c},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1396),s=i(a),r=n(1407),o=i(r),l=n(8),c=n(153),u=n(1355),d=n(12),p=l.createClass({displayName:"GroupSubtitle",mixins:[c],propTypes:{presence:l.PropTypes.instanceOf(s["default"]),groupMetadata:l.PropTypes.instanceOf(o["default"]),placeholder:l.PropTypes.node,location:l.PropTypes.oneOf(["list","title"])},_init:function(){Store.GroupMetadata.find(this.props.groupMetadata.id)["catch"](d.WapDrop,_.noop)},componentWillMount:function(){this.uiIdle(this._init);var e=this.props.groupMetadata.participants;this.addObserver(e,"sort remove reset"),"list"!==this.props.location&&this.addObserver(this.props.presence,"change:chatstate.id change:chatstate.type change:forceDisplay change:withholdDisplay")},getSubtitle:function(){return this.props.groupMetadata.participants.map(function(e){return e.contact.formattedShortNameWithNonBreakingSpaces}).join(", ")},render:function(){var e,t=this.props.presence;return"list"===this.props.location?(e=this.getSubtitle(),e?l.createElement(u,{ellipsify:!0,titlify:!0,text:e}):null):(e=t.withholdDisplay?this.props.placeholder:t.getFormattedString()||(t.forceDisplay?this.getSubtitle():this.getSubtitle()||this.props.placeholder),e?l.createElement("div",{className:"chat-status ellipsify"},l.createElement(u,{ellipsify:!0,titlify:!0,text:e})):null)}});e.exports=p},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e){var t=e.duration,n=b.durationStr(t);return n?E.createElement("span",{className:"media-canvas-duration"},n):null}var s=n(15),r=i(s),o=n(5),l=i(o),c=n(6),u=i(c),d=n(19),p=i(d),h=n(18),f=i(h),m=n(453),g=(i(m),n(1368)),v=i(g),y=n(1371),E=n(8),_=n(231),b=n(76),C=(n(1379),function(e){function t(){(0,l["default"])(this,t);var e=(0,p["default"])(this,(0,r["default"])(t).apply(this,arguments));return e.onSelectClick=function(t){e.props.onMessageSelect&&e.props.onMessageSelect(e.props.msg,!e.props.selected)},e.onMouseOver=function(t){e.state.hover||e.setState({hover:!0})},e.onMouseEnter=function(t){e.state.hover||e.setState({hover:!0})},e.onMouseLeave=function(t){e.state.hover&&e.setState({hover:!1})},e.state={hover:!1},e}return(0,f["default"])(t,e),(0,u["default"])(t,[{key:"componentDidMount",value:function(){this.props.listeners.add(this.props.msg.mediaData,"change:preview"),this.props.imgRef&&this.props.imgRef(this.img)}},{key:"componentWillUnmount",value:function(){this.props.imgRef&&this.props.imgRef(null)}},{key:"render",value:function(){var e=this.props,t=e.msg.mediaData,n=(e.selected,e.selectable,void 0),i=null,s=null,r=null,o=null;switch(t.type){case _.TYPE.AUDIO:n="media-canvas attach-media-audio-thumb",s=E.createElement("span",{className:"icon-s icon-msg-audio-light"}),r=E.createElement(a,{duration:t.duration});break;case _.TYPE.VIDEO:i=E.createElement("div",{className:"shade"}),t.isGif?(n=t.preview?"media-canvas":"media-canvas media-video-thumb",s=E.createElement("span",{className:"icon-s icon-msg-gif-light"})):(n="media-canvas",s=E.createElement("span",{className:"icon-s icon-msg-video-light"}),r=E.createElement(a,{duration:t.duration})),t.preview&&(o={backgroundImage:'url("'+t.preview.url()+'")'});break;case _.TYPE.IMAGE:n="media-canvas",t.renderableUrl?o={backgroundImage:"url("+t.renderableUrl+")"}:t.preview&&(o={backgroundImage:'url("'+t.preview.url()+'")'})}var l=void 0;l=this.props.onDragStart?E.createElement("div",{className:n,style:o,onClick:this.props.onClick||null,ref:(0,y.GetRef)("img",this),onDragStart:this.props.onDragStart,draggable:!0}):E.createElement("div",{className:n,style:o,onClick:this.props.onClick||null,ref:(0,y.GetRef)("img",this)});var c=null,u=null,d=null,p=null;return this.props.hoverEvent&&(u=this.onMouseOver,d=this.onMouseEnter,p=this.onMouseLeave),E.createElement("div",{className:this.props.classes,onMouseOver:u,onMouseEnter:d,onMouseLeave:p},c,l,i,s,r)}}]),t}(E.Component));e.exports=(0,v["default"])(C)},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1354),s=i(a),r=n(8),o=n(1356),l=n(1369),c=r.createClass({displayName:"MuteMenuItem",mixins:[o],propTypes:{chat:r.PropTypes.instanceOf(s["default"]).isRequired,onMute:r.PropTypes.func.isRequired},getInitialState:function(){return{isMuted:this.async("chat.mute.isMuted")}},render:function(){var e=this.props.onMute.bind(null,!this.state.isMuted);return r.createElement(l,{action:e,shortcut:"m",a8n:"mi-mute"},this.state.isMuted?l10n.t("web_menuitem_mute_off"):l10n.t("web_menuitem_mute"))}});e.exports=c},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1354),s=i(a),r=n(8),o=n(1356),l=n(10),c=n(1416),u=n(1379),d=n(454),p=r.createClass({displayName:"MuteRow",mixins:[o],propTypes:{chat:r.PropTypes.instanceOf(s["default"]).isRequired},getInitialState:function(){return this.asyncState({isMuted:"chat.mute.isMuted"})},onMute:function(e){l.muteChat(this.props.chat,e,this)},onUnmute:function(){var e=this.props.chat.isGroup?l10n.t("confirm_unmute_group"):l10n.t("confirm_unmute_chat");l.openModal(r.createElement(d,{onOK:this.unmute,okText:l10n.t("action_chat_unmute"),onCancel:function(){return l.closeModal()},cancelText:l10n.t("web_cancel")},e))},unmute:function(){this.onMute(!1),l.closeModal()},render:function(){var e=this,t=this.props.chat.mute.isMuted,n=t?this.onUnmute:function(){e.onMute(!0)},i=r.createElement(u,{checked:t,onChange:n}),a=t?l10n.t("web_chat_muted"):l10n.t("web_menuitem_mute");return r.createElement(c,{classes:"row-drawer-item",side:i,onClick:n,ellipsify:!0},r.createElement("span",{className:"title"},a))}});e.exports=p},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(47),s=i(a),r=n(21),o=i(r),l=function(e){for(var t={edges:{}},n=t,i=0;i<e.length;++i){for(var a=e[i],s=0;s<a.length;++s){var r=a[s];n.edges[r]||(n.edges[r]={edges:{}}),n=n.edges[r],s===a.length-1&&(n.idx=i)}n=t}return t},c=(0,o["default"])(n(486)),u=l(c),d=function(e,t){for(var n=[],i=e.length,a=t,s=0,r=void 0;(r=s)<i;){var o=a.edges[e[s++]];if(o){a=o;for(var l=a.idx;(a=a.edges[e[s]])&&++s;)void 0!==a.idx&&(l=a.idx);void 0===l?s=r+1:n.push([r,s-1]),a=t}}return n},p=function(e){for(var t=[],n=0,i=e.length;n<i;){var a=e.charCodeAt(n++);if(a>=55296&&a<=56319&&n<i){var s=e.charCodeAt(n++);if(56320===(64512&s)){t.push(""+e[n-2]+e[n-1]);continue}--n}t.push(e[n-1])}return t};e.exports=function(e){if(!e||!e.length)return[];for(var t=[],n=0,i=d(e,u),a=0;a<i.length;++a){var r=(0,s["default"])(i[a],2),o=r[0],l=r[1];o!==n&&(t=t.concat(p(e.substring(n,o)))),t.push(e.slice(o,l+1)),n=l+1}return n<e.length&&(t=t.concat(p(e.substr(n)))),t}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1429),s=i(a);e.exports=(0,s["default"])({CHANGE:void 0,MOUNT:void 0})},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1429),s=i(a);e.exports=(0,s["default"])({SEARCH:void 0,INACTIVE:void 0,ENTER:void 0,TAB:void 0,DOWN:void 0,UP:void 0})},function(e,t,n){"use strict";var i=n(8),a=n(43),s=i.createClass({displayName:"Tooltip",propTypes:{body:i.PropTypes.node.isRequired,className:i.PropTypes.string,direction:i.PropTypes.oneOf(["top","right","bottom","left"]).isRequired},getDefaultProps:function(){return{className:null}},render:function(){var e=a("tooltip",this.props.className,this.props.direction);return i.createElement("div",{className:e},this.props.body)}});e.exports=s},function(e,t,n){"use strict";var i=n(8),a=n(44),s=n(154),r=n(1267),o=i.createClass({displayName:"Video",mixins:[s,r],propTypes:{src:i.PropTypes.string.isRequired,onPlay:i.PropTypes.func},componentDidMount:function(){var e=a.findDOMNode(this),t=this;this.regNativeListener(e,"playing",function(n){e.videoHeight&&e.videoWidth||(e.pause(),e.play()),e.videoHeight&&e.videoWidth&&t.props.onPlay(n)})},render:function(){return i.createElement("video",this.props)}});e.exports=o},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(158),s=i(a),r=n(2),o=i(r),l=n(1354),c=i(l),u=n(1482),d=i(u),p=n(92),h=i(p),f=n(110),m=i(f),g=n(8),v=n(44),y=n(9),E=n(1422),b=n(1525),C=n(94),M=n(156),S=n(1356),T=n(153),w=n(10),k=n(454),P=n(12),N=n(59),x=n(46),D=n(1566),O=n(1420),R=n(1446),I=n(238),A=n(1),L=n(1360),F=n(457),U=n(75),G=n(43),j=n(229),B=n(1507),V=n(96),q=n(1565),H=function(){return U.supportsFeature(U.F.LINK_PREVIEW)||U.supportsFeature(U.F.SEND_LINK_PREVIEW)&&!1},z=g.createClass({displayName:"ComposeBox",mixins:[C,M,S,L,T],propTypes:{chat:g.PropTypes.instanceOf(c["default"]).isRequired,onPageUpDown:g.PropTypes.func.isRequired,onComposeHeightChange:g.PropTypes.func,className:g.PropTypes.string},getInitialState:function(){var e=this.props.chat;this.text=e.composeContents.text||"",this.selection=e.composeContents.selection,this.omittedURL=e.composeContents.omittedURL,this.pendingLinkPreviewPromises=[],this.preview=this.omittedURL,this.scanForLinks=this.safeDebounce(this._scanForLinks,200);var t;return t=0,{trusted:this.async("chat.trusted"),hasText:!!this.text,emojiExpanded:!1,recording:!1,linkPreview:null,quotedMsg:e.composeQuotedMsg,textsize:t}},componentWillMount:function(){var e=this.props.chat;e.setComposeContents({}),this.regCmd("focus_chat_text_input_"+this.props.chat.id,this.restoreFocus),this.regCmd("focus_chat_text_input",this.restoreFocus),this.regCmd("paste_chat_text_input_"+this.props.chat.id,this.pasteEmojiInput),this.regCmd("enter_chat_text_input_"+this.props.chat.id,this.onSendText),this.addObserver(e,"change:composeQuotedMsg",this.onQuotedMsgChange)},componentDidMount:function(){var e=this;this.height=v.findDOMNode(this.refs.composeBlock).clientHeight,H()&&this.scanForLinks(),this.regCmd("textsize_change",function(t){e.setState({textsize:t})})},componentWillUnmount:function(){this.props.chat.setComposeContents({text:this.text,selection:this.selection,omittedURL:this.omittedURL})},pasteEmojiInput:function(e){return" "!==e||this.hasText()?void(this.refs.input&&(this.refs.input.focus(!0),this.refs.input.replaceSelection(e))):w.scrollMessages()},onMaxPasteExceeded:function(){w.openModal(g.createElement(k,{title:l10n.t("message_too_large_title"),onOK:w.closeModal.bind(w),okText:l10n.t("web_ok")},l10n.t("message_too_large_text")))},restoreFocus:function(){this.refs.input&&this.refs.input.focus()},clearLinkPreview:function(){this.preview=null,this.omitLinkPreview()},cancelPendingLinkPreviews:function(){_.forEach(this.pendingLinkPreviewPromises,function(e){return e.cancel()}),this.pendingLinkPreviewPromises=[]},omitLinkPreview:function(e){e!==!0&&this.state.linkPreview&&(this.setState({linkPreview:null}),this.omittedURL=this.preview)},omitQuotedPreview:function(e){e!==!0&&(this.props.chat.composeQuotedMsg=null)},_findFirstWebLink:function(){return _.head(I.findLinks(this.text).filter(function(e){var t=e.url;return x.isHttp(t)}))},_scanForLinks:function(){var e=this;if(!this.state.hasText)return void this.clearLinkPreview();var t=this._findFirstWebLink();if(!t)return void this.clearLinkPreview();var n=t.url;if(!this.preview||this.preview!==n){this.preview=n,this.omittedURL=null;var i=(0,d["default"])(n).checkpoint(this.rejectOnUnmount()).cancellable();this.pendingLinkPreviewPromises.push(i),i.then(function(t){var n=t.url,i=t.data;e.preview&&e.preview!==n||(i.title||i.description)&&e.setState({linkPreview:i})})["catch"](P.Unmount,_.noop)["catch"](P.WapDrop,_.noop)["catch"](o["default"].CancellationError,_.noop)}},onQuotedMsgChange:function(){var e=this.props.chat,t=!1;(this.state.quotedMsg?!e.composeQuotedMsg:e.composeQuotedMsg)&&(t=!0),t&&!e.composeQuotedMsg?this.setState({quotedMsg:null}):this.setState({quotedMsg:e.composeQuotedMsg})},indicateFocus:function(e){var t=this.refs.container;if(t&&t.activate(),!(Date.now()-(m["default"].flashFocus||0)>200)){var n=v.findDOMNode(this.refs.input_hotkey);Velocity(n,"stop"),Velocity(n,{backgroundColor:["#ffffff","#D9F3FF"],borderColor:["#ffffff","#CBE4EF"]},{duration:1300,easing:[.24,.91,.01,.99]}),this.refs.input.focus(!1)}},onEmojiButtonFocus:function(){var e=v.findDOMNode(this.refs.emojiButton);h["default"].focus(e)},onPageUpDown:function(e){var t=this;this.props.onPageUpDown&&(e.stopPropagation(),this.props.onPageUpDown(e),this.safeDefer(function(){return t.refs.input&&t.refs.input.focus(!0)}))},handleEmoji:function(e){this.refs.input.replaceSelection(e)},handleGif:function(e,t){var n=V.get(e,V.RESP_TYPE.BLOB).then(function(e){var n=e.response;return n.isGifHackDoNotUse=!0,n.gifAttributionHackDoNotUse=t,n})["catch"](function(e){throw A.error("failed loading gif ("+e+")")(),new P.MediaFileFailedLoad});this.closeEmojiPanel(),w.attachMediaDrawer(this.props.chat,[n])},openEmojiPanel:function(){this.state.emojiExpanded!==!0&&this.setState({emojiExpanded:!0})},closeEmojiPanel:function(){this.state.emojiExpanded!==!1&&this.setState({emojiExpanded:!1})},onPTT:function(e){this.setState({recording:e===q.REC})},preventBlur:function(e){var t=e.target,n=v.findDOMNode(this.refs.input),i=v.findDOMNode(this.refs.container);do if(t===n)return;while(t!==i&&(t=t.parentNode));this.stopEvent(e),this.refs.input.focus(!1)},onChange:function(e){var t=v.findDOMNode(this.refs.composeBlock),n=t.clientHeight,i=n-this.height;i&&this.props.onComposeHeightChange({input:i}),this.height=n;var a=this.hasText();this.text=e;var s=this.hasText();if(s!==a&&this.setState({hasText:s}),s?(this.props.chat.presence.subscribe()["catch"](P.WapDrop,_.noop),this.props.chat.markComposing()):this.props.chat.markPaused(),H()){var r=this._findFirstWebLink();(!r&&this.preview||r&&r.url!==this.preview)&&this.clearLinkPreview(),this.scanForLinks()}},_getSendButton:function(){var e=navigator.getUserMedia&&window.AudioContext;if(this.state.hasText||!e)return g.createElement("button",{className:"icon icon-send compose-btn-send",onClick:this.onSendText,disabled:!this.hasText});var t=this.props.chat;return g.createElement(q,{key:"ptt",chat:t,onStateChange:this.onPTT})},_restoreEmojiPanelFocus:function(){this.refs.emojiPanel&&this.refs.emojiPanel.restoreFocus()},_getPopupPanel:function(){var e=void 0;this.state.linkPreview&&(e=g.createElement(j,{displayName:"ComposeBoxLinkPreview",escapable:!0,requestDismiss:this.omitLinkPreview},g.createElement("div",{className:"compose-popup-panel"},g.createElement(R,(0,s["default"])({onOmit:this.omitLinkPreview},this.state.linkPreview)))));var t=void 0;this.state.quotedMsg&&(t=g.createElement(j,{displayName:"ComposeBoxQuotedMsg",escapable:!0,requestFocus:this.restoreFocus,requestDismiss:this.omitQuotedPreview},g.createElement("div",{className:"compose-popup-panel"},g.createElement(O,{msg:this.state.quotedMsg,key:this.state.quotedMsg.id.toString(),onOmit:this.omitQuotedPreview,chat:this.state.quotedMsg.chat}))));var n=null;this.state.emojiExpanded&&(n=g.createElement(j,{displayName:"ComposeBoxEmojiPanel",escapable:!0,requestDismiss:this.closeEmojiPanel,requestFocus:this._restoreEmojiPanelFocus},g.createElement("div",null,g.createElement(E,{ref:"emojiPanel",key:"compose-emoji-panel",onEmoji:this.handleEmoji,onFocusRelease:this.restoreFocus,onGif:y.SHOW_GIF_SEARCH?this.handleGif:void 0,showSearch:this.state.showEmojiSearch,searchQuery:this.state.emojiSearchQuery,text:this.text}))));var i=this.props.chat,a=U.supportsFeature(U.F.SPAM),r=null;return!i.isPSA&&i.isVisible&&!i.trusted&&a&&(r=g.createElement(D,{chat:this.props.chat})),g.createElement("div",{className:"compose-box-items-positioning-container"},g.createElement("div",{className:"compose-box-items-overlay-container"},g.createElement(B,{onHeightChange:this.onHeightChange},r,n,t,e)))},onHeightChange:function(e,t){this.props.onComposeHeightChange({overlay:e},t)},onFiles:function(e){var t=_.filter(e.getFiles(),function(e){var t=N.typeFromMimetype(e.type);return"image"===t||"video"===t});if(t.length)return w.attachMediaDrawer(this.props.chat,t),!0},onSelectionChange:function(e){this.selection=e},hasText:function(){return z.hasText=this.text.trim().length>0},onEnter:function(e){e&&e.repeat||this.onSendText()},onSendText:function(){var e=this.text.trim();if(e.length){var t=/\u200B((\d+)@c\.us)\u200B/g,n=[],i=e.replace(t,function(e,t,i){return n.push(t),"@"+i});this.props.chat.sendMessage(F.emojify(i),this.state.linkPreview,this.props.chat.composeQuotedMsg,n),this.cancelPendingLinkPreviews(),this.setState({emojiExpanded:!1,showEmojiSearch:!1,emojiSearchQuery:"",hasText:!1,linkPreview:null,quotedMsg:this.props.chat.composeQuotedMsg=null}),this.props.chat.setComposeContents({}),this.refs.input.reset(),this.text="",this.hasText()}},stopEvent:function(e){e&&(e.preventDefault(),e.stopPropagation())},handleEmojiButtonClick:function(e){return this.stopEvent(e),this.state.emojiExpanded?this.closeEmojiPanel():this.openEmojiPanel()},handleTab:function(e){this.state.emojiExpanded&&(m["default"].flashFocus=Date.now(),this.refs.emojiPanel.focusSearchInput(),this.stopEvent(e))},render:function(){var e,t=this,n=this.state.emojiExpanded?g.createElement("button",{className:"icon icon-hide compose-btn-emoji",onClick:this.closeEmojiPanel}):g.createElement("button",{className:"icon icon-smiley compose-btn-emoji",onClick:this.openEmojiPanel}),i={enter:this.handleEmojiButtonClick},a=G("input-container",{disabled:this.state.recording}),s={pagedown:this.onPageUpDown,pageup:this.onPageUpDown},r=l10n.t("type_a_message"),o=_.find(y.TEXTSIZE_CLASS_MAP,function(e){return e.scale===t.state.textsize});o&&(e=o.classname);var l=G("block-compose",e,{"ptt-open":this.state.recording}),c={tab:this.handleTab,"shift+tab":this.handleTab},u=null;return g.createElement(j,{displayName:"ComposeBox",ref:"container",state:j.State.PASSIVE,requestFocus:this.restoreFocus},g.createElement(m["default"],{component:"footer",handlers:s,className:this.props.className,onMouseDown:this.preventBlur,onContextMenu:this.preventBlur},u,g.createElement("div",{className:l,ref:"composeBlock"},g.createElement(m["default"],{ref:"emojiButton",className:"emoji-button-container","data-tab":4,handlers:i,onFocus:this.onEmojiButtonFocus},n),g.createElement(m["default"],{ref:"input_hotkey",className:a,handlers:c,onFocus:this.indicateFocus},g.createElement(b,{placeholder:r,readOnly:this.state.recording,ref:"input",initialValue:this.text,initialSelection:this.selection,spellCheck:!0,multiline:!0,maxLength:y.MAX_TXT_MSG_SIZE,onMaxPasteExceeded:this.onMaxPasteExceeded,onEnter:this.onEnter,onFiles:this.onFiles,onChange:this.onChange,onSelect:this.onSelectionChange,className:"input"})),this._getSendButton()),this._getPopupPanel(),g.createElement(b.Suggestions,{chat:this.props.chat})))}});e.exports=z},function(e,t,n){"use strict";var i=n(8),a=i.createClass({displayName:"LinkPreview",propTypes:{title:i.PropTypes.string,description:i.PropTypes.string,canonicalUrl:i.PropTypes.string,thumbnail:i.PropTypes.string,onOmit:i.PropTypes.func},render:function(){var e=this.props,t=e.title,n=e.description,a=e.canonicalUrl,s=e.thumbnail,r=s?i.createElement("img",{className:"link-preview-media",src:"data:image/jpeg;base64,"+s}):null,o=this.props.onOmit?i.createElement("div",{className:"btn-background"},i.createElement("button",{className:"icon icon-x",onClick:this.props.onOmit})):null;return i.createElement("div",{className:"message-in link-preview-compose"},i.createElement("div",{className:"link-preview-container"},r,i.createElement("div",{className:"link-preview-body"},i.createElement("div",{className:"link-preview-title",title:t},t),i.createElement("div",{className:"link-preview-description",title:n},n),i.createElement("div",{className:"link-preview-source ellipsify"},a))),o)}});e.exports=a},function(e,t,n){"use strict";function i(e,t){var n=[];return n.push(r.createElement(l,{key:"info",a8n:"mi-group-info",action:function(){return o.chatInfoDrawer(e)},shortcut:"i"},l10n.t("web_group_info"))),n.push(r.createElement(l,{a8n:"mi-select-messages",key:"select",action:t,shortcut:"e"},l10n.t("web_select_messages"))),e.mute.canMute()&&n.push(r.createElement(c,{key:"mute",onMute:function(t){return o.muteChat(e,t)},chat:e})),e.canClear()&&n.push(r.createElement(l,{key:"clear",a8n:"mi-clear",shortcut:"e",action:function(){return o.clearChatMsgs(e)}},l10n.t("clear_chat"))),e.canDelete()&&n.push(r.createElement(u,{key:"delete",onDeleteOrExit:function(){return o.deleteOrExitChat(e)},chat:e})),n}function a(e,t){var n=[];return n.push(r.createElement(l,{key:"info",a8n:"mi-broadcast-info",action:function(){return o.chatInfoDrawer(e)},shortcut:"i"},l10n.t("web_list_info"))),n.push(r.createElement(l,{a8n:"mi-select-messages",key:"select",action:t,shortcut:"e"},l10n.t("web_select_messages"))),e.canClear()&&n.push(r.createElement(l,{key:"clear",a8n:"mi-clear",shortcut:"e",action:function(){return o.clearChatMsgs(e)}},l10n.t("clear_chat"))),e.canDelete()&&n.push(r.createElement(u,{key:"delete",onDeleteOrExit:function(){return o.deleteOrExitChat(e)},chat:e})),n}function s(e,t){var n=[];return e.isPSA||n.push(r.createElement(l,{key:"info",a8n:"mi-contact",action:function(){return o.chatInfoDrawer(e)},shortcut:"i"},l10n.t("web_contact_info"))),n.push(r.createElement(l,{a8n:"mi-select-messages",key:"select",action:t,shortcut:"e"},l10n.t("web_select_messages"))),e.mute.canMute()&&n.push(r.createElement(c,{key:"mute",onMute:function(t){return o.muteChat(e,t)},chat:e})),e.canClear()&&n.push(r.createElement(l,{key:"clear",a8n:"mi-clear",shortcut:"e",action:function(){return o.clearChatMsgs(e)}},l10n.t("clear_chat"))),e.canDelete()&&n.push(r.createElement(u,{key:"delete",onDeleteOrExit:function(){return o.deleteOrExitChat(e)},chat:e})),n}var r=n(8),o=n(10),l=n(1369),c=n(1438),u=n(1435);e.exports={group:i,contact:s,broadcast:a}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(453),s=i(a),r=n(8),o=n(76),l=r.createClass({displayName:"HiddenText",propTypes:{msg:r.PropTypes.instanceOf(s["default"]).isRequired},render:function(){var e=this.props.msg,t=e.senderObj.formattedUser,n="["+o.timeStr(e.t)+"]";return r.createElement("span",{className:"message-pre-text"},"⁠⁠",n," ",t,": ⁠⁠⁠")}});e.exports=l},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(453),s=i(a),r=n(1377),o=i(r),l=n(8),c=n(1373),u=n(1356),d=n(154),p=n(1367),h=n(1363),f=n(46),m=n(43),g=n(471),v=n(461),y=50,E=["foursquare.com","facebook.com","maps.google.com"],b=l.createClass({displayName:"Location",mixins:[u,d],propTypes:{msg:l.PropTypes.instanceOf(s["default"]).isRequired,quotedMsg:l.PropTypes.element,displayAuthor:l.PropTypes.bool},statics:{previewWidth:270,previewHeight:150},getInitialState:function(){var e="",t=!1,n=this.getStaticMapUrl();return v.isCached(n)&&(e=n,t=!0),{src:e,hiResAvail:t}},componentDidMount:function(){this.updateResolution(),this.regNativeListener(window,"dpichange",this.updateResolution)},getClientThumb:function(){return"data:image/jpeg;base64,"+this.async("msg.body")},getStaticMapUrl:function(){var e=this.props.msg,t=b.previewWidth,n=b.previewHeight+y,i=g.currentRes===g.RES.HIGH?2:1,a=f.build("https://maps.googleapis.com/maps/api/staticmap",{markers:"color:red|"+e.lat+", "+e.lng,zoom:14,size:t+"x"+n,scale:i,language:l10n.getLocale(),client:f.GSM_NAME});return f.gsmURL(a,f.GSM_NUMS)},getMapUrl:function(){var e=this.props.msg,t=this.loc();return t&&t.name?["https://maps.google.com/maps/search",encodeURIComponent(t.name),"@"+e.lat+","+e.lng+",17z"].join("/")+"?hl="+l10n.getLocale():f.build("https://maps.google.com/maps",{q:e.lat+","+e.lng,z:17,hl:l10n.getLocale()})},loc:function C(){var C=this.props.msg.get("loc");if(C)return C=C.split("\n"),2===C.length?{name:C[0],addr:C[1]}:{name:C}},getLocationDetails:function(){var e=this.props.msg,t=this.loc(),n=this.props.msg.clientUrl||this.getMapUrl(),i=void 0,a=void 0,s=void 0,r=f.hostname(n),o=_.isEmpty(E.filter(function(e){return r.indexOf(e)>-1}));if(s=o?l.createElement("div",{className:"location-page-host location-caption"},l.createElement(c,null,r)):null,t){i=t.name?l.createElement("a",{href:n,title:t.name,target:"_blank",className:"text-title"},l.createElement(c,null,t.name)):null;var u=m("text-contents",{"location-caption":!s});a=t.addr?l.createElement("div",{title:t.addr,className:u},l.createElement(c,null,t.addr)):null}var d=i&&a?l.createElement("div",{className:"image-caption message-text","data-id":e.id},i,a,s):null;return d},updateResolution:function(){this.setState({src:this.getStaticMapUrl()})},onImgLoaded:function(){this.state.hiResAvail||this.setState({hiResAvail:!0})},onClick:function(e){e.stopPropagation()},render:function(){var e=this.props.msg,t=this.getLocationDetails(),n=t?null:l.createElement("div",{className:"shade"}),i=this.props.displayAuthor&&h.shouldRender(e)?l.createElement(h,{msg:e}):null,a=m("bubble-location",{"bubble-location-caption":t,"bubble-broadcast":t&&e.broadcast,"bubble-star":t&&e.star}),s={background:"url("+this.getClientThumb()+")",backgroundSize:"cover",width:b.previewWidth,height:this.state.hiResAvail?void 0:b.previewHeight},r={height:b.previewHeight},c=m("image-thumb-body",{"image-thumb-location-lores":!this.state.hiResAvail});return l.createElement("div",{className:a},i,this.props.quotedMsg,l.createElement("div",{className:"image-thumb",onClick:this.onClick,style:r},l.createElement("a",{href:this.getMapUrl(),target:"_blank"},l.createElement(o["default"],{src:this.state.src,className:c,style:s,hasPrivacyChecks:!1,onLoaded:this.onImgLoaded,noXHR:!0})),n),t,l.createElement(p,{msg:e}))}});e.exports=b},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(15),s=i(a),r=n(5),o=i(r),l=n(6),c=i(l),u=n(19),d=i(u),p=n(18),h=i(p),f=n(453),m=i(f),g=n(8),v=n(457),y=n(1559),E=n(1554),_=n(1543),b=n(1553),C=n(1563),M=n(1542),S=n(1562),T=n(1449),w=n(1555),k=n(1545),P=n(1547);n(1360);var N=n(1561),x=n(1552),D=n(1556),O=n(1),R=function(e){function t(){return(0,o["default"])(this,t),(0,d["default"])(this,(0,s["default"])(t).apply(this,arguments))}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"render",value:function(){var e=this.props,t=e.msg,n=e.quotedMsg,i=e.displayAuthor,a=e.displayType,s=e.isMsgVisible;switch(t.type){case m["default"].TYPE.CIPHERTEXT:return g.createElement(_,{msg:t,ref:"msg",displayAuthor:i});case m["default"].TYPE.REVOKED:return g.createElement(D,{msg:t,ref:"msg",displayAuthor:i});case m["default"].TYPE.CHAT:return g.createElement(y,{msg:t,ref:"msg",quotedMsg:n,trusted:t.isTrusted(),senderName:t.senderObj?t.senderObj.name:void 0,displayAuthor:i});case m["default"].TYPE.IMAGE:return g.createElement(E,{msg:t,ref:"msg",quotedMsg:n,isMsgVisible:s,displayAuthor:i});case m["default"].TYPE.GROUP_NOTIFICATION:case m["default"].TYPE.GP2:case m["default"].TYPE.BROADCAST_NOTIFICATION:case m["default"].TYPE.NOTIFICATION:case m["default"].TYPE.E2E_NOTIFICATION:case m["default"].TYPE.CALL_LOG:var r=t.body,o=void 0,l=void 0,c=void 0;switch(t.type){case m["default"].TYPE.GP2:case m["default"].TYPE.GROUP_NOTIFICATION:r=v.formatGroupNotification(t);break;case m["default"].TYPE.BROADCAST_NOTIFICATION:r=v.formatBroadcastNotification(t.subtype,t.body);break;case m["default"].TYPE.E2E_NOTIFICATION:r=v.formatE2ENotification(t),o=t.subtype,c=t.body,l=t.id.remote;break;case m["default"].TYPE.CALL_LOG:r=v.formatCallLog(t,!0)}return g.createElement(b,{text:r,type:t.type,subtype:t.subtype,ref:"msg",e2eSubtype:o,participantJid:c,chatId:l});case m["default"].TYPE.AUDIO:return g.createElement(M,{msg:t,quotedMsg:n,isMsgVisible:s,displayAuthor:i,ref:"msg"});case m["default"].TYPE.VIDEO:return t.isGif?g.createElement(P,{msg:t,ref:"msg",quotedMsg:n,isMsgVisible:s,displayType:a,displayAuthor:i}):g.createElement(C,{msg:t,ref:"msg",quotedMsg:n,isMsgVisible:s,displayAuthor:i});case m["default"].TYPE.VCARD:return g.createElement(S,{msg:t,ref:"msg",quotedMsg:n,displayAuthor:i});case m["default"].TYPE.MULTI_VCARD:return g.createElement(x,{msg:t,quotedMsg:n,displayAuthor:i});case m["default"].TYPE.LOCATION:return g.createElement(T,{msg:t,ref:"msg",quotedMsg:n,displayAuthor:i});case m["default"].TYPE.PTT:return g.createElement(w,{msg:t,quotedMsg:n,displayAuthor:i,ref:"msg"});case m["default"].TYPE.DOCUMENT:return g.createElement(k,{msg:t,ref:"msg",quotedMsg:n,trusted:t.isTrusted(),senderName:t.senderObj?t.senderObj.name:null,displayAuthor:i});case m["default"].TYPE.UNKNOWN:return g.createElement(N,{msg:t,displayAuthor:i});default:return O.log("messageList:render Unknown message type: "+t.type)(),g.createElement(N,{msg:t,displayAuthor:i})}}}]),t}(g.Component);e.exports=R},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(453),s=i(a),r=n(8),o=n(44),l=n(9),c=n(154),u=n(1434),d=r.createClass({displayName:"PTTPlayer",mixins:[c],propTypes:{msg:r.PropTypes.instanceOf(s["default"]).isRequired,autoPlay:r.PropTypes.bool.isRequired,onPlayingUpdate:r.PropTypes.func.isRequired,onTimeUpdate:r.PropTypes.func.isRequired},playing:!1,dragging:!1,getInitialState:function(){return{progress:0}},onPlayClick:function(){var e=o.findDOMNode(this.refs.audio);this.playing?e.pause():e.play()},onPlaying:function(){this.playing=!0;var e=this.props.msg;!e.get("isSentByMe")&&e.get("ack")<l.ACK_PLAYED&&e.sendPlayed(),this.props.onPlayingUpdate&&this.props.onPlayingUpdate(this.playing)},onPause:function(){this.playing=!1,this.props.onPlayingUpdate&&this.props.onPlayingUpdate(this.playing)},onEnded:function(){var e=o.findDOMNode(this.refs.audio);e.currentTime=0,e.load()},onTimeUpdate:function(){var e=o.findDOMNode(this.refs.audio),t=0;_.isFinite(e.duration)&&(t=Math.round(100*Math.min(1,e.currentTime/e.duration)),this.props.onTimeUpdate&&this.props.onTimeUpdate(e.currentTime)),this.setState({progress:t})},componentDidMount:function(){var e=o.findDOMNode(this.refs.audio);this.regNativeListener(e,"playing",this.onPlaying),this.regNativeListener(e,"pause",this.onPause),this.regNativeListener(e,"ended",this.onEnded),this.regNativeListener(e,"timeupdate",this.onTimeUpdate),
this.regNativeListener(e,"durationchange",this.onTimeUpdate),this.regNativeListener(e,"progress",this.onTimeUpdate)},onDrag:function(e){var t=o.findDOMNode(this.refs.audio),n=e.target.value;this.setState({progress:n}),t.duration&&(t.currentTime=t.duration/100*n)},onPlayerError:function(e){},render:function(){var e="btn-audio icon ";e+=this.playing?"icon-audio-pause":"icon-audio-play";var t={width:this.state.progress-this.state.progress/100*3+"%"};return r.createElement("div",{className:"audio"},r.createElement("div",{className:"audio-controls"},r.createElement("button",{ref:"play_pause",className:e,onClick:this.onPlayClick})),r.createElement("div",{className:"audio-body"},r.createElement("div",{className:"audio-track-container"},r.createElement("span",{className:"audio-progress",style:t}),r.createElement("input",{type:"range",className:"audio-track",value:this.state.progress,onChange:this.onDrag,min:"0",max:"100"}))),r.createElement(u,{ref:"audio",msg:this.props.msg,preload:"auto",onError:this.onPlayerError,autoPlay:this.props.autoPlay}))}});e.exports=d},function(e,t,n){"use strict";var i=n(8),a=n(94),s=n(154),r=n(156),o=n(159),l=n(1411),c=n(58),u=n(480),d=n(92),p=n(1410),h=i.createClass({displayName:"EmojiInput",mixins:[a,s,r],propTypes:{focusOnMount:i.PropTypes.bool,editable:i.PropTypes.bool,format:i.PropTypes.bool,value:i.PropTypes.string,selection:i.PropTypes.object,className:i.PropTypes.string,placeholder:i.PropTypes.string,onKeyPress:i.PropTypes.func,onEnter:i.PropTypes.func,onChange:i.PropTypes.func,onFocus:i.PropTypes.func,onBlur:i.PropTypes.func,onFiles:i.PropTypes.func,onMouseDown:i.PropTypes.func,onSelectionChange:i.PropTypes.func,maxLength:i.PropTypes.number,multiline:i.PropTypes.bool,spellCheck:i.PropTypes.bool,focusOnChange:i.PropTypes.bool},getDefaultProps:function(){return{editable:!0,format:!1,value:"",focusOnChange:!0}},getInitialState:function(){return this.value=this.props.value||"",this.selection=this.props.selection,null},componentWillMount:function(){this.debouncedSaveSelection=this.safeDebounce(this._saveSelection,0)},componentWillReceiveProps:function(e){if(e.value!==this.value&&(this.setNewValue(e.value||"",!1),this.updateDOM(),this.props.focusOnChange&&this.safeDefer(this.restoreFocus.bind(this,!0))),this.props.editable!==e.editable){var t=this.refs.input;t.contentEditable=e.editable,e.editable&&this._disableObjectResize()}},restoreFocus:function(e){if(this.props.editable){var t=this.refs.input;document.activeElement!==t&&(d.focus(t),this.selection&&!e?this.restoreSelection(this.selection):this._moveCursorToEnd(t),this.debouncedSaveSelection())}},_moveCursorToEnd:function(e){if(e){var t=window.getSelection();t&&(t.selectAllChildren(e),t=window.getSelection(),t&&t.rangeCount&&t.collapseToEnd())}},componentDidMount:function(){this.props.focusOnMount&&this.safeDefer(this.restoreFocus),this.props.editable&&this._disableObjectResize(),this.refs.input.restoreFocus=this.restoreFocus,this.refs.input.pasteText=this.pasteText},componentWillUnmount:function(){this.refs.input.restoreFocus=null},_disableObjectResize:function(){c.isGecko&&document.execCommand("enableObjectResizing",!1,!1)},limitLength:function(e){var t=this.props.maxLength;if(!t)return e;e=e||"";var n=this.selectionLength(),i=n+t-l.multibyteLength(this.value);return i>0?l.multibyteSubstr(e,0,i):""},onMouseDown:function(e){e.stopPropagation(),this.regNativeListener(window,"mouseup",this.onWindowMouseUp),this.props.onMouseDown&&this.props.onMouseDown(e)},onWindowMouseUp:function(){this.unregNativeListener(window,"mouseup",this.onWindowMouseUp),this.debouncedSaveSelection()},onContextMenu:function(e){e.stopPropagation()},onKeyUp:function(e){if(c.isTrident&&this.onInput(e),"Backspace"===e.key||"Delete"===e.key){var t=this.refs.input;switch(t.innerHTML){case"\n":case"\r\n":case"<br>":t.innerHTML="",this.setNewValue("",!0,!0)}}this.debouncedSaveSelection()},onKeyPress:function(e){if(c.isTrident&&this.onInput(e),!this.props.onKeyPress||(this.props.onKeyPress(e),!e.defaultPrevented)){var t=e.ctrlKey||e.shiftKey||e.altKey;if(!this.props.multiline&&"Enter"===e.key||this.props.multiline&&"Enter"===e.key&&!t)return e.preventDefault(),void(this.props.onEnter&&this.props.onEnter(e));var n=this.limitLength(u.ucs2.encode([e.charCode]));this.props.multiline&&"Enter"===e.key&&t&&(this.replaceSelection("\n",!0),e.preventDefault()),n.length||e.preventDefault()}},onInput:function(e){var t=this.refs.input;e=_.isBoolean(e)?e:void 0,this.setNewValue(o.NodeToEmoji(t),!0,e)},setNewValue:function(e,t,n){if(e!==this.value||n){if(e&&!this.value){var i=this.refs.placeholder;i&&(i.style.display="none")}else if(this.value&&!e){var a=this.refs.placeholder;a&&(a.style.display="")}this.value=e,t&&this.props.onChange&&this.props.onChange({target:{value:e}}),this.debouncedSaveSelection()}},updateDOM:function(){var e=o.emojiToHTML(_.escape(this.value)),t=this.refs.input;t.innerHTML!==e&&(t.innerHTML=e)},selectionLength:function(){if(!this.props.editable)return 0;var e=this.refs.input;d.focus(e);var t=window.getSelection();if(t.rangeCount){var n=t.getRangeAt(0);return l.multibyteLength(o.NodeToEmoji(n.cloneContents()))}return 0},_saveSelection:function(){var e=this.getSelection();_.isEqual(e,this.prevSelection)||(this.props.onSelectionChange&&this.props.onSelectionChange(e),this.prevSelection=this.selection,this.selection=e)},isCollapsed:function(){if(this.isMounted()){var e=this.refs.input;if(document.activeElement!==e)return null;var t=window.getSelection();return t.isCollapsed}},getCursor:function(){if(!this.isMounted())return-1;var e=this.refs.input;if(document.activeElement!==e)return null;var t=window.getSelection(),n=t.anchorNode,i=t.anchorOffset,a=e.childNodes,s=0;e===n&&(n=a[i]);for(var r=0;r<a.length;r++){var o=a[r];if(o===n)return s+i;o.nodeType===window.Node.ELEMENT_NODE&&o.alt?s+=o.alt.length:o.nodeType===window.Node.TEXT_NODE&&(s+=o.length)}return s},isAtBeginning:function(){return this.isCollapsed()&&0===this.getCursor()},isAtEnd:function(){return this.isCollapsed()&&this.getCursor()===this.value.length},getSelection:function(){if(!this.isMounted())return null;var e=this.refs.input;if(document.activeElement!==e)return null;for(var t=window.getSelection(),n=t.anchorNode,i=t.anchorOffset,a=t.focusNode,s=t.focusOffset,r=e.childNodes,o=-1,l=-1,c=!1,u=!1,d=0;d<r.length;d++){var p=r[d];if(p===n&&(o=d,c=!0),p===a&&(l=d,u=!0),c&&u)break}return{anchor:{index:o,offset:i},focus:{index:l,offset:s}}},restoreSelection:function(e){var t,n,i,a,s,r,o=this.refs.input,l=o.childNodes;e.anchor.index===-1?(t=o,i=e.anchor.offset,s=0):(t=l[e.anchor.index],i=e.anchor.index,s=e.anchor.offset),e.focus.index===-1?(n=o,a=e.focus.offset,r=0):(n=l[e.focus.index],a=e.focus.index,r=e.focus.offset);var u;u=i===a?r>=s?"forward":"reverse":i>a?"reverse":"forward";var d=window.getSelection();if(t&&n)try{var p=document.createRange();return void(c.isTrident?("forward"===u?(p.setStart(t,e.anchor.offset),p.setEnd(n,e.focus.offset)):(p.setStart(n,e.focus.offset),p.setEnd(t,e.anchor.offset)),d.removeAllRanges(),d.addRange(p)):(p.setStart(t,e.anchor.offset),d.removeAllRanges(),d.addRange(p),d.extend(n,e.focus.offset)))}catch(h){this._moveCursorToEnd(o)}else this._moveCursorToEnd(o)},onCut:function(e){c.isTrident&&this.onInput(e)},onPaste:function(e){if(!e.defaultPrevented){e.preventDefault();var t=new p(e.clipboardData);if(t.hasFiles())return e.stopPropagation(),this.props.onFiles&&this.props.onFiles(t);var n=c.isTrident?"text":"text/plain",i=e.clipboardData.getData(n);this.pasteText(i)}},pasteText:function(e){e&&(this.props.maxPaste&&e.length>this.props.maxPaste?this.props.onMaxPasteExceeded():this.replaceSelection(e))},replaceSelection:function(e,t){if(this.props.editable&&(d.focus(this.refs.input),e=this.limitLength(e),0!==e.length)){this.props.multiline||(e=e.replace(/\n+/g," ").replace(/(\r\n)+/g," "));var n=window.getSelection(),i=null;n.getRangeAt&&n.rangeCount&&(i=n.getRangeAt(0),i.deleteContents());var a=this.refs.input,s=a.scrollTop,r=a.scrollHeight,l=o.emojiToHTML(_.escape(e));c.isTrident?i&&this.replaceSelectionTrident(l,n,i):t?document.execCommand("insertText",!1,l):document.execCommand("insertHTML",!1,l),this.onInput(!0),this.debouncedSaveSelection(),this.scrollToCursor(s,r)}},scrollToCursor:function(e,t){var n=this.refs.input,i=n.scrollHeight,a=n.clientHeight;if(!(i<=a)){var s=i-t;this.refs.input.scrollTop=(e||0)+s}},replaceSelectionTrident:function(e,t,n){var i=document.createElement("div");i.innerHTML=e;for(var a,s,r=document.createDocumentFragment();a=i.firstChild;)s=r.appendChild(a);n.insertNode(r),s&&(n=n.cloneRange(),n.setStartAfter(s),n.collapse(!0),t.removeAllRanges(),t.addRange(n))},shouldComponentUpdate:function(){return!1},render:function(){var e=o.emojiToHTML(_.escape(this.value)),t=this.props.className?"input "+this.props.className:"input",n="input-emoji",a=this.props.placeholder&&!this.props.value?i.createElement("div",{className:"input-placeholder",ref:"placeholder"},this.props.placeholder):null;return i.createElement("div",{className:n},a,i.createElement("div",{dangerouslySetInnerHTML:{__html:e},dir:"auto",ref:"input",spellCheck:this.props.spellCheck,"data-tab":this.props.editable?1:null,contentEditable:this.props.editable,className:t,onInput:this.onInput,onPaste:this.onPaste,onCut:this.onCut,onKeyUp:this.onKeyUp,onKeyPress:this.onKeyPress,onMouseDown:this.onMouseDown,onContextMenu:this.onContextMenu,onFocus:this.props.onFocus,onBlur:this.props.onBlur}))}});e.exports=h},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(15),s=i(a),r=n(5),o=i(r),l=n(6),c=i(l),u=n(19),d=i(u),p=n(18),h=i(p),f=(n(1395),n(8)),m=n(58),g=function(e){function t(e){(0,o["default"])(this,t);var n=(0,d["default"])(this,(0,s["default"])(t).call(this,e));return n.setVideoRef=function(e){n._videoRef=e,n.synchronizeVideo()},n.synchronizeVideo=function(){var e=n._videoRef;e&&(n.state.animate?e.paused&&e.play():e.paused||(e.pause(),e.currentTime=0))},n.setShouldAnimate=function(e){n.state.animate===e&&n.state.show||n.setState({animate:e,show:!0},n.synchronizeVideo)},n.handleClick=function(){n.props.onSend(n.props.gif)},n._videoRef=null,n.state={animate:!1,show:!1},n}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"render",value:function(){var e=this.props.gif,t=null;this.state.show&&(t=m.troublesWithLotsOfVideos&&e.nonVideoUrl?f.createElement("img",{className:"gif-search-gif",onClick:this.handleClick,src:e.nonVideoUrl}):f.createElement("video",{className:"gif-search-gif",onClick:this.handleClick,controls:!1,autoPlay:this.state.animate,loop:!0,muted:!0,ref:this.setVideoRef,src:e.previewUrl}));var n=void 0;return this.props.isStarred&&(n=f.createElement("span",{className:"icon-s icon-star-light",onClick:this.props.onUnstarMsg})),f.createElement("div",{className:"gif-search-gif-wrapper",style:{flexBasis:e.widthStr}},f.createElement("div",{style:{width:e.widthStr}},f.createElement("div",{style:{paddingBottom:e.ratioStr}},t)),n)}}]),t}(f.Component);t["default"]=g},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t,n){this.key=e,this.css=t,this.title=n,this.className="emoji-"+e}Object.defineProperty(t,"__esModule",{value:!0}),t.PossibleTabs=t.ExtendedTabs=t.TabsOrdered=t.Tab=t.SKIN_TONE_VARIATIONS=t.EMOJI_HEIGHT=t.EMOJI_WIDTH=void 0;var s,r=n(230),o=i(r);t.TabInfo=a;var l=n(159),c=i(l),u=n(239),d=u.EMOJI.CATEGORIES,p=(t.EMOJI_WIDTH=44,t.EMOJI_HEIGHT=44,t.SKIN_TONE_VARIATIONS=[""].concat(c["default"].skinToneVariations),t.Tab=(s={},(0,o["default"])(s,d.RECENT,new a(d.RECENT,"icon-emoji-recent",function(){return l10n.t("emoji_tab_recent")})),(0,o["default"])(s,d.SMILEYS_PEOPLE,new a(d.SMILEYS_PEOPLE,"icon-emoji-people",function(){return l10n.t("emoji_tab_smileys_people")})),(0,o["default"])(s,d.ANIMALS_NATURE,new a(d.ANIMALS_NATURE,"icon-emoji-nature",function(){return l10n.t("emoji_tab_animals_nature")})),(0,o["default"])(s,d.FOOD_DRINK,new a(d.FOOD_DRINK,"icon-emoji-food",function(){return l10n.t("emoji_tab_food_drink")})),(0,o["default"])(s,d.ACTIVITY,new a(d.ACTIVITY,"icon-emoji-activity",function(){return l10n.t("emoji_tab_activity")})),(0,o["default"])(s,d.TRAVEL_PLACES,new a(d.TRAVEL_PLACES,"icon-emoji-travel",function(){return l10n.t("emoji_tab_travel_places")})),(0,o["default"])(s,d.OBJECTS,new a(d.OBJECTS,"icon-emoji-objects",function(){return l10n.t("emoji_tab_objects")})),(0,o["default"])(s,d.SYMBOLS,new a(d.SYMBOLS,"icon-emoji-symbols",function(){return l10n.t("emoji_tab_symbols")})),(0,o["default"])(s,d.FLAGS,new a(d.FLAGS,"icon-emoji-flags",function(){return l10n.t("emoji_tab_flags")})),(0,o["default"])(s,d.GIFS,new a(d.GIFS,"icon-emoji-gifs",function(){return l10n.t("emoji_tab_gifs")})),(0,o["default"])(s,d.SEARCH_RESULT,new a(d.SEARCH_RESULT,null,null)),s)),h=t.TabsOrdered=[p.RECENT,p.SMILEYS_PEOPLE,p.ANIMALS_NATURE,p.FOOD_DRINK,p.ACTIVITY,p.TRAVEL_PLACES,p.OBJECTS,p.SYMBOLS,p.FLAGS],f=t.ExtendedTabs=h.concat([p.GIFS]);t.PossibleTabs=f.concat([p.SEARCH_RESULT])},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1354),s=i(a),r=n(8),o=n(1364),l=n(1465),c=n(1610),u=n(1604),d=n(75),p=n(1603),h=n(1596),f=n(1593),m=r.createClass({displayName:"InfoFlow",mixins:[o],propTypes:{chat:r.PropTypes.instanceOf(s["default"]).isRequired},componentWillMount:function(){var e=d.supportsFeature(d.F.STARRED)&&d.supportsFeature(d.F.FULL_TEXT_SEARCH),t=e?this.onStarred:null,n=d.supportsFeature(d.F.MEDIA_GALLERY)?this.onMediaGallery:null,i=null;this.props.chat.isGroup?i=r.createElement(p,{chat:this.props.chat,onVerification:this.onVerification,onStarred:t,onMediaGallery:n,onGroupInviteLink:this.onGroupInviteLink,onClose:this._pop}):this.props.chat.isBroadcast?i=r.createElement(f,{chat:this.props.chat,onStarred:t,onMediaGallery:n,onClose:this._pop}):this.props.chat.isUser&&(i=r.createElement(h,{contact:this.props.chat.contact,onVerification:this.onVerification,onStarred:t,onMediaGallery:n,onClose:this._pop})),this.push(i)},onStarred:function(){var e=r.createElement(l,{chat:this.props.chat,starredMsgs:this.props.chat.getStarredMsgs(),onClose:this._pop});this.push(e)},onMediaGallery:function(){var e=r.createElement(c,{chat:this.props.chat,onBack:this._pop});this.push(e)},onGroupInviteLink:function(){var e=r.createElement(u,{chat:this.props.chat,onBack:this._pop});this.push(e)},_pop:function(){this.pop()}});e.exports=m},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(158),s=i(a),r=n(2),o=i(r),l=n(15),c=i(l),u=n(5),d=i(u),p=n(6),h=i(p),f=n(19),m=i(f),g=n(18),v=i(g),y=n(8),E=i(y),_=n(1371),b=i(_),C=n(12),M=i(C),S=n(23),T=i(S),w=n(1406),k=i(w);t["default"]=function(e){var t,n;return n=t=function(t){function n(){var e,t,i,a;(0,d["default"])(this,n);for(var s=arguments.length,r=Array(s),l=0;l<s;l++)r[l]=arguments[l];return t=i=(0,m["default"])(this,(e=(0,c["default"])(n)).call.apply(e,[this].concat(r))),i.isUnmounted=!1,i.rejectOnUnmount=function(){return i.rejectPromise?i.rejectPromise:(i.rejectPromise=new o["default"](function(e,t){i.rejector=t}),i.rejectPromise["catch"](T["default"].noop),i.isUnmounted&&i.rejector(new M["default"].Unmount),i.rejectPromise)},a=t,(0,m["default"])(i,a)}return(0,v["default"])(n,t),(0,h["default"])(n,[{key:"componentWillUnmount",value:function(){this.isUnmounted=!0,this.rejectPromise&&this.rejector(new M["default"].Unmount)}},{key:"render",value:function(){return E["default"].createElement(e,(0,s["default"])({ref:_.HOCRef,rejectOnUnmount:this.rejectOnUnmount},this.props))}}]),n}(b["default"]),t.displayName="Promise("+(0,k["default"])(e)+")",n}},function(e,t,n){"use strict";var i=n(60),a=50,s=75,r={getInitialState:function(){var e=this;this._setState=this.setState,this.setState=function(t,n,i){_.assign(e.getBatchRenderState(),t),_.isUndefined(n)&&_.isUndefined(i)?e._debounceSetState.forceRun():_.isUndefined(i)?e._debounceSetState.debounce(n):e._debounceSetState.debounceAndCap(n,i)}},componentWillMount:function(){var e=this;this._debounceSetState=new i(function(){e._setState(e._batchRenderMixinState),e._batchRenderMixinState={}})},componentWillUnmount:function(){this._debounceSetState.cancel()},getBatchRenderState:function(){return this._batchRenderMixinState||(this._batchRenderMixinState={}),this._batchRenderMixinState}};r.DD=s,r.CD=a,e.exports=r},function(e,t,n){"use strict";var i=n(8),a=n(44),s=n(457),r=n(1),o=n(1444),l=n(1378),c=n(1356),u=n(1360),d=n(154),p=n(156),h=n(1357),f=n(1359),m=n(1358),g=n(43),v=n(1387),y=n(9),E=n(109),b={ANIMATING:"animating",LOADING:"loading",RECORDING:"active",SENDING:"sending"},C=i.createClass({displayName:"CaptureDrawer",mixins:[p,c,u,d],propTypes:{noContainer:i.PropTypes.bool,stream:i.PropTypes.object.isRequired,caption:i.PropTypes.bool,onBack:i.PropTypes.func.isRequired,onSend:i.PropTypes.func.isRequired,onCaptured:i.PropTypes.func},statics:{State:b},getInitialState:function(){return{state:b.ANIMATING,img:void 0,url:void 0}},componentDidMount:function(){this.safeDelay(function(){this.setState({state:b.LOADING,url:window.URL.createObjectURL(this.props.stream)})},300)},componentWillUnmount:function(){window.URL.revokeObjectURL(this.state.url)},onCapture:function(e){var t=document.createElement("canvas");if(this.refs.video){var n=a.findDOMNode(this.refs.video);t.height=n.videoHeight,t.width=n.videoWidth;var i=t.getContext("2d");i.translate(t.width,0),i.scale(-1,1),i.drawImage(n,0,0,n.videoWidth,n.videoHeight);var s=t.toDataURL("image/jpeg");this.props.onCaptured?this.props.onCaptured(s,this.state.videoSize):this.setState({state:b.SENDING,img:s})}},onVideoLoaded:function(e){this.setState({state:b.RECORDING,videoSize:{width:e.target.videoWidth,height:e.target.videoHeight}})},onRetake:function(e){this.setState({state:b.RECORDING,caption:void 0})},onSend:function(e){this.props.onSend({file:window.dataURLtoBlob(this.state.img),caption:s.emojify(_.trim(this.state.caption))})},onCaptionChange:function(e){this.setState({caption:e.target.value})},render:function(){var e,t,n,a;switch(this.state.state){case b.ANIMATING:break;case b.LOADING:case b.RECORDING:var s=g("capture-video media-viewer-img webcam",{"capture-video-inactive":this.state.state===b.LOADING});n=i.createElement("div",{key:"webcam"},i.createElement(l,{type:l.TYPES.CONTAIN,size:this.state.videoSize},i.createElement(o,{className:s,autoPlay:!0,ref:"video",onPlay:this.onVideoLoaded,src:this.state.url}))),e=i.createElement("div",{className:"drawer-controls fade",key:"btn-capture"},i.createElement("button",{className:"btn btn-round btn-l",onClick:this.onCapture},i.createElement("span",{className:"icon icon-camera-light"})));break;case b.SENDING:n=i.createElement(l,{type:l.TYPES.CONTAIN,size:this.state.videoSize},i.createElement("img",{className:"capture-image snapshot",src:this.state.img}));var c=this.props.noContainer?"icon icon-checkmark-light-l":"icon icon-send-light";e=i.createElement("div",{className:"drawer-controls btn-send",key:"btn-send"},i.createElement("button",{className:"btn btn-round btn-l",onClick:this.onSend},i.createElement("span",{className:c}))),t=i.createElement("div",{className:"drawer-header-action",onClick:this.onRetake},i.createElement("span",{className:"icon icon-refresh-light"}),l10n.t("retake")),a=i.createElement(v,{ref:"emojiInput",editable:!0,value:this.state.caption,maxLength:y.MAX_CAPTION_LENGTH,showRemaining:!0,placeholder:l10n.t("add_a_caption"),onEnter:this.onSend,onChange:this.onCaptionChange,supportsEmoji:!0,focusOnMount:!0});break;default:r.log("captureDrawer:render Unhandled video capture state "+this.state.state)()}var u=void 0;u=this.props.caption?i.createElement("div",{className:"capture-footer"},i.createElement(E,{transitionName:"media-caption",className:"media-caption"},a),i.createElement(E,{transitionName:"pop_delay"},e)):i.createElement("div",{className:"capture-footer"},i.createElement(E,{transitionName:"pop_delay"},e));var d=this.props.noContainer?f.Type.POPUP:f.Type.OFFSET;return i.createElement(h,{key:"attach-capture-modal",position:"right",id:"capture",variant:"noheader",noContainer:this.props.noContainer},i.createElement(f,{title:l10n.t("take_photo"),type:d,onCancel:this.props.onBack},t),i.createElement(m,null,i.createElement("div",{className:"media-body"},i.createElement("div",{className:"media-body-container"},i.createElement(E,{transitionName:"capture"},n))),u))}});e.exports=C},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1391),s=i(a),r=n(1366),o=i(r),l=n(453),c=i(l),u=n(1354),d=i(u),p=n(1413),h=i(p),f=n(1398),m=i(f),g=n(110),v=i(g),y=n(8),E=n(44),b=n(76),C=n(1357),M=n(1358),S=n(1386),T=n(1356),w=n(153),k=n(94),P=n(1360),N=n(1457),x=n(154),D=n(1370),O=n(457),R=n(58),I=n(155),A=n(10),L=n(75),F=n(1411),U=n(12),G=n(1372),j=n(9),B=n(1476),V=n(1375),q=n(1355),H=n(1480),z=n(92),W=n(93),Y=n(1371),K=Y.GetRef,Q=n(1267),X=n(43),Z=2,J=y.createClass({displayName:"ChatSearch",mixins:[w,k,Q,P,N],propTypes:{chat:y.PropTypes.instanceOf(d["default"]).isRequired},getInitialState:function(){var e=this;return this.ftsMsgs=new B,this.fts=_.debounce(function(){e.pending=!1;var t=_.trim(e.state.searchText||"");F.multibyteLength(t)<Z||(e._ftsPromise&&e._ftsPromise.cancel(),e._ftsPromise=e.ftsMsgs.search(t,e.props.chat).checkpoint(e.rejectOnUnmount()).then(function(n){t===_.trim(e.state.searchText)&&e.setState({searching:!1},N.DD)})["catch"](U.Unmount,_.noop)["catch"](function(){e.pending||e.setState({searching:!1},N.DD)}))},750),this.selection=new G([],function(e){return e.id.toString()}),{searchText:"",searching:!1}},componentDidMount:function(){this.onFocusSearch(),this.addObserver(this.ftsMsgs,"reset msgs_update")},componentDidUpdate:function(){this.shouldFTSSearch(this.refs.panel)&&(this.fts(),this.pending=!0,this.state.searching||this.setState({searching:!0}))},componentWillUnmount:function(){this.fts.cancel(),this.ftsMsgs["delete"](!0),this._ftsPromise&&this._ftsPromise.cancel()},fullTextSearch:function(e){var t=_.trim(e);F.multibyteLength(t)>=Z&&L.supportsFeature(L.F.FULL_TEXT_SEARCH)?(this.fts(),this.pending=!0,this.state.searching||this.setState({searching:!0},N.DD)):(this.fts.cancel(),this.ftsMsgs.resetSearch(),this.ftsMsgs["delete"](),this._ftsPromise&&this._ftsPromise.cancel(),this.pending=!1,this.state.searching&&this.setState({searching:!1},N.DD))},shouldFTSSearch:function(e){if(!this.ftsMsgs.hasMoreMsgs||this.pending||this.state.searching||this.ftsMsgs.searchPromise||F.multibyteLength(this.state.searchText||"")<Z)return!1;var t=_.last(e.children);return e.scrollHeight<e.clientHeight+t.scrollHeight},onSearch:function(e){if(this.isMounted()){if(!e)return void this.onStopSearch();var t=this.state.searchText;if(e!==t){var n={searchText:e};this.fullTextSearch(e),this.setState({searchText:e}),this.setState(n,N.DD)}}},onStopSearch:function(){this.fts.cancel(),this.ftsMsgs.resetSearch(),this.ftsMsgs["delete"](),this._ftsPromise&&this._ftsPromise.cancel(),this.pending=!1,this.setState({searchText:"",searching:!1})},onFocusList:function(e){e.repeat||this.refs.msglist&&this.search.isAtEnd()&&(e.preventDefault(),e.stopPropagation(),v["default"].flashFocus=Date.now(),this.refs.msglist.focusFirst())},onOpenFirst:function(e){e.preventDefault();var t=_.head(this.state.ftsResult);if(t){var n=t.chat,i=n.getSearchContext(t);A.focusChatTextInput(n),A.openChatAt(n,i)}},onFocusSearch:function(e){v["default"].flashFocus=Date.now(),z.focus(this.search)},onClose:function(){this.context.uim.uie.requestDismiss()},indicateFocus:function(e){if(!(Date.now()-(v["default"].flashFocus||0)>200)){var t=E.findDOMNode(this.refs.input_hotkey);Velocity(t,"stop"),Velocity(t,{backgroundColor:["#fbfbfb","#D9F3FF"]},{duration:1600,easing:[.19,.69,.01,.99]})}},onScroll:function(e){this.handleScroll(e.target)},handleScroll:_.throttle(function(e){e.scrollTop+j.SCROLL_FUDGE>e.scrollHeight-e.clientHeight&&this.ftsMsgs.hasMoreMsgs&&!this.pending&&(this.fts(),this.pending=!0)},100),getEmptyChatlistState:function(e){if(e.length)return null;var t=_.trim(this.state.searchText||"");return F.multibyteLength(t)>=Z?this.state.searching?y.createElement(D.SearchingMessages,null):y.createElement(D.SearchMessages,null):D.BeforeSearchMessages(this.props.chat.title())},render:function(){var e=this.ftsMsgs.models,t=this.getEmptyChatlistState(e);if(!t){var n=this.state.searchText?_.trim(this.state.searchText):null;t=y.createElement($,{ref:"msglist",isSearching:!!this.state.searchText,searchText:n,ftsResult:e,selection:this.selection,onFocusSearch:this.onFocusSearch})}var i={down:this.onFocusList,enter:this.onOpenFirst},a=this.ftsMsgs.hasMoreMsgs&&e.length?y.createElement("div",{className:"more",style:{alignSelf:"center"}},y.createElement(I,{stroke:6,size:24})):null;return y.createElement(C,{key:"search-modal",id:"search",variant:"panel",onCancel:this.onClose},y.createElement("header",{className:"pane-header"},y.createElement("div",{className:"header-close"},y.createElement("button",{onClick:this.onClose},y.createElement("span",{className:"icon icon-x"}))),y.createElement("div",{className:"header-body"},y.createElement("div",{className:"header-main"},y.createElement("div",{className:"header-title"},l10n.t("search_msgs"))))),y.createElement(M,null,y.createElement(v["default"],{handlers:i,onFocus:this.indicateFocus,ref:"input_hotkey",className:"chatlist-panel-search"},y.createElement(s["default"],{ref:K("search",this),onSearch:this.onSearch,placeholder:l10n.t("search"),loading:this.state.searching})),y.createElement("div",{ref:"panel",className:"pane-body pane-list-body",onScroll:this.onScroll,id:"pane-side","data-list-scroll-container":!0},t,a)))}});J.contextTypes={uim:y.PropTypes.instanceOf(W)};var $=y.createClass({displayName:"MsgList",mixins:[w,k,x],propTypes:{isSearching:y.PropTypes.bool,searchText:y.PropTypes.string,ftsResult:y.PropTypes.array,onClick:y.PropTypes.func,selection:y.PropTypes.instanceOf(G),onFocusSearch:y.PropTypes.func},getDefaultProps:function(){return{chats:[]}},getInitialState:function(){return this._listPointerEvents=!0,{}},componentWillMount:function(){this.props.selection.init(this.getSelection())},onListPointerEventsOff:function(){this._listPointerEvents=!1},onListPointerEventsOn:function(){this._listPointerEvents=!0},onClick:function(e,t,n){var i=this;e.preventDefault(),e.stopPropagation(),Store.Chat.find(t.id).then(function(e){i.props.isSearching&&i.props.onClick&&i.props.onClick(),2===H.column&&i.context.uim.uie.requestDismiss(),A.focusChatTextInput(e),A.openChatAt(e,n)})},getSelection:function(){return this.props.ftsResult||[]},getList:function(){var e=this;return this.props.ftsResult.map(function(t){return y.createElement(ee,{msg:t,searchText:e.props.searchText,onClick:e.onClick,active:e.props.selection,key:t.id.toString()})})},restoreFocus:function(){this.props.selection.reset()},onFocusGain:function(e){e.target===E.findDOMNode(this)&&this._listPointerEvents&&(this.props.selection.index<0?this.focusFirst():this.props.selection.reset())},focusFirst:function(){this.props.selection.setFirst()},onNextChat:function(e,t,n){e&&(e.preventDefault(),e.stopPropagation());var i=this.props.selection.next();this.props.selection.index!==i&&this.props.selection.setNext()},onPrevChat:function(e,t,n){e&&(e.stopPropagation(),e.preventDefault());var i=this.props.selection.prev();i>-1?(this.props.selection.setPrev(),this.focusComposer=n):t||this.props.onFocusSearch()},render:function(){var e=this,t={down:function(t){return e.onNextChat(t)},up:function(t){return e.onPrevChat(t)}};return y.createElement(v["default"],{handlers:t,onFocus:this.onFocusGain,"data-tab":3},y.createElement(o["default"],{className:"chatlist",data:this.getList(),height:72,animate:!0,extraItems:4,onPointerEventsOff:this.onListPointerEventsOff,onPointerEventsOn:this.onListPointerEventsOn}))}});$.contextTypes={uim:y.PropTypes.instanceOf(W)};var ee=y.createClass({displayName:"Message",mixins:[T,w],propTypes:{msg:y.PropTypes.instanceOf(c["default"]).isRequired,searchText:y.PropTypes.string,mouseDownAsClick:y.PropTypes.bool,onClick:y.PropTypes.func,active:y.PropTypes.object},getInitialState:function(){var e=this.props,t=e.msg,n=e.active,i={formattedTitle:this.async("msg.chat.formattedTitle"),active:!!n&&n.value===t};return t.sender&&t.isGroupMsg&&!t.isNotification&&(t.isSentByMe?i.formattedShortName=t.senderObj.formattedShortName:i.formattedShortName=this.async("msg.senderObj.formattedShortName")),i},componentWillMount:function(){this.props.active&&this.addObserver(this.props.active,this.props.msg.id.toString(),this.onActiveChange)},onActiveChange:function(e,t){if("focus"===e){var n=E.findDOMNode(this);z.focus(n),t&&S.scrollIntoViewIfNeeded(n)}this.setState({active:!!e})},onClick:function(e){if(_.isFunction(this.props.onClick)){var t=this.props.msg,n=t.chat,i=n.getSearchContext(t);i.msg=t,this.props.onClick(e,n,i)}},onMouseDown:function(e){0===e.button&&this.onClick(e)},onEnter:function(e){e.preventDefault(),e.stopPropagation(),v["default"].flashFocus=Date.now(),this.onClick(e)},indicateFocus:function(e){if(!(Date.now()-(v["default"].flashFocus||0)>200)){var t=E.findDOMNode(this.refs.cell);Velocity(t,"stop"),Velocity(t,{backgroundColor:["#e9eaeb","#cbdde7"]},{duration:1300,easing:[.19,.69,.01,.99],complete:this.onBlur})}},onBlur:function(e){var t=E.findDOMNode(this.refs.cell);t&&(Velocity(t,"stop"),t.style.backgroundColor="")},contextEnabled:function(){return!1},render:function(){var e=this.props.msg,t=y.createElement("span",{className:"chat-time-title"},b.relativeStr(e.t)),n=[];e.isSentByMe&&n.push(y.createElement(h["default"],{msg:e,key:"symbol"})),e.isSentByMe||!e.isGroupMsg||e.isNotification||(n.push(y.createElement(q,{text:this.state.formattedShortName,direction:"auto",className:{number:!e.senderObj.name,"chat-status-name":!0},key:"author"})),n.push(y.createElement("span",{className:"chat-status-divider",key:"divider"},":"))),e.hasSymbol()&&n.push(y.createElement(m["default"],{msg:e,key:"msg-symbol"})),n.push(y.createElement(q,{direction:e.dir,ellipsify:!0,highlight:this.props.searchText?[this.props.searchText]:null,text:O.msgText(e),key:"status"}));var i="chat-status";R.isGecko&&(i+=" ellipsify");var a=l10n.embedDir(O.msgText(e),e.rtl),s=y.createElement("div",{className:i,title:a},n),r={enter:this.onEnter},o=X("message",{active:!!this.state.active}),l=this.props.mouseDownAsClick;return y.createElement(v["default"],{handlers:r,onFocus:this.indicateFocus,onBlur:this.onBlur,className:"chat-drag-cover"},y.createElement(V,{id:e.id+"",ref:"cell",contextEnabled:this.contextEnabled,className:o,primaryDetail:t,secondary:s,onClick:l?null:this.onClick,onMouseDown:l?this.onMouseDown:null,onContext:this.onMenu}))}});e.exports=J},function(e,t,n){"use strict";var i=n(8),a=n(43),s=i.createClass({displayName:"DrawerItem",propTypes:{title:i.PropTypes.node,icon:i.PropTypes.node,classes:i.PropTypes.string,onClick:i.PropTypes.func},render:function(){var e=this.props,t=e.onClick,n=e.title,s=e.icon,r=e.classes,o=e.children,l=a("drawer-button",r,{clickable:t}),c=a("contents",{"drawer-button-row":s}),u=a({"col-main":s}),d=a({"col-side":s});return i.createElement("div",{className:l,onClick:t},i.createElement("div",{className:c},i.createElement("div",{className:u},i.createElement("div",{className:"primary"},n),i.createElement("div",{className:"secondary"},o)),i.createElement("div",{className:d},s)))}});e.exports=s},function(e,t,n){"use strict";var i=n(8),a=n(154),s=n(1518),r=n(1357),o=n(1359),l=n(1358),c=n(1378),u=n(109),d=480,p=640,h=i.createClass({displayName:"EditImageDrawer",mixins:[a],propTypes:{img:i.PropTypes.string.isRequired,imageSize:i.PropTypes.shape({width:i.PropTypes.width,height:i.PropTypes.height}),onCancel:i.PropTypes.func.isRequired,onFinished:i.PropTypes.func.isRequired,onRetake:i.PropTypes.func},getInitialState:function(){return{img:this.props.img,doneEditing:!1,editorSize:{width:p,height:d}}},onDoneEditing:function(){this.setState({
doneEditing:!0})},onRetake:function(){this.props.onRetake()},onObjectLoad:function(e){e&&(this.state.editorSize&&this.state.editorSize.width===e.clientWidth||this.state.editorSize&&this.state.editorSize.height===e.clientHeight||this.setState({editorSize:{width:e.clientWidth,height:e.clientHeight}}))},render:function(){var e,t=i.createElement("div",{className:"drawer-controls-right btn-send",key:"btn-send"},i.createElement("button",{className:"btn btn-round btn-l",onClick:this.onDoneEditing},i.createElement("span",{className:"icon icon-checkmark-light-l"}))),n=this.props.noContainer?o.Type.POPUP:o.Type.OFFSET,a=i.createElement(s,{img:this.state.img,onImageSet:this.props.onFinished,doneEditing:this.state.doneEditing,size:this.state.editorSize});this.props.onRetake&&(e=i.createElement("div",{className:"drawer-header-action",onClick:this.onRetake},i.createElement("span",{className:"icon icon-refresh-light"}),l10n.t("retake")));var h=i.createElement("div",{className:"capture-footer"},i.createElement(u,{transitionName:"pop_delay"},t)),f=this.props.imageSize?this.props.imageSize:{width:p,height:d};return i.createElement(r,{key:"attach-edit-modal",position:"right",id:"edit",variant:"noheader"},i.createElement(o,{title:l10n.t("adjust_image"),type:n,onCancel:this.props.onCancel},e),i.createElement(l,null,i.createElement("div",{className:"media-body"},i.createElement("div",{className:"media-body-container-background"},i.createElement(u,{transitionName:"capture"},i.createElement(c,{type:c.TYPES.CONTAIN,size:f,onObjectLoad:this.onObjectLoad},a)))),h))}});e.exports=h},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(110),s=i(a),r=n(1391),o=i(r),l=n(1366),c=i(l),u=n(8),d=n(1357),p=n(1359),h=n(1358),f=n(1383),m=n(1372),g=n(92),v=n(1371),y=v.GetRef,E=u.createClass({displayName:"ListModal",propTypes:{title:u.PropTypes.string.isRequired,selection:u.PropTypes.instanceOf(m),onSearch:u.PropTypes.func,searchPlaceholder:u.PropTypes.string,onCancel:u.PropTypes.func.isRequired,onSelect:u.PropTypes.func},onNext:function(e){e.preventDefault(),e.stopPropagation();var t=this.props.selection;t&&t.setNext()},onPrev:function(e){var t=this.props.selection;if(t){e.preventDefault(),e.stopPropagation();var n=t.prev();n>-1?t.setPrev():(t.unset(),s["default"].flashFocus=Date.now(),g.focus(this.search))}},onFocusList:function(e){this.list&&(e.preventDefault(),e.stopPropagation(),s["default"].flashFocus=Date.now(),this.props.selection.setFirst())},onSelectFirst:function(e){e.preventDefault(),e.stopPropagation();var t=_.head(this.props.children);t&&this.props.onSelect(e,t)},onSearch:function(e){this.props.onSearch(e)},render:function(){var e=this.props,t=e.title,n=e.onCancel,i=e.onSearch,a=e.searchPlaceholder,r=e.children,l={down:this.onFocusList,enter:this.onSelectFirst},m={down:this.onNext,up:this.onPrev},g=void 0;i&&(g=u.createElement(s["default"],{handlers:l},u.createElement(o["default"],{ref:y("search",this),onSearch:this.onSearch,placeholder:a||l10n.t("search")})));var v=void 0;return v=r&&r.length?u.createElement(s["default"],{handlers:m},u.createElement(c["default"],{className:"chatlist",ref:y("list",this),data:r,height:72,extraItems:4})):r,u.createElement(f,{type:f.TOWER},u.createElement(d,{key:"contact-modal",onCancel:n,position:"right"},u.createElement(p,{title:t,type:p.Type.POPUP,onCancel:n}),g,u.createElement(h,{"data-list-scroll-container":!0},v)))}});e.exports=E},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1377),s=i(a),r=n(232),o=i(r),l=n(8),c=n(1361),u=n(1355),d=n(1378),p=n(10),h=n(1356),f=n(43),m=n(229),g=500,v=l.createClass({displayName:"PhotoViewerModal",mixins:[h],propTypes:{contact:l.PropTypes.instanceOf(o["default"]),imgFull:l.PropTypes.string,animateBorderRadius:l.PropTypes.bool,getZoomNode:l.PropTypes.func.isRequired},getInitialState:function(){return{formattedUser:this.async("contact.formattedUser"),imgFull:this.props.imgFull||this.async("contact.profilePicThumb.imgFull"),style:{visibility:"hidden"}}},shouldComponentUpdate:function(e,t){return!!t.imgFull||(this.onClose(),!1)},onScroll:function(e){Math.abs(e.deltaY)>3&&this.onClose()},onClose:function(){if(!this.closing){this.closing=!0;var e=void 0;if(this.props.getZoomNode(function(t){e=t}),!e)return p.closeModalMedia();var t=this.refs.image,n=t.getBoundingClientRect(),i=e.getBoundingClientRect(),a=i.top-n.top,s=i.left-n.left,r=e.clientWidth/t.clientWidth;Velocity(t,{translateX:[s,0],translateY:[a,0],scale:[r,1]},{duration:200,easing:[.1,.82,.25,1]}).then(function(){p.closeModalMedia()})}},onImageLoad:function(e){var t=this,n=e.target;this.setState({size:{width:n.naturalWidth,height:n.naturalHeight}},function(){t.props.getZoomNode(function(e){var i=n.getBoundingClientRect(),a=e.getBoundingClientRect(),s=a.top-i.top,r=a.left-i.left,o=e.clientWidth/n.clientWidth,l={visibility:"hidden",transform:"translateX("+r+"px) translateY("+s+"px) scale("+o+")",transition:"transform 0s"};t.props.animateBorderRadius&&(l.borderRadius="50%"),t.setState({style:l},function(){var e={transform:"translateX(0px) translateY(0px) scale(1)",transition:"transform "+g+"ms cubic-bezier(.1,.82,.25,1)"};t.props.animateBorderRadius&&(e={transform:"translateX(0px) translateY(0px) scale(1)",borderRadius:"0%",transition:"transform "+g+"ms cubic-bezier(.1,.82,.25,1),\n                                         border-radius "+g+"ms cubic-bezier(.1,.82,.25,1)"}),t.setState({style:e})})})})},render:function(){var e=this.props.contact,t=f("media-viewer","media-viewer-animate"),n=f("media-panel-header",{});return l.createElement(m,{displayName:"PhotoViewer",escapable:!0,requestDismiss:this.onClose},l.createElement("div",{className:t,onWheel:this.onScroll,onClick:this.onClose},l.createElement("div",{className:n},l.createElement("div",{className:"chat media-chat"},l.createElement("div",{className:"chat-avatar"},l.createElement(c,{id:e.id})),l.createElement("div",{className:"chat-body"},l.createElement("div",{className:"chat-main"},l.createElement(u,{text:this.state.formattedUser})))),l.createElement("div",{className:"menu menu-horizontal media-panel-tools"},l.createElement("div",{className:"menu-item"},l.createElement("button",{className:"icon icon-x-viewer",title:l10n.t("web_close"),onClick:this.onClose})))),l.createElement("div",{className:"media-content",dir:"ltr",ref:"container"},l.createElement("div",{className:"media"},l.createElement(d,{type:d.TYPES.SCALE_DOWN,size:this.state.size},l.createElement("div",{className:"profile-viewer",ref:"image",style:this.state.style},l.createElement(s["default"],{src:this.state.imgFull,hasPrivacyChecks:!0,onLoad:this.onImageLoad,className:"profile-viewer-img"})))))))}});e.exports=v},function(e,t,n){"use strict";var i=n(8),a=n(1357),s=n(1359),r=n(1381),o=n(1358),l=n(1414),c=n(454),u=n(10),d=n(1356),p=n(153),h=n(1360),f=n(1387),m=n(9),g=n(457),v=n(93),y=n(12),E=i.createClass({displayName:"ProfileDrawer",mixins:[d,p,h],propTypes:{id:i.PropTypes.string.isRequired,onClose:i.PropTypes.func},getInitialState:function(){return this.asyncState({status:"id.Status.status",imgFull:"id.ProfilePicThumb.imgFull"},{pushname:Store.Conn.pushname,status:l10n.t("contact_status_loading"),pendingPushname:!1,pendingStatus:!1,pendingPhoto:!1})},componentWillMount:function(){var e=this;this.addObserver(Store.Conn,"change:pushname",function(){e.setState({pushname:Store.Conn.pushname})})},validateStatus:function(){var e=arguments.length<=0||void 0===arguments[0]?"":arguments[0];return!!e.trim()},onSetStatusError:function(){u.openModal(i.createElement(c,{onOK:u.closeModal.bind(u),okText:l10n.t("web_ok")},l10n.t("action_status_empty")))},onSetStatus:function(e){var t=this;if(Store.Status.canSetMyStatus()){var n=Store.Status.get(this.props.id).status,i=g.emojify(this.state.status);if(i===n)return this.setState({status:i});this.setState({pendingStatus:!0}),Store.Status.setMyStatus(g.emojify(this.state.status)).checkpoint(this.rejectOnUnmount()).then(function(){t.setState({status:Store.Status.get(t.props.id).status,pendingStatus:!1})})["catch"](y.Unmount,_.noop)}},onBack:function(){this.props.onClose?this.props.onClose():this.context.uim.uie.requestDismiss()},onStatusChange:function(e){this.setState({status:e.target.value})},onCancelStatus:function(){this.setState({status:Store.Status.get(this.props.id).status})},validatePushname:function(){var e=arguments.length<=0||void 0===arguments[0]?"":arguments[0];return!!e.trim()},onSetPushname:function(e){var t=this;if(Store.Conn.canSetMyPushname()){var n=Store.Conn.pushname,i=g.emojify(this.state.pushname);if(i===n)return this.setState({pushname:i});this.setState({pendingPushname:!0}),Store.Conn.updatePushname(g.emojify(this.state.pushname)).checkpoint(this.rejectOnUnmount()).then(function(){t.setState({pendingPushname:!1})})["catch"](y.Unmount,_.noop)}},onSetPushnameError:function(){u.openModal(i.createElement(c,{onOK:u.closeModal.bind(u),okText:l10n.t("web_ok")},l10n.t("action_pushname_empty")))},onPushnameChange:function(e){this.setState({pushname:e.target.value})},onCancelPushname:function(){this.setState({pushname:Store.Conn.pushname})},onImageSet:function(e,t){var n=this,i=Store.ProfilePicThumb.get(this.props.id);this.setState({pendingPhoto:!0});var a;a=e&&t?i.setPicture(e,t):i.deletePicture(),a.checkpoint(this.rejectOnUnmount()).then(function(){n.setState({pendingPhoto:!1})})["catch"](y.Unmount,_.noop)},render:function(){var e=Store.ProfilePicThumb.get(this.props.id),t=l.Type.PROFILE,n=!e.canSet()&&!e.canDelete(),c=i.createElement(l,{type:t,id:this.props.id,pending:this.state.pendingPhoto,startImage:this.state.imgFull,readOnly:n,onImageSet:this.onImageSet}),u=m.STATUS_V2?i.createElement(r,{a8n:"col-main-profile",title:l10n.t("web_status"),classes:"animate-enter1 well-input"},i.createElement(f,{value:this.state.status,editable:Store.Status.canSetMyStatus(),pending:this.state.pendingStatus,showRemaining:!0,validate:this.validateStatus,maxLength:m.MAX_STATUS_LENGTH,onChange:this.onStatusChange,onSave:this.onSetStatus,onError:this.onSetStatusError,onCancel:this.onCancelStatus,supportsEmoji:!0,lockable:!0,lowProfile:!0})):null,d=l10n.t("menuitem_profile_status"),p=l10n.t("menuitem_profile");return i.createElement(a,{onCancel:this.onBack,id:"profile"},i.createElement(s,{a8n:"drawer-title-profile",title:m.STATUS_V2?d:p,onBack:this.onBack,type:s.Type.LARGE}),i.createElement(o,null,i.createElement("div",{className:"drawer-section drawer-scale drawer-section-photo"},c),i.createElement(r,{a8n:"col-main-profile",title:l10n.t("pushname"),classes:"animate-enter1 well-input"},i.createElement(f,{value:this.state.pushname,editable:Store.Conn.canSetMyPushname(),pending:this.state.pendingPushname,showRemaining:!0,validate:this.validatePushname,maxLength:m.MAX_PUSHNAME_LENGTH,onChange:this.onPushnameChange,onSave:this.onSetPushname,onError:this.onSetPushnameError,onCancel:this.onCancelPushname,supportsEmoji:!0,lockable:!0,lowProfile:!0})),i.createElement("div",{className:"hint animate-enter1 well-transparent"},l10n.t("pushname_description")),u))}});E.contextTypes={uim:i.PropTypes.instanceOf(v)},e.exports=E},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e){return e.scrollTop+m.SCROLL_FUDGE>e.scrollHeight-e.clientHeight}var s=n(453),r=i(s),o=n(1354),l=i(o),c=n(1428),u=i(c),d=n(110),p=i(d),h=n(8),f=n(44),m=n(9),g=n(10),v=n(1357),y=n(1370),E=n(1359),b=n(1358),C=n(153),M=n(1360),S=n(109),T=n(1421),w=n(1372),k=n(1485),P=n(155),N=n(12),x=n(75),D=n(1),O=n(92),R=n(154),I=n(1393),A=I.MenuBarItem,L=n(1369),F=n(462),U=n(1627),G=n(93),j=h.createClass({displayName:"StarredDrawer",mixins:[C,M,R],propTypes:{chat:h.PropTypes.instanceOf(l["default"]),starredMsgs:h.PropTypes.instanceOf(u["default"]),onClose:h.PropTypes.func},getInitialState:function(){return this.handleScroll=_.throttle(this._handleScroll,100),this.msgListInfo={visibleMsgs:{}},{cursor:new k(this.props.starredMsgs,(void 0),m.RENDOR_CURSOR.STARRED_DRAWER).loadAfter(m.MSG_PRELOAD_THRESHOLD)}},componentWillMount:function(){this.currSelection=new w([],function(e){return e.id.toString()}),this.activeSelection=new w([],function(e){return e.id.toString()})},componentDidMount:function(){var e=this;this.focus(),this.regNativeListener(window,"resize",this.updateMsgListInfo),!this.props.starredMsgs.isSynced&&this.props.starredMsgs.length<m.PAGE_SIZE&&this.uiIdle(this.loadEarlierMsgs),this.initObservers(),this.addObserver(this.props.starredMsgs,"reset",function(){e.setState(e.getInitialState()),e.loadEarlierMsgs()})},componentWillUnmount:function(){this._firstSyncComplete&&this._firstSyncComplete.cancel(),this.handleScroll.cancel()},componentDidUpdate:function(){this.updateMsgListInfo()},initObservers:function(){var e=this;this.addObserverAndRun(this.props.starredMsgs,"reset sync",function(){e.initSelectionObjects(),e.setState({})}),this.addObserver(this.props.starredMsgs,"add remove",this.handleStarChange),this.onFocusGain()},handleStarChange:function(e){this.initSelectionObjects(),this.setState({})},initSelectionObjects:function(){var e=this.props.starredMsgs.models;this.currSelection.init(e,!0),this.activeSelection.init(e)},loadEarlierMsgs:function(){var e=this,t=this.state.cursor,n=this.props.chat&&this.props.chat.id,i=this.props.starredMsgs.models;if(t.end<i.length)this.setState({cursor:t.loadAfter()});else{if(this.props.starredMsgs.isSynced)return;this.props.starredMsgs.sync(n).checkpoint(this.rejectOnUnmount()).then(function(){t.hasAfter()&&e.setState({cursor:t.loadAfter()})})["catch"](N.Unmount,_.noop)["catch"](function(e){D.log("StarredDrawer:loadEarlierMsgs failed")(),D.log(e)()})}},onClose:function(){this.props.onClose?this.props.onClose():this.context.uim.uie.requestDismiss()},focus:function(){O.focus(f.findDOMNode(this.refs.body))},onFocusGain:function(e){var t=e?e.target:document.activeElement;t===f.findDOMNode(this.refs.body)&&(this.currSelection.index<0?this.currSelection.setFirst():this.currSelection.reset(!1))},onNextMsg:function(e){e&&(e.preventDefault(),e.stopPropagation());var t=this.currSelection.next();this.currSelection.index!==t&&this.currSelection.setNext()},onPrevMsg:function(e){e&&(e.stopPropagation(),e.preventDefault());var t=this.currSelection.prev();t>-1&&this.currSelection.setPrev()},onScroll:function(e){this.handleScroll(e.target)},_handleScroll:function(e){this.updateMsgListInfo(),a(e)&&this.loadEarlierMsgs()},selectMsg:function(e){this.currSelection.setVal(e),this.activeSelection.setVal(e),g.openChatAt(e.chat,e.chat.getSearchContext(e)),g.focusShowMsg(e.id)},getMsgList:function(){var e=this.state.cursor,t=this.props.starredMsgs.models,n=this.props.starredMsgs.isSynced?e.end:Math.min(e.end,t.length);return t=t.slice(e.start,n),this.length=t.length,t},getMsgVisibility:function(e){if(!e)return m.VISIBILITY.BELOW;var t=f.findDOMNode(this.refs.scrollContainer),n=t.previousSibling.clientHeight,i=t.scrollTop+n,a=i+t.clientHeight,s=f.findDOMNode(e);return s?s.offsetTop+s.clientHeight<=i?m.VISIBILITY.ABOVE:s.offsetTop>=a?m.VISIBILITY.BELOW:m.VISIBILITY.VISIBLE:m.VISIBILITY.BELOW},isMsgVisible:function(e){var t=!(arguments.length<=1||void 0===arguments[1])&&arguments[1];return!!this.msgListInfo.visibleMsgs[e.toString()]&&(!!t||this.getMsgComponent(e))},getMsgComponent:function(e){var t=this.refs[e.toString()];if(t){var n=t.refs.wrapper;if(n)return n.refs.component&&n.refs.component.refs.msg}},updateMsgListInfo:_.throttle(function(){for(var e=this.getMsgList(),t={},n=0,i=this.length-1;n<i;){var a=Math.floor((n+i)/2),s=this.refs[e[a].id.toString()];this.getMsgVisibility(s)===m.VISIBILITY.ABOVE?n=a+1:i=a}for(var r=n;r<e.length;r++){var o=this.refs[e[r].id.toString()];if(this.getMsgVisibility(o)!==m.VISIBILITY.VISIBLE)break;t[e[r].id.toString()]=!0}this.pauseHiddenGifs(this.msgListInfo.visibleMsgs,t),this.msgListInfo.visibleMsgs=t},100),pauseHiddenGifs:function(e,t){for(var n in e)if(!t[n]){var i=this.props.starredMsgs.get(n);if(i&&i.isGif){var a=this.getMsgComponent(n);a&&a.playCount&&a.pause()}}},render:function(){var e=this,t=this.getMsgList(),n=this.state.cursor,i=this.props.chat||null,a=void 0,s=void 0;if(s=this.props.starredMsgs.isSynced&&n.end>=t.length?null:this.props.starredMsgs.syncPromise?h.createElement("div",{className:"more"},h.createElement("div",{className:"btn-more",title:l10n.t("loading_messages")},h.createElement(P,{stroke:6,size:24}))):h.createElement("div",{className:"more"},h.createElement("div",{className:"btn-more",title:l10n.t("load_earlier_messages"),onClick:this.loadEarlierMsgs},h.createElement("span",{className:"icon icon-refresh"}))),t.length>0){var o=t.map(function(t){var n=t.type===r["default"].TYPE.IMAGE||t.type===r["default"].TYPE.VIDEO||t.type===r["default"].TYPE.AUDIO;return h.createElement(T,{key:t.id,ref:t.id.toString(),msg:t,isMsgVisible:n?e.isMsgVisible:_.noop,currSelection:e.currSelection,activeSelection:e.activeSelection,onClickMsg:e.selectMsg})});a=h.createElement(S,{transitionName:"slide"},o)}else this.props.starredMsgs.isSynced?a=h.createElement(y.StarredMsgs,null):(a=h.createElement(y.Loading,null),s=null);var l={down:this.onNextMsg,up:this.onPrevMsg},c=t.length||this.props.starredMsgs.isSynced,u=x.supportsFeature(x.F.UNSTAR_ALL)?h.createElement(A,{a8n:"starred-menu",icon:"menu-white",title:l10n.t("menutitle_menu"),disabled:!c},h.createElement(B,{chat:i,msgs:t})):null;return h.createElement(v,{id:"starred",onCancel:this.onClose},h.createElement(p["default"],{className:"drawer",handlers:l,onFocus:this.onFocusGain,"data-tab":2,ref:"body"},h.createElement(E,{title:l10n.t("starred_flow_title"),onBack:this.onClose,type:E.Type.LARGE,menu:u}),h.createElement(b,{onScroll:this.onScroll,ref:"scrollContainer"},a,s)))}});j.contextTypes={uim:h.PropTypes.instanceOf(G)},e.exports=j;var B=h.createClass({displayName:"StarredHeaderDropdown",propTypes:{chat:h.PropTypes.instanceOf(l["default"]),msgs:h.PropTypes.array},sendUnstarAll:function(){g.openModal(h.createElement(U,{msgs:this.props.msgs,chat:this.props.chat}))},render:function(){return h.createElement(F,{type:F.Type.DROPDOWN_MENU,flipOnRTL:!0,key:"StarredDrawerHeader",direction:{x:F.Direction.X.LEFT}},h.createElement(L,{a8n:"mi-unstar-all menu-item",action:this.sendUnstarAll},l10n.t("unstar_all")))}})},function(e,t,n){"use strict";function i(e){var t=document.createElement("a");t.href=e,t.target="_blank",t.style.display="none",document.body.appendChild(t),t.click(),document.body.removeChild(t)}function a(e){return e.join(" ")}var s=n(8),r=n(10),o=n(20),l=n(459),c=n(1404),u=n(1460),d=n(1375),p=s.createClass({displayName:"VCardModalDetails",propTypes:{className:s.PropTypes.string,parsedVCard:s.PropTypes.object.isRequired,thumbnail:s.PropTypes.string},defaultProps:{className:""},openChat:function(e){r.closeModal(),Store.Chat.find(o.numberToWid(e)).then(function(e){r.openChatFromUnread(e).then(function(t){t&&r.focusChatTextInput(e)})})},sendEmail:function(e){var t="mailto:"+e;i(t)},openLocation:function(e){var t=_.map(_.filter(e),encodeURIComponent).join(", "),n="https://maps.google.com/maps/search/"+t+"?hl="+l10n.getLocale();i(n)},getHeader:function(){var e=this.props.parsedVCard,t=l.vcardWAids(this.props.parsedVCard),n=null;if(_.first(e.FN))n=_.first(e.FN).value;else if(_.first(e.NICKNAME))n=_.first(e.NICKNAME).value;else if(_.first(e.TEL)){var i=_.first(e.TEL),a=_.first(i.properties.waid);n=a?o.formattedUser(a):i.value}var r=l.getOrganizationString(e),u=s.createElement("div",{className:"chat-avatar"},s.createElement(c,{thumb:this.props.thumbnail,waid:l.thumbnailWAid(t)}));return s.createElement("div",{className:"chatlist chatlist-plain"},s.createElement(d,{id:t[0],contextEnabled:function(){return!1},image:u,primary:n,secondary:r}))},render:function(){var e=this,t=this.props.parsedVCard,n=_.filter(t.TEL,function(e){return e.properties.waid}),i=_.filter(t.TEL,function(e){return!e.properties.waid}),r=_.map(n,function(t){var n=_.first(t.properties.waid),i=function(){return e.openChat(n)},a=s.createElement("span",{onClick:i,className:"icon icon-chat clickable"}),r=s.createElement("span",{className:"selectable-text"},o.formattedUser(n));return s.createElement(u,{title:r,icon:a,key:"vCard-"+t.index},l.getType(t))}),c=_.map(t.EMAIL,function(t){return s.createElement(u,{title:t.value,onClick:function(){return e.sendEmail(t.value)},key:"vCard-"+t.index},l.getType(t))}),d=_.map(t.ADR,function(t){var n=a(t.value);return s.createElement(u,{title:n,onClick:function(){return e.openLocation(t.value)},key:"vCard-"+t.index},l.getType(t))}),p=_.map(i,function(e){return s.createElement(u,{title:e.value,key:"vCard-"+e.index},l.getType(e))}),h=_.map(t.SERVICE,function(e){return s.createElement(u,{title:e.value,key:"vCard-"+e.index},l.getType(e))}),f=_.map(t.BDAY,function(e){return s.createElement(u,{title:l.getDate(e.value),key:"vCard-"+e.index},l10n.t("vcard_birthday"))}),m=_.map(t.NICKNAME,function(e){return s.createElement(u,{title:e.value,key:"vCard-"+e.index},l10n.t("vcard_nickname"))}),g=this.getHeader();return s.createElement("div",{className:this.props.className},s.createElement("div",null,g,s.createElement("div",{className:"drawer-item-container-compact"},r,c,d,p,f,m,h)))}});e.exports=p},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(77),o=i(r),l=n(59),c=n(464).prepRawMedia,u=n(1661),d=n(12),p={READY:"ready",PROCESSING:"processing",ERROR:"error"},h=(0,r.defineState)("AttachMedia",{props:{id:"number",file:"object",uiProcessed:"boolean"},session:{state:{type:"string",values:_.values(p)},media:"object",mediaPrep:"object",url:"string",name:"string",preview:"string",processPromise:"object",exception:"object",chat:"object",caption:"string",original:"object",generatedPreview:"object"},initialize:function(){o["default"].prototype.initialize.call(this),this.processFile(this.file)},processFile:function(e){var t=this;return this.state=p.PROCESSING,this.processPromise=s["default"].resolve(e).then(function(e){var n=void 0;n=e.isGifHackDoNotUse?{asGif:!0,gifAttribution:e.gifAttributionHackDoNotUse}:{};var i=c(e,n);return i.waitForPrep().then(function(e){return u.enrich(e)}).then(function(e){var n=e.media,a=e.documentPreview;t.set({media:n,mediaPrep:i,url:window.URL.createObjectURL(n.mediaBlob),name:n.filename,preview:n.preview,state:p.READY,generatedPreview:a})})})["catch"](d.MediaFileTooLarge,d.InvalidMediaFileType,d.MediaFileFailedLoad,d.MediaFileEmpty,function(e){return t.set({exception:e,state:p.ERROR}),t})["catch"](function(e){return t.set({exception:new d.InvalidMediaFileType,state:p.ERROR}),t})},getFileType:function(){return l.typeFromMimetype(this.file.type)},editImage:function(e){return this.getFileType()!==l.FILETYPE.IMAGE?null:(window.URL.revokeObjectURL(this.url),e.original=this.original||new f(this.toJSON()),this.set(e),void this.initialize())},revertImage:function(){if(this.getFileType()!==l.FILETYPE.IMAGE)return null;if(!this.original)return this;window.URL.revokeObjectURL(this.url);var e=this.original.toJSON();return e.original=null,this.set(e),this.initialize(),this}}),f=h.AttachMedia;f.STATE=p,e.exports=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BlocklistProxy=t["default"]=void 0;var i=n(77),a=(0,i.defineState)("Blocklist",{Collection:"Blocklist",session:{contact:"object"},props:{id:"string"},initialize:function(){this.addChild("contact",Store.Contact.gadd(this.id))}}),s=a.Blocklist,r=a.BlocklistProxy;t["default"]=s,t.BlocklistProxy=r},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.CallProxy=t["default"]=void 0;var a=n(77),s=i(a),r=n(1),o=n(10),l=(0,a.defineState)("Call",{Collection:"Call",props:{id:"string",type:"string",from:"string"},initialize:function(){s["default"].prototype.initialize.call(this),this.listenToAndRun(this,"change:type",this.updateNotification)},updateNotification:function(){r.log("call:"+this.type+" id:"+this.id+" from:"+this.from)(),"offer"===this.type||"offer_video"===this.type?o.alertCall(this.id,this.from,"offer_video"===this.type):o.cancelCall(this.id)}}),c=l.state,u=l.proxy;t["default"]=c,t.CallProxy=u},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(453),o=i(r),l=n(455),c=n(9),u=n(12),d=l.extend({model:o["default"],initialize:function(){l.prototype.initialize.call(this),this.hasDocBefore=!0},"delete":function(){l.prototype["delete"].call(this),this.stopListening(),this.reset()},queryDocs:function(e,t){var n=this;if(t)return this.queryDocBefore?this.queryDocBefore:(this.queryDocBefore=Store.Msg.queryMedia(t.id.remote,c.MEDIA_QUERY_LIMIT,"before",t.id,"document").then(function(e){return(!e||e.length<c.MEDIA_QUERY_LIMIT)&&(n.hasDocBefore=!1),n.add(e.filter(function(e){return e.isDoc}),{at:0}),{length:e.length}})["catch"](u.WapDrop,404,_.noop)["finally"](function(){n.queryDocBefore=null,n.trigger("query_doc_before")}),this.trigger("query_doc_before"),this.queryDocBefore);var i=e.msgs.models;if(0===this.length){if(!i||0===i.length)return new s["default"](function(e){e({eof:!0})});this.add(i.filter(function(e){return e.isDoc}),{at:0})}if(this.length<=2*c.MEDIA_QUERY_LIMIT){var a=0===this.length?_.head(i):this.head();return this.queryDocs(e,a)}return new s["default"](function(e){e({eof:!1})})}});e.exports=d},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(453),o=i(r),l=n(455),c=n(9),u=n(12),d=l.extend({model:o["default"],initialize:function(){l.prototype.initialize.call(this),this.hasLinkBefore=!0},comparator:function(e,t){return e.t-t.t},"delete":function(){l.prototype["delete"].call(this),this.stopListening(),this.reset()},queryLinks:function(e,t){var n=this;if(t)return this.queryLinkBefore?this.queryLinkBefore:(this.queryLinkBefore=Store.Msg.queryMedia(t.id.remote,c.MEDIA_QUERY_LIMIT,"before",t.id,"url").then(function(e){return(!e||e.length<c.MEDIA_QUERY_LIMIT)&&(n.hasLinkBefore=!1),n.add(e.filter(function(e){return e.hasLink}),{at:0}),{length:e.length}})["catch"](u.WapDrop,404,_.noop)["finally"](function(){n.queryLinkBefore=null,n.trigger("query_link_before")}),this.trigger("query_link_before"),this.queryLinkBefore);var i=function(){var t=e.msgs.models;if(0===n.length){var i=function(){if(!t||0===t.length)return{v:{v:new s["default"](function(e){e({eof:!0})})}};n.add(t.filter(function(e){return e.hasLink}),{at:0});var e=[];s["default"].loop(function(n,i,a){t.length===a&&n();var s=t[a];s.createLinks(),s.links.length&&e.push(s)}).then(function(){n.add(e)})}();if("object"==typeof i)return i.v}if(n.length<=2*c.MEDIA_QUERY_LIMIT){var a=0===n.length?_.head(t):n.head();return{v:n.queryLinks(e,a)}}return{v:new s["default"](function(e){e({eof:!1})})}}();return"object"==typeof i?i.v:void 0}});e.exports=d},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(453),o=i(r),l=n(455),c=n(9),u=n(12),d={before:"before",after:"after"},p=l.extend({model:o["default"],initialize:function(){l.prototype.initialize.call(this),this.hasMediaBefore=!0,this.hasMediaAfter=!0},"delete":function(){l.prototype["delete"].call(this),this.stopListening()},contains:function(e){return this.models.indexOf(e)>-1},getAfter:function(e){var t=this.models.indexOf(e);return t<0||t===this.models.length-1?null:this.models[t+1]},getBefore:function(e){var t=this.models.indexOf(e);return t<=0?null:this.models[t-1]},loadEarlierMedias:function(){var e=this.head();e&&this.queryMedia(null,e)},loadRecentMedias:function(){var e=this.last();e&&this.queryMedia(null,e,d.after)},loadMoreAroundIfNeeded:function(e){if(e){var t=this.models.indexOf(e);t<20&&this.hasMediaBefore&&this.loadEarlierMedias(),this.models.length-t<20&&this.hasMediaAfter&&this.loadRecentMedias()}},queryMedia:function(e,t){var n=this,i=arguments.length<=2||void 0===arguments[2]?d.before:arguments[2];if(!t){var a=e.msgs.models;if(!a||0===a.length)return new s["default"](function(e){e({eof:!0})});this.add(a.filter(function(e){return e.isMedia}),{at:0});var r=this.models;if(this.downloadMedias(r),r.length<=2*c.MEDIA_QUERY_LIMIT){var o=0===r.length?_.head(a):_.head(r);return this.queryMedia(e,o)}return new s["default"](function(e){e({eof:!1})})}return i===d.before?this.queryMediaBefore?this.queryMediaBefore:(this.queryMediaBefore=Store.Msg.queryMedia(t.id.remote,c.MEDIA_QUERY_LIMIT,i,t.id).then(function(e){var t=e.messages;(!t||t.length<c.MEDIA_QUERY_LIMIT)&&(n.hasMediaBefore=!1);var i=[];return t&&t.length>0&&(i=t.filter(function(e){return e.isMedia}),n.downloadMedias(i)),n.add(i,{at:0}),{length:i.length}})["catch"](u.WapDrop,404,_.noop)["finally"](function(){n.queryMediaBefore=null,n.trigger("query_media_before")}),this.trigger("query_media_before"),this.queryMediaBefore):i===d.after?this.queryMediaAfter?this.queryMediaAfter:this.queryMediaAfter=Store.Msg.queryMedia(t.id.remote,c.MEDIA_QUERY_LIMIT,i,t.id).then(function(e){var t=e.messages;(!t||t.length<c.MEDIA_QUERY_LIMIT)&&(n.hasMediaAfter=!1);var i=[];return t&&t.length>0&&(i=t.filter(function(e){return e.isMedia}),n.downloadMedias(i)),n.add(i),{length:i.length}})["catch"](u.WapDrop,404,_.noop)["finally"](function(){n.queryMediaAfter=null,n.trigger("query_media_after")}):void 0},downloadMedias:function(e){_.forEach(e,function(e){e.downloadMedia()})}});e.exports=p},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(77),s=i(a),r=n(1385),o=n(1),l=(0,a.defineState)("ChatMsgs",{props:{pendingMsgs:"boolean"},session:{msgChunks:{type:"array","default":function(){return[]}},lastReceivedKey:"object",unreadMsgAnchor:"object",disableUnreadAnchor:"boolean",msgsLength:"number",msgsChanged:{type:"number","default":0}},collections:{msgs:r},initialize:function(){var e=this;s["default"].prototype.initialize.call(this),_.isFunction(this.onEmptyMRM)||o.error("states that extend ChatMsgs need to define onEmptyMRM()")(),this.listenTo(this.msgs,"change:last",function(){e.msgsChanged++}),this.listenTo(this.msgs,"add remove bulk_add",function(){e.msgsChanged++,e.msgsLength=e.msgs.length})},"delete":function(e){s["default"].prototype["delete"].call(this),this.getAllCMCs().forEach(function(e){e["delete"]()})},removeMsg:function(e){var t=e.msgChunk;if(t){var n=t.indexOf(e);n<0||(o.log("models:Chat:removeMsg "+e.get("id"))(),t.remove(e),0===t.length&&(t===this.msgs?this.onEmptyMRM():this.removeMsgsCollection(t)))}},getAllCMCs:function(){return this.msgChunks.concat([this.msgs])},getAllMsgs:function(){return _.flatten(this.getAllCMCs().map(function(e){return e.models}))},replaceMsgsCollection:function(e){o.info("model:Chat:replaceMsgsCollection:"+this.id)(),this.msgs.replace(e),this.notifyMsgCollectionMerge(e,this.msgs,this.msgs),this.msgChunks=_.without(this.msgChunks,e),e["delete"]()},removeMsgsCollection:function(e){this.msgChunks=_.without(this.msgChunks,e),e["delete"]()},notifyMsgCollectionMerge:function(e,t,n){this.trigger("change:cmc:merge",e,t,n)}}),c=l.ChatMsgs;e.exports=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChatPreferenceProxy=t["default"]=void 0;var i=n(77),a=(0,i.defineState)("ChatPreference",{Collection:"ChatPreference",props:{id:"string",wallpaperColor:"string"}}),s=a.ChatPreference,r=a.ChatPreferenceProxy;t["default"]=s,t.ChatPreferenceProxy=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EmojiVariantProxy=t["default"]=void 0;var i=n(77),a=(0,i.defineState)("EmojiVariant",{props:{id:"string","char":"string",variant:"string"},initialize:function(e){this.id=e.id||e["char"]}}),s=a.EmojiVariant,r=a.EmojiVariantProxy;t["default"]=s,t.EmojiVariantProxy=r},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(453),o=i(r),l=n(455),c=n(12),u=n(75),d=100,p=l.extend({model:o["default"],initialize:function(){var e=this;l.prototype.initialize.call(this),this.hasMoreMsgs=!0,this.resultPage=0,this.listenTo(Store.Msg,"remove",function(t){
e.remove(t),e.trigger("msgs_update")}),this.listenTo(Store.Chat,"remove",function(t){var n=[];e.forEach(function(e){e.chat===t&&n.push(e)}),e.remove(n),e.trigger("msgs_update")})},"delete":function(e){e&&this.stopListening(),l.prototype["delete"].call(this)},resetSearch:function(e){this.hasMoreMsgs=!0,this.resultPage=0,this.searchTerm=e,this.searchPromise&&this.searchPromise.cancel()},search:function(e,t){var n=this;if(this.searchTerm!==e&&(this.searchTerm&&0===e.indexOf(this.searchTerm)||(this.searchTerm=e,this["delete"]()),this.resultPage=0,this.hasMoreMsgs=!0),this.searchPromise){if(this.searchTerm===e)return this.searchPromise;this.searchPromise.cancel()}var i=void 0;return i=t?t.fts(e,++this.resultPage,d):Store.Msg.search(e,++this.resultPage,d),this.searchPromise=i.cancellable().then(function(t){u.supportsFeature(u.F.FTS_PAGINATION)&&!t.eof||(n.hasMoreMsgs=!1),n.searchTerm!==e&&n["delete"](),n.searchTerm=e,n.add(t.messages)})["catch"](c.WapDrop,s["default"].CancellationError,_.noop)["finally"](function(){n.searchPromise=null,n.trigger("msgs_update")}),this.trigger("msgs_update"),this.searchPromise}});e.exports=p},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.MsgInfoProxy=t["default"]=void 0;var a=n(77),s=i(a),r=n(232),o=i(r),l=n(484),c=n(465),u=n(469),d=(0,a.defineState)("Participant",{props:{id:"string",t:"number"},session:{contact:"object"},initialize:function(){s["default"].prototype.initialize.call(this),this.addChild("contact",Store.Contact.gadd(this.id))},getCollection:function(){return this.collection}}),p=d.Participant,h=c.extend(u,{model:p,comparator:function(e,t){return o["default"].Comparator(e.contact,t.contact)},isStateStale:function(e){var t=this.get(e);return t&&t.stale}}),f=(0,a.defineState)("MsgInfo",{Collection:"MsgInfo",props:{id:"msgKey",isPTT:"boolean",playedRemaining:{type:"number","default":0},readRemaining:{type:"number","default":0},deliveryRemaining:{type:"number","default":0}},collections:{played:h,read:h,delivery:h},derived:{settled:{deps:["isPTT","playedRemaining","readRemaining"],fn:function(){return this.isPTT?!this.playedRemaining:!this.readRemaining}}}},l),m=f.MsgInfo,g=f.MsgInfoProxy;t["default"]=m,t.MsgInfoProxy=g},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RecentEmojiProxy=t["default"]=void 0;var i=n(77),a=(0,i.defineState)("RecentEmoji",{props:{id:"string","char":"string",weight:"number"},initialize:function(e){this.id=e.id||e["char"]}}),s=a.RecentEmoji,r=a.RecentEmojiProxy;t["default"]=s,t.RecentEmojiProxy=r},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(453),s=i(a),r=n(1354),o=i(r),l=n(8),c=n(10),u=n(454),d=n(1355),p=n(460),h=n(1365),f=n(1423),m=n(75),g=n(153),v=n(58),y=l.createClass({displayName:"MultiselectBar",mixins:[g],propTypes:{chat:l.PropTypes.instanceOf(o["default"]).isRequired,selectedMessages:l.PropTypes.instanceOf(h).isRequired,onCancel:l.PropTypes.func.isRequired,noSortOnForward:l.PropTypes.bool},componentWillMount:function(){var e=this;_.forEach(this.props.selectedMessages.getSelected(),function(t){e.addObserver(t,"change:star")}),this.addObserver(this.props.selectedMessages,"all"),this.addObserver(Store.Msg,"change:star",this.onStarChanged)},onStarChanged:function(e){this.props.selectedMessages.isSelected(e)&&this.setState({})},onStarSelected:function(){this.props.chat.sendStarMsgs(this.props.selectedMessages.getSelected(),!0),this.props.onCancel()},onUnstarSelected:function(){this.props.chat.sendStarMsgs(this.props.selectedMessages.getSelected(),!1),this.props.onCancel()},onDownloadSelected:function(){var e=_.filter(this.props.selectedMessages.getSelected(),function(e){return e.mediaData&&e.mediaData.renderableUrl});e.length&&(p.initDownload(e),this.props.onCancel())},onDeleteSelected:function(){var e=this,t=this.props.selectedMessages.getSelected(),n=function(){c.closeModal(),e.props.chat.sendDeleteMsgs(t),e.props.onCancel()},i=_.size(t),a=l10n.t("delete_message_confirmation",{count:i,_plural:i});c.openModal(l.createElement(u,{onOK:n,okText:l10n.t("web_delete"),onCancel:c.closeModal.bind(c),cancelText:l10n.t("web_cancel")},l.createElement(d,{text:a})))},onForwardSelected:function(){var e=this,t=this.props.selectedMessages.getSelected();this.props.noSortOnForward||(t=this.props.chat.sortMsgs(t));var n=_.size(t),i=function(){e.props.onCancel()},a=_.filter(t,function(e){return e.canForward()});if(_.size(a))if(n!==_.size(a)){var s=function(){c.openModal(l.createElement(f,{msgs:a,onForward:i}),"modal-flow")};c.openModal(l.createElement(u,{title:l10n.t("confirm_forward_partial_messages_title"),onOK:s,okText:l10n.t("forward"),onCancel:c.closeModal.bind(c),cancelText:l10n.t("web_cancel")},l10n.t("confirm_forward_partial_messages_text")))}else c.openModal(l.createElement(f,{msgs:t,onForward:i}),"modal-flow");else c.openModal(l.createElement(u,{title:l10n.t("err_unsent_forward_title"),onOK:c.closeModal.bind(c),okText:l10n.t("web_ok")},l10n.t("err_unsent_forward_text",{count:n,_plural:n})))},render:function(){var e=this.props.selectedMessages.getSelected(),t=_.size(e),n=m.supportsFeature(m.F.ENC_DOC)||_.every(e,function(e){return e.type!==s["default"].TYPE.DOCUMENT}),i=_.some(e,function(e){return e.canForward()}),a=_.some(e,function(e){return e.mediaData&&e.mediaData.renderableUrl}),r=l.createElement("button",{className:"btn-icon btn-forward",disabled:t&&n&&i?null:"disabled",title:l10n.t("forward_message",{count:t,_plural:t}),onClick:this.onForwardSelected},l.createElement("span",{className:"icon icon-forward"})),o=void 0;m.supportsFeature(m.F.MESSAGE_DELETE)&&(o=l.createElement("button",{className:"btn-icon btn-delete",disabled:t?null:"disabled",title:l10n.t("delete_message",{count:t,_plural:t}),onClick:this.onDeleteSelected},l.createElement("span",{className:"icon icon-delete"})));var c=void 0;if(m.supportsFeature(m.F.STARRED)){var u=void 0,d=void 0,p=void 0;t&&_.every(e,"star")?(u=this.onUnstarSelected,d=l.createElement("span",{className:"icon icon-unstar-btn"}),p=l10n.t("unstar_message",{count:t,_plural:t})):(u=this.onStarSelected,d=l.createElement("span",{className:"icon icon-star-btn"}),p=l10n.t("star_message",{count:t,_plural:t})),c=l.createElement("button",{className:"btn-icon btn-star",disabled:t?null:"disabled",title:p,onClick:u},d)}var h=v.isSafari?null:l.createElement("button",{className:"btn-icon",disabled:t&&a?null:"disabled",title:l10n.t("web_button_download"),onClick:this.onDownloadSelected},l.createElement("span",{className:"icon icon-download"}));return l.createElement("div",{className:"multi-controls"},l.createElement("button",{className:"btn-icon btn-cancel",onClick:this.props.onCancel},l.createElement("span",{className:"icon icon-x"})),l.createElement("span",{className:"multi-count"},l10n.t("selected_count",{count:t,_plural:t})),c,o,r,h)}});e.exports=y},function(e,t){"use strict";var n=window.matchMedia("\nonly screen and (max-width: 1024px)\n"),i={column:n.matches?2:3},a=function(e){var t=e.matches?2:3;if(i.column!==t){i.column=t;var n=document.createEvent("Event");n.initEvent("columnChange",!0,!0),window.dispatchEvent(n)}};n.addListener(a),e.exports=i},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(461),o=n(12),l={getFiles:function(e,t){var n=e.target.files||e.dataTransfer.files;if(n=_.map(n,function(e,t){return e}),n.length)return s["default"].resolve(n);if(e.dataTransfer.getData("text/uri-list"))return r.urlToFile(e.dataTransfer.getData("text/uri-list")).then(function(e){return[e]});if(e.dataTransfer.getData("text/html")){var i=new DOMParser,a=i.parseFromString(e.dataTransfer.getData("text/html"),"text/html");if(a.createNodeIterator(a.childNodes[0],NodeFilter.SHOW_TEXT).nextNode()){if(e.dataTransfer.getData("text/plain")&&!t)return s["default"].reject(new o.MediaDragDropError("dropped html has text nodes",e.dataTransfer.getData("text/plain")))}else{var l=a.getElementsByTagName("img");if(l.length)return r.urlToFile(l[0].src).then(function(e){return[e]})}}return s["default"].resolve(n)}};e.exports=l},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e){return c.hasOwnProperty(e)?c[e]:c[e]=r["default"].props({url:e,data:l["default"].queryLinkPreview(e)})}Object.defineProperty(t,"__esModule",{value:!0});var s=n(2),r=i(s);t["default"]=a;var o=n(45),l=i(o),c={}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(15),s=i(a),r=n(5),o=i(r),l=n(6),c=i(l),u=n(19),d=i(u),p=n(18),h=i(p),f=n(159),m=n(115),g=n(233),v=g.matchAll,y=function(e){function t(){return(0,o["default"])(this,t),(0,d["default"])(this,(0,s["default"])(t).apply(this,arguments))}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"match",value:function(e){return v(f.emojiRegex(),e)}},{key:"alwaysApply",get:function(){return!0}}]),t}(m);e.exports=y},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(15),s=i(a),r=n(5),o=i(r),l=n(6),c=i(l),u=n(19),d=i(u),p=n(18),h=i(p),f=n(115),m=n(233),g=m.matchAll,v=n(23),y=function(e){function t(e){var n=!(arguments.length<=1||void 0===arguments[1])&&arguments[1];(0,o["default"])(this,t);var i=(0,d["default"])(this,(0,s["default"])(t).call(this)),a=e.map(v.escapeRegExp),r=n?"(?:^|\\b)":"";return i._regex=new RegExp(r+"("+a.join("|")+")","ig"),i}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"match",value:function(e){return g(this._regex,e)}}]),t}(f);e.exports=y},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t,n){var i=e.models;if(n===b.BEFORE){var a=function(){var e=0;return{v:{hasNext:function(){return t>=e},next:function(){return i[t--]}}}}();if("object"==typeof a)return a.v}else{if(n!==b.AFTER)throw new Error("RendorCursor:invalid direction");var s=function(){var e=i.length-1;return{v:{hasNext:function(){return t<=e},next:function(){return i[t++]}}}}();if("object"==typeof s)return s.v}}function s(e,t,n){for(var i=arguments.length<=3||void 0===arguments[3]?1:arguments[3],s=w*i,r=a(e,t,n),o=0,c=0,u=void 0;r.hasNext();){var d=r.next(),p=l(d),h=2*d.isNotification+d.isSentByMe,f=h&&h===u?C:M;if(o+=p+f,c++,o>s)break;u=h}return c}function r(e,t,n){for(var i=arguments.length<=3||void 0===arguments[3]?1:arguments[3],s=w*i,r=a(e,t,n),o=0,c=0,u=void 0;r.hasNext();){var d=r.next(),p=l(d),h=d.author||(d.isSentByMe?Store.Conn.me:void 0),f=h&&!d.isSentByMe&&h!==u?S:0,m=h&&h===u?C:M;if(o+=p+f+m,c++,o>s)break;u=h}return c}function o(e,t,n){for(var i=arguments.length<=3||void 0===arguments[3]?1:arguments[3],s=w*i,r=a(e,t,n),o=0,c=0;r.hasNext();){var u=r.next(),d=l(u);if(o+=d+T,c++,o>s)break}return c}function l(e){var t=0;switch(e.quotedMsg&&(t+=54),e.caption&&(t+=31),e.type){case g["default"].TYPE.NOTIFICATION:case g["default"].TYPE.GROUP_NOTIFICATION:case g["default"].TYPE.GP2:case g["default"].TYPE.BROADCAST_NOTIFICATION:case g["default"].TYPE.E2E_NOTIFICATION:case g["default"].TYPE.CALL_LOG:case g["default"].TYPE.CIPHERTEXT:case g["default"].TYPE.REVOKED:case g["default"].TYPE.CHAT:e.linkPreview&&(t+=53);var n=E(e.body).length;return t+19*_.ceil(n/100)+13;case g["default"].TYPE.IMAGE:return t+e.fullWidth&&e.fullHeight?Math.floor(Math.min(330/e.fullWidth*e.fullHeight,330)):330;case g["default"].TYPE.VIDEO:case g["default"].TYPE.AUDIO:return e.isGif?t+137:t+166;case g["default"].TYPE.LOCATION:return t+y.previewHeight;case g["default"].TYPE.PTT:return t+67;case g["default"].TYPE.VCARD:return t+74;case g["default"].TYPE.DOCUMENT:return t+188;case g["default"].TYPE.UNKNOWN:default:return t}}function c(e){switch(e){case v.RENDOR_CURSOR.CONVERSATION:case v.RENDOR_CURSOR.GROUP_CONVERSATION:return v.RENDOR_CURSOR.RECENT_AT_BOTTOM;case v.RENDOR_CURSOR.STARRED_DRAWER:return v.RENDOR_CURSOR.RECENT_AT_TOP;default:return v.RENDOR_CURSOR.RECENT_AT_BOTTOM}}function u(e){switch(e){case v.RENDOR_CURSOR.CONVERSATION:return s;case v.RENDOR_CURSOR.GROUP_CONVERSATION:return r;case v.RENDOR_CURSOR.STARRED_DRAWER:return o;default:return s}}var d=n(5),p=i(d),h=n(6),f=i(h),m=n(453),g=i(m),v=n(9),y=n(1449),E=n(1440),b={BEFORE:"before",AFTER:"after"},C=2,M=12,S=19,T=65,w=window.innerHeight,k=_.debounce(function(e){w=window.innerHeight},500);window.addEventListener("resize",k);var P=function(){function e(t,n,i){var a=this;(0,p["default"])(this,e);var s=u(i);this.msgCollection=t,this.type=i,this.dir=c(i),this.cursorSize=function(e,t){if(e===b.BEFORE)return s(a.msgCollection,a.start-1,e,t);if(e===b.AFTER)return s(a.msgCollection,a.end,e,t);throw new Error("RendorCursor:invalid direction")},this.init(n)}return(0,f["default"])(e,[{key:"init",value:function(e){return this.before=0,this.after=0,this.prevKey=void 0,this.msgKey=e,this.loadBefore(void 0,1),this.loadAfter(void 0,1),this}},{key:"setKey",value:function(e){var t=this.index;this.msgKey=e;var n=this.index;return e?(this.after=this.after-(n-t),this.before=this.before+(n-t)):(this.before+=this.after,this.after=0),this.updatePrev(),this}},{key:"onRemove",value:function(e){e.id===this.prevKey?this.updatePrev():e.id===this.msgKey&&this.focusBefore()}},{key:"updatePrev",value:function(){this.prevKey=this.index>0?this.msgCollection.models[this.index-1].id:void 0}},{key:"focusBefore",value:function(){this.msgKey=this.prevKey,this.updatePrev()}},{key:"hasBefore",value:function(e){arguments.length<=1||void 0===arguments[1]?2:arguments[1];return this.index-this.before>0}},{key:"loadBefore",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?2:arguments[1],n=e||this.cursorSize(b.BEFORE,t);return this.before+=n,this}},{key:"hasAfter",value:function(e){arguments.length<=1||void 0===arguments[1]?2:arguments[1];return this.index+this.after<this.msgCollection.length-1}},{key:"loadAfter",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?2:arguments[1],n=e||this.cursorSize(b.AFTER,t);return this.after+=n,this}},{key:"index",get:function(){if(this.msgKey){var e=this.msgCollection.get(this.msgKey),t=this.msgCollection.indexOf(e);if(t!==-1)return t}return this.dir===v.RENDOR_CURSOR.RECENT_AT_TOP?0:this.msgCollection.length-1}},{key:"start",get:function(){return Math.max(this.index-this.before,0)}},{key:"end",get:function(){return Math.min(this.index+this.after+1,this.msgCollection.length)}}]),e}();e.exports=P},,function(e,t,n){"use strict";var i=n(8),a=n(10),s=n(94),r=n(93),o=i.createClass({displayName:"ActionListener",mixins:[s],componentWillMount:function(){this.regCmd("mute_chat",this.onMute),this.regCmd("delete_or_exit_chat",this.onDeleteOrExit),this.regCmd("archive_chat",this.onArchive),this.regCmd("clear_chat_msgs",this.onClear),this.regCmd("mark_chat_unread",this.onMarkUnread)},onMute:function l(e,t){if(t){var s=n(1614),l=function(t){e.pendingAction++,e.mute.mute(t,!0)["finally"](function(){e.pendingAction--})};a.openModal(i.createElement(s,{chat:e,onMute:l}),"modal",this.context.uim)}else e.pendingAction++,e.mute.unmute(!0)["finally"](function(){e.pendingAction--})},onDeleteOrExit:function(e){var t=n(1599),s=function(t){e.pendingAction++,t["finally"](function(){e.pendingAction--})};a.openModal(i.createElement(t,{chat:e,onDeleteOrExit:s}),"modal",this.context.uim)},onClear:function(e){var t=n(1594);a.openModal(i.createElement(t,{chat:e}),"modal",this.context.uim)},onArchive:function(e,t){e.pendingAction++,e.setArchive(t)["catch"](_.noop)["finally"](function(){e.pendingAction--})},onMarkUnread:function(e,t){e.pendingAction++,e.markUnread(t)["finally"](function(){e.pendingAction--})},render:function(){return null}});o.contextTypes={uim:i.PropTypes.instanceOf(r)},e.exports=o},function(e,t,n){"use strict";var i=n(8),a=n(113).MIMETYPES,s=_.pickBy(a,function(e){return"audio"===e.msgType}),r=i.createClass({displayName:"AttachMediaTypeAudio",propTypes:{mimeType:i.PropTypes.oneOf(_.keys(s)).isRequired,url:i.PropTypes.string.isRequired},render:function(){var e=this.props,t=e.mimeType,n=e.url;return i.createElement("div",{className:"media-element-container"},i.createElement("div",{className:"media-element"},i.createElement("audio",{controls:!0,type:t,src:n})))}});e.exports=r},function(e,t,n){"use strict";var i=n(8),a=n(1378),s=n(1412),r=i.createClass({displayName:"AttachMediaTypeDoc",propTypes:{preview:i.PropTypes.object,mimeType:i.PropTypes.string,filename:i.PropTypes.string},render:function(){var e=this.props.preview;return e?i.createElement("div",{className:"media-element-pdf-container"},i.createElement("div",{className:"media-element-pdf-preview"},i.createElement(a,{type:a.TYPES.SCALE_DOWN,size:{width:e.width,height:e.height}},i.createElement("img",{src:e.url,className:"media-viewer-img"})))):i.createElement(s,{mimeType:this.props.mimeType,filename:this.props.filename})}});e.exports=r},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(158),s=i(a),r=n(8),o=n(1378),l=n(113).MIMETYPES,c=_.pickBy(l,function(e){return"image"===e.msgType||"video"===e.msgType}),u=r.createClass({displayName:"AttachMediaTypeMedia",propTypes:{mimeType:r.PropTypes.oneOf(_.keys(c)).isRequired,url:r.PropTypes.string.isRequired,isGif:r.PropTypes.bool,size:r.PropTypes.shape({width:r.PropTypes.number,height:r.PropTypes.number})},render:function(){var e=this.props,t=e.mimeType,n=e.url,i=e.size,a=void 0;if("image"===c[t].msgType)a=r.createElement("img",{src:n,className:"media-viewer-img"});else if("video"===c[t].msgType){var l=this.props.isGif?{loop:!0,autoPlay:!0,muted:!1,controls:!1}:{};a=r.createElement("video",(0,s["default"])({controls:!0,className:"media-viewer-img",type:t},l,{src:n}))}else"audio"===c[t].msgType&&(a=r.createElement("audio",{controls:!0,className:"media-viewer-audio",type:t,src:n}));return r.createElement("div",{className:"media-element-container"},r.createElement("div",{className:"media-element"},r.createElement(o,{type:o.TYPES.SCALE_DOWN,size:i},a)))}});e.exports=u},function(e,t,n){"use strict";var i=n(8),a=n(1378),s=n(1412),r=i.createClass({displayName:"AttachMediaTypePdf",propTypes:{preview:i.PropTypes.object,mimeType:i.PropTypes.string,filename:i.PropTypes.string},componentWillUnmount:function(){},render:function(){var e=this.props.preview;if(e){var t=l10n.t("attach_document_pdf_total_pages",{count:e.pdfPages,_plural:e.pdfPages});return i.createElement("div",{className:"media-element-pdf-container"},i.createElement("div",{className:"media-element-pdf-preview"},i.createElement(a,{type:a.TYPES.SCALE_DOWN,size:{width:e.width,height:e.height}},i.createElement("img",{src:e.url,className:"media-viewer-img"}))),i.createElement("div",{className:"media-element-pdf-caption"},t))}return i.createElement(s,{mimeType:this.props.mimeType,filename:this.props.filename})}});e.exports=r},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(112),s=i(a),r=n(467),o=i(r),l=n(8),c=n(1),u=n(58),d=n(247),p=n(16),h=n(163),f=n(39),m=n(60),g=n(0),v=n(38),y=n(153),E=n(94),b=n(156),C=n(9),M=n(10),S=n(43),T=n(109),w=n(1389),k=l.createClass({displayName:"ButterBar",mixins:[y,E],getInitialState:function(){var e=this;this._showNotifyTimer=new m(this.showPrompt),this._showBatteryTimer=new m(function(){return e.batteryUpdate()});var t=o["default"].battery<C.BATTERY_LOW_THRESHOLD_1?o["default"].battery<C.BATTERY_LOW_THRESHOLD_2?2:1:0;return{lowBatteryWarning:o["default"].plugged?0:t,notifyPermission:window.Notification&&window.Notification.permission,showNotify:!1}},componentWillMount:function(){this.addObserver(s["default"],"change:displayInfo"),this.addObserver(s["default"],"change:needsUpdate"),this.addObserver(s["default"],"change:needsManualDownload"),this.addObserver(o["default"],"change:plugged",this.batteryUpdate),this.addObserver(o["default"],"change:battery",this.batteryUpdate)},componentWillUnmount:function(){this._showNotifyTimer.cancel(),this._showBatteryTimer.cancel()},onReload:function(){d.restart()},onClickManualDownload:function(){},batteryUpdate:function(e){var t=this.state.lowBatteryWarning;o["default"].plugged||o["default"].battery>C.BATTERY_LOW_THRESHOLD_1?0!==t&&this.setState({lowBatteryWarning:0}):o["default"].battery<=C.BATTERY_LOW_THRESHOLD_2?t!==-2&&(e?this._showBatteryTimer.onOrBefore(C.BATTERY_DELAY):2!==t&&this.setState({lowBatteryWarning:2})):t>-1&&o["default"].battery<=C.BATTERY_LOW_THRESHOLD_1&&(e?this._showBatteryTimer.onOrBefore(C.BATTERY_DELAY):1!==t&&this.setState({lowBatteryWarning:1}))},dismissLowBatteryWarning:function(){var e=this.state.lowBatteryWarning;e>0&&this.setState({lowBatteryWarning:-e})},showPrompt:function(e){this.setState({showNotify:e})},guideConfirm:function(){M.closeModal()},guideLearnMore:function(){switch(u.browser){case C.BROWSER_TYPE.CHROME:return window.open("https://www.whatsapp.com/faq/web/28080004","_blank");case C.BROWSER_TYPE.FIREFOX:return window.open("https://www.whatsapp.com/faq/web/28080006","_blank");case C.BROWSER_TYPE.SAFARI:return window.open("https://www.whatsapp.com/faq/web/28080008","_blank");case C.BROWSER_TYPE.OPERA:return window.open("https://www.whatsapp.com/faq/web/28080007","_blank");default:return window.open("https://www.whatsapp.com/faq/web/28080004","_blank")}},requestPermissions:function(){M.openModal(l.createElement(w,{title:"guide_desktop_notifications_title",desc:"guide_desktop_notifications_description",onConfirm:this.guideConfirm,onCancel:this.guideLearnMore,type:w.TYPE.GUIDE_ALLOW}));var e=this;window.Notification.requestPermission(function(t){M.closeModal(),e.setState({notifyPermission:t})})},render:function(){var e=null;switch(s["default"].displayInfo){case s["default"].INFO.OFFLINE:e=l.createElement(x,{key:"bbar"});break;case s["default"].INFO.OPENING:case s["default"].INFO.CONNECTING:e=l.createElement(D,{key:"bbar"});break;case s["default"].INFO.NORMAL:break;case s["default"].INFO.RESUMING:case s["default"].INFO.TIMEOUT:var t=function(){window.open("http://www.whatsapp.com/faq/web/28080002")},n=l.createElement("span",null,l10n.t("make_sure_phone_active_internet_connection")," ",l.createElement("span",{className:"action",onClick:t},l10n.t("learn_more")));e=l.createElement(P,{type:"phone",key:"bbar",title:l10n.t("phone_not_connected"),text:n})}if(!e&&this.state.lowBatteryWarning>0&&(e=l.createElement(P,{type:"battery",key:"bbar",title:l10n.t("phone_battery_low"),text:l10n.t("charge_phone_description"),dismissable:!0,onDismiss:this.dismissLowBatteryWarning})),!e&&s["default"].needsUpdate&&(e=l.createElement(P,{type:"update",key:"bbar",title:l10n.t("update_available"),text:l10n.t("click_to_update_whatsapp_web"),action:this.onReload})),s["default"].needsManualDownload&&(e=l.createElement(P,{type:"update",key:"bbar",title:l10n.t("desktop_client_update_available"),text:l10n.t("click_to_download_desktop_client"),action:this.onClickManualDownload})),e)this.state.showNotify&&this._showNotifyTimer.onOrBefore(0,!1);else if(this.state.showNotify){if(window.Notification&&this.state.notifyPermission===C.PERMISSION_DEFAULT){var i=l.createElement("span",{className:"action",onClick:this.requestPermissions},l10n.t("enable_desktop_notifications"));e=l.createElement(P,{type:"notification",key:"bbar",title:l10n.t("get_notified_of_new_messages"),text:i})}}else this._showNotifyTimer.onOrBefore(C.NOTIFICATION_PROMPT_DELAY,!0);return l.createElement("div",{className:"butterbar-container"},l.createElement(T,{transitionName:"butterbar"},e))}}),P=l.createClass({displayName:"BB",propTypes:{type:l.PropTypes.oneOf(["computer","phone","notification","battery","update"]),title:l.PropTypes.node.isRequired,text:l.PropTypes.node,dismissable:l.PropTypes.bool,onDismiss:l.PropTypes.func,action:l.PropTypes.func},onClick:function(){this.props.action&&this.props.action()},render:function(){var e,t;switch(this.props.type){case"computer":case"phone":case"notification":case"battery":case"update":e="butterbar-"+this.props.type,t="icon-alert-"+this.props.type;break;default:c.log("butterbar:render invalid type")()}var n=S("butterbar",e,{action:this.props.action}),i=S("icon","icon-alert",t),a=this.props.dismissable?l.createElement("div",{className:"butterbar-controls"},l.createElement("button",{className:"icon icon-x-light",onClick:this.props.onDismiss})):null,s=this.props.text?l.createElement("div",{className:"butterbar-text"},this.props.text):null;return l.createElement("div",{className:"butterbar-wrapper"},l.createElement("div",{className:n,onClick:this.onClick},l.createElement("div",{className:"butterbar-icon"},l.createElement("span",{className:i})),l.createElement("div",{className:"butterbar-body"},l.createElement("div",{className:"butterbar-title"},this.props.title),s),a))}}),N=3e3,x=l.createClass({displayName:"Offline",mixins:[b],getInitialState:function(){return{allowReconnect:!0}},reconnect:function(){var e=h.numSocketsAttempted+1;p.poke(),v.waitForBBEvent(s["default"],"change:displayInfo",function(){return s["default"].displayInfo===s["default"].INFO.NORMAL}).then(function(){new f.WebcManualWebsocketAttempt({webcManualWebsocketAttemptSuccessful:h.numSocketsAttempted===e}).commit()}),this.setState({allowReconnect:!1}),this.reconnectTimeout=this.safeDelay(this.resetReconnectTimeout,N)},resetReconnectTimeout:function(){this.clearSafeTimeout(this.reconnectTimeout),delete this.reconnectTimeout,this.setState({allowReconnect:!0})},render:function(){var e,t;return this.state.allowReconnect?(e=l.createElement("span",null,l10n.t("make_sure_computer_active_internet_connection")+" ",l.createElement("span",{className:"action",onClick:this.reconnect},l10n.t("reconnect"))),t=l10n.t("computer_not_connected")):(e=null,t=l10n.t("connecting_to_whatsapp_or_phone")),l.createElement(P,{type:"computer",title:t,text:e})}}),D=l.createClass({displayName:"Resume",mixins:[y],getInitialState:function(){return{takingTooLong:!1,didShowSubtitle:!1}},componentWillMount:function(){this._timeoutTimer=new m(this.timedOut),this._intervalTimer=new m(this.onInterval),this.addObserver(p,"change:state",this.onProgress),this.addObserver(p,"change:retryTimestamp",this.onProgress)},componentDidMount:function(){this._timeoutTimer.onOrBefore(3e3)},componentWillUnmount:function(){this._timeoutTimer.cancel(),this._intervalTimer.cancel()},timedOut:function(){this._intervalTimer.onOrAfter(1e3),this.setState({takingTooLong:!0,didShowSubtitle:!0})},onProgress:function(){this._intervalTimer.cancel(),this._timeoutTimer.onOrBefore(3e3),this.setState({takingTooLong:!1})},onInterval:function(){this._intervalTimer.onOrAfter(1e3),this.setState({now:Date.now()})},retry:function(e){p.poke(),this.onProgress()},render:function(){var e,t;if(s["default"].displayInfo===s["default"].INFO.OPENING)e=l10n.t("connecting_to_whatsapp");else{if(s["default"].displayInfo!==s["default"].INFO.CONNECTING)return null;e=l10n.t("connecting_to_whatsapp_or_phone")}if(this.state.takingTooLong){var n=p.retryTimestamp-Date.now();if(n<1)n=l10n.t("retrying"),_.defer(function(){return p.poke()});else if(n<6e4){var i=Math.ceil(n/1e3);n=l10n.t("retrying_in_some_seconds",{number:i,_plural:i})}else n=l10n.t("retrying_in",{duration:g.duration(n).humanize()});t=l.createElement("span",null,n," ",l.createElement("span",{className:"action",onClick:this.retry},l10n.t("retry_now")))}else t=this.state.didShowSubtitle?l.createElement("span",null,l10n.t("retrying")):null;return l.createElement(P,{type:"computer",title:e,text:t})}});e.exports=k},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(15),s=i(a),r=n(5),o=i(r),l=n(6),c=i(l),u=n(19),d=i(u),p=n(18),h=i(p),f=n(8),m=i(f),g=n(1354),v=(i(g),n(1396)),y=(i(v),n(1362)),E=i(y),_=n(1498),b=i(_),C=n(1355),M=i(C),S=function(e){function t(){return(0,o["default"])(this,t),(0,d["default"])(this,(0,s["default"])(t).apply(this,arguments))}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"render",value:function(){var e=this.props,t=e.chat,n=e.presence;if(n.isActive()){var i=n.getFormattedString();if(i)return m["default"].createElement("div",{className:"chat-status typing ellipsify",dir:"auto"},m["default"].createElement(M["default"],{ellipsify:!0,titlify:!0,text:i}))}var a=t.previewMessage;return a?m["default"].createElement(b["default"],{key:a.id,msg:a}):m["default"].createElement("div",{className:"chat-status"})}}]),t}(m["default"].PureComponent);S.CONCERNS={chat:["previewMessage"],chatstate:["id","type"]},S.WEAK_CONCERNS={presence:["hasData","withholdDisplay"]};var T=(0,E["default"])(S);t["default"]=function(e){var t=e.chat;return m["default"].createElement(T,{chat:t,presence:t.presence,chatstate:t.presence.chatstate})}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1354),s=i(a),r=n(232),o=i(r),l=n(1390),c=i(l),u=n(8),d=n(153),p=n(1365),h=n(1372),f=n(1376),m=n(1379),g=n(157),v=u.createClass({displayName:"CheckboxChatWrapper",mixins:[d],propTypes:{chat:u.PropTypes.oneOfType([u.PropTypes.instanceOf(s["default"]),u.PropTypes.instanceOf(o["default"])]).isRequired,active:u.PropTypes.instanceOf(h).isRequired,selections:u.PropTypes.instanceOf(p).isRequired,onSelect:u.PropTypes.func.isRequired},getInitialState:function(){return{selected:this.props.selections.isSelected(this.props.chat)}},componentWillMount:function(){this.addObserver(this.props.selections,this.props.chat.id.toString(),this.onSelectChange)},onSelectChange:function(e){this.state.selected!==e&&this.setState({selected:e})},onSelect:function(){this.props.onSelect(this.props.chat,!this.state.selected)},render:function(){var e=this.props,t=e.chat,n=e.active,i=void 0;return i=t instanceof s["default"]?u.createElement(c["default"],{className:"chat-container",active:n,chat:t,mode:l.Mode.INFO,noContext:!0,onClick:this.onSelect}):u.createElement(f,{className:"chat-container",active:n,contact:t,onClick:this.onSelect,secondary:t.isBlocked()?g.t("confirm_unblock_contact_and_forward_text"):null}),u.createElement("div",{className:"checkbox-chat-wrapper"},u.createElement("div",{className:"checkbox-container-wrapper"},u.createElement(m,{onChange:this.onSelect,checked:this.state.selected})),i)}});e.exports=v},function(e,t,n){"use strict";var i=n(8),a=n(76),s=i.createClass({displayName:"ContactMsgInfoCell",propTypes:{title:i.PropTypes.string.isRequired,icon:i.PropTypes.node.isRequired,t:i.PropTypes.number},render:function(){var e=this.props,t=e.title,n=e.t,s=e.icon,r=n?a.relativeDateAndTimeStr(n):"-",o={cursor:"auto"};return i.createElement("div",{className:"contact chat",style:o},i.createElement("div",{className:"chat-body"},i.createElement("div",{className:"chat-main"},i.createElement("div",{className:"chat-title"},i.createElement("span",{className:"ellipsify",dir:"auto"},s,t))),i.createElement("div",{className:"chat-secondary"},i.createElement("div",{className:"chat-status ellipsify"},i.createElement("span",{className:"ellipsify",dir:"auto"},r)))))}});e.exports=s},function(e,t,n){"use strict";var i=n(8),a=n(1375),s=n(1361),r=n(76),o=n(1356),l=i.createClass({displayName:"GroupMsgInfoCell",mixins:[o],propTypes:{participant:i.PropTypes.instanceOf(Object).isRequired},getInitialState:function(){return{formattedName:this.async("participant.contact.formattedName")}},render:function(){var e=this.props.participant,t=i.createElement("div",{className:"chat-avatar"},i.createElement(s,{id:e.id})),n={cursor:"auto"};return i.createElement(a,{id:e.id,contextEnabled:function(){return!1},image:t,primary:this.state.formattedName,secondary:r.relativeDateAndTimeStr(e.t),style:n})}});e.exports=l},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(15),s=i(a),r=n(5),o=i(r),l=n(6),c=i(l),u=n(19),d=i(u),p=n(18),h=i(p),f=n(8),m=i(f),g=n(1354),v=(i(g),n(1426)),y=(i(v),n(1362)),E=i(y),_=n(157),b=i(_),C=n(109),M=function(e){function t(){return(0,o["default"])(this,t),(0,d["default"])(this,(0,s["default"])(t).apply(this,arguments))}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"render",value:function(){var e=this.props,t=e.chat,n=e.mute,i=n.isMuted?m["default"].createElement("span",{
className:"icon icon-meta icon-muted",key:"icon-muted"}):null,a=0!==t.unreadCount?m["default"].createElement("span",{className:"icon-meta unread-count",key:"icon-unread"},t.unreadCount>0?b["default"].n(t.unreadCount):m["default"].createElement("span",null," ")):null,s=t.archive?m["default"].createElement("span",{className:"icon-meta chat-marker chat-marker-archived",key:"icon-archived"},b["default"].t("chat_archived")):null;return m["default"].createElement(C,{transitionName:"pop"},i,s,a)}}]),t}(m["default"].PureComponent);M.CONCERNS={chat:["unreadCount","archive"],mute:["isMuted"]},t["default"]=(0,E["default"])(M)},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a,s,r=n(15),o=i(r),l=n(5),c=i(l),u=n(6),d=i(u),p=n(19),h=i(p),f=n(18),m=i(f),g=n(8),v=i(g),y=n(453),E=(i(y),n(1431)),_=i(E),b=n(58),C=i(b),M=n(157),S=i(M),T=n(1413),w=i(T),k=n(1398),P=i(k),N=n(1355),x=i(N),D=n(1362),O=i(D);t["default"]=(0,O["default"])((s=a=function(e){function t(){return(0,c["default"])(this,t),(0,h["default"])(this,(0,o["default"])(t).apply(this,arguments))}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"render",value:function(){var e=this.props.msg,t=[];e.isSentByMe&&t.push(v["default"].createElement(w["default"],{msg:e,key:"symbol"})),e.isSentByMe||!e.isGroupMsg||e.isNotification||t.push(v["default"].createElement(_["default"],{contact:e.senderObj,key:"author"}),v["default"].createElement("span",{className:"chat-status-divider",key:"divider"},":")),e.hasSymbol()&&t.push(v["default"].createElement(P["default"],{msg:e,key:"msg-symbol"})),t.push(v["default"].createElement(x["default"],{direction:e.dir,ellipsify:!0,text:e.msgText(!1),format:!0,dirMismatch:e.dir&&e.rtl!==S["default"].isRTL(),mention:e.mentionMap(),noMentionClick:!0,key:"status"}));var n="chat-status";C["default"].isGecko&&(n+=" ellipsify");var i=S["default"].embedDir(e.msgText(e.rtl));return v["default"].createElement("div",{className:n,title:i},t)}}]),t}(v["default"].PureComponent),a.CONCERNS={msg:["isSentByMe","isGroupMsg","isNotification","senderObj","dir","rtl","type"]},s))},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(158),s=i(a),r=n(160),o=i(r),l=n(15),c=i(l),u=n(5),d=i(u),p=n(6),h=i(p),f=n(19),m=i(f),g=n(18),v=i(g),y=n(8),E=i(y),_=n(44),b=i(_),C=n(1375),M=i(C),S=n(1355),T=i(S),w=n(43),k=i(w),P=n(1386),N=i(P),x=n(58),D=i(x),O=n(92),R=i(O),I=n(1432),A=i(I),L=n(1398),F=i(L),U=n(453),G=(i(U),n(1413)),j=i(G),B=n(1431),V=i(B),q=n(110),H=i(q),z=n(463),W=i(z),Y=n(157),K=i(Y),Q=n(1362),X=i(Q),Z=n(1368),J=i(Z),$=n(23),ee=i($),te=function(e){function t(){var e,n,i,a;(0,d["default"])(this,t);for(var s=arguments.length,r=Array(s),o=0;o<s;o++)r[o]=arguments[o];return n=i=(0,m["default"])(this,(e=(0,c["default"])(t)).call.apply(e,[this].concat(r))),i.state={active:!!i.props.active&&i.props.active.value===i.props.msg},i.onActiveChange=function(e){if("focus"===e){var t=b["default"].findDOMNode(i);R["default"].focus(t),N["default"].scrollIntoViewIfNeeded(t)}i.setState({active:!!e})},i.onClick=function(e){if(ee["default"].isFunction(i.props.onClick)){var t=i.props,n=t.msg,a=t.chat,s=Store.Msg.get(n.id),r=a.getSearchContext(s);r.msg=s,i.props.onClick(e,Store.Chat.get(a.id),r)}},i.onMouseDown=function(e){0===e.button&&i.onClick(e)},i.onEnter=function(e){e.preventDefault(),e.stopPropagation(),H["default"].flashFocus=Date.now(),i.onClick(e)},i.indicateFocus=function(e){if(!(Date.now()-(H["default"].flashFocus||0)>200)){var t=b["default"].findDOMNode(i.refs.cell);(0,W["default"])(t,"stop"),(0,W["default"])(t,{backgroundColor:["#e9eaeb","#cbdde7"]},{duration:1300,easing:[.19,.69,.01,.99],complete:i.onBlur})}},i.onBlur=function(e){var t=b["default"].findDOMNode(i.refs.cell);t&&((0,W["default"])(t,"stop"),t.style.backgroundColor="")},a=n,(0,m["default"])(i,a)}return(0,v["default"])(t,e),(0,h["default"])(t,[{key:"componentWillMount",value:function(){var e=this.props,t=e.active,n=e.msg,i=e.listeners;t&&i.add(t,n.id.toString(),this.onActiveChange)}},{key:"render",value:function(){var e=this.props,t=e.msg,n=e.chat,i=[];t.isSentByMe&&i.push(E["default"].createElement(j["default"],{msg:t,key:"symbol"})),t.isSentByMe||!t.isGroupMsg||t.isNotification||i.push(E["default"].createElement(V["default"],{contact:t.senderObj,key:"author"}),E["default"].createElement("span",{className:"chat-status-divider",key:"divider"},":")),t.hasSymbol()&&i.push(E["default"].createElement(F["default"],{msg:t,key:"msg-symbol"}));var a=void 0;this.props.searchText&&(a=ee["default"].uniq(ee["default"].compact(ee["default"].split(ee["default"].toLower(this.props.searchText)," ")))),i.push(E["default"].createElement(T["default"],{direction:t.dir,ellipsify:!0,text:t.msgText(!1),format:!0,highlight:a,dirMismatch:t.dir&&t.rtl!==K["default"].isRTL(),mention:t.mentionMap(),key:"status"}));var s=(0,k["default"])("chat-status",{ellipsify:D["default"].isGecko}),r=E["default"].createElement(A["default"],{msg:t}),o=K["default"].embedDir(t.msgText(t.rtl)),l=E["default"].createElement("div",{className:s,title:o},i),c={enter:this.onEnter},u=(0,k["default"])("message",{active:!!this.state.active}),d=this.props.mouseDownAsClick;return E["default"].createElement(H["default"],{handlers:c,onFocus:this.indicateFocus,onBlur:this.onBlur,className:"chat-drag-cover"},E["default"].createElement(M["default"],{id:t.id.toString(),ref:"cell",contextEnabled:function(){return!1},className:u,primary:n.title(),primaryDetail:r,secondary:l,onClick:d?null:this.onClick,onMouseDown:d?this.onMouseDown:null}))}}]),t}(E["default"].PureComponent);te.CONCERNS={msg:["id","isSentByMe","isGroupMsg","isNotification","senderObj","dir","rtl","type"],chat:["id","formattedTitle"]};var ne=(0,J["default"])((0,X["default"])(te));t["default"]=function(e){var t=e.msg,n=(0,o["default"])(e,["msg"]);return E["default"].createElement(ne,(0,s["default"])({msg:t,chat:t.chat},n))}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1408),s=i(a),r=n(8),o=n(1355),l=n(1356),c=r.createClass({displayName:"Status",mixins:[l],propTypes:{status:r.PropTypes.instanceOf(s["default"])},getInitialState:function(){return{status:this.async("status.status")}},render:function(){var e=void 0,t=void 0;return _.isUndefined(this.state.status)?e=r.createElement("span",{className:"muted"},l10n.t("contact_status_loading")):(e=r.createElement(o,{direction:"auto",ellipsify:!0,text:this.state.status}),t=this.state.status),r.createElement("div",{className:"chat-status",title:t},e)}});e.exports=c},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1354),s=i(a),r=n(8),o=n(10),l=n(94),c=n(93),u=r.createClass({displayName:"ChatActionListener",mixins:[l],componentWillMount:function(){this.regCmd("chat_info_drawer",this.onChatInfoDrawer),this.regCmd("msg_info_drawer",this.onMsgInfoDrawer),this.regCmd("chat_search",this.onChatSearch),this.regCmd("attach_media_drawer",this.onAttachMediaDrawer),this.regCmd("verification_drawer",this.onVerificationDrawer),this.regCmd("media_viewer_modal",this.onMediaViewer)},onChatInfoDrawer:function(e){var t=n(1455);o.openDrawerRight(r.createElement(t,{chat:e}),"slide-left",this.context.uim)},onVerificationDrawer:function(e){var t=n(1629);o.openDrawerRight(r.createElement(t,{contact:Store.Contact.get(e),isFirstLevel:!0}),"slide-left",this.context.uim)},onMsgInfoDrawer:function(e){if(e.chat.kind===s["default"].KIND.CHAT){var t=n(1597);o.openDrawerRight(r.createElement(t,{msg:e}),"slide-left",this.context.uim)}else{var i=n(1607);o.openDrawerRight(r.createElement(i,{msg:e}),"slide-left",this.context.uim)}},onAttachMediaDrawer:function(e,t,i){var a=this;o.existsDrawerMid(function(s){if(!s){var l=n(1575),c=i||{};c.noFocus=!0,o.openDrawerMid(r.createElement(l,{chat:e,files:t}),"slide-up",a.context.uim,c)}})},onChatSearch:function(e){var t=n(1459);o.openDrawerRight(r.createElement(t,{chat:e}),"slide-left",this.context.uim)},onMediaViewer:function(e,t,i){if(Store.Msg.get(e.id)){var a=n(1580);o.openModalMedia(r.createElement(a,{msg:e,startTime:i,getZoomNode:t}),"media-viewer",this.context.uim)}else{var s=n(1382);o.openModal(r.createElement(s,{msg:e}))}},render:function(){return null}});u.contextTypes={uim:r.PropTypes.instanceOf(c)},e.exports=u},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(23),s=i(a),r=n(8),o=n(157),l=n(1365),c=n(153),u=n(1355),d=n(109),p=r.createClass({displayName:"ChatSelectorFooter",mixins:[c],propTypes:{selections:r.PropTypes.instanceOf(l).isRequired,onForward:r.PropTypes.func.isRequired},componentWillMount:function(){this.addObserver(this.props.selections,"all")},render:function(){var e=void 0;return s["default"].size(this.props.selections.getSelected())>0&&(e=r.createElement("div",{className:"drawer-controls-summary"},r.createElement(h,{chats:this.props.selections.getSelected()}),r.createElement("button",{className:"btn btn-round btn-l btn-action",onClick:this.props.onForward},r.createElement("span",{className:"icon icon-send-light"})))),r.createElement(d,{transitionName:"slide-up-down-footer",className:"drawer-controls-container"},e)}}),h=r.createClass({displayName:"SelectedChatsList",propTypes:{chats:r.PropTypes.array.isRequired},getInitialState:function(){return{chats:this.props.chats}},componentWillReceiveProps:function(e){var t=this.state.chats,n=e.chats;t=s["default"].size(n)>s["default"].size(t)?t.concat(s["default"].difference(n,t)):s["default"].intersection(t,n),this.setState({chats:t})},render:function(){var e=s["default"].map(this.state.chats,function(e){var t=e.isGroup?e.formattedTitle:e.formattedShortNameWithNonBreakingSpaces;return r.createElement(u,{text:t,className:"list-comma-item",key:e.id})});return o.isRTL()||e.reverse(),r.createElement(d,{transitionName:"pop",className:"drawer-controls-summary-text"},e)}});e.exports=p},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(114),s=i(a),r=n(1366),o=i(r),l=n(1390),c=i(l),u=n(1354),d=i(u),p=n(1499),h=i(p),f=n(110),m=i(f),g=n(8),v=n(44),y=n(10),E=n(1402),b=n(153),C=n(94),M=n(154),S=n(1372),T=n(229),w=n(9),k=n(1376),P=n(75),N=g.createClass({displayName:"Chatlist",mixins:[b,C,M],propTypes:{isSearching:g.PropTypes.bool,searchText:g.PropTypes.string,chats:g.PropTypes.array,contacts:g.PropTypes.array,ftsResult:g.PropTypes.array,onClick:g.PropTypes.func,selection:g.PropTypes.instanceOf(S),onFocusSearch:g.PropTypes.func},getDefaultProps:function(){return{chats:[]}},getInitialState:function(){var e=this;this._listPointerEvents=!0,this.debouncedOpenSelected=_.debounce(function(){e.openSelected(e.focusComposer),e.focusComposer=!1},200);var t;return t=0,{textsize:t}},componentWillMount:function(){this.props.selection.init(this.getSelection())},componentWillUnmount:function(){var e=this.getSelection(),t=this.props.selection.getVal();t&&t.isState&&!this.props.isSearching&&!e.length&&y.clearChat(t)},componentDidMount:function(){var e=this;this.regCmd("focus_chat_list",this.restoreFocus),this.regCmd("focus_next_chat",this.onNextChat.bind(this,null,!0)),this.regCmd("focus_prev_chat",this.onPrevChat.bind(this,null,!0)),this.regCmd("update_chatlist_selection",this.updateSelected),this.regCmd("textsize_change",function(t){e.setState({textsize:t})})},componentDidUpdate:function(e,t){var n=this.props.selection.getVal();this.props.selection.init(this.getSelection(),!e.isSearching&&!this.props.isSearching),n!==this.props.selection.getVal()&&(this.focusComposer=!0,this.debouncedOpenSelected())},onListPointerEventsOff:function(){this._listPointerEvents=!1},onListPointerEventsOn:function(){this._listPointerEvents=!0},updateSelected:function(e){this.debouncedOpenSelected.cancel(),this.props.selection.setVal(e,!1)},openSelected:function(){var e=!(arguments.length<=0||void 0===arguments[0])&&arguments[0],t=this.props.selection.getVal();t&&(t instanceof d["default"]&&t!==this.getActiveChat()?y.openChatFromUnread(t).then(function(n){n&&e&&y.focusChatTextInput(t)}):e&&y.focusChatTextInput(t))},onClick:function(e,t,n){var i=this;e.preventDefault(),e.stopPropagation(),Store.Chat.find(t.id).then(function(e){i.props.isSearching&&i.props.onClick&&i.props.onClick(),n?y.openChatAt(e,n).then(function(t){t&&y.focusChatTextInput(e)}):e!==i.getActiveChat()?y.openChatFromUnread(e).then(function(t){t&&y.focusChatTextInput(e)}):y.focusChatTextInput(e)})},getSelection:function(){return[].concat((0,s["default"])(this.props.chats),(0,s["default"])(this.props.contacts),(0,s["default"])(this.getFTSStarred()),(0,s["default"])(this.getFTSMessages()))},getFTSStarred:function(){return _.filter(this.props.ftsResult,{star:!0})},getFTSMessages:function(){return _.filter(this.props.ftsResult,{star:!1})},getList:function(){for(var e=this.props,t=e.chats,n=e.contacts,i=[],a=0;a<t.length;a++){var s=t[a];s&&(this.props.isSearching&&0===a&&i.push(g.createElement(E,{key:"chat-header",header:l10n.t("web_chats")})),i.push(g.createElement(c["default"],{chat:s,mode:l.Mode.LAST,searchText:this.props.searchText,onClick:this.onClick,mouseDownAsClick:!0,active:this.props.selection,key:s.id})))}for(var r=0;r<n.length;r++){var o=n[r];o&&(0===r&&i.push(g.createElement(E,{key:"contact-header",header:l10n.t("web_contacts")})),i.push(g.createElement(k,{contact:o,active:this.props.selection,searchText:this.props.searchText,onClick:this.onClick,mouseDownAsClick:!0,key:o.id})))}if(P.supportsFeature(P.F.FULL_TEXT_SEARCH)){for(var u=this.getFTSStarred(),d=0;d<u.length;d++){var p=u[d];0===d&&i.push(g.createElement(E,{key:"fts-header-starred",header:l10n.t("web_starred_messages")})),i.push(g.createElement(h["default"],{msg:p,searchText:this.props.searchText,onClick:this.onClick,active:this.props.selection,key:p.id.toString()}))}for(var f=this.getFTSMessages(),m=0;m<f.length;m++){var v=f[m];0===m&&i.push(g.createElement(E,{key:"fts-header-messages",header:l10n.t("web_messages")})),i.push(g.createElement(h["default"],{msg:v,searchText:this.props.searchText,onClick:this.onClick,active:this.props.selection,key:v.id.toString()}))}}return i},restoreFocus:function(){this.props.selection.reset()},onFocusGain:function(e){var t=this.refs.uie;t&&t.activate(),e.target===v.findDOMNode(this)&&this._listPointerEvents&&(this.props.selection.index<0?this.focusFirst():this.props.selection.reset())},focusFirst:function(){this.props.selection.setFirst(),this.debouncedOpenSelected()},onNextChat:function(e,t,n){e&&(e.preventDefault(),e.stopPropagation());var i=this.props.selection.next();this.props.selection.index!==i&&(this.props.selection.setNext(),this.focusComposer=n,this.debouncedOpenSelected())},onPrevChat:function(e,t,n){e&&(e.stopPropagation(),e.preventDefault());var i=this.props.selection.prev();i>-1?(this.props.selection.setPrev(),this.focusComposer=n,this.debouncedOpenSelected()):t||(this.debouncedOpenSelected.cancel(),this.openSelected(),this.props.onFocusSearch())},render:function(){var e=this,t={down:function(t){return e.onNextChat(t)},up:function(t){return e.onPrevChat(t)}},n=72,i=_.find(w.LIST_HEIGHT_TEXTSIZE_MAP,function(t){return t.scale===e.state.textsize});return i&&(n=i.height),g.createElement(T,{displayName:"Chatlist",ref:"uie",state:T.State.PASSIVE,requestFocus:function(){return e.props.selection.reset(!1)}},g.createElement(m["default"],{handlers:t,onFocus:this.onFocusGain,"data-tab":3},g.createElement(o["default"],{className:"chatlist",data:this.getList(),height:n,animate:!0,extraItems:4,onPointerEventsOff:this.onListPointerEventsOff,onPointerEventsOn:this.onListPointerEventsOn})))},getActiveChat:function(){return _.find(Store.Chat.toArray(),{active:!0})}});e.exports=N},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1658),s=i(a),r=n(8),o=n(16),l=n(1464),c=n(454),u=n(1581),d=n(1582),p=n(1585),h=n(1590),f=n(1465),m=n(29),g=n(462),v=n(1369),y=n(1361),E=n(10),_=n(1356),b=n(156),C=n(9),M=n(1393),S=M.MenuBarItem,T=M.MenuBar,w=n(75),k=n(456),P=n(43),N=n(109),x="global_mute",D=r.createClass({displayName:"ChatlistHeader",mixins:[_,b],getDefaultProps:function(){return{muteId:x}},getInitialState:function(){return Store.Mute.globalMute(),{isMuted:this.async("muteId.Mute.isMuted")}},componentWillMount:function(){},onWindowFocus:function(){var e=this;this.setState({newlyFocused:!0}),this.safeDelay(function(){return e.setState({newlyFocused:!1})},100)},onMouseDown:function(){},onDrag:function(e){this.didDrag=!0},onClickCapture:function(e){},onNewChat:function(e){e.preventDefault(),E.openDrawerLeft(r.createElement(u,null))},onProfile:function(){E.openDrawerLeft(r.createElement(l,{id:Store.Conn.me}))},onUnmute:function(){Store.Mute.globalMute().unmute(),E.openToast(r.createElement(k,{msg:l10n.t("global_unmuted"),id:k.genId()}))},render:function(){var e=null;this.state.isMuted&&(e=r.createElement(S,{a8n:"menu-bar-unmute",icon:"dnd",title:l10n.t("global_unmute"),onClick:this.onUnmute,key:"btn-dnd"}));var t=null;w.supportsFeature(w.F.STATUS_V3_UI)&&(t=r.createElement(s["default"],null));var n=P("pane-list-user",{});return r.createElement("header",{className:"pane-header pane-list-header",onMouseDown:this.onMouseDown,onClickCapture:this.onClickCapture},r.createElement("div",{className:n},r.createElement(y,{id:Store.Conn.me,size:40,onClick:this.onProfile})),r.createElement("div",{className:"pane-list-controls"},r.createElement(T,{key:"chatlist-header"},r.createElement(N,{transitionName:"btn"},e,t,r.createElement(S,{a8n:"menu-bar-chat",icon:"chat",title:l10n.t("web_menuitem_new"),onClick:this.onNewChat}),r.createElement(S,{a8n:"menu-bar-menu",icon:"menu",title:l10n.t("menutitle_menu")},r.createElement(O,null))))))}});e.exports=D;var O=r.createClass({displayName:"ChatlistHeaderDropdown",getInitialState:function(){return{rememberMe:m.getRememberMe()}},onCreateGroup:function(){E.openDrawerLeft(r.createElement(d,null))},onProfile:function(){E.openDrawerLeft(r.createElement(l,{id:Store.Conn.me}))},onDisconnect:function(){var e=Store.Msg.some(function(e){return 0===e.ack&&e.local&&e.isSentByMe});return e?void E.openModal(r.createElement(c,{title:l10n.t("confirm_logout"),onOK:function(){return o.logout()},okText:l10n.t("menuitem_logout"),onCancel:function(){return E.closeModal()},cancelText:l10n.t("web_cancel")},l10n.t("some_of_your_messages_are_still_sending"))):o.logout()},onArchived:function(){E.openDrawerLeft(r.createElement(h,null))},onSettings:function(){E.openDrawerLeft(r.createElement(p,null))},onStarred:function(){E.openDrawerLeft(r.createElement(f,{starredMsgs:Store.AllStarredMsgs}))},render:function(){var e=w.supportsFeature(w.F.GROUP_CREATE)?r.createElement(v,{a8n:"mi-new-group menu-item",action:this.onCreateGroup,shortcut:"g"},l10n.t("web_menuitem_groupchat")):null,t=w.supportsFeature(w.F.STARRED)&&w.supportsFeature(w.F.FULL_TEXT_SEARCH)?r.createElement(v,{a8n:"mi-starred menu-item",action:this.onStarred},l10n.t("menuitem_starred")):null,n=l10n.t("menuitem_profile_status"),i=l10n.t("menuitem_profile");return r.createElement(g,{type:g.Type.DROPDOWN_MENU,flipOnRTL:!0,key:"ChatlistHeader",direction:{x:g.Direction.X.LEFT}},e,r.createElement(v,{a8n:"mi-profile-status menu-item",action:this.onProfile},C.STATUS_V2?n:i),r.createElement(v,{a8n:"mi-archived menu-item",action:this.onArchived},l10n.t("menuitem_archived")),t,r.createElement(v,{a8n:"mi-setting menu-item",action:this.onSettings},l10n.t("menuitem_settings")),r.createElement(v,{a8n:"mi-logout menu-item",action:this.onDisconnect,shortcut:"q"},l10n.t("menuitem_logout")))}})},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(110),s=i(a),r=n(8),o=n(1376),l=n(1372),c=r.createClass({displayName:"ParticipantList",propTypes:{contacts:r.PropTypes.array.isRequired,onDelete:r.PropTypes.func.isRequired,onFocusSearch:r.PropTypes.func.isRequired},getInitialState:function(){return this.selection=new l(this.props.contacts,function(e){return e.id}),null},componentWillReceiveProps:function(e){this.selection.init(e.contacts,!0)},focusLast:function(){_.size(this.props.contacts)&&this.selection.setLast()},focusPrev:function(e){e.preventDefault(),e.stopPropagation();var t=this.selection.prev();t>-1&&this.selection.setPrev()},focusNext:function(e){e.preventDefault(),e.stopPropagation();var t=this.selection.next();this.selection.index===t?(this.selection.unset(),this.props.onFocusSearch(e)):this.selection.setNext()},deleteContact:function(e){e.preventDefault(),e.stopPropagation();var t=_.find(this.props.contacts,this.selection.getVal());this.props.onDelete(e,t)},onParticipantClick:function(e,t){this.selection.setVal(t)},render:function(){var e=this,t=this.props.contacts;if(!t)return null;var n=_.size(this.props.contacts)?_.map(this.props.contacts,function(t){return r.createElement(o,{contact:t,active:e.selection,onDelete:e.props.onDelete,onClick:e.onParticipantClick,type:o.Type.SMALL,key:t.id})}):null,i={up:this.focusPrev,down:this.focusNext,backspace:this.deleteContact};i[l10n.LR("left","right")]=this.focusPrev,i[l10n.LR("right","left")]=this.focusNext;var a=r.createElement("ul",{ref:"list"},n);return r.createElement(s["default"],{handlers:i},a)}});e.exports=c},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1391),s=i(a),r=n(110),o=i(r),l=n(8),c=n(44),u=n(153),d=n(94),p=n(1360),h=n(1457),f=n(1504),m=n(1503),g=n(1370),v=n(155),y=n(1492),E=n(10),b=n(75),C=n(1411),M=n(12),S=n(1372),T=n(9),w=n(92),k=n(1476),P=n(43),N=n(1371),x=N.GetRef,D=n(1267),O=T.MIN_CHARS_FOR_FTS,R=l.createClass({displayName:"ChatlistPanel",mixins:[u,d,D,p,h],propTypes:{className:l.PropTypes.string},getInitialState:function(){var e=this;this.ftsMsgs=new k,this.fts=_.debounce(function(){e.pending=!1;var t=_.trim(e.searchText||"");C.multibyteLength(t)<O||(e._ftsPromise&&e._ftsPromise.cancel(),e._ftsPromise=e.ftsMsgs.search(t).checkpoint(e.rejectOnUnmount()).then(function(n){t===_.trim(e.searchText)&&e.setState({searching:!1},h.DD)})["catch"](M.Unmount,_.noop)["catch"](function(){e.pending||e.setState({searching:!1},h.DD)}))},750),this.selection=new S([],function(e){return e.id.toString()}),this.throttledFilteredChats=_.throttle(function(t){var n=e.getFilteredChats(t);e.setState({chats:n},h.DD,h.CD)},450,{leading:!1,trailing:!0}),this.throttledFilteredContacts=_.throttle(function(t){var n=e.getFilteredContacts(t);e.setState({contacts:n},h.DD,h.CD)},450,{leading:!1,trailing:!0}),this.searchText="";var t;return t=0,{searching:!1,chats:this.getFilteredChats(),contacts:this.getFilteredContacts(),textsize:t}},componentWillMount:function(){var e=this;this.addObserver(Store.Chat,"remove",function(t){if(e.searchText){var n=_.without(e.state.chats,t);n.length!==e.state.chats.length&&e.setState({chats:n})}else e.throttledFilteredChats.cancel(),e.setState({chats:e.getFilteredChats()})}),this.addObserver(Store.Contact,"remove",function(t){if(e.searchText){var n=_.without(e.state.contacts,t);n.length!==e.state.contacts.length&&e.setState({contacts:n})}else e.throttledFilteredContacts.cancel(),e.setState({contacts:e.getFilteredContacts()})}),this.addObserver(Store.Chat,"sort change:archive",function(){e.searchText||(e.throttledFilteredChats.cancel(),e.setState({chats:e.getFilteredChats()}))}),this.addObserver(Store.Contact,"sort",function(){e.searchText||(e.throttledFilteredContacts.cancel(),e.setState({contacts:e.getFilteredContacts()}))})},componentDidMount:function(){var e=this;this.addObserver(this.ftsMsgs,"reset msgs_update"),this.regCmd("focus_chat_search",this.onFocusSearch),this.regCmd("textsize_change",function(t){e.setState({textsize:t})})},componentDidUpdate:function(){this.shouldFTSSearch(this.refs.panel)&&(this.fts(),this.pending=!0,this.state.searching||this.setState({searching:!0}))},componentWillUnmount:function(){this.fts.cancel(),this.ftsMsgs["delete"](!0),this._ftsPromise&&this._ftsPromise.cancel(),this.throttledFilteredChats.cancel(),this.throttledFilteredContacts.cancel()},getFilteredContacts:function(e,t){if(!e)return[];e=l10n.accentFold(_.trim(e));var n=Store.Contact.getFilteredContacts();return n.filter(function(n){var i=n.searchMatch(e);if(!i)return!1;var a=Store.Chat.get(n.id);return!(!t&&a&&a.isVisible)})},getFilteredChats:function(e){return e=_.trim(e),e?(e=l10n.accentFold(e),Store.Chat.filter(function(t){return t.contact.searchMatch(e)&&t.isVisible})):Store.Chat.filter(function(e){return!e.archive&&e.isVisible})},fullTextSearch:function(e){var t=_.trim(e);C.multibyteLength(t)>=O&&b.supportsFeature(b.F.FULL_TEXT_SEARCH)?(this.fts(),this.pending=!0,this.state.searching||this.setState({searching:!0},h.DD)):(this.fts.cancel(),this.ftsMsgs.resetSearch(),this.ftsMsgs["delete"](),this._ftsPromise&&this._ftsPromise.cancel(),this.pending=!1,this.state.searching&&this.setState({searching:!1},h.DD))},shouldFTSSearch:function(e){if(!this.ftsMsgs.hasMoreMsgs||this.pending||this.state.searching||this.ftsMsgs.searchPromise||C.multibyteLength(this.searchText||"")<O)return!1;var t=_.last(e.children);return e.scrollHeight<e.clientHeight+t.scrollHeight},onSearch:function(e){if(!e)return void this.onStopSearch();var t=this.searchText;if(e!==t){var n={searchText:e};this.fullTextSearch(e),this.throttledFilteredChats(e),this.throttledFilteredContacts(e),this.searchText=e,this.setState(n,h.DD)}},onStopSearch:function(){this.fts.cancel(),this.ftsMsgs.resetSearch(),this.ftsMsgs["delete"](),this._ftsPromise&&this._ftsPromise.cancel(),this.searchText="",this.search&&this.search.setState({searchText:this.searchText}),this.throttledFilteredChats.cancel(),this.throttledFilteredContacts.cancel(),this.pending=!1,this.setState({chats:this.getFilteredChats(),contacts:this.getFilteredContacts(),searching:!1})},onFocusList:function(e){e.repeat||this.refs.chatlist&&this.search.isAtEnd()&&(e.preventDefault(),e.stopPropagation(),o["default"].flashFocus=Date.now(),this.refs.chatlist.focusFirst())},onOpenFirst:function(e){var t=this;e.preventDefault();var n=_.head(this.getFilteredChats(this.searchText))||_.head(this.getFilteredContacts(this.searchText));n&&Store.Chat.find(n.id).then(function(e){t.onStopSearch(),o["default"].flashFocus=Date.now(),E.openChatFromUnread(e).then(function(t){t&&E.focusChatTextInput(e)})})},onFocusSearch:function(e){var t=this;E.existsDrawerLeft(function(e){e||(o["default"].flashFocus=Date.now(),w.focus(t.search))})},indicateFocus:function(e){if(!(Date.now()-(o["default"].flashFocus||0)>200)){var t=c.findDOMNode(this.refs.input_hotkey);Velocity(t,"stop"),Velocity(t,{backgroundColor:["#fbfbfb","#D9F3FF"]},{duration:1600,easing:[.19,.69,.01,.99]})}},onScroll:function(e){this.handleScroll(e.target)},handleScroll:_.throttle(function(e){e.scrollTop+T.SCROLL_FUDGE>e.scrollHeight-e.clientHeight&&this.ftsMsgs.hasMoreMsgs&&!this.pending&&(this.fts(),this.pending=!0)},100),getEmptyChatlistState:function(e,t,n){return e.length||t.length||n.length?null:this.searchText?this.state.searching?l.createElement(g.Searching,null):l.createElement(g.Search,null):Store.Chat.some(function(e){return e.isVisible})?l.createElement(g.AllArchived,null):l.createElement(g.ListChats,null)},render:function(){var e=this,t=this.state,n=t.chats,i=t.contacts,a=this.ftsMsgs.models,r=this.getEmptyChatlistState(n,i,a);if(!r){var c=this.searchText?_.trim(this.searchText):null;r=l.createElement(m,{ref:"chatlist",chats:n,contacts:i,isSearching:!!this.searchText,searchText:c,ftsResult:a,selection:this.selection,onFocusSearch:this.onFocusSearch,onClick:this.onStopSearch})}var u,d={down:this.onFocusList,enter:this.onOpenFirst},p=this.ftsMsgs.hasMoreMsgs&&a.length?l.createElement("div",{className:"more",style:{alignSelf:"center"}},l.createElement(v,{stroke:6,size:24})):null,h=_.find(T.TEXTSIZE_CLASS_MAP,function(t){return t.scale===e.state.textsize});h&&(u=h.classname);var g=P("chatlist-panel",u,this.props.className),E=this.ftsMsgs.hasMoreMsgs&&a.length?this.onScroll:void 0;return l.createElement("div",{id:"side",className:g},l.createElement(f,{key:"ChatHeader"}),l.createElement(y,{key:"ButterBar"}),l.createElement(o["default"],{handlers:d,onFocus:this.indicateFocus,ref:"input_hotkey",className:"chatlist-panel-search"},l.createElement(s["default"],{ref:x("search",this),onSearch:this.onSearch,loading:this.state.searching})),l.createElement("div",{ref:"panel",className:"chatlist-panel-body",onScroll:E,id:"pane-side","data-list-scroll-container":!0},r,p))}});e.exports=R},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(114),s=i(a),r=n(2),o=i(r),l=n(15),c=i(l),u=n(5),d=i(u),p=n(6),h=i(p),f=n(19),m=i(f),g=n(18),v=i(g),y=n(47),E=i(y),_=n(10),b=n(8),C=n(44),M=n(463),S={duration:300,easing:[.1,.82,.25,1]},T=function(e,t){return e.map(function(e,n){return[t[n]===e,n]}).filter(function(e){var t=(0,E["default"])(e,1),n=t[0];return!n}).map(function(e){var t=(0,E["default"])(e,2),n=t[1];return n})},w=function(e,t){return T(e,t).filter(function(n){return e[n]&&!t[n]})},k=function(e,t){return T(e,t).filter(function(n){return!e[n]&&t[n]})},P=function(e){function t(){var e,n,i,a;(0,d["default"])(this,t);for(var s=arguments.length,r=Array(s),o=0;o<s;o++)r[o]=arguments[o];return n=i=(0,m["default"])(this,(e=(0,c["default"])(t)).call.apply(e,[this].concat(r))),i.containerHeight=0,i.childAnimations=[],i.state={children:i.props.children},i.pendingRemoval=[],a=n,(0,m["default"])(i,a)}return(0,v["default"])(t,e),(0,h["default"])(t,[{key:"getHeightChange",value:function(e,t){var n=this;return e.reduce(function(e,i){if(i<t)return e;var a=n.refs["animation-child-"+i];if(!a)return e;var s=C.findDOMNode(a);return s?e+s.clientHeight:e},0)}},{key:"animateElement",value:function(e,t,n,i){var a=this;this.childAnimations[e]||(this.childAnimations[e]=o["default"].resolve()),this.childAnimations[e].cancel();var s=n>0?[0,n]:[-n,0];return this.childAnimations[e]=this.childAnimations[e].then(function(){return M(t,{translateY:s},S)}).then(function(){return a.childAnimations[e]=o["default"].resolve()}).cancellable()["catch"](o["default"].CancellationError,function(){M(t,"finish",!0),t.style.transform=""}).then(function(){n>=0||(i.indexOf(e)===-1?t.style.transform="":t.style.opacity="0")})["finally"](function(){return _.setUiBusy(!1,"animation_group")}),this.childAnimations[e]}},{key:"transitionAffected",value:function(e,t){if(!e)return o["default"].resolve();for(var n=[],i=e.slice(-1),a=(0,E["default"])(i,1),s=a[0],r=0;r<=s;++r){var l=this.refs["animation-child-"+r];l&&n.push(this.animateElement(r,C.findDOMNode(l),(t?1:-1)*this.getHeightChange(e,r),e))}return o["default"].all(n)}},{key:"notifyHeightChange",value:function(e,t){e.length&&this.props.onHeightChange&&this.props.onHeightChange((t?1:-1)*this.getHeightChange(e,0))}},{key:"componentWillReceiveProps",value:function(e){for(var t,n=this,i=e.children,a=w(this.state.children,i),r=k(this.state.children,i),o=0;o<r.length;++o)_.setUiBusy(!0,"animation_group");if(!a.length)return this.setState({children:i});var l=a.filter(function(e){return n.pendingRemoval.indexOf(e)===-1});if(l.length){for(var c=0;c<l.length;++c)_.setUiBusy(!0,"animation_group");(t=this.pendingRemoval).push.apply(t,(0,s["default"])(l)),this.notifyHeightChange(a,!1),this.transitionAffected(a,!1).then(function(){n.pendingRemoval=n.pendingRemoval.filter(function(e){return l.indexOf(e)===-1}),n.setState({children:i})})}}},{key:"componentDidUpdate",value:function(e,t){var n=t.children,i=k(n,this.state.children);i.length&&(this.notifyHeightChange(i,!0),this.transitionAffected(i,!0))}},{key:"componentDidMount",value:function(){var e=this,t=this.state.children.reduce(function(t,n,i){var a=e.refs["animation-child-"+i];if(!a)return t;var s=C.findDOMNode(a);return s?(s.style.transform="translateY(0)",t+s.clientHeight):t},0);this.props.onHeightChange(t,!0)}},{key:"render",value:function(){var e=this.state.children,t=b.Children.map(e,function(e,t){return e?b.cloneElement(e,{ref:"animation-child-"+t}):e});return b.createElement("div",null,t)}}]),t}(b.Component);e.exports=P;
},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1354),s=i(a),r=n(8),o=n(1356),l=n(1369),c=r.createClass({displayName:"ArchiveMenuItem",mixins:[o],propTypes:{chat:r.PropTypes.instanceOf(s["default"]).isRequired,onArchive:r.PropTypes.func.isRequired},getInitialState:function(){return{archive:this.async("chat.archive")}},render:function(){var e=this.props.onArchive.bind(null,!this.state.archive);return r.createElement(l,{a8n:"mi-archive",action:e,shortcut:"a",key:"ArchiveMenuItem"},this.state.archive?l10n.t("unarchive_chat"):l10n.t("archive_chat"))}});e.exports=c},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(15),s=i(a),r=n(5),o=i(r),l=n(6),c=i(l),u=n(19),d=i(u),p=n(18),h=i(p),f=n(1368),m=i(f),g=n(1354),v=(i(g),n(453)),y=(i(v),n(1470)),E=(i(y),n(8)),_=n(9),b=n(23),C=n(10),M=n(1421),S=n(155),T=n(1370),w=(n(1365),function(e){function t(){var e,n,i,a;(0,o["default"])(this,t);for(var r=arguments.length,l=Array(r),c=0;c<r;c++)l[c]=arguments[c];return n=i=(0,d["default"])(this,(e=(0,s["default"])(t)).call.apply(e,[this].concat(l))),i.onScroll=function(e){i.handleScroll(e.target)},i.handleScroll=b.throttle(function(e){var t=i.props.docMsgs;t.hasDocBefore&&e.scrollTop+_.SCROLL_FUDGE>e.scrollHeight-e.clientHeight&&i.queryDocs(t.head())},100),i.onClickMsg=function(e,t){i.props.selectable&&void 0!==t?i.props.onMessageSelect(e,t):C.openChatAt(e.chat,e.chat.getSearchContext(e))},a=n,(0,d["default"])(i,a)}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"componentWillMount",value:function(){this.props.docMsgs.hasDocBefore&&this.queryDocs()}},{key:"componentDidMount",value:function(){this.props.listeners.add(this.props.docMsgs,"add remove reset"),this.props.listeners.add(this.props.docMsgs,"query_doc_before")}},{key:"queryDocs",value:function(e){var t=this,n=this.props.docMsgs;n.hasDocBefore&&this.props.listeners.uiIdle(function(){n.queryDocs(t.props.chat,e)})}},{key:"render",value:function(){var e=this,t=this.props.docMsgs,n=this.props.selectedMessages,i=t.map(function(t){return E.createElement(M,{key:t.id,ref:t.id.toString(),msg:t,multiMedia:!0,selectable:e.props.selectable,selectedMessages:n,onMessageSelect:e.props.onMessageSelect,onClickMsg:e.onClickMsg})});if(i.reverse(),t.queryDocBefore){if(0===i.length)return E.createElement(T.Loading,null);i.push(E.createElement("div",{className:"more",key:"spinner"},E.createElement(S,{stroke:6,size:24})))}return 0!==t.length||t.queryDocBefore||t.hasDocBefore?E.createElement("div",{onScroll:this.onScroll,className:"doc-gallery"},i):E.createElement(T.DocMsgs,null)}}]),t}(E.Component));e.exports=(0,m["default"])(w)},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(158),s=i(a),r=n(160),o=i(r),l=n(8),c=n(155),u=n(43),d=function(e){var t=e.className,n=e.children,i=(0,o["default"])(e,["className","children"]),a=u("doc-state",t);return l.createElement("div",(0,s["default"])({className:a},i),n)},p=function(e){var t=e.onClick;return l.createElement(d,{onClick:t||_.noop},l.createElement("span",{className:"icon doc-state-icon icon-audio-download"}))},h=function(){return l.createElement(d,null,l.createElement(c,{stroke:3,size:32}))},f=function(){return l.createElement(d,null,l.createElement("span",{className:"icon doc-state-icon icon-audio-cancel-noborder"},l.createElement(c,{stroke:3,size:32})))},m=function(){return l.createElement(d,null,l.createElement("span",{className:"icon doc-state-icon icon-audio-upload"}))};e.exports={Download:p,Pending:h,PendingCancel:f,Upload:m}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(230),s=i(a),r=n(8),o=n(44),l=n(154),c=n(235),u=n(43),d=r.createClass({displayName:"Draggable",mixins:[l],propTypes:{children:r.PropTypes.node.isRequired,padding:r.PropTypes.number.isRequired,start:r.PropTypes.shape({x:r.PropTypes.number,y:r.PropTypes.number}),scale:r.PropTypes.number,childSize:r.PropTypes.shape({width:r.PropTypes.number,height:r.PropTypes.number}),container:r.PropTypes.shape({width:r.PropTypes.number.isRequired,height:r.PropTypes.number.isRequired,x:r.PropTypes.number,y:r.PropTypes.number}),onStart:r.PropTypes.func,onDrag:r.PropTypes.func,onStop:r.PropTypes.func},getInitialState:function(){return{dragging:!1,x:0,y:0,scaledPadding:this.props.scale*this.props.padding,offsetX:0,offsetY:0}},componentDidMount:function(){this.updateContainer()},componentWillReceiveProps:function(e){e.scale!==this.props.scale||e.container.width!==this.props.container.width||e.container.height!==this.props.container.height?this.updateContainer(e,!0):this.updateContainer(e)},updateContainer:function(e,t){e=e||this.props;var n=e.container;if(n&&this.refs.draggable){var i,a=o.findDOMNode(this.refs.draggable),s=0===a.width&&e.childSize?e.childSize.width:a.width,r=0===a.height&&e.childSize?e.childSize.height:a.height,l=n.x?n.x:0,c=n.y?n.y:0,u=this.state.x,d=this.state.y,p=s*e.scale,h=r*e.scale,f=e.padding*e.scale;this.props.scale!==e.scale&&this.state.center?(i=this.state.center,u=n.width/2-i.x*p,d=n.height/2-i.y*h):i={x:(n.width/2-u)/p,y:(n.height/2-d)/h},u+f>l?u=l-f:u+p+f<l+n.width&&(u=l+n.width-p-f),d+f>c?d=c-f:d+h+f<c+n.height&&(d=c+n.height-h-f),this.setState({width:p,height:h,x:u,y:d,scaledPadding:f,center:i}),this.props.onStop&&t&&e.onStop(u,d)}},handleMouseDown:function(e){e.preventDefault(),this.setState({dragging:!0,offsetX:e.clientX-this.state.x,offsetY:e.clientY-this.state.y}),this.regNativeListener(window,"mousemove",this.handleMouseMove),this.regNativeListener(window,"mouseup",this.handleMouseUp),this.props.onStart&&this.props.onStart()},handleMouseUp:function(e){this.unregisterListeners(),this.setState({dragging:!1}),this.props.onStop&&this.props.onStop(this.state.x,this.state.y)},handleMouseMove:function(e){if(this.state.dragging){var t=e.clientX-this.state.offsetX,n=e.clientY-this.state.offsetY,i=this.props.container,a=i.x?i.x:0,s=i.y?i.y:0,r=this.state.scaledPadding;i&&((t+r>a||t+this.state.width+r<a+i.width)&&(t=this.state.x),(n+r>s||n+this.state.height+r<s+i.height)&&(n=this.state.y)),this.setState({x:t,y:n}),this.props.onDrag&&this.props.onDrag(t,n)}},render:function(){var e,t=this.props.scale?" scale("+this.props.scale+")":"",n=(e={},(0,s["default"])(e,c.prefix("transform"),"translate("+this.state.x+"px, "+this.state.y+"px)"+t),(0,s["default"])(e,"padding",this.props.padding+"px"),e);this.state.dragging||(n[c.prefix("transition")]="transform 200ms");var i=u("draggable",{dragging:this.state.dragging});return r.cloneElement(r.Children.only(this.props.children),{style:n,draggable:!0,ref:"draggable",className:i,onMouseDown:this.handleMouseDown})}});e.exports=d},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(159),s=i(a),r=n(8),o=n(9),l=o.ONE_BY_ONE_TRANS_GIF,c=n(43);e.exports=function(e){var t=e.emoji,n=e.size,i=void 0===n?"small":n,o=e.className,u=a.emojiMap[t];return u?r.createElement("img",{alt:t,draggable:!1,src:l,className:c(o,s["default"].getClasses(u,i))}):null}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(160),s=i(a),r=n(8),o=r.createClass({displayName:"IsolatedBlock",propTypes:{Component:r.PropTypes.string.isRequired},getDefaultProps:function(){return{Component:"span"}},render:function(){var e=this.props,t=e.Component,n=e.children,i=(0,s["default"])(e,["Component","children"]);return r.createElement(t,i,"​⁠​",n,"​⁠​")}});e.exports=o},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(15),s=i(a),r=n(5),o=i(r),l=n(6),c=i(l),u=n(19),d=i(u),p=n(18),h=i(p),f=n(1368),m=i(f),g=n(1354),v=(i(g),n(453)),y=(i(v),n(1471)),E=(i(y),n(8)),_=n(9),b=n(23),C=n(10),M=n(1421),S=n(1515),T=n(155),w=n(1370),k=(n(1365),function(e){function t(){var e,n,i,a;(0,o["default"])(this,t);for(var r=arguments.length,l=Array(r),c=0;c<r;c++)l[c]=arguments[c];return n=i=(0,d["default"])(this,(e=(0,s["default"])(t)).call.apply(e,[this].concat(l))),i.onScroll=function(e){i.handleScroll(e.target)},i.handleScroll=b.throttle(function(e){var t=i.props.linkMsgs;t.hasLinkBefore&&e.scrollTop+_.SCROLL_FUDGE>e.scrollHeight-e.clientHeight&&i.queryLinks(t.head())},100),i.onClickMsg=function(e,t){i.props.selectable&&void 0!==t?i.props.onMessageSelect(e,t):C.openChatAt(e.chat,e.chat.getSearchContext(e))},a=n,(0,d["default"])(i,a)}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"componentWillMount",value:function(){this.props.linkMsgs.hasLinkBefore&&this.queryLinks()}},{key:"componentDidMount",value:function(){this.props.listeners.add(this.props.linkMsgs,"add remove reset"),this.props.listeners.add(this.props.linkMsgs,"query_link_before")}},{key:"queryLinks",value:function(e){var t=this,n=this.props.linkMsgs;n.hasLinkBefore&&this.props.listeners.uiIdle(function(){n.queryLinks(t.props.chat,e)})}},{key:"render",value:function(){var e=this,t=this.props.linkMsgs,n=this.props.selectedMessages,i=t.reduce(function(t,i){return i.links.forEach(function(a,s){t.push(E.createElement(S,{key:i.id+"-"+s,msg:i,link:a,selectable:e.props.selectable,selectedMessages:n,onMessageSelect:e.props.onMessageSelect,onClickMsg:e.onClickMsg}))}),i.isLink&&t.push(E.createElement(M,{key:i.id,ref:i.id.toString(),msg:i,multiMedia:!0,selectable:e.props.selectable,selectedMessages:n,onMessageSelect:e.props.onMessageSelect,onClickMsg:e.onClickMsg})),t},[]);if(i.reverse(),t.queryLinkBefore){if(0===i.length)return E.createElement(w.Loading,null);i.push(E.createElement("div",{className:"more",key:"spinner"},E.createElement(T,{stroke:6,size:24})))}return 0!==t.length||t.queryLinkBefore||t.hasLinkBefore?E.createElement("div",{onScroll:this.onScroll,className:"link-gallery"},i):E.createElement(w.LinkMsgs,null)}}]),t}(E.Component));e.exports=(0,m["default"])(k)},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(15),s=i(a),r=n(5),o=i(r),l=n(6),c=i(l),u=n(19),d=i(u),p=n(18),h=i(p),f=n(8),m=i(f),g=n(1368),v=i(g),y=n(1446),E=i(y),_=n(1379),b=(i(_),n(1355)),C=i(b),M=n(43),S=i(M),T=n(1365),w=(i(T),n(109)),k=i(w),P=n(157),N=i(P),x=function(e){function t(e){(0,o["default"])(this,t);var n=(0,d["default"])(this,(0,s["default"])(t).call(this,e));n.mouseOver=function(){n.state.hover||n.setState({hover:!0})},n.mouseEnter=function(){n.state.hover||n.setState({hover:!0})},n.mouseLeave=function(){n.state.hover&&n.setState({hover:!1})},n.onSelectChange=function(e){n.state.selected!==e&&n.setState({selected:e})},n.onSelectClick=function(e){e&&e.stopPropagation(),n.props.onMessageSelect(n.props.msg,!n.state.selected)},n.onClick=function(){n.props.onClickMsg(n.props.msg,!n.state.selected)};var i=e.msg,a=e.selectedMessages;return n.state={hover:!1,selected:!!a&&a.isSelected(i)},n}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"componentDidMount",value:function(){this.props.selectedMessages&&this.props.listeners.add(this.props.selectedMessages,this.props.msg.id.toString(),this.onSelectChange)}},{key:"render",value:function(){var e=this.props,t=e.msg,n=e.link,i=null,a={wrapper:(0,S["default"])("starred-msg-wrapper",{hover:this.state.hover}),linkContainer:(0,S["default"])("message tail-override-left",{"message-out":t.isSentByMe,"message-in":!t.isSentByMe})};return m["default"].createElement("div",{className:a.wrapper,onClick:this.onClick,onMouseEnter:this.state.hover?null:this.mouseEnter,onMouseOver:this.state.hover?null:this.mouseOver,onMouseLeave:this.state.hover?this.mouseLeave:null},m["default"].createElement("div",{className:"msg"},m["default"].createElement(k["default"],{transitionName:"delay-leave"},i),m["default"].createElement("div",{className:a.linkContainer},m["default"].createElement("span",{className:"tail-container"}),m["default"].createElement("div",{className:"bubble message-text"},m["default"].createElement(E["default"],{title:n.url,canonicalUrl:n.domain}),m["default"].createElement(C["default"],{text:t.body,selectable:!0,dirMismatch:t.rtl!==N["default"].isRTL(),direction:t.dir,linkify:t.isTrusted(),mention:t.mentionMap(),format:!0,wbr:15})))))}}]),t}(m["default"].Component);e.exports=(0,v["default"])(x)},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(230),s=i(a),r=n(15),o=i(r),l=n(5),c=i(l),u=n(6),d=i(u),p=n(19),h=i(p),f=n(18),m=i(f),g=n(8),v=n(235),y=n(43),E=function(e){function t(e){(0,c["default"])(this,t);var n=(0,h["default"])(this,(0,o["default"])(t).call(this,e));return n.state={rendered:!1},n}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"componentDidMount",value:function(){this.setState({rendered:!0})}},{key:"render",value:function(){var e=this.props,t=e.children,n=e.rowNumber,i=e.rowHeight,a=e.zIndex,r=e.className,o=(0,s["default"])({zIndex:a,height:i},v.prefix("transform"),"translate3d(0, "+i*n+"px, 0)");return r=y(r,{"infinite-list-item":!0,"infinite-list-item-keyframe":!this.state.rendered,"infinite-list-item-transition":!0}),g.createElement("div",{className:r,style:o},t)}}]),t}(g.Component);e.exports=E},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1354),s=i(a),r=n(8),o=n(1356),l=n(1369),c=r.createClass({displayName:"MarkUnreadMenuItem",mixins:[o],propTypes:{chat:r.PropTypes.instanceOf(s["default"]).isRequired,onMarkUnread:r.PropTypes.func.isRequired},getInitialState:function(){return{unreadCount:this.async("chat.unreadCount")}},render:function(){var e=this.props.onMarkUnread.bind(null,!this.state.unreadCount);return r.createElement(l,{a8n:"mi-mark-as",action:e,shortcut:"r",key:"MarkUnreadMenuItem"},this.state.unreadCount?l10n.t("mark_read_chat"):l10n.t("mark_unread_chat"))}});e.exports=c},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(8),o=i(r),l=n(461),c=i(l),u=n(1511),d=i(u),p=n(162),h=i(p),f=n(9),m=i(f),g=n(43),v=i(g),y=n(109),E=i(y),_=n(1),b=i(_),C=200,M=1.3,S=2,T=140.5,w=80.5,k=350,P=o["default"].createClass({displayName:"PhotoEditor",propTypes:{img:o["default"].PropTypes.string.isRequired,id:o["default"].PropTypes.string,size:o["default"].PropTypes.shape({width:o["default"].PropTypes.number.isRequired,height:o["default"].PropTypes.number.isRequired}),className:o["default"].PropTypes.oneOfType([o["default"].PropTypes.string,o["default"].PropTypes.arrayOf(o["default"].PropTypes.string),o["default"].PropTypes.objectOf(o["default"].PropTypes.bool)]),onImageSet:o["default"].PropTypes.func.isRequired},getInitialState:function(){return{img:this.props.img,scale:1,left:T,top:w}},componentWillMount:function(){this.setImage(this.props.img)},componentWillReceiveProps:function(e){return!this.props.doneEditing&&e.doneEditing?void this.onCrop():void(this.props.img!==e.img&&this.setImage(e.img))},setImage:function(e){var t=this;c["default"].rotateAndResize(window.dataURLtoBlob(e),3*m["default"].IMG_MAX_EDGE,3*m["default"].IMG_MAX_EDGE,c["default"].DATA_URL|c["default"].CANVAS).then(function(e){var n=e.width,i=e.height,a=e.images,s=C/Math.min(n,i);t.setState({scale:s,minScale:s,left:T,top:w}),h["default"].loadImage(a.dataUrl).then(function(e){t.setState({img:e.src,imageSize:{width:e.width,height:e.height}})})["catch"](function(e){b["default"].error("PhotoEditor:loadImage failed to load image: "+e)()})})["catch"](function(e){b["default"].error("PhotoEditor:setImage failed to load image: "+e)()})},cropImage:function(){var e=this;if(!this.state.img)return s["default"].reject("Image missing from state");var t=this.state.img,n=this.getOffset(),i=this.state.scale,a=Math.abs((this.state.left-n.x)/i),r=Math.abs((this.state.top-n.y)/i),o=C/i,l=o;o>m["default"].MAX_PIC_SIDE?l=m["default"].MAX_PIC_SIDE:o<m["default"].MIN_PIC_SIDE&&(l=m["default"].MIN_PIC_SIDE);var u;return this.promise=new s["default"](function(n,i){c["default"].crop(t,a,r,o,o,l,l,c["default"].DATA_URL|c["default"].CANVAS).then(function(e){var t=e.images;return u=t.dataUrl,c["default"].crop(t.canvas,0,0,m["default"].PROF_PIC_THUMB_SIDE,m["default"].PROF_PIC_THUMB_SIDE,c["default"].DATA_URL)}).then(function(e){var t=e.images;n({thumb:t.dataUrl,full:u})})["catch"](i)["finally"](function(){e.promise=null})}),this.promise},onCrop:function(){var e=this;this.promise||this.cropImage().then(function(t){e.props.onImageSet(t.thumb,t.full)})["catch"](function(){e.setState({img:e.props.img,isEditing:!1})})},onZoomIn:function(){var e=this.state.scale*M;S<=e||this.setState({scale:e})},onZoomOut:function(){var e=this.state.scale/M;this.state.minScale>=e&&(e=this.state.minScale),this.setState({scale:e})},onMouseWheel:function(e){e.deltaY<-4?this.onZoomOut():e.deltaY>4&&this.onZoomIn()},onDragEnd:function(e,t){e+=this.state.scale*k,t+=this.state.scale*k,this.setState({left:e,top:t})},getOffset:function(){var e=T,t=w;return this.props.size&&(e=this.props.size.width/2-C/2,t=this.props.size.height/2-C/2),{x:e,y:t}},render:function(){var e,t=this.getOffset(),n={width:C,height:C,x:t.x,y:t.y};this.state.img&&this.state.imageSize&&(e=o["default"].createElement(d["default"],{ref:"img",container:n,onStop:this.onDragEnd,scale:this.state.scale,padding:k,childSize:this.state.imageSize},o["default"].createElement("img",{className:"avatar-original",src:this.state.img})));var i=o["default"].createElement("div",{className:"avatar-picker-controls",key:"zoom-controls"},o["default"].createElement("button",{className:"icon icon-plus",onClick:this.onZoomIn}),o["default"].createElement("button",{className:"icon icon-minus",onClick:this.onZoomOut})),a=(0,v["default"])("avatar-picker-editor",this.props.className);return o["default"].createElement("div",{className:a,onWheel:this.onMouseWheel},o["default"].createElement("div",{className:"avatar-editor",ref:"imageContainer",dir:"ltr"},o["default"].createElement("div",{className:"avatar-editor-body"},e)),o["default"].createElement("svg",{className:"svg-overlay",style:{position:"absolute"}},o["default"].createElement("defs",null,o["default"].createElement("mask",{id:"mask",x:0,y:0,width:this.props.size.width,height:this.props.size.height,style:{position:"absolute"}},o["default"].createElement("rect",{x:0,y:0,width:this.props.size.width,height:this.props.size.height,fill:"rgba(255, 255, 255, 0.7)"}),o["default"].createElement("circle",{cx:this.props.size.width/2,cy:this.props.size.height/2,r:100,style:{position:"absolute"}}))),o["default"].createElement("rect",{x:0,y:0,width:this.props.size.width,height:this.props.size.height,mask:"url(#mask)",fillOpacity:.7,style:{position:"absolute"}})),o["default"].createElement(E["default"],{transitionName:"fade",style:{left:this.state.left,top:this.state.top}},i))}});e.exports=P},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){return function(n){e.some(function(e){var i=(0,r["default"])(e,2),a=i[0],s=i[1],o=s.call(a,n,t);return!!n.defaultPrevented||o===!0&&(n.preventDefault&&n.preventDefault(),n.stopPropagation&&n.stopPropagation(),!0)})}}var s=n(47),r=i(s),o=n(21),l=i(o);e.exports=function(e,t){var n=e.reduce(function(e,t){var n=t.handlers;return n?((0,l["default"])(n).forEach(function(i){e[i]||(e[i]=[]),e[i].push([t,n[i]])}),e):e},{});return(0,l["default"])(n).reduce(function(e,i){return e[i]=a(n[i],t),e},{})}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){return function(){for(var n=arguments.length,i=Array(n),a=0;a<n;a++)i[a]=arguments[a];e.forEach(function(e){var n=(0,r["default"])(e,2),a=n[0],s=n[1];return s.call.apply(s,[a].concat(i,[t]))})}}var s=n(47),r=i(s),o=n(21),l=i(o);e.exports=function(e,t){var n=e.reduce(function(e,t){var n=t.hooks;return n?((0,l["default"])(n).forEach(function(i){e[i]||(e[i]=[]),e[i].push([t,n[i]])}),e):e},{});return(0,l["default"])(n).reduce(function(e,i){return e[i]=a(n[i],t),e},{})}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){return function(n){e.some(function(e){var i=(0,r["default"])(e,2),a=i[0],s=i[1],o=s.call(a,n,t);return!!n.defaultPrevented||o===!0&&(n.preventDefault&&n.preventDefault(),n.stopPropagation&&n.stopPropagation(),!0)})}}var s=n(47),r=i(s),o=n(21),l=i(o);e.exports=function(e,t){var n=e.reduce(function(e,t){var n=t.hotkeys;return n?((0,l["default"])(n).forEach(function(i){e[i]||(e[i]=[]),e[i].push([t,n[i]])}),e):e},{});return(0,l["default"])(n).reduce(function(e,i){return e[i]=a(n[i],t),e},{})}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){return e.msMatchesSelector?e.msMatchesSelector(t):e.webkitMatchesSelector?e.webkitMatchesSelector(t):e.matches(t)}function s(e,t){for(var n=0;n<t.length;++n){var i=t[n].serializers;if(i)for(var s=0;s<i.length;++s){var r=(0,l["default"])(i[s],2),o=r[0],c=r[1];if(a(e,o))return c}}return null}function r(e,t){for(var n=[],i=e.cloneNode(!0),a=i.firstChild;a;){switch(a.nodeType){case 1:var r=s(a,t);if(r){n.push(r(a));break}switch(a.tagName){case"P":case"BR":case"PRE":case"DIV":n.push("\n")}case 3:n.push(a.nodeValue)}if(a.hasChildNodes())a=a.firstChild;else{for(;a&&!a.nextSibling;)if(a=a.parentNode,a===e){a=null;break}a&&(a=a.nextSibling)}}return n.join("")}var o=n(47),l=i(o);e.exports=r},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){return t.reduce(function(e,t){var n=t.parsers;return n?n.reduce(function(e,t){return t(e)},e):e},r["default"].escape(e))}var s=n(23),r=i(s);e.exports=a},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(158),s=i(a),r=n(15),o=i(r),l=n(5),c=i(l),u=n(6),d=i(u),p=n(19),h=i(p),f=n(18),m=i(f),g=n(8),v=function(e,t){var n,i;return i=n=function(n){function i(){return(0,c["default"])(this,i),(0,h["default"])(this,(0,o["default"])(i).apply(this,arguments))}return(0,m["default"])(i,n),(0,d["default"])(i,[{key:"render",value:function(){return g.createElement(e,(0,s["default"])({},this.props,t))}}]),i}(g.Component),n.displayName="Wrapper("+(e.displayName||e.name)+")",i};e.exports=v},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(15),s=i(a),r=n(5),o=i(r),l=n(19),c=i(l),u=n(18),d=i(u),p=n(1527),h=i(p),f=n(1532),m=i(f),g=n(1526),v=i(g),y=n(1535),E=i(y),_=n(1534),b=i(_),C=n(1524),M=i(C),S=function(e){function t(){return(0,o["default"])(this,t),(0,c["default"])(this,(0,s["default"])(t).apply(this,arguments))}return(0,d["default"])(t,e),t}((0,v["default"])([h["default"],m["default"],E["default"]]));S.Suggestions=(0,M["default"])(b["default"],{plugin:m["default"]}),e.exports=S},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e){return{handlers:s(e,G)}}function s(e,t){return t.reduce(function(t,n){return Array.isArray(n)?t[n[0]]=e[n[1]]:t[n]=e[n],t},{})}function r(e){return e.which===L&&(e.getModifierState("Shift")||e.getModifierState("Alt")||e.getModifierState("Control"))}function o(e,t,n){var i={};return n.forEach(function(n){return i[n]=e[n]!==t[n]}),i}var l=n(114),c=i(l),u=n(158),d=i(u),p=n(15),h=i(p),f=n(5),m=i(f),g=n(6),v=i(g),y=n(19),E=i(y),_=n(18),b=i(_),C=n(110),M=i(C),S=n(1415),T=n(1410),w=n(92),k=n(1441),P=n(8),N=n(1519),x=n(1520),D=n(1521),O=n(43),R=n(1522),I=n(1440),A=n(1523),L=13,F=function(e){function t(){var e,n,i,a;(0,m["default"])(this,t);for(var s=arguments.length,r=Array(s),o=0;o<s;o++)r[o]=arguments[o];return n=i=(0,E["default"])(this,(e=(0,h["default"])(t)).call.apply(e,[this].concat(r))),U.call(i),a=n,(0,E["default"])(i,a)}return(0,b["default"])(t,e),(0,v["default"])(t,[{key:"replaceSelection",value:function(e){if(!this.props.readOnly){var t=this.refs.input;this._hasFocus(t)||(w.focus(t),this.selection&&this.restoreSelection(this.selection));var n=this.trimToFit(e);if(n.length){this.props.multiline||(n=n.replace(/\r?\n/g,"")),window.getSelection().getRangeAt(0).deleteContents();var i=t.scrollTop,a=t.scrollHeight;document.execCommand("insertHTML",!1,A(n,this.plugins)),this.onSelect();var s=t.scrollHeight,r=t.clientHeight;s<=r||(t.scrollTop=(i||0)+(s-a))}}}},{key:"restoreSelection",value:function(e){var t=this.refs.input;if(t){var n=e.anchorIndex,i=e.focusIndex,a=e.anchorOffset,s=e.focusOffset,r=t.childNodes,o=n===-1?t:r[n],l=i===-1?t:r[i];if(o&&l)try{if(o===l&&a>s){var c=[s,a];a=c[0],s=c[1]}var u=document.createRange();u.setStart(o,a),u.setEnd(l,s);var d=window.getSelection();d.removeAllRanges(),d.addRange(u)}catch(p){this.focus(!0)}}}},{key:"getSelection",value:function(){var e=this.refs.input;if(!e||document.activeElement!==e)return null;for(var t=window.getSelection(),n=t.anchorNode,i=t.anchorOffset,a=t.focusNode,s=t.focusOffset,r=e.childNodes,o=-1,l=-1,c=0,u=void 0;(o<0||l<0)&&(u=r[c++]);)n===u&&(o=c-1),a===u&&(l=c-1);return{anchorIndex:o,anchorOffset:i,focusIndex:l,focusOffset:s}}},{key:"trimToFit",value:function(e){var t=this.props.maxLength;if(!t)return e;var n=this.selectionLength,i=this.length,a=t+n-i;if(a<=0)return"";var s=I(String(e));return s.slice(0,a).join("")}},{key:"render",value:function(){var e=this.props.placeholder,t=this.state.value,n=t.length?"hidden":"visible",i=A(t,this.plugins);return P.createElement(M["default"],{className:"input-emoji",handlers:this.hotKeyMap},P.createElement("div",{className:"input-placeholder",ref:"placeholder",style:{visibility:n}},e),P.createElement("div",(0,d["default"])({},this.handlerMap,{className:O(this.props.className),contentEditable:!this.props.readOnly,dangerouslySetInnerHTML:{__html:i},"data-tab":this.props.readOnly?null:1,dir:"auto",ref:"input",spellCheck:this.props.spellCheck})))}},{key:"value",get:function(){return this.state.value}},{key:"selectionLength",get:function(){if(this.props.readOnly)return 0;var e=this.refs.input;this._hasFocus(e)||w.focus(e);var t=window.getSelection();return t.rangeCount?I(R(t.getRangeAt(0).cloneContents(),this.plugins)).length:0}},{key:"length",get:function(){return I(this.state.value).length}},{key:"isComposing",get:function(){return this.__isComposing}}]),t}(P.Component),U=function(){var e=this;this.__changeDueToReset=!1,this.__isMounted=!0,this.__isComposing=!1,this.selection=this.props.initialSelection,this.state={value:this.props.initialValue||""},this.trigger=function(t){var n=arguments.length<=1||void 0===arguments[1]?[]:arguments[1],i=e.hookMap[t];i&&i.apply(void 0,(0,c["default"])(n))},this.serializeNode=function(t){return R(t,e.plugins)},this._hasFocus=function(){var t=arguments.length<=0||void 0===arguments[0]?e.refs.input:arguments[0];if(!t)return!1;var n=document,i=n.activeElement;return!!i&&(i===t||t.contains(i))},this.forceFocus=function(){var t=!(arguments.length<=0||void 0===arguments[0])&&arguments[0];if(!e.props.readOnly&&e.__isMounted){var n=e.refs.input;if(n){var i=e._hasFocus(n);if(!i||t)if(i||w.focus(n),!t&&e.selection)e.restoreSelection(e.selection);else{var a=window.getSelection();a&&a.rangeCount&&(a.selectAllChildren(n),a.collapseToEnd())}}}},this.focus=function(){var t=!(arguments.length<=0||void 0===arguments[0])&&arguments[0];return setTimeout(function(){e.forceFocus(t)},0)},this.reset=function(){e.__changeDueToReset=!0,e.selection=null,e.setState({value:""})},this.onSelect=function(){e.selection=e.getSelection(),e.props.onSelect&&e.props.onSelect(e.selection)},this.shouldComponentUpdate=function(t,n){var i=n.value,a=!i.length&&!!e.state.value.length,s=!!i.length&&!e.state.value.length;if(!s&&!a)return!1;var r=s?"hidden":"visible";return e.refs.placeholder&&e.refs.placeholder.setAttribute("style","visibility: "+r),a&&(e.refs.input.innerHTML=""),e.__changeDueToReset&&(e.__changeDueToReset=!1,e.refs.input&&(e.refs.input.innerHTML=A(i,e.plugins))),!1},this.componentWillReceiveProps=function(t){var n=o(e.props,t,["readOnly"]);n.readOnly&&e.refs.input.setAttribute("contentEditable",String(!t.readOnly))},this.componentWillUnmount=function(){e.__isMounted=!1,e.refs.input.restoreFocus=null},this.onInput=function(t){var n=R(e.refs.input,e.plugins),i="\n"===n?"":n,a=e.props.maxLength;if(a>0&&I(i).length>a){var s=e.selection;return e.refs.input.innerHTML=A(e.state.value,e.plugins),void(s&&e.restoreSelection(s))}e.setState({value:i},function(){e.trigger(k.CHANGE,[i]),e.props.onChange&&e.props.onChange(i)})},this.onPaste=function(t){t.preventDefault();var n=new T(t.clipboardData),i=e.props.onFiles;n.hasFiles()&&i&&i(n)||n.hasText()&&n.getText().then(function(t){if(t){if(I(t).length>e.props.maxLength){var n=e.props.onMaxPasteExceeded;return n&&n()}e.replaceSelection(t)}})},this.onBeforeInput=function(t){if(e.props.readOnly)return!0;var n=e.props.maxLength;if(!n)return!1;var i=t.data.charCodeAt(0);if(8===i||127===i)return!1;var a=e.selectionLength,s=e.length,r=n+a-s;return I(t.data).length>r},this.onKeyDown=function(t){return!(!e.props.onKeyDown||!e.props.onKeyDown(t))||t.which===L&&((!e.props.multiline||!r(t))&&(e.props.onEnter&&e.props.onEnter(t),!0))},this.componentDidMount=function(){e.refs.input.restoreFocus=e.focus,e.trigger(k.MOUNT)},this.onBlur=function(t){return e.props.onBlur&&e.props.onBlur(t)},this.onFocus=function(t){e.props.onFocus&&e.props.onFocus(t)},this.onCompositionStart=function(t){return!(e.__isComposing=!0)},this.onCompositionEnd=function(){return e.__isComposing=!1}};e.exports=function(e){var t=function(t){function n(){var t,i,s,r;(0,m["default"])(this,n);for(var o=arguments.length,l=Array(o),u=0;u<o;u++)l[u]=arguments[u];return i=s=(0,E["default"])(this,(t=(0,h["default"])(n)).call.apply(t,[this].concat(l))),s.plugins=[].concat((0,c["default"])(e.map(function(e){return e instanceof S&&e.initialize(s),e})),[a(s)]),s.handlerMap=N(s.plugins,s),s.hookMap=x(s.plugins,s),s.hotKeyMap=D(s.plugins,s),r=i,(0,E["default"])(s,r)}return(0,b["default"])(n,t),n}(F);return t};var G=["onBeforeInput","onBlur","onCompositionEnd","onCompositionStart","onFocus","onInput","onKeyDown","onPaste","onSelect"]},function(e,t,n){"use strict";var i=n(159),a=i.emojiRegex,s=i.emojiMap,r=n(9),o=r.ONE_BY_ONE_TRANS_GIF,l=a(),c={serializers:[["img.emoji",function(e){return e.getAttribute("alt")||""}]],parsers:[function(e){return e.replace("️","")},function(e){return e.replace(l,function(e,t){var n=s[t];if(!n)return"";var a=document.createElement("img");return a.setAttribute("alt",t),a.setAttribute("draggable","false"),a.setAttribute("class",i.getClasses(n)),a.setAttribute("src",o),a.outerHTML})}],handlers:{onBeforeInput:function(e,t){var n=e.data,i=l.exec(n);return!!i&&(t.replaceSelection(i[0]),!0)}}};e.exports=c},function(e,t,n){"use strict";var i=n(1400),a=n(1401),s=n(1394),r=a.Direction;e.exports=function(e,t){if(!s(e))return!1;var n=a(t,r.BACKWARD);if(!n||!n.getAttribute("data-mention-jid"))return!1;var o=i(t,n),l=window.getSelection();l.removeAllRanges();var c=document.createRange();return c.setStart(t,o),c.setEnd(t,o),l.addRange(c),!0}},function(e,t,n){"use strict";var i=n(1400),a=n(1401),s=n(1394),r=a.Direction;e.exports=function(e,t){if(!s(e))return!1;var n=a(t,r.FORWARD);if(!n||!n.getAttribute("data-mention-jid"))return!1;var o=i(t,n),l=window.getSelection();l.removeAllRanges();var c=document.createRange();return c.setStart(t,o+1),c.setEnd(t,o+1),l.addRange(c),!0}},function(e,t,n){"use strict";var i=n(1400),a=n(1401),s=n(1394),r=a.Direction,o=n(58),l=o.isGecko;e.exports=function(e,t){if(!l||!s(e))return!1;var n=a(t,r.BACKWARD);if(!n||!n.getAttribute("data-mention-jid"))return!1;var o=i(t,n),c=window.getSelection();c.removeAllRanges();var u=document.createRange();return u.setStart(t,o),u.setEnd(t,o+1),c.addRange(u),!0}},function(e,t,n){"use strict";var i=n(1400),a=n(1401),s=n(1394),r=a.Direction;e.exports=function(e,t){if(!s(e))return!1;var n=a(t,r.FORWARD);if(!n||!n.getAttribute("data-mention-jid"))return!1;var o=i(t,n),l=window.getSelection();l.removeAllRanges();var c=document.createRange();return c.setStart(t,o),c.setEnd(t,o+1),l.addRange(c),!0}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e){if(e.hasChildNodes())for(;e.childNodes.length;)e.removeChild(e.childNodes[0])}function s(e,t){if(!e.rangeCount)return null;var n=e.getRangeAt(0);if(!n.collapsed)return null;for(var i=0;i<5;++i)e.modify("extend","backward","word");
var a=e.getRangeAt(0).cloneContents(),s=t.serializeNode(a),l=D(F,s).pop();if(!l)return r(e,n);r(e,n);for(var c=l[0].length;c--;)e.modify("extend","backward","character");var u=S.findDOMNode(t.refs.input),d=u.querySelectorAll("span[data-mention-jid]");return o(e,d)?r(e,n):{original:n,range:e.getRangeAt(0),match:l}}function r(e,t){e.removeAllRanges(),e.addRange(t)}function o(e,t){var n=t.length;if(!n)return 0;for(var i=0,a=0;a<n;++a)e.containsNode(t[a],!0)&&++i;return i}var l=n(230),c=i(l),u=n(15),d=i(u),p=n(5),h=i(p),f=n(6),m=i(f),g=n(19),v=i(g),y=n(18),E=i(y),_=n(1415),b=n(1442),C=n(75),M=n(1441),S=n(44),T=n(237),w=T.dir,k=n(58),P=k.isGecko,N=k.isTrident,x=n(233),D=x.matchAll,O=n(1530),R=n(1531),I=n(1529),A=n(1528),L=/\u200B((\d+)@c\.us)\u200B/g,F=/(?:\B|^)@((?:[^\s@]+ ?){1,3}(?:[^\s@]+)?)?$/g,U={Enter:b.ENTER,Tab:b.TAB,ArrowUp:b.UP,ArrowDown:b.DOWN},G=function(e){function t(){var e,n,i,o,l;(0,h["default"])(this,t);for(var u=arguments.length,p=Array(u),f=0;f<u;f++)p[f]=arguments[f];return i=o=(0,v["default"])(this,(e=(0,d["default"])(t)).call.apply(e,[this].concat(p))),o.serializers=[["span[data-mention-jid]",function(e){return a(e),"​"+(e.getAttribute("data-mention-jid")||"")+"​"}]],o.parsers=[function(e){return e.replace(L,function(e,t,n){var i=window.Store.Contact.get(t);if(!i)return t;var a=!i.isMyContact&&i.notifyName?i.notifyName:i.formattedName,s=document.createElement("span");s.setAttribute("data-mention-jid",i.id);var r=document.createElement("span");r.setAttribute("class","at-symbol"),r.appendChild(document.createTextNode("@"));var o=document.createElement("span");return o.setAttribute("dir",w(a)||"auto"),o.appendChild(document.createTextNode(a)),s.appendChild(r),s.appendChild(o),s.outerHTML})}],o.hooks=(n={},(0,c["default"])(n,M.CHANGE,function(e,t){var n=t.refs.input;if(P)for(var i=n.querySelectorAll("[data-mention-jid]"),a=0;a<i.length;++a){var s=i[a].nextSibling;s&&s instanceof Element&&"BR"===s.tagName&&"_moz"===s.getAttribute("type")&&s.remove()}}),(0,c["default"])(n,M.MOUNT,function(e){for(var t=e.refs.input,n=t.querySelectorAll("[data-mention-jid]"),i=0;i<n.length;++i)n[i].setAttribute("contenteditable","false")}),n),o.handlers={onKeyDown:function(e,t){if(!this.ctx.isComposing){var n=t.refs.input,i=e.key;if("Backspace"===i&&O(e,n)||"Delete"===i&&R(e,n))return!1;if("ArrowRight"===i&&I(e,n)||"ArrowLeft"===i&&A(e,n))return!0}var a=U[e.key];return!!a&&this.handle(a,[e,t])},onBlur:function(){return this.handle(b.INACTIVE),!1},onSelect:function(e,t){var n=C.supportsFeature(C.F.MENTIONS_OUT);if(N||this.ctx.isComposing||!n)return!1;if(t.value.indexOf("@")<0)return this.handle(b.INACTIVE);var i=window.getSelection(),a=s(i,t);if(!a)return this.handle(b.INACTIVE);var o=a.original,l=a.match;return this.handle(b.SEARCH,[l[1]||""]),r(i,o),!1}},l=i,(0,v["default"])(o,l)}return(0,E["default"])(t,e),(0,m["default"])(t,[{key:"handleSelect",value:function(e,t){if(s(window.getSelection(),this.ctx)){this.ctx.replaceSelection("​"+e.id+"​ "),this.handle(b.INACTIVE);for(var n=this.ctx.refs.input,i=n.querySelectorAll("[data-mention-jid]"),a=0;a<i.length;++a)i[a].setAttribute("contenteditable","false")}}}]),t}(_);e.exports=new G},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(15),s=i(a),r=n(5),o=i(r),l=n(6),c=i(l),u=n(19),d=i(u),p=n(18),h=i(p),f=n(1361),m=n(1355),g=n(8),v=function(e){function t(){return(0,o["default"])(this,t),(0,d["default"])(this,(0,s["default"])(t).apply(this,arguments))}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"shouldComponentUpdate",value:function(e){return this.props.className!==e.className||this.props.contact!==e.contact||this.props.term!==e.term}},{key:"render",value:function(){var e=this.props,t=e.className,n=e.contact,i=n.id,a=n.formattedName,s=n.isMyContact,r=n.notifyName,o=e.onMouseDown,l=e.onMouseOver,c=e.onMouseUp,u=e.term;return g.createElement("div",{className:t,onMouseDown:o,onMouseUp:c,onMouseOver:l},g.createElement(f,{id:i,size:32,className:"mentions-result-image"}),g.createElement("div",{className:"mentions-result-text-contact",dir:"auto"},g.createElement(m,{text:a,highlight:u?[u]:null,highlightBounary:!0})),g.createElement("div",{className:"mentions-result-text-pushname",dir:"auto"},!s&&r?g.createElement(m,{text:r,highlight:u?[u]:null,highlightBounary:!0,className:"emoji-text"}):null))}}]),t}(g.Component);e.exports=v},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){return function(n,i){return!(!t.state.active||!t.state.results.length)&&(e.call(t,n,i),!0)}}function s(e,t){if(t.isMe)return!1;var n=[t.searchName||t.formattedName];return!t.isMyContact&&t.notifyName&&n.push(t.notifyName.toLowerCase()),n.some(function(t){return r(e,t)})}function r(e,t){var n=-1;do if(t.indexOf(e,n+1)===n+1)return!0;while((n=t.indexOf(" ",n+1))!==-1);return!1}var o=n(15),l=i(o),c=n(5),u=i(c),d=n(6),p=i(d),h=n(19),f=i(h),m=n(18),g=i(m),v=n(1366),y=i(v),E=n(1442),_=n(8),b=n(44),C=n(1533),M=n(229),S=n(109),T=n(43),w={active:!1,offset:0,omitted:"",query:"",results:[],scrollTop:0},k=52,P=function(e){function t(){var e,n,i,s;(0,u["default"])(this,t);for(var r=arguments.length,o=Array(r),c=0;c<r;c++)o[c]=arguments[c];return n=i=(0,f["default"])(this,(e=(0,l["default"])(t)).call.apply(e,[this].concat(o))),i.state=w,i.onEnter=a(function(){return i.handleSelect(i.state.offset)},i),i.onInactive=a(function(){return i.setState(w)},i),i.onSearch=function(e){var t=i,n=t.state.omitted;n&&e.startsWith(n)||i.props.chat&&i.props.chat.isGroup&&i.setState({active:!0,offset:0,omitted:null,query:e,results:i.getResults(e)})},i.onEscape=function(){i.setState({active:!1,offset:0,omitted:i.state.query,query:"",results:[]})},i.onUp=a(function(){var e=Math.max(i.state.offset-1,0);i.setOffset(e)},i),i.onDown=a(function(){var e=i.state.results.length-1,t=Math.min(i.state.offset+1,e);i.setOffset(t)},i),s=n,(0,f["default"])(i,s)}return(0,g["default"])(t,e),(0,p["default"])(t,[{key:"componentWillMount",value:function(){var e=this.props.plugin;e.registerHandler(E.ENTER,this.onEnter),e.registerHandler(E.TAB,this.onEnter),e.registerHandler(E.SEARCH,this.onSearch),e.registerHandler(E.INACTIVE,this.onInactive),e.registerHandler(E.UP,this.onUp),e.registerHandler(E.DOWN,this.onDown)}},{key:"componentWillUnmount",value:function(){var e=this.props.plugin;e.unregisterHandler(E.ENTER),e.unregisterHandler(E.TAB),e.unregisterHandler(E.SEARCH),e.unregisterHandler(E.INACTIVE),e.unregisterHandler(E.UP),e.unregisterHandler(E.DOWN)}},{key:"handleSelect",value:function(e){var t=this.state.results[e];if(t&&t.id){var n=this.props.chat.assignedColor(t.id);this.props.plugin.handleSelect(t,n)}}},{key:"getResults",value:function(e){var t=this.props.chat.groupMetadata.participants,n=t.models.map(function(e){var t=e.contact;return t}),i=(e||"").toLowerCase(),a=n.filter(function(e){return s(i,e)});return a}},{key:"setOffset",value:function(e){var t=!(arguments.length<=1||void 0===arguments[1])&&arguments[1],n=e*k,i=n+k,a=b.findDOMNode(this.refs.overflow),s=a.scrollTop,r=s+a.clientHeight,o={offset:e,scrollTop:s};t||(s>n?o.scrollTop=n:r<i&&(o.scrollTop+=i-r)),this.setState(o)}},{key:"renderList",value:function(e,t,n){var i=this;if(!e||!t.length)return null;var a=t.map(function(e,t){return _.createElement(C,{key:e.id,contact:e,term:n,ref:"mention-result-"+t,className:T("mentions-result",{selected:t===i.state.offset}),onMouseDown:function(e){return e.preventDefault()},onMouseUp:function(){return i.handleSelect(t)},onMouseOver:function(){return i.setOffset(t,!0)}})});return _.createElement(M,{displayName:"MentionSuggestions",escapable:!0,requestDismiss:this.onEscape},_.createElement("div",{className:"mentions-overlay-container"},_.createElement("div",{className:"mentions-results-container","data-list-scroll-container":"true",ref:"overflow"},_.createElement(y["default"],{data:a,height:k,scrollTop:this.state.scrollTop,animate:!1}))))}},{key:"render",value:function(){var e=this.state,t=e.query,n=e.results,i=e.active;return _.createElement(S,{component:"div",className:"mentions-positioning-container",transitionName:"slide-up"},this.renderList(i,n,t))}}]),t}(_.Component);e.exports=P},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(15),s=i(a),r=n(5),o=i(r),l=n(19),c=i(l),u=n(18),d=i(u),p=n(1415),h=i(p),f=n(10),m=i(f),g=n(1394),v=i(g),y=function(e){function t(){var e,n,i,a;(0,o["default"])(this,t);for(var r=arguments.length,l=Array(r),u=0;u<r;u++)l[u]=arguments[u];return n=i=(0,c["default"])(this,(e=(0,s["default"])(t)).call.apply(e,[this].concat(l))),i.handlers={onKeyDown:function(e){return!this.ctx.isComposing&&(!(" "!==e.key||!(0,v["default"])(e))&&(!this.ctx.value.length&&(m["default"].scrollMessages(),!0)))}},a=n,(0,c["default"])(i,a)}return(0,d["default"])(t,e),t}(h["default"]);t["default"]=new y},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(8),o=n(12),l=n(10),c=n(1369),u=n(1383),d=n(1577),p=n(1389),h=r.createClass({displayName:"TakePhotoMenuItem",propTypes:{onImageTake:r.PropTypes.func.isRequired},onCapture:function(){var e=this,t=new s["default"](function(n,i){navigator.getUserMedia({video:!0},function(i){l.closeModal(),n(i),t.isPending()||l.openModal(r.createElement(u,{type:u.BOX},r.createElement(d,{stream:i,onFinished:e.props.onImageTake,handleStreamClose:!1})))},function(e){var n=_.isString(e)?e:e.name,a=o.GUM[n]||o.GUM.GUMError;i(new a),t&&!t.isPending()&&l.closeModal()})}).timeout(1500,"waitForGUMTakePhotoTimeout").then(function(t){l.openModal(r.createElement(u,{type:u.BOX},r.createElement(d,{stream:t,onFinished:e.props.onImageTake,handleStreamClose:!1})))})["catch"](s["default"].TimeoutError,function(e){l.openModal(r.createElement(p,{title:"guide_desktop_camera_title",desc:"guide_desktop_camera_description",type:p.TYPE.GUIDE_ALLOW}))})["catch"](o.GUM.PermissionDeniedError,function(){l.openModal(r.createElement(p,{title:"guide_desktop_camera_title",desc:"guide_desktop_camera_fail_description",type:p.TYPE.GUIDE_UNBLOCK}))})["catch"](o.GUM.GUMError,function(){l.openModal(r.createElement(p,{title:"guide_desktop_camera_missing_title",desc:"guide_desktop_camera_missing_description",type:p.TYPE.GUIDE_NONE}))})},render:function(){return r.createElement(c,{action:this.onCapture,a8n:"mi-take-photo"},l10n.t("take_photo"))}});e.exports=h},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(158),s=i(a),r=n(160),o=i(r),l=n(8),c=n(10),u=n(93),d=l.createClass({displayName:"UIETooltip",propTypes:{tooltip:l.PropTypes.object.isRequired},componentDidMount:function(){var e=this,t=this.props.tooltip,n=t.menu,i=(0,o["default"])(t,["menu"]);c.openTooltip(n,(0,s["default"])({},i),this.context.uim,function(t){return e.element=t})},componentWillUnmount:function(){c.closeTooltip(this.context.uim)},getElement:function(){return this.element},render:function(){return null}});d.contextTypes={uim:l.PropTypes.instanceOf(u)},e.exports=d},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(112),s=i(a),r=n(8),o=n(44),l=n(94),c=n(154),u=n(153),d=n(156),p=n(1567),h=n(1589),f=n(12),m=n(9),g=n(10),v=void 0,y=r.createClass({displayName:"Conversation",mixins:[l,c,u,d],getInitialState:function(){return{chat:void 0,msgCollection:void 0,focusCtx:void 0}},componentWillMount:function(){this.regCmd("open_chat",this.handleOpenChat),this.regCmd("clear_chat",this.handleClearChat),this.regNativeListener(window,"focus",this.windowGainedFocus),this.regNativeListener(window,"blur",this.windowLostFocus)},componentDidMount:function(){var e=this.safeDebounce(this.windowResized,100);this.regNativeListener(window,"resize",e),e()},windowResized:function(){v=o.findDOMNode(this).clientHeight},shouldComponentUpdate:function(e,t){return t!==this.state||e.animate!==this.props.animate},componentDidUpdate:function(e,t){var n=this.state.chat,i=t.chat;n&&i!==n&&(this.addObserver(n,"change:cmc:merge",this.msgCollectionChanged),i&&this.removeObserver(i,"change:cmc:merge"))},msgCollectionChanged:function(e,t,n){var i=this.state.msgCollection;i!==e&&i!==t||this.setState({msgCollection:n})},windowGainedFocus:function(){s["default"].markAvailable();var e=this.state.chat;e&&e.isUser&&e.presence.subscribe()["catch"](f.WapDrop,_.noop)},windowLostFocus:function(){s["default"].markUnavailable(m.SEND_UNAVAILABLE_WAIT)},handleClearChat:function(e){this.state.chat===e&&this.setState({chat:void 0,msgCollection:void 0,focusCtx:void 0})},handleOpenChat:function(e,t,n){var i=this;g.updateChatlistSelection(e);var a=this.openedChatInfo,s={},r=function(e){_.assign(s,e)};this.state.chat!==e?this.setState({chat:e,msgCollection:t?t.collection:e.msgs,focusCtx:t,notifyChatRendered:function(){return n(i.newChatScrollInfo(a,t))},updateOpenedChatInfo:r}):this.setState({msgCollection:t?t.collection:e.msgs,focusCtx:t,notifyChatRendered:function(){return n(i.newChatScrollInfo(a,t))},updateOpenedChatInfo:r}),this.openedChatInfo=s},newChatScrollInfo:function(e,t){var n=t?t.msg||Store.Msg.get(t.key):void 0;if(t&&n&&e&&e.chat&&e.renderedMsgsInfo&&e.visibleMsgOrder&&!_.isEmpty(e.renderedMsgsInfo)&&!_.isEmpty(e.visibleMsgOrder)){var i=e.renderedMsgsInfo[_.head(e.visibleMsgOrder)],a=_.find(e.renderedMsgsInfo,function(e,t){return t===n.id.toString()});return a?{wasVisible:!0,offset:a.offset}:e.chat===n.chat?n.t<i.t?{wasVisible:!1,alignAt:"top"}:{wasVisible:!1,alignAt:"bottom"}:{wasVisible:!1,alignAt:"center"}}return{wasVisible:!1,alignAt:"center"}},render:function(){var e=this.state,t=e.chat,n=e.msgCollection,i=e.focusCtx;return t?r.createElement(p,{key:t.id,chat:t,msgCollection:n,height:v,focusCtx:i,notifyChatRendered:this.state.notifyChatRendered,updateOpenedChatInfo:this.state.updateOpenedChatInfo}):r.createElement("div",{className:"pane pane-two"},r.createElement(h,{animate:this.props.animate,className:"pane-body"}))}});e.exports=y},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(1354),o=i(r),l=n(1417),c=i(l),u=n(8),d=n(9),p=n(113),h=n(1356),f=n(1360),m=n(156),g=n(1447),v=n(1436),y=n(1361),E=n(1355),b=n(1576),C=n(1455),M=n(1459),S=n(10),T=n(1389),w=n(454),k=n(12),P=n(75),N=n(1393),x=N.MenuBar,D=N.MenuBarItem,O=n(462),R=n(1369),I=n(1443),A=n(1397),L=n(1425),F=n(93),U=u.createClass({displayName:"ConversationHeader",mixins:[h,f,m],propTypes:{chat:u.PropTypes.instanceOf(o["default"]).isRequired,onSelectMessages:u.PropTypes.func.isRequired,canAttach:u.PropTypes.bool.isRequired},statics:{ATTACH_MEDIA_ACTIVE:"attach_media_active",GROUP_CHAT_ACTIVE:"group_chat_active"},getInitialState:function(){return this.asyncState({img:"chat.ProfilePicThumb.img",formattedTitle:"chat.formattedTitle"},{activeDropdown:void 0})},componentWillMount:function(){},onWindowFocus:function(){var e=this;this.setState({newlyFocused:!0}),this.safeDelay(function(){return e.setState({newlyFocused:!1})},100)},onMouseDown:function(e){},onDrag:function(e){this.didDrag=!0},onClickCapture:function(e){},onClick:function(){var e=this.props.chat;!e.isPSA&&(e.isUser||e.isBroadcast||e.isGroup)&&S.openDrawerRight(u.createElement(C,{chat:e}),"slide-left",this.context.uim)},checkForDrawerMid:function(e){S.existsDrawerMid(function(t){t&&e.preventDefault()})},onChatSearch:function(e){e.preventDefault(),S.openDrawerRight(u.createElement(M,{chat:this.props.chat}),"slide-left",this.context.uim)},onCaptureClick:function(){var e=this,t=this.props.chat,n=A.start("camera");s["default"].race([n,this.rejectOnUnmount()]).bind(this).checkpoint(this.rejectOnUnmount()).then(function(n){S.openDrawerMid(u.createElement(b,{chat:t,stream:n}),"slide-up",e.context.uim,{noFocus:!0})})["catch"](k.Unmount,function(){n.then(function(e){return A.stop(e)})["catch"](_.noop)})["catch"](k.GUM.PermissionDeniedError,function(){S.openModal(u.createElement(T,{title:"guide_desktop_camera_title",desc:"guide_desktop_camera_fail_description",type:T.TYPE.GUIDE_UNBLOCK}))})["catch"](k.GUM.GUMError,function(){S.openModal(u.createElement(T,{title:"guide_desktop_camera_missing_title",desc:"guide_desktop_camera_missing_description",type:T.TYPE.GUIDE_NONE}))})},render:function(){var e,t,i=this.props.chat;i.isUser?(e=u.createElement(V,{chat:i,onSelectMessages:this.props.onSelectMessages}),t=u.createElement(c["default"],{presence:i.presence,chatstate:i.presence.chatstate,placeholder:l10n.t("click_here_for_user_info"),location:l.Location.TITLE})):i.isBroadcast?(e=u.createElement(B,{chat:i,onSelectMessages:this.props.onSelectMessages}),t=null):i.isGroup&&(e=u.createElement(j,{chat:i,onSelectMessages:this.props.onSelectMessages}),t=u.createElement(v,{presence:i.presence,groupMetadata:i.groupMetadata,placeholder:l10n.t("click_here_for_group_info"),location:"title"}));var a=n(75),s=a.supportsFeature(a.F.FTS_IN_CONV)?u.createElement(D,{a8n:"search-button",icon:"search-alt",title:l10n.t("search"),onClick:this.onChatSearch}):null,r=this.props.canAttach?u.createElement(D,{a8n:"conversation-clip",icon:"clip",title:l10n.t("menutitle_attach"),transitionName:"menu",onClick:this.checkForDrawerMid},u.createElement(G,{chat:i,onCaptureClick:this.onCaptureClick})):null,o="chat-avatar",d="chat-body",p="chat-title",h=null,f=i.contact&&i.contact.isVerified;return(i.isPSA||f)&&(i.isPSA&&(o+=" chat-psa",d+=" chat-psa"),p+=" chat-title-verified",h=u.createElement("span",{className:"icon-psa-verified"}),t=null),u.createElement("header",{className:"pane-header pane-chat-header",onClickCapture:this.onClickCapture,onMouseDown:this.onMouseDown},u.createElement("div",{className:o,onClick:this.onClick},u.createElement(y,{id:i.id,size:40})),u.createElement("div",{className:d,onClick:this.onClick},u.createElement("div",{className:"chat-main"},u.createElement("h2",{className:p,dir:"auto"},u.createElement(E,{text:i.title(),titlify:!0,ellipsify:!0}),h)),t),u.createElement("div",{className:"pane-chat-controls"},u.createElement(x,{key:"conversation-header"},s,r,u.createElement(D,{a8n:"conversation-menu",icon:"menu",title:l10n.t("menutitle_menu"),onClick:this.checkForDrawerMid},e))))}});U.contextTypes={uim:u.PropTypes.instanceOf(F)};var G=u.createClass({displayName:"AttachMenuDropdown",mixins:[f],propTypes:{chat:u.PropTypes.instanceOf(o["default"]).isRequired},canSendDocument:function(){return P.supportsFeature(P.F.ENC_DOC)},onDocumentPick:function(e){if(e){e.stopPropagation();var t=_.toArray(e.target.files);t.length&&(e.target.value="",this.canSendDocument()?S.attachMediaDrawer(this.props.chat,t):this.showCantSendDocument())}},onMediaPick:function(e){if(e){e.stopPropagation();var t=_.toArray(e.target.files);t.length&&(e.target.value="",S.attachMediaDrawer(this.props.chat,t))}},onMediaClick:function(e){e.preventDefault(),this.refs.mediaPicker.triggerInput()},onDocumentClick:function(e){e.preventDefault(),this.canSendDocument()?this.refs.docPicker.triggerInput():this.showCantSendDocument()},confirmContactSend:function(e){var t=this,n=void 0;n=this.props.chat.isUser?l10n.t("confirm_contact_send_chat",{name:e.formattedName,chat:this.props.chat.title()}):this.props.chat.isGroup?l10n.t("confirm_contact_send_group",{name:e.formattedName,chat:this.props.chat.title()}):l10n.t("confirm_contact_send_broadcast",{name:e.formattedName}),S.openModal(u.createElement(w,{key:"contact_confirm",onOK:function(){return t.sendContact(e)},onCancel:function(){return S.closeModal()}},n))},sendContact:function(e){this.props.chat.sendContact(e),S.closeModal()},onContactClick:function(e){e.preventDefault(),S.openModal(u.createElement(L,{key:"contacts",title:l10n.t("send_contact"),filter:Store.Contact.isFilteredContact,onCancel:function(){return S.closeModal()},onSelect:this.confirmContactSend}))},showCantSendDocument:function(e){var t;if(e instanceof k.InvalidMediaFileType)t=l10n.t("cannot_send_document_type_unsupported");else if(e instanceof k.MediaFileTooLarge)t=l10n.t("document_too_big",{maxSize:d.MAX_MEDIA_UPLOAD_SIZE/1024/1024+"MB"});else{var n=this.props.chat;t=n.isUser?l10n.t("cannot_send_document_to_contact_unsupported",{contact:n.title()}):l10n.t("cannot_send_document_to_group_unsupported",{group:n.title()})}S.openModal(u.createElement(w,{key:"doc_cant_send",onOK:S.closeModal.bind(S)},u.createElement(E,{text:t})))},onCaptureClick:function(){this.props.onCaptureClick()},render:function(){var e=u.createElement(I,{direction:"left",className:"tooltip-menu",body:l10n.t("attach_capture")}),t=navigator.getUserMedia?u.createElement(R,{tooltip:e,a8n:"mi-attach-camera",action:this.onCaptureClick},u.createElement("button",{className:"menu-icons-item"},u.createElement("div",{className:"icon-xl icon-camera"}))):null,n=void 0;if(P.supportsFeature(P.F.ENC_DOC)){var i=u.createElement(I,{direction:"left",className:"tooltip-menu",body:l10n.t("attach_document")});n=u.createElement(R,{tooltip:i,ref:"docPicker",a8n:"mi-attach-document",action:this.onDocumentClick,filePickerMimes:p.DOC_MIMES,onFilePick:this.onDocumentPick},u.createElement("button",{className:"menu-icons-item"},u.createElement("div",{className:"icon-xl icon-document"})))}var a=u.createElement(I,{direction:"left",className:"tooltip-menu",body:l10n.t("attach_media")}),s=u.createElement(R,{tooltip:a,ref:"mediaPicker",a8n:"mi-attach-media",filePickerMimes:[d.IMAGE_MIMES,d.VIDEO_MIMES].join(","),action:this.onMediaClick,onFilePick:this.onMediaPick},u.createElement("button",{className:"menu-icons-item"},u.createElement("div",{className:"icon-xl icon-image"}))),r=u.createElement(I,{direction:"left",className:"tooltip-menu",body:l10n.t("attach_vcard")}),o=u.createElement(R,{tooltip:r,a8n:"mi-attach-contact",action:this.onContactClick},u.createElement("button",{className:"menu-icons-item"},u.createElement("div",{className:"icon-xl icon-contact"})));return u.createElement("div",null,u.createElement(O,{type:O.Type.MENU,key:"AttachMenuDropdown"},s,t,n,o))}}),j=u.createClass({displayName:"GroupMenuDropdown",mixins:[h],propTypes:{chat:u.PropTypes.instanceOf(o["default"]).isRequired,onSelectMessages:u.PropTypes.func.isRequired},getInitialState:function(){return{isReadOnly:this.async("chat.isReadOnly")}},render:function(){var e=g.group(this.props.chat,this.props.onSelectMessages);return u.createElement(O,{type:O.Type.DROPDOWN_MENU,key:"GroupMenuDropdown",flipOnRTL:!0,direction:{x:O.Direction.X.LEFT}},e)}}),B=u.createClass({displayName:"BroadcastMenuDropdown",propTypes:{chat:u.PropTypes.instanceOf(o["default"]).isRequired,onSelectMessages:u.PropTypes.func.isRequired},render:function(){var e=g.broadcast(this.props.chat,this.props.onSelectMessages);return u.createElement(O,{type:O.Type.DROPDOWN_MENU,key:"BroadcastMenuDropdown",flipOnRTL:!0,direction:{x:O.Direction.X.LEFT}},e)}}),V=u.createClass({displayName:"ContactMenuDropdown",propTypes:{chat:u.PropTypes.instanceOf(o["default"]).isRequired,onSelectMessages:u.PropTypes.func.isRequired},render:function(){var e=g.contact(this.props.chat,this.props.onSelectMessages);return u.createElement(O,{type:O.Type.DROPDOWN_MENU,key:"ContactMenuDropdown",flipOnRTL:!0,direction:{x:O.Direction.X.LEFT}},e)}});e.exports=U},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(230),s=i(a),r=n(1354),o=i(r),l=n(453),c=i(l),u=n(8),d=n(44),p=n(1410),h=n(9),f=n(1356),m=n(153),g=n(94),v=n(156),y=n(1360),E=n(1564),b=n(1541),C=n(10),M=n(1385),S=n(154),T=n(59),w=n(43),k=n(1447),P=n(60),N=n(1485),x=n(1365),D=n(1558),O=n(109),R=n(1),I=n(76),A=n(1380),L=n(229),F=n(157),U=n(92),G=n(456),j=n(12),B=3e3,V=8.5,q=300,H=E.UpdateTypes,z=E.UpdateTypePriority,W=u.createClass({displayName:"ConversationMsgs",mixins:[f,g,m,S,v,y],propTypes:{chat:u.PropTypes.instanceOf(o["default"]).isRequired,msgCollection:u.PropTypes.instanceOf(M).isRequired,selectable:u.PropTypes.bool,onMessageSelect:u.PropTypes.func.isRequired,onSelectMessages:u.PropTypes.func.isRequired,focusCtx:u.PropTypes.object,selectedMessages:u.PropTypes.instanceOf(x),notifyChatRendered:u.PropTypes.func,updateOpenedChatInfo:u.PropTypes.func.isRequired},getInitialState:function(){return this.rerender=this.safeDebounce(this._rerender,100),this.handleScroll=_.throttle(this._handleScroll,100),this.initialState(this.props)},componentWillMount:function(){var e=this;this._hideStickyDateMarkerTimer=new P(function(){return e.hideFloatingMarker()})},componentDidMount:function(){var e=this,t=this.props,n=t.chat,i=t.msgCollection;if(this.regCmd("compose_height_change",this.composeHeightChange),this.regCmd("scroll_chat_to_bottom",this.scrollToBottom),this.regCmd("scroll_to_focused_msg",function(){e.chatOpenScrollTimestamp=Date.now()}),this.attachMsgCollectionObservers(this.props,void 0),this.regNativeListener(window,"focus",this.windowGainedFocus),this.regNativeListener(window,"blur",this.windowLostFocus),this.handleResize=_.throttle(function(){e.updateMsgListInfo(),e.updateFloatingDateMarker()},100),this.updateNearBottomOnResize=this.safeDebounce(this.updateNearBottom,100),this.regNativeListener(window,"resize",this.handleResize),this.regNativeListener(window,"resize",this.updateNearBottomOnResize),this.addObserver(n,"change:trusted"),this.regCmd("textsize_change",function(t){e.setState({textsize:t})}),n.isGroup?this.addObserver(n.groupMetadata.participants,"change:contact.name change:contact.isMyContact change:contact.notifyName",this.rerender):n.isUser&&this.addObserver(n.contact,"change:isMyContact",this.rerender),this.addObserver(i,"change:star",this.rerender),this.addObserver(n,"change:quotedMsg",this.onQuotedMsgChange),!this.props.focusCtx){var a=d.findDOMNode(this.refs.scrollContainer),s=d.findDOMNode(this.refs.messageList);s&&s.clientHeight<a.clientHeight&&this.loadEarlierMsgs()}this.updateMsgListInfo(),this.updateFloatingDateMarker(),this.props.updateOpenedChatInfo({chat:n}),n.sendSeen();var r=void 0,o=void 0,l=void 0;this.regCmd("panes_will_change",function(t){if(e.msgListInfo&&e.msgListInfo.visibleMsgOrder&&e.msgListInfo.visibleMsgOrder.length&&e.refs.messageList){var n=_.last(e.msgListInfo.visibleMsgOrder).toString();l=d.findDOMNode(e.refs.messageList.refs[n]),o=d.findDOMNode(e.refs.scrollContainer),r=e.getMsgBottom(o,l)}}),this.regCmd("panes_did_change",function(t){o&&l&&!_.isUndefined(r)&&(e.setMsgBottom(o,l,r),l=void 0,o=void 0,r=void 0)})},getMsgBottom:function(e,t){var n=e.scrollTop,i=e.scrollHeight,a=e.clientHeight,s=i-(n+a);return i-(t.offsetTop+t.clientHeight+s)},setMsgBottom:function(e,t,n){var i=t.offsetTop,a=t.clientHeight,s=i+a+n-e.clientHeight;this.setScrollTop(e,s)},_rerender:function(){var e=this,t=d.findDOMNode(this.refs.scrollContainer),n=t.scrollTop;this.setState({msgListKey:this.state.msgListKey+1},function(){e.setScrollTop(t,n)})},componentDidUpdate:function(e,t){if(this.updateType=H.DEFAULT,this.updateMsgListInfo(),t.msgListKey===this.state.msgListKey){var n=e.chat===this.props.chat;this.updateFloatingDateMarker(n),this.props.updateOpenedChatInfo({chat:this.props.chat})}},initialState:function(e){var t=e.focusCtx,n=e.chat,i=e.msgCollection;this.updateType=H.DEFAULT,this.msgListInfo={visibleMsgs:{},dateMarker:void 0};var a,s=t||this.getUnreadFocusCtx(e),r=s&&s.msg,o=r&&r.id;return a=0,{msgListKey:0,cursor:new N(i,o,n.isGroup?h.RENDOR_CURSOR.GROUP_CONVERSATION:h.RENDOR_CURSOR.CONVERSATION),unreadCount:n.pendingSeenCount?0:n.unreadCount,isNearBottom:!0,newUnread:0,focusCtx:s,contextMenu:!1,textsize:a}},attachMsgCollectionObservers:function(e,t){var n=this,i=e.chat,a=e.msgCollection,s=e.focusCtx;this.props.msgCollection&&(this.removeObserver(this.props.chat,"change:unreadCount"),this.removeObserver(this.props.msgCollection,"change:last"),this.removeObserver(this.props.msgCollection,"remove",this.onMsgDelete),this.removeObserver(this.props.chat.msgs,"change:last")),a===i.msgs&&this.addObserver(i,"change:unreadCount",this.onUnreadCount),this.addObserver(i.msgs,"change:last",this.onLastMsgChanged),this.addObserver(a,"remove",this.onMsgDelete),this.state.cursor.msgCollection=a;var r=s,o=function(){return r.key&&(r.msg=Store.Msg.get(r.key)),r.msg?(n.setUpdateType(H.KEEP_SCROLL_BOTTOM),void n.setState({cursor:n.state.cursor.init(r.msg.id)})):C.openChatBottom(n.props.chat)};r&&a.loadAroundPromise?a.loadAroundPromise.checkpoint(this.rejectOnUnmount()).then(o)["catch"](j.Unmount,_.noop)["catch"](j.E404,function(){C.openToast(u.createElement(G,{msg:F.t("message_query_404"),id:G.genId()})),o()})["catch"](o):r&&o()},isMostRecentCMC:function(){return this.props.chat.msgs===this.props.msgCollection},componentWillReceiveProps:function(e){var t=this;this.attachMsgCollectionObservers(e,this.props.focusCtx);var n=_.clone(e);n.selectable=!e.selectable,_.isEqual(n,this.props)||this.setState(this.initialState(e),function(){t.props.chat.sendSeen()})},componentWillUnmount:function(){this._hideStickyDateMarkerTimer.cancel(),this.handleScroll.cancel(),this.handleResize.cancel(),this.maybeSendSeen()&&(this.props.chat.markedUnread=!1)},loadEarlierMsgs:function(){var e=this,t=this.props,n=t.chat,i=t.msgCollection,a=this.state.cursor;if(a.start>0)a.hasBefore()&&(this.setUpdateType(H.KEEP_SCROLL_BOTTOM),this.setState({cursor:a.loadBefore()}));else{if(i.msgLoadState.noEarlierMsgs||i.msgLoadState.isLoadingEarlierMsgs||i.msgLoadState.isLoadingAroundMsgs)return;n.loadEarlierMsgs(i).checkpoint(this.rejectOnUnmount()).then(function(){a.hasBefore()?(e.setUpdateType(H.KEEP_SCROLL_BOTTOM),e.setState({cursor:a.loadBefore()})):i.msgLoadState.noEarlierMsgs&&e.setState({})})["catch"](j.Unmount,_.noop)["catch"](function(e){R.log("ConversationMsgs:loadEarlierMsgs failed")(),R.log(e)()})}},loadRecentMsgs:function(){var e=this,t=this.props,n=t.chat,i=t.msgCollection,a=this.state.cursor;if(a.end<i.length)this.setUpdateType(H.KEEP_SCROLL_TOP),this.setState({cursor:a.loadAfter()});else{if(i.msgLoadState.isLoadingRecentMsgs||i.msgLoadState.isLoadingAroundMsgs)return;n.loadRecentMsgs(i).checkpoint(this.rejectOnUnmount()).then(function(){a.hasAfter()?(e.setUpdateType(H.KEEP_SCROLL_TOP),e.setState({cursor:a.loadAfter()})):e.state.cursor.end>=i.length&&e.isMostRecentCMC()&&e.setState({})})["catch"](j.Unmount,_.noop)["catch"](function(e){R.log("ConversationMsgs:loadRecentMsgs failed")(),R.log(e)()})}},composeHeightChange:function(e){var t=this,n=d.findDOMNode(this.refs.scrollContainer);if(e){if(e<0&&n.scrollTop===n.scrollHeight-n.clientHeight)return;this.setScrollTop(n,n.scrollTop+e)}else!function(){var e=n.scrollHeight-(n.scrollTop+n.clientHeight);Velocity(n,{tween:18},{progress:function(){t.setScrollTop(n,n.scrollHeight-e-n.clientHeight)},duration:300},[.1,.82,.25,1])}()},getScrollBottom:function(){var e=d.findDOMNode(this.refs.scrollContainer);return e.scrollHeight-(e.scrollTop+e.clientHeight)},setScrollBottom:function(e){var t=d.findDOMNode(this.refs.scrollContainer);this.setScrollTop(t,t.scrollHeight-e-t.clientHeight)},onStickyDateMarkerUpdated:function(e){var t=this.refs.stickyDateMarker;t&&t.updateDateMarkerText(e)},hideFloatingMarker:function(){var e=this.refs.stickyDateMarker;e&&e.hideStickyDateMarker(!0)},setScrollTop:function(e,t){this.programmaticScroll=Date.now(),e.scrollTop=t},updateFloatingDateMarker:function(){var e=!(arguments.length<=0||void 0===arguments[0])&&arguments[0],t=this.msgListInfo.dateMarker;if(this.isMounted()&&void 0!==t){var n=e||Date.now()-(this.programmaticScroll||0)<200;if(!n){var i=this.refs.stickyDateMarker;i&&i.hideStickyDateMarker(!1)}if(this.refs.messageList){var a=this.refs.messageList.refs;if(t===-1)this.onStickyDateMarkerUpdated();else if(a){var s=a["dateMarker_"+t];if(s){var r=s.props.timestamp,o=I.relativeDateStr(r).toUpperCase();this.onStickyDateMarkerUpdated(o)}}if(a&&t!==this.dateMarkerIdx){var l=a["dateMarker_"+this.dateMarkerIdx],c=a["dateMarker_"+t];l&&l.hide(!1),c&&c.hide(!0),this.dateMarkerIdx=t}n||this._hideStickyDateMarkerTimer.debounce(B)}}},setUpdateType:function(e){z[e]>=z[this.updateType]&&(this.updateType=e)},nearBottom:function(e){return e=e||d.findDOMNode(this.refs.scrollContainer),e.scrollTop+h.SCROLL_FUDGE>e.scrollHeight-e.clientHeight},updateNearBottom:function(){
var e=this.nearBottom();this.nearBottom!==e&&(this.setUpdateType(H.NONE),this.setState({isNearBottom:e}))},getUnreadFocusCtx:function(e){var t,n=e||this.props,i=n.chat,a=n.msgCollection,r=n.focusCtx;if((!r||this.isMostRecentCMC())&&i.unreadCount){var o=(t={},(0,s["default"])(t,c["default"].TYPE.CHAT,c["default"].TYPE.CHAT),(0,s["default"])(t,c["default"].TYPE.IMAGE,c["default"].TYPE.IMAGE),(0,s["default"])(t,c["default"].TYPE.VIDEO,c["default"].TYPE.VIDEO),(0,s["default"])(t,c["default"].TYPE.AUDIO,c["default"].TYPE.AUDIO),(0,s["default"])(t,c["default"].TYPE.VCARD,c["default"].TYPE.VCARD),(0,s["default"])(t,c["default"].TYPE.LOCATION,c["default"].TYPE.LOCATION),(0,s["default"])(t,c["default"].TYPE.PTT,c["default"].TYPE.PTT),t),l=_(a.toArray()).filter(function(e){return!!o[e.type]}).reverse().take(i.unreadCount).value();if(l.length===i.unreadCount)return l=_.last(l),{msg:l,isUnreadDivider:!0,highlightMsg:!1}}},getMsgs:function(){var e=this.props.msgCollection,t=this.state.cursor;return e.toArray().slice(t.start,t.end)},updateMsgListInfo:function(){var e=this.refs.messageList;if(e){for(var t=e.props.msgs,n=e.refs,i={},a=[],s=0,r=t.length-1;s<r;){var o=Math.floor((s+r)/2),l=n[t[o].id.toString()],c=d.findDOMNode(l);c||(R.error("invalid ref lookup for ref: "+t[o].id.toString()+" msg index: "+o)(),_.forEach(_.keys(n),function(e){R.info(""+e)()}),R.error("msg ids: ")(),_.forEach(t,function(e){R.info(""+e.id)()})),e.getMsgVisibility(l).visibility===h.VISIBILITY.ABOVE?s=o+1:r=o}for(var u=s;u<t.length;u++){var p=n[t[u].id.toString()],f=e.getMsgVisibility(p);if(f.visibility!==h.VISIBILITY.VISIBLE)break;i[t[u].id.toString()]={offset:f.offset,t:t[u].t},a.push(t[u].id)}var m=_.pickBy(n,function(e,t){return _.startsWith(t,"dateMarker_")}),g=d.findDOMNode(this.refs.scrollContainer),v=g.scrollTop,y=n.dateMarker_0?d.findDOMNode(n.dateMarker_0).offsetTop:void 0;if(s=0,r=_.size(m)-1,_.size(m)&&y<=v+V)for(;s<r;){var E=Math.ceil((s+r)/2),b=d.findDOMNode(n["dateMarker_"+E]);if(!b)return;b.offsetTop>v+V?r=E-1:s=E}else s=-1;this.msgListInfo.dateMarker=s,this.pauseHiddenGifs(this.msgListInfo.visibleMsgs,i),this.msgListInfo.visibleMsgs=i,this.msgListInfo.visibleMsgOrder=a,this.props.updateOpenedChatInfo({renderedMsgsInfo:i,visibleMsgOrder:a,clientHeight:g.clientHeight})}},isMsgVisible:function(e){var t=!(arguments.length<=1||void 0===arguments[1])&&arguments[1];return!!this.msgListInfo.visibleMsgs[e.toString()]&&(!!t||this.getMsgComponent(e))},getMsgComponent:function(e){var t=this.refs.messageList;if(t){var n=t.refs[e.toString()];if(n)return n.refs.component&&n.refs.component.refs.msg}},pauseHiddenGifs:function(e,t){for(var n in e)if(!t[n]){var i=this.props.msgCollection.get(n);if(i&&i.isGif){var a=this.getMsgComponent(n);a&&a.playCount&&a.pause()}}},onScroll:function(e){this.handleScroll(e.target,this.props.chat,this.nearBottom,this)},_handleScroll:function(e,t,n){this.updateMsgListInfo(),e.scrollTop<q&&Date.now()-(this.chatOpenScrollTimestamp||0)>h.MSG_FOCUS_SCROLL_ANIMATION_DURATION+50&&this.loadEarlierMsgs();var i=this.state,a=i.isNearBottom,s=i.cursor,r=n(e);r?(this.maybeSendSeen(!0),this.isMostRecentCMC()&&a!==r&&(this.setUpdateType(H.NONE),this.setState({isNearBottom:r,newUnread:0})),(s.end<this.props.msgCollection.length||!this.isMostRecentCMC())&&this.loadRecentMsgs()):a!==r&&(this.setUpdateType(H.NONE),this.setState({isNearBottom:r})),this.updateFloatingDateMarker()},windowGainedFocus:function(){var e=this.props.chat;!this.clearUnreadTimer&&e.isDirty()&&(this.clearUnreadTimer=this.safeDelay(function(){delete this.clearUnreadTimer,this.maybeSendSeen()},h.CLEAR_CHAT_DIRTY_WAIT))},windowLostFocus:function(){if(this.state.unreadCount&&this.isMostRecentCMC()){var e=this.props.chat;0===e.unreadCount&&(this.setUpdateType(H.KEEP_SCROLL_BOTTOM),this.setState({unreadCount:0})),e.markedUnread=!1}},maybeSendSeen:function(e,t){var n=this.props,i=n.chat,a=n.msgCollection,s=this.state.cursor;if(i.isDirty()&&this.isMostRecentCMC()&&s.end>=a.length&&(_.isUndefined(t)&&(t=document.hasFocus()),t&&(_.isUndefined(e)&&(e=this.nearBottom()),e)))return i.sendSeen(),!0},jumpToBottom:function(){var e=this;this.isMostRecentCMC()&&this.state.cursor.end>=this.props.msgCollection.length?this.scrollToBottom():C.openChatBottom(this.props.chat).then(function(t){t&&C.focusChatTextInput(e.props.chat)})},scrollToBottom:function(e){var t=d.findDOMNode(this.refs.scrollContainer);t&&this.setScrollTop(t,t.scrollHeight),e&&e()},onLastMsgChanged:function(){var e=this.props.msgCollection,t=this.state,n=t.cursor,i=t.focusCtx,a=e.last();if(!this.isMostRecentCMC())return void(a&&a.isSentByMe&&this.jumpToBottom());var s={},r=document.hasFocus(),o=this.nearBottom();this.setUpdateType(o?H.SCROLL_BOTTOM:H.KEEP_SCROLL_TOP),r&&o?(this.setUpdateType(H.SCROLL_BOTTOM),s.unreadCount=0,s.focusCtx=void 0,s.cursor=n.setKey()):a&&a.isSentByMe&&(this.setUpdateType(H.SCROLL_BOTTOM),this.state.unreadCount&&(s.unreadCount=0,s.focusCtx=void 0,s.cursor=n.setKey()),this.jumpToBottom()),this.isMostRecentCMC()&&(i&&!s.hasOwnProperty("focusCtx")?s.cursor=n.loadAfter(1):s.cursor=n.loadBefore(1)),_.isEmpty(s)||this.setState(s)},onUnreadCount:function(){var e=this.props.chat,t=this.nearBottom(),n=document.hasFocus();this.maybeSendSeen(t,n);var i={};if(e.unreadCount&&!e.pendingSeenCount){i.unreadCount=e.unreadCount;var a=this.getUnreadFocusCtx();a&&(i.focusCtx=a,i.cursor=this.state.cursor.setKey(a.msg.key))}t&&i.unreadCount-this.state.unreadCount===1&&this.setUpdateType(H.SCROLL_BOTTOM),(!t&&this.isMostRecentCMC()||!e.pendingSeenCount&&this.state.newUnread!==e.unreadCount)&&(i.newUnread=e.unreadCount),_.isEmpty(i)||this.setState(i)},onMsgDelete:function(e,t,n){this.state.cursor.onRemove(e),this.setState({})},onPageUpDown:function(e){U.focus(d.findDOMNode(this.refs.scrollContainer))},onKeyPress:function(e){e.metaKey||e.ctrlKey||(e.preventDefault(),"Enter"!==e.key||e.shiftKey?C.pasteChatTextInput(this.props.chat,String.fromCharCode(e.charCode)):C.enterChatTextInput(this.props.chat))},onContextMenu:function(e){var t,n=this.props.chat,i=this.props.onSelectMessages;if(n.isUser)t=k.contact(n,i);else if(n.isGroup)t=k.group(n,i);else{if(!n.isBroadcast)return;t=k.broadcast(n,i)}e.preventDefault(),e.stopPropagation(),e.persist(),this.setState({contextMenu:{menu:t,event:e}})},contextClose:function(){this.setState({contextMenu:!1})},onPaste:function(e){var t=this;e.preventDefault();var n=new p(e.clipboardData);if(!n.hasFiles()&&n.hasType("text/plain"))return void n.getText().then(function(e){return C.pasteChatTextInput(t.props.chat,e)});var i=_.filter(n.getFiles(),function(e){var t=T.typeFromMimetype(e.type);return"image"===t||"video"===t});i.length&&C.attachMediaDrawer(this.props.chat,i)},render:function(){var e,t=this,n=this.props,i=n.chat,a=n.msgCollection,s=n.selectable,r=n.onMessageSelect,o=this.state.focusCtx,l=w("pane-chat-msgs pane-chat-body lastTabIndex",{selectable:s}),c=this.isMostRecentCMC(),d=!!o,p=_.find(h.TEXTSIZE_CLASS_MAP,function(e){return e.scale===t.state.textsize});p&&(e=p.classname);var f=u.createElement(E,{key:"ml-"+i.id+"-"+this.state.msgListKey,ref:"messageList",updateType:this.updateType,unreadCount:this.state.unreadCount,selectable:s,onMessageSelect:r,msgs:this.getMsgs(),focusedMsgCtx:o,selectedMessages:this.props.selectedMessages,isMsgVisible:this.isMsgVisible,notifyChatRendered:this.props.notifyChatRendered}),m=u.createElement(b,{direction:"around",isMostRecentCMC:c,loadMoreMsgs:_.noop,msgCollection:a}),g=void 0;(this.state.cursor.start>0||!a.msgLoadState.noEarlierMsgs)&&(g=u.createElement(b,{direction:"earlier",isMostRecentCMC:c,loadMoreMsgs:this.loadEarlierMsgs,msgCollection:a}));var v=void 0;(this.state.cursor.end<a.length||!c)&&(v=u.createElement(b,{direction:"recent",isMostRecentCMC:c,loadMoreMsgs:this.loadRecentMsgs,msgCollection:a})),d&&a.msgLoadState.isLoadingAroundMsgs?(v=void 0,g=void 0,f=void 0):m=void 0;var y=void 0,C=void 0,M=this.state,S=M.isNearBottom,T=M.newUnread;S&&(a.msgLoadState.isLoadingAroundMsgs||c)||(T&&i.unreadCount&&(C=u.createElement("span",{className:"icon-meta unread-count",key:"icon-unread"},F.n(this.state.newUnread))),y=u.createElement("div",{className:"incoming-msgs",onClick:this.jumpToBottom},u.createElement(O,{transitionName:"pop"},C),u.createElement("span",{className:"icon icon-down"})));var k=void 0;return this.state.contextMenu&&(k=u.createElement(L,{displayName:"ConversationContextMenu",escapable:!0,popable:!0,requestDismiss:this.contextClose},u.createElement(A,{contextMenu:this.state.contextMenu}))),u.createElement("div",{className:e},u.createElement(D,{ref:"stickyDateMarker"}),u.createElement(O,{transitionName:"pop"},y),u.createElement("div",{className:l,ref:"scrollContainer",onScroll:this.onScroll,onKeyPress:this.onKeyPress,onContextMenu:s?null:this.onContextMenu,onPaste:this.onPaste,tabIndex:"0"},u.createElement("div",{className:"pane-chat-empty"}),m,g,f,v),k)}});e.exports=W},function(e,t,n){"use strict";var i=n(8),a=n(155),s=n(153),r=n(1385),o=i.createClass({displayName:"LoadMoreMessages",mixins:[s],propTypes:{direction:i.PropTypes.oneOf(["recent","earlier","around"]).isRequired,isMostRecentCMC:i.PropTypes.bool.isRequired,loadMoreMsgs:i.PropTypes.func.isRequired,msgCollection:i.PropTypes.instanceOf(r).isRequired},getInitialState:function(){return this.props.msgCollection.msgLoadState.toJSON()},componentWillMount:function(){this.attachObservers()},componentWillReceiveProps:function(e){this.attachObservers(e)},attachObservers:function(e){var t=this,n=this.props.msgCollection.msgLoadState;e&&(this.removeObserver(n,"change"),n=e.msgCollection.msgLoadState),this.addObserver(n,"change",function(){t.setState(n.toJSON())})},loadMoreMsgs:function(e){"earlier"===this.props.direction&&this.state.isLoadingEarlierMsgs||"recent"===this.props.direction&&this.state.isLoadingRecentMsgs||"around"===this.props.direction&&this.state.isLoadingAroundMsgs||this.props.loadMoreMsgs()},render:function(){var e=this.props.direction;if("earlier"===e&&this.state.isLoadingEarlierMsgs||"recent"===e&&this.state.isLoadingRecentMsgs||"around"===e&&this.state.isLoadingAroundMsgs)return i.createElement("div",{className:"more"},i.createElement("div",{className:"btn-more",title:l10n.t("loading_messages")},i.createElement(a,{stroke:6,size:24})));var t;return t="earlier"===e?l10n.t("load_earlier_messages"):"recent"===e?l10n.t("load_recent_messages"):l10n.t("loading_messages"),i.createElement("div",{className:"more"},i.createElement("div",{className:"btn-more",title:t,onClick:this.loadMoreMsgs},i.createElement("span",{className:"icon icon-refresh"})))}});e.exports=o},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(453),s=i(a),r=n(8),o=n(9),l=n(1356),c=n(231),u=n(1367),d=n(1363),p=n(1419),h=n(1451),f=n(10),m=n(1382),g=n(1384),v=n(75),y=n(460),E=n(454),_=n(155),b=r.createClass({displayName:"Audio",mixins:[l],propTypes:{msg:r.PropTypes.instanceOf(s["default"]).isRequired,quotedMsg:r.PropTypes.element,displayAuthor:r.PropTypes.bool},getInitialState:function(){return this.asyncState({mediaStage:"msg.mediaData.mediaStage",ack:"msg.ack"},{currentTime:0,playing:!1,autoPlay:!1})},componentDidMount:function(){this.props.msg.downloadMedia()},showMediaMissing:function(){f.openModal(r.createElement(m,{msg:this.props.msg}))},downloadMedia:function(){this.props.msg.forceDownloadMedia()},cancelDownload:function(){this.props.msg.cancelDownload()},cancelUpload:function(){this.props.msg.cancelUpload()},resumeUpload:function(){this.props.msg.resumeUpload()},resumeRemoteUpload:function(){v.supportsFeature(v.F.MEDIA_RETRY)?this.props.msg.resumeRemoteUpload():f.openModal(r.createElement(g,{msg:this.props.msg}))},downloadUnsupportedToDesktop:function(e){var t=this;e&&e.stopPropagation(),f.openModal(r.createElement(E,{onCancel:f.closeModal.bind(f),onOK:function(){f.closeModal(),y.initDownload(t.props.msg)},okText:l10n.t("web_button_download"),cancelText:l10n.t("web_cancel"),title:l10n.t("download_unsupported_media_title")},l10n.t("download_unsupported_media_prompt")))},handleTimeUpdate:function(e){this.setState({currentTime:e})},handlePlayingUpdate:function(e){this.setState({autoPlay:!1,playing:e})},loader:function(e,t,n){return n=n?r.createElement(_,{stroke:3,size:38}):null,r.createElement("div",{className:"audio"},r.createElement("div",{className:"audio-controls"},r.createElement("button",{className:"btn-audio "+(t?"icon "+t:""),onClick:e},n)),r.createElement("div",{className:"audio-body"},r.createElement("input",{type:"range",className:"audio-track",min:0,max:100,value:0,disabled:"disabled"})))},getStatusClass:function(e){return e+=" audio-state-default",this.state.ack===o.ACK_PLAYED&&(e+=" audio-state-played"),e},render:function(){var e,t=this.props.msg,n=t.mediaData,i=this.getStatusClass("bubble bubble-attach bubble-audio"),a=this.state.playing?this.state.currentTime:n.duration,s=r.createElement(p,{key:"image",className:this.props.quotedMsg?"quoted-msg-bubble-ptt":null,type:n.type,shade:!1,duration:a}),o=t.isSentByMe?s:null,l=t.isSentByMe?null:s,f=t.isSentByMe?"text no-author":"text";switch(n.mediaStage){case c.STAGE.RESOLVED:e=r.createElement(h,{msg:t,autoPlay:!1,onPlayingUpdate:this.handlePlayingUpdate,onTimeUpdate:this.handleTimeUpdate});break;case c.STAGE.NEED_POKE:e=this.loader(this.downloadMedia,"icon-audio-download");break;case c.STAGE.NEED_UPLOAD:e=this.loader(this.resumeUpload,"icon-audio-upload");break;case c.STAGE.REMOTE_NEED_UPLOAD:e=this.loader(this.resumeRemoteUpload,"icon-audio-upload");break;case c.STAGE.ERROR_MISSING:e=this.loader(this.showMediaMissing,"icon-audio-play");break;default:e=this.loader(null,null,!0)}var m=this.props.displayAuthor&&d.shouldRender(t)?r.createElement(d,{msg:t,className:this.props.quotedMsg?"quoted-msg-bubble-ptt-author":null}):null;return r.createElement("div",{className:i},this.props.quotedMsg?m:null,this.props.quotedMsg,r.createElement("div",{className:"wrapper"},o,r.createElement("div",{className:"contents"},this.props.quotedMsg?null:m,r.createElement("div",{className:f},e)),l,r.createElement(u,{msg:t})))}});e.exports=b},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(453),s=i(a),r=n(8),o=n(1367),l=n(1363),c=n(46),u=n(43),d=r.createClass({displayName:"Ciphertext",propTypes:{msg:r.PropTypes.instanceOf(s["default"]).isRequired,displayAuthor:r.PropTypes.bool},onLearnMore:function(){var e="https://www.whatsapp.com/faq/general/26000015/";e=c.build(e,{lg:l10n.getLocale()}),window.open(e,"_blank")},render:function(){var e=this.props.msg,t=this.props.displayAuthor&&l.shouldRender(e),n=t?r.createElement(l,{msg:e}):null,i=u("bubble bubble-placeholder",{"has-author":t}),a="message-text";return r.createElement("div",{className:i},n,r.createElement("div",{className:"icon icon-ciphertext placeholder-icon"}),r.createElement("div",{className:a},r.createElement("span",null,r.createElement("span",{className:"placeholder-msg"},l10n.t("placeholder_msg")),r.createElement("span",{className:"placeholder-learn-more",onClick:this.onLearnMore},l10n.t("learn_more")))),r.createElement(o,{msg:e}))}});e.exports=d},function(e,t,n){"use strict";var i=n(8),a=n(1373),s=n(1355),r=n(94),o=n(43),l=n(76),c=n(0),u=i.createClass({displayName:"DateMarker",mixins:[r],propTypes:{timestamp:i.PropTypes.number.isRequired},getInitialState:function(){return{hide:!1}},componentDidMount:function(){this.maybeRegMidnight()},componentDidUpdate:function(){this.maybeRegMidnight()},hide:function(e){this.state.hide!==e&&this.setState({hide:e})},rerender:function(){this.forceUpdate()},maybeRegMidnight:function(){this.unregCmd("midnight",this.rerender);var e=c().startOf("day").subtract(7,"day");this.props.timestamp>=e.unix()&&this.regCmd("midnight",this.rerender)},render:function(){var e=l.relativeDateStr(this.props.timestamp).toUpperCase(),t=o("message-system-body",{"date-marker-floating":this.state.hide});return i.createElement("div",{className:"msg"},i.createElement("div",{className:"message message-system"},i.createElement("span",{className:t},i.createElement(a,null,i.createElement(s,{direction:"auto",text:e})))))}});e.exports=u},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(453),o=i(r),l=n(8),c=n(1356),u=n(1363),d=n(231),p=n(1367),h=n(1355),f=n(43),m=n(1382),g=n(1384),v=n(1510),y=n(75),E=n(10),b=n(113).MIMETYPES,C=n(460),M=n(95),S=n(58),T=n(454),w=n(456),k=_.pickBy(b,function(e){return"document"===e.msgType}),P=l.createClass({displayName:"Doc",mixins:[c],propTypes:{msg:l.PropTypes.instanceOf(o["default"]).isRequired,quotedMsg:l.PropTypes.element,displayAuthor:l.PropTypes.bool},getInitialState:function(){return{mediaStage:this.async("msg.mediaData.mediaStage")}},showMediaMissing:function(){E.openModal(l.createElement(m,{msg:this.props.msg}))},downloadMedia:function(e){var t=this;e&&e.stopPropagation(),this.downloadToBlob().then(function(){C.initDownload(t.props.msg)})},downloadToBlob:function(){return this.props.msg.mediaData.mediaStage===d.STAGE.RESOLVED?s["default"].resolve():this.props.msg.forceDownloadMedia().then(this.displayToast)["catch"](_.noop)},displayToast:function(){if(this.props.msg.mediaData.mediaStage!==d.STAGE.RESOLVED)return s["default"].reject(this.props.msg.mediaData.mediaStage);var e=this.props.msg,t=e.mediaData,n=e.caption||t.filename||l10n.t("untitled_document");return E.openToast(l.createElement(w,{msg:l10n.t("document_downloaded",{name:n}),id:w.genId()})),s["default"].resolve()},cancelDownload:function(){this.props.msg.cancelDownload()},cancelUpload:function(){this.props.msg.cancelUpload()},resumeUpload:function(){this.props.msg.resumeUpload()},resumeRemoteUpload:function(){y.supportsFeature(y.F.MEDIA_RETRY)?this.props.msg.resumeRemoteUpload():E.openModal(l.createElement(g,{msg:this.props.msg}))},preventDefault:function(e){return function(t){t.preventDefault(),e(t)}},openDownloadedFile:function(){var e=this.props.msg.mediaData.renderableUrl;e&&window.open(e,"_blank")},render:function(){var e,t=this.props,n=t.msg,i=t.displayAuthor,a=n.mediaData,s=f("bubble","bubble-doc",{"bubble-broadcast":n.broadcast,"bubble-star":n.star}),r=i&&u.shouldRender(n)?l.createElement(u,{msg:n}):null;a.pageCount>0&&(e=l.createElement("span",{className:"document-meta-value"},l10n.t("web_conversations_most_recent_document",{count:a.pageCount,_plural:a.pageCount})));var o,c=a.size>0?l.createElement("span",{className:"document-meta-value"},l10n.filesize(a.size)):null,m="icon-doc";_.has(k,a.mimetype)&&(o=l.createElement("span",{className:"document-meta-value"},k[a.mimetype].ext),m=f(m,k[a.mimetype].icon));var g=a.preview?l.createElement("div",{className:"document-thumb",style:{backgroundImage:'url("'+a.preview.url()+'")'}}):null,y=n.caption||a.filename||l10n.t("untitled_document"),b=null,C=null;switch(a.mediaStage){case d.STAGE.RESOLVED:case d.STAGE.ERROR_UNSUPPORTED:b=l.createElement(v.Download,{onClick:this.downloadMedia}),C=this.preventDefault(this.downloadMedia);break;case d.STAGE.FETCHING:b=l.createElement(v.PendingCancel,null),C=this.preventDefault(this.cancelDownload);break;case d.STAGE.NEED_POKE:case d.STAGE.INIT:b=l.createElement(v.Download,{onClick:this.downloadMedia}),C=this.preventDefault(this.downloadMedia);break;case d.STAGE.UPLOADING:b=l.createElement(v.PendingCancel,null),C=this.preventDefault(this.cancelUpload);break;case d.STAGE.NEED_UPLOAD:b=l.createElement(v.Upload,null),C=this.preventDefault(this.resumeUpload);break;case d.STAGE.REMOTE_NEED_UPLOAD:b=l.createElement(v.Upload,null),C=this.preventDefault(this.resumeRemoteUpload);break;case d.STAGE.ERROR_MISSING:C=this.preventDefault(this.showMediaMissing);break;default:b=l.createElement(v.Pending,null)}return M&&(C=null),S.isSafari&&(C=this.preventDefault(function(){E.openModal(l.createElement(T,{onOK:E.closeModal.bind(E),okText:l10n.t("web_ok")},l10n.t("whatsapp_safari_limited")))})),l.createElement("div",{className:s},r,this.props.quotedMsg,l.createElement("a",{className:"document-container",download:y,target:"_blank",onClick:C,href:"/download/blob?msg="+n.id.toString(),title:l10n.t("web_download_document",{name:y})},g,l.createElement("div",{className:"document-body"},l.createElement("div",{className:"document-icon"},l.createElement("div",{className:m})),l.createElement("div",{className:"document-text"},l.createElement(h,{text:y,ellipsify:!0,selectable:!1,dirMismatch:n.rtl!==l10n.isRTL(),direction:"auto"})),b)),l.createElement("div",{className:"document-meta"},e,o,c),l.createElement(p,{msg:n}))}});e.exports=P},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(110),s=i(a),r=n(8),o=n(1443),l=r.createClass({displayName:"FailedMsgIcon",propTypes:{onResend:r.PropTypes.func.isRequired,errMsg:r.PropTypes.string.isRequired},getInitialState:function(){return{hover:!1}},onMouseEnter:function(){this.setState({hover:!0})},onMouseLeave:function(){this.setState({hover:!1})},render:function(){var e=r.createElement("span",null,this.props.errMsg),t=this.state.hover?r.createElement(o,{direction:"left",className:"tooltip-error",body:e}):null;return r.createElement(s["default"],{onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,className:"icon-error-container"},t,r.createElement("button",{className:"error",onClick:this.props.onResend},r.createElement("span",{className:"icon icon-error"})))}});e.exports=l},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(453),o=i(r),l=n(8),c=n(44),u=n(1356),d=n(156),p=n(1363),h=n(1418),f=n(43),m=n(10),g=n(454),v=n(1384),y=n(231),E=n(1392),b=n(1367),C=n(1403),M=n(75),S=n(9),T=n(1360),w=n(38),k=2.4,P=330,N=P/k,x=3,D=6,O=l.createClass({displayName:"Gif",mixins:[u,d,T],propTypes:{msg:l.PropTypes.instanceOf(o["default"]).isRequired,quotedMsg:l.PropTypes.element,isMsgVisible:l.PropTypes.func,displayType:l.PropTypes.oneOf(_.values(S.DISP_TYPE)),displayAuthor:l.PropTypes.bool},getInitialState:function(){return this.playCount=0,{mediaStage:this.async("msg.mediaData.mediaStage"),playing:!1}},componentDidMount:function(){this.props.msg.downloadMedia()},componentWillUnmount:function(){this._preppingPlay&&this._preppingPlay.cancel()},pause:function(){this.playCount=0,this._pause()},play:function(e){var t=this;this.props.msg.mediaData.mediaStage===y.STAGE.RESOLVED&&this.refs.player&&(e&&e.stopPropagation(),this._preppingPlay&&this._preppingPlay.cancel(),this._preppingPlay=s["default"].resolve().cancellable().then(function(){if(!_.isUndefined(t.duration))return t.duration;var e=c.findDOMNode(t.refs.player);return e.readyState>0?e.duration:w.waitForEvent(e,"canplay").then(function(){return e.duration})}).then(function(e){t.duration=e,t.setState({playing:!0});var n=Math.ceil(D/e);t.playCount=Math.max(n,x),t._play()}),this._preppingPlay["catch"](s["default"].CancellationError,_.noop)["finally"](function(){t._preppingPlay=void 0}))},_pause:function(){if(this.setState({playing:!1}),this.refs.player){var e=c.findDOMNode(this.refs.player);e&&(e.currentTime=0,e.paused||e.pause())}},_play:function(){if(this.refs.player){if(!this.playCount)return this.pause();this.playCount-=1;var e=c.findDOMNode(this.refs.player);e&&e.paused&&e.play()}},getStyle:function(){var e=this.props.msg.mediaData,t=e.thumbWidth||1,n=e.thumbHeight||1,i=void 0,a=void 0,s=this.aspect(t,n);s?s<1/k?(a=P,i=N):s<1?(a=P,i=t*a/n):s<k?(i=P,a=n*i/t):(i=P,a=N):(a="100%",i=P);var r=e.renderableUrl?e.fullWidth||t:t,o=e.renderableUrl?e.fullHeight||n:n;return s?r/o>i/a?(r=r*a/o,o=a):(o=o*i/r,r=i):(r=P,o="100%"),{bubbleWidth:i,bubbleHeight:a,contentWidth:r,contentHeight:o}},aspect:function(e,t){if(e&&t)return e/t},showMediaMissing:function(){m.openModal(l.createElement(g,{title:l10n.t("missing_photo_title"),onOK:m.closeModal.bind(m),okText:l10n.t("web_ok")},l10n.t("missing_photo_text")))},getZoomNode:function(e){var t=this.props.isMsgVisible(e);if(t&&t.getImgNode)return t.getImgNode()},launchMediaViewer:function(e){e&&e.stopPropagation();var t=this.props,n=t.msg,i=t.isMsgVisible;m.mediaViewerModal(n,i?this.getZoomNode:_.noop)},downloadMedia:function(){this.props.msg.forceDownloadMedia()},cancelDownload:function(){this.props.msg.cancelDownload()},cancelUpload:function(){this.props.msg.cancelUpload()},resumeUpload:function(){this.props.msg.resumeUpload()},resumeRemoteUpload:function(){M.supportsFeature(M.F.MEDIA_RETRY)?this.props.msg.resumeRemoteUpload():m.openModal(l.createElement(v,{msg:this.props.msg}))},onDragStart:function(e){e.nativeEvent.dataTransfer.setData(S.DRAG_TYPE_LOCAL_IMAGE,!0)},stopEvent:function(e){e.stopPropagation()},getImgNode:function(){if(this.refs.player)return c.findDOMNode(this.refs.player)},render:function(){var e=this.props.msg,t=e.mediaData,n=e.caption?l.createElement(h,{msg:e}):null,i=n?null:l.createElement("div",{className:"shade"}),a=t.preview?t.preview.url():void 0,s=null,r=null,c=null,u=this.getStyle(),d=u.bubbleWidth,m=u.bubbleHeight,g=u.contentWidth,v=u.contentHeight,_={width:d,height:m};switch(t.mediaStage){case y.STAGE.RESOLVED:this.state.playing||(s=l.createElement("span",{className:"image-gif-control",onClick:this.play},l.createElement("button",{className:"icon icon-media-gif"}))),c=l.createElement(C,{msg:e,poster:a,ref:"player",className:"image-thumb-body",width:g,height:v,onEnded:this._play,muted:!0},l10n.t("video_playback_not_supported")),r=this.launchMediaViewer;break;case y.STAGE.INIT:r=this.launchMediaViewer;break;case y.STAGE.FETCHING:s=l.createElement(E.PendingCancel,null),r=this.cancelDownload;break;case y.STAGE.NEED_POKE:s=l.createElement(E.Download,{filesize:t.size}),r=this.downloadMedia;break;case y.STAGE.UPLOADING:s=l.createElement(E.PendingCancel,null),r=this.cancelUpload;break;case y.STAGE.NEED_UPLOAD:s=l.createElement(E.Upload,{filesize:t.size}),r=this.resumeUpload;break;case y.STAGE.REMOTE_NEED_UPLOAD:s=l.createElement(E.Upload,{filesize:t.size}),r=this.resumeRemoteUpload;break;case y.STAGE.ERROR_MISSING:r=this.showMediaMissing;break;default:s=l.createElement(E.Pending,null)}c||(c=l.createElement("div",{className:"image-thumb-body image-thumb-gif",style:{backgroundImage:"url("+a+")"}}));var M=f("bubble-image",{"bubble-image-caption":e.caption,"bubble-broadcast":e.caption&&e.broadcast,"bubble-star":e.caption&&e.star}),S=this.props.displayAuthor&&p.shouldRender(e)?l.createElement(p,{msg:e}):null,T=void 0;switch(e.gifAttribution){case o["default"].GIF_ATTRIBUTION.GIPHY:T=l.createElement("span",{className:"icon-gif-vendor icon icon-giphy"});break;case o["default"].GIF_ATTRIBUTION.TENOR:T=l.createElement("span",{className:"icon-gif-vendor icon icon-tenor"});break;default:T=null}return l.createElement("div",{className:M,onClick:this.stopEvent,style:{width:_.width}},S,this.props.quotedMsg,l.createElement("div",{className:"image-thumb",onClick:r,style:_},s,c,i,T),n,l.createElement(b,{msg:this.props.msg}))}});e.exports=O},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.EMOJI_SIZE=void 0;var a,s,r=n(15),o=i(r),l=n(5),c=i(l),u=n(6),d=i(u),p=n(19),h=i(p),f=n(18),m=i(f),g=n(1377),v=i(g),y=n(1368),E=i(y),_=n(8),b=n(471),C=n(1409),M=n(159),S=M.emojiMap,T=M.getEmojiPath,w=M.getClasses,k=n(9),P=k.ONE_BY_ONE_TRANS_GIF,N=n(43),x=t.EMOJI_SIZE={LARGE:"large",XLARGE:"xlarge"};t["default"]=(0,E["default"])((s=a=function(e){function t(){var e,n,i,a;(0,c["default"])(this,t);for(var s=arguments.length,r=Array(s),l=0;l<s;l++)r[l]=arguments[l];return n=i=(0,h["default"])(this,(e=(0,o["default"])(t)).call.apply(e,[this].concat(r))),i.state={assetLoaded:!1},i.onAssetLoaded=function(){i.setState({assetLoaded:!0})},i.onCopy=function(e){if(e.clipboardData){var t=window.getSelection();e.clipboardData.setData("text/plain",C.asPlainText(t))}e.stopPropagation(),e.preventDefault()},a=n,(0,h["default"])(i,a)}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"componentWillMount",value:function(){var e=this;this.props.listeners.add(window,"dpichange",function(){e.setState({assetLoaded:!1})})}},{key:"render",value:function(){var e=S[this.props.emoji];if(!e)return null;var t=T(e,this.props.emojiSize)[b.currentRes],n=void 0;return n=this.state.assetLoaded?N("large-emoji","selectable-text",{"heart-animation":this.props.animation}):N(w(e),"selectable-text"),this.props.animation&&this.state.assetLoaded?_.createElement("div",{className:"large-emoji-container",onCopy:this.onCopy},_.createElement("img",{className:"large-emoji selectable-text image",src:P,alt:this.props.emoji}),_.createElement(v["default"],{className:"large-emoji heart-animation container",draggable:!1,src:t})):_.createElement("div",{className:"large-emoji-container",onCopy:this.onCopy},_.createElement(v["default"],{draggable:!1,onLoad:this.onAssetLoaded,alt:this.props.emoji,src:t,className:n}))}}]),t}(_.Component),a.defaultProps={emojiSize:x.LARGE,animation:!1},s))},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(453),s=i(a),r=n(8),o=n(46),l=n(1267),c=n(43),u={LINK:"link",GROUP_INVITE:"group_invite"},d=r.createClass({displayName:"LinkPreview",mixins:[l],propTypes:{msg:r.PropTypes.instanceOf(s["default"]).isRequired,type:r.PropTypes.oneOf(_.values(u)).isRequired},getDefaultProps:function(){return{type:u.LINK}},render:function(){var e=this.props,t=e.msg,n=e.type,i=void 0;if(t.thumbnail){var a=c({"link-preview-media":n===u.LINK,"group-invite-preview":n===u.GROUP_INVITE});i=r.createElement("img",{className:a,src:"data:image/jpeg;base64,"+t.thumbnail})}var s=t.title?r.createElement("div",{className:"link-preview-title",title:t.title},t.title):null,l=t.description?r.createElement("div",{className:"link-preview-description",title:t.description},t.description):null,d=c("link-preview-body",{nothumb:!i}),p=n===u.LINK?r.createElement("div",{className:"link-preview-source ellipsify"},o.hostname(t.canonicalUrl||t.matchedText)):null,h=function(e){var n=document.createElement("a");n.href=t.matchedText,n.target="_blank",document.body.appendChild(n),n.click(),document.body.removeChild(n)};return r.createElement("div",{className:"link-preview-container",onClick:h},i,r.createElement("div",{className:d},s,l,p))}});d.Type=u,e.exports=d},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(453),s=i(a),r=n(8),o=n(43),l={FRONT:"front",MID:"mid",END:"end",SINGLE:"single"},c=r.createClass({displayName:"Menu",propTypes:{msg:r.PropTypes.instanceOf(s["default"]).isRequired,position:r.PropTypes.oneOf(_.values(l)).isRequired,onClick:r.PropTypes.func,isFocusedMsg:r.PropTypes.bool},click:function(){this.refs.context.click()},render:function(){var e=this.props,t=e.msg,n=e.position,i=e.onClick,a=t.isMedia,c=t.isSentByMe,u=t.isGroupMsg,d=t.type,p=!!t.quotedMsg,h=c?"context-out":"context-in",f=t.type===s["default"].TYPE.DOCUMENT&&!t.body,m=t.type===s["default"].TYPE.DOCUMENT&&t.body,g=d===s["default"].TYPE.LOCATION;a=a||m||g||p;var v;u&&(v=!c&&(n===l.FRONT||n===l.SINGLE),a=a&&!v);var y=d===s["default"].TYPE.CHAT&&t.matchedText&&t.matchedText.length&&t.body.indexOf(t.matchedText)>-1&&!v&&t.isTrusted(),E=o("js-context-icon",a&&d!==s["default"].TYPE.AUDIO?"context-icon-media":"context-icon"),_=o(h,{context:!(a||y),"context-media":a&&d!==s["default"].TYPE.AUDIO,"context-media-document":m,"context-ptt":d===s["default"].TYPE.PTT&&!p,"context-ptt-author":d===s["default"].TYPE.PTT&&v&&!p,"context-special":(y||f)&&!v&&!p,"context-doc":f&&!v&&!p,"context-inverse":d===s["default"].TYPE.CHAT&&!p&&!!t.dir&&t.rtl!==l10n.isRTL()});return r.createElement("div",{className:_},r.createElement("div",{className:E,ref:"context",onClick:i}))}});e.exports=c},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(15),s=i(a),r=n(5),o=i(r),l=n(6),c=i(l),u=n(19),d=i(u),p=n(18),h=i(p),f=n(1548),m=i(f),g=n(23),v=i(g),y=n(8),E=function(e){function t(){return(0,o["default"])(this,t),(0,d["default"])(this,(0,s["default"])(t).apply(this,arguments))}return(0,h["default"])(t,e),
(0,c["default"])(t,[{key:"render",value:function(){var e=this,t=this.props.emojis,n=v["default"].size(t);if(0===n)return null;var i=1===n?f.EMOJI_SIZE.XLARGE:f.EMOJI_SIZE.LARGE,a=t.map(function(t,n){return y.createElement(m["default"],{animation:e.props.animation,emoji:t,key:t+n,emojiSize:i})});return y.createElement("span",{className:"large-emoji-wrapper"},a)}}]),t}(y.Component);t["default"]=E},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(453),s=i(a),r=n(8),o=n(43),l=n(1363),c=n(488),u=n(459),d=n(1404),p=n(1367),h=n(1355),f=n(10),m=n(1613),g=r.createClass({displayName:"VCardList",propTypes:{msg:r.PropTypes.instanceOf(s["default"]).isRequired,quotedMsg:r.PropTypes.node,displayAuthor:r.PropTypes.bool},getDefaultProps:function(){return{quotedMsg:null,displayAuthor:!1}},_showContactsModal:function(){f.openModal(r.createElement(m,{msg:this.props.msg}))},_renderProfilePics:function(){for(var e=_(this.props.msg.vcardList).map(function(e,t){var n=u.thumbnailWAid(u.vcardWAids(u.parse(e.vcard))),i=u.thumbnail(e.vcard);if(n||i)return r.createElement(d,{key:t,waid:n,thumb:i,className:"preview-vcard-multi preview-vcard",size:d.Size.NONE})}).filter().take(3).value(),t=Math.min(3-e.length,this.props.msg.vcardList.length-e.length),n=0;n<t;n++)e.push(r.createElement(d,{key:"default-"+n,className:"preview-vcard-multi preview-vcard",size:d.Size.NONE}));return e},render:function(){var e=this.props.msg,t=this.props.quotedMsg,n=o(["bubble","bubble-vcard"],{"bubble-attach-caption":!!e.caption,"bubble-vcard-quoted":!!e.quotedMsg}),i="vcard-avatar";t&&(i=o(i,"quoted-msg-bubble-vcard"));var a=this.props.displayAuthor&&l.shouldRender(e)?r.createElement(l,{msg:e}):null,s=null,u=c.getNameString(e.vcardList),f=t?r.createElement(d,{className:"preview-vcard",size:d.Size.NONE}):this._renderProfilePics();return r.createElement("div",{className:n},a,t,r.createElement("div",{className:"wrapper wrapper-vcard wrapper-vcard-multi",title:u,onClick:this._showContactsModal},r.createElement("div",{className:"vcard"},r.createElement("div",{className:i},f),r.createElement("div",{className:"vcard-body"},r.createElement(h,{text:u,element:"div",className:"vcard-name vcard-name-multi",dirMismatch:e.rtl!==l10n.isRTL(),direction:e.dir,wbr:15}))),r.createElement(p,{msg:e,contextMenu:this.contextMenu})),s)}});e.exports=g},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(453),s=i(a),r=n(8),o=n(1373),l=n(1355),c=n(1267),u=n(10),d=n(1602),p=r.createClass({displayName:"Notification",mixins:[c],propTypes:{text:r.PropTypes.string.isRequired,e2eSubtype:r.PropTypes.string,participantJid:r.PropTypes.string,chatId:r.PropTypes.string,type:r.PropTypes.string,subtype:r.PropTypes.string},onSecurityClick:function(){u.openModal(r.createElement(d,{e2eSubtype:this.props.e2eSubtype,jid:this.props.participantJid,chatId:this.props.chatId}))},render:function(){var e=null;this.props.type===s["default"].TYPE.CALL_LOG&&(e="miss_video"===this.props.subtype?r.createElement("span",{className:"icon icon-miss_video"}):r.createElement("span",{className:"icon icon-miss"}));var t=r.createElement(o,null,e,r.createElement(l,{direction:"auto",text:this.props.text})),n=!!this.props.e2eSubtype,i=n?r.createElement("button",{className:"message-system-e2e",onClick:this.onSecurityClick},t):r.createElement("span",{className:"message-system-body"},t);return i}});e.exports=p},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!e||!t)return M;var n=e/t,i=void 0;return i=n<=1?M:n<=2.4?t*(C/e):C/2.4,Math.round(i)}function s(e,t,n,i){return e&&t&&n&&i?t/e>i/n?{height:"100%"}:{width:"100%"}:{height:"100%",width:"100%"}}var r=n(453),o=i(r),l=n(8),c=n(1356),u=n(1363),d=n(1418),p=n(43),h=n(10),f=n(1382),m=n(1384),g=n(231),v=n(1392),y=n(1367),E=n(75),b=n(9),C=330,M=330,S=l.createClass({displayName:"Picture",mixins:[c],propTypes:{msg:l.PropTypes.instanceOf(o["default"]).isRequired,quotedMsg:l.PropTypes.element,isMsgVisible:l.PropTypes.func,displayAuthor:l.PropTypes.bool},getInitialState:function(){return{mediaStage:this.async("msg.mediaData.mediaStage")}},componentDidMount:function(){this.props.msg.downloadMedia()},showMediaMissing:function(){h.openModal(l.createElement(f,{msg:this.props.msg}))},getZoomNode:function(e){var t=this.props.isMsgVisible(e);if(t&&t.getImgNode)return t.getImgNode()},launchMediaViewer:function(e){e&&e.stopPropagation();var t=this.props,n=t.msg,i=t.isMsgVisible;h.mediaViewerModal(n,i?this.getZoomNode:_.noop)},downloadMedia:function(){this.props.msg.forceDownloadMedia()},cancelDownload:function(){this.props.msg.cancelDownload()},cancelUpload:function(){this.props.msg.cancelUpload()},resumeUpload:function(){this.props.msg.resumeUpload()},resumeRemoteUpload:function(){E.supportsFeature(E.F.MEDIA_RETRY)?this.props.msg.resumeRemoteUpload():h.openModal(l.createElement(m,{msg:this.props.msg}))},onDragStart:function(e){e.nativeEvent.dataTransfer.setData(b.DRAG_TYPE_LOCAL_IMAGE,!0)},stopEvent:function(e){e.stopPropagation()},getImgNode:function(){return this.refs.img},render:function(){var e=this.props.msg,t=e.mediaData,n=e.caption?null:l.createElement("div",{className:"shade"}),i=e.caption?l.createElement(d,{msg:e}):null,r=t.renderableUrl||t.preview&&t.preview.url(),o=null,c=null;switch(t.mediaStage){case g.STAGE.RESOLVED:c=this.launchMediaViewer;break;case g.STAGE.FETCHING:o=l.createElement(v.PendingCancel,null),c=this.cancelDownload;break;case g.STAGE.NEED_POKE:o=l.createElement(v.Download,{filesize:t.size}),c=this.downloadMedia;break;case g.STAGE.UPLOADING:o=l.createElement(v.PendingCancel,null),c=this.cancelUpload;break;case g.STAGE.NEED_UPLOAD:o=l.createElement(v.Upload,{filesize:t.size}),c=this.resumeUpload;break;case g.STAGE.REMOTE_NEED_UPLOAD:o=l.createElement(v.Upload,{filesize:t.size}),c=this.resumeRemoteUpload;break;case g.STAGE.ERROR_MISSING:c=this.showMediaMissing;break;case g.STAGE.ERROR_UNSUPPORTED:o=l.createElement(v.Download,{filesize:t.size}),c=this.launchMediaViewer;break;default:o=l.createElement(v.Pending,null)}var h=p("bubble-image",{"bubble-image-caption":e.caption,"bubble-broadcast":e.caption&&e.broadcast,"bubble-star":e.caption&&e.star}),f=p("image-thumb-body",{"image-thumb-lores":!t.renderableUrl}),m=this.props.displayAuthor&&u.shouldRender(e)?l.createElement(u,{msg:e}):null,E=C,_=a(t.thumbWidth,t.thumbHeight),b={width:E,height:_},M=t.fullHeight||t.thumbHeight,S=t.fullWidth||t.thumbWidth,T=s(M,S,_,E);return l.createElement("div",{className:h,onClick:this.stopEvent},m,this.props.quotedMsg,l.createElement("div",{className:"image-thumb",onClick:c,style:b},o,l.createElement("img",{src:r,onDragStart:this.onDragStart,className:f,style:T,ref:"img"}),n),i,l.createElement(y,{msg:e}))}});e.exports=S},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(453),s=i(a),r=n(8),o=n(9),l=n(1356),c=n(1367),u=n(1363),d=n(1419),p=n(1451),h=n(1384),f=n(10),m=n(75),g=n(231),v=n(1382),y=n(155),E=r.createClass({displayName:"PTT",mixins:[l],propTypes:{msg:r.PropTypes.instanceOf(s["default"]).isRequired,quotedMsg:r.PropTypes.element,displayAuthor:r.PropTypes.bool},getInitialState:function(){return this.asyncState({mediaStage:"msg.mediaData.mediaStage",img:"msg.sender.ProfilePicThumb.img",ack:"msg.ack"},{currentTime:0,playing:!1,autoPlay:!1})},componentDidMount:function(){this.props.msg.downloadMedia()},showMediaMissing:function(){f.openModal(r.createElement(v,{msg:this.props.msg}))},downloadMedia:function(){this.props.msg.forceDownloadMedia()},cancelDownload:function(){this.props.msg.cancelDownload()},cancelUpload:function(){this.props.msg.cancelUpload()},resumeUpload:function(){this.props.msg.resumeUpload()},resumeRemoteUpload:function(){m.supportsFeature(m.F.MEDIA_RETRY)?this.props.msg.resumeRemoteUpload():f.openModal(r.createElement(h,{msg:this.props.msg}))},handleTimeUpdate:function(e){this.setState({currentTime:e})},handlePlayingUpdate:function(e){this.setState({autoPlay:!1,playing:e})},loader:function(e,t,n){return n=n?r.createElement(y,{stroke:3,size:38}):null,r.createElement("div",{className:"audio"},r.createElement("div",{className:"audio-controls"},r.createElement("button",{className:"btn-audio "+(t?"icon "+t:""),onClick:e},n)),r.createElement("div",{className:"audio-body"},r.createElement("input",{type:"range",className:"audio-track",min:0,max:100,value:0,disabled:"disabled"})))},getStatusClass:function(e){return e+=" audio-state-default",this.state.ack===o.ACK_PLAYED&&(e+=" audio-state-played"),e},render:function(){var e=this.props.msg,t=e.mediaData,n=this.getStatusClass("bubble bubble-attach bubble-audio"),i="audio-status icon ";i+=this.state.ack===o.ACK_PLAYED?e.isSentByMe?"icon-ptt-out-blue":"icon-ptt-in-blue":e.isSentByMe?"icon-ptt-out-gray":"icon-ptt-in-green";var a,s=r.createElement("span",{className:i,key:"status"}),l=this.state.playing?this.state.currentTime:t.duration,h=r.createElement(d,{key:"image",className:this.props.quotedMsg?"quoted-msg-bubble-ptt":null,thumb:this.state.img,type:t.type,shade:!1,duration:l}),f=e.isSentByMe?[h,s]:null,m=e.isSentByMe?null:[h,s],v=e.isSentByMe?"text no-author":"text";switch(t.mediaStage){case g.STAGE.RESOLVED:a=r.createElement(p,{msg:e,autoPlay:this.state.autoPlay,onPlayingUpdate:this.handlePlayingUpdate,onTimeUpdate:this.handleTimeUpdate});break;case g.STAGE.NEED_POKE:a=this.loader(this.downloadMedia,"icon-audio-download");break;case g.STAGE.NEED_UPLOAD:a=this.loader(this.resumeUpload,"icon-audio-upload");break;case g.STAGE.REMOTE_NEED_UPLOAD:a=this.loader(this.resumeRemoteUpload,"icon-audio-upload");break;case g.STAGE.ERROR_MISSING:a=this.loader(this.showMediaMissing,"icon-audio-play");break;default:a=this.loader(null,null,!0)}var y=this.props.displayAuthor&&u.shouldRender(e)?r.createElement(u,{msg:e,className:this.props.quotedMsg?"quoted-msg-bubble-ptt-author":null}):null;return r.createElement("div",{className:n},this.props.quotedMsg?y:null,this.props.quotedMsg,r.createElement("div",{className:"wrapper"},f,r.createElement("div",{className:"contents"},this.props.quotedMsg?null:y,r.createElement("div",{className:v},a)),m,r.createElement(c,{msg:e})))}});e.exports=E},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(453),s=i(a),r=n(8),o=n(1367),l=n(1363),c=n(43),u=r.createClass({displayName:"Revoked",propTypes:{msg:r.PropTypes.instanceOf(s["default"]).isRequired,displayAuthor:r.PropTypes.bool},render:function(){var e=this.props.msg,t=this.props.displayAuthor&&l.shouldRender(e),n=t?r.createElement(l,{msg:e}):null,i=c("bubble bubble-placeholder",{"has-author":t}),a="message-text";return r.createElement("div",{className:i},n,r.createElement("div",{className:a},r.createElement("span",null,r.createElement("span",{className:"placeholder-msg"},l10n.t("revoked_msg")))),r.createElement(o,{msg:e}))}});e.exports=u},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(453),s=i(a),r=n(8),o=n(1356),l=n(43),c=r.createClass({displayName:"Status",mixins:[o],propTypes:{msg:r.PropTypes.instanceOf(s["default"]).isRequired},getInitialState:function(){var e=this.props.msg;return{ack:e.ack<3?this.async("msg.ack"):e.ack}},render:function(){var e=this.props.msg,t=e.ack,n=e.isMedia&&!e.caption&&e.type!==s["default"].TYPE.AUDIO||e.type===s["default"].TYPE.LOCATION&&!e.get("loc"),i="icon",a=void 0;return a=t<1?n?"icon-msg-time-light":"icon-msg-time":1===t?n?"icon-msg-check-light":"icon-msg-check":2===t?n?"icon-msg-dblcheck-light":"icon-msg-dblcheck":n?"icon-msg-dblcheck-ack-light":"icon-msg-dblcheck-ack",i=l("icon",a),r.createElement("span",{className:i})}});e.exports=c},function(e,t,n){"use strict";var i=n(8),a=n(1373),s=n(1355),r=n(109),o=i.createClass({displayName:"StickyDateMarker",proptypes:{},getInitialState:function(){return{date:null,hide:!1}},updateDateMarkerText:function(e){this.setState({date:e})},hideStickyDateMarker:function(e){this.state.hide!==e&&this.setState({hide:e})},render:function(){var e=void 0;return this.state.date&&!this.state.hide&&(e=i.createElement("div",{className:"msg sticky-date-marker-floating-container"},i.createElement("div",{className:"sticky-date-marker-floating-wrapper"},i.createElement("span",{className:"message-system-body"},i.createElement(a,null,i.createElement(s,{direction:"auto",text:this.state.date})))))),i.createElement(r,{transitionName:"slide-down-date"},e)}});e.exports=o},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(47),s=i(a),r=n(453),o=i(r),l=n(1551),c=i(l),u=n(8),d=n(1363),p=n(1367),h=n(1549),f=n(1448),m=n(1355),g=n(43),v=n(1267),y=n(236),E=y.parseCmd,_=y.Cmd,b=n(157),C=n(159),M=u.createClass({displayName:"Text",mixins:[v],propTypes:{msg:u.PropTypes.instanceOf(o["default"]).isRequired,quotedMsg:u.PropTypes.element,senderName:u.PropTypes.string,displayAuthor:u.PropTypes.bool,trusted:u.PropTypes.bool},render:function(){var e=this.props,t=e.msg,n=e.displayAuthor,i=e.trusted,a=n&&d.shouldRender(t),r=g("bubble","bubble-text",{"bubble-broadcast":t.broadcast,"bubble-star":t.star,"has-author":a}),o=a?u.createElement(d,{msg:t,className:this.props.quotedMsg?"text-author-quoted-msg":null}):null,l=void 0,v=void 0;if(i&&t.linkPreview){var y=E(t.matchedText),M=(0,s["default"])(y,1),S=M[0];if(S===_.GROUP_INVITE){l=u.createElement(h,{msg:t,type:h.Type.GROUP_INVITE});var T=function(e){var n=document.createElement("a");n.href=t.matchedText,n.target="_blank",document.body.appendChild(n),n.click(),document.body.removeChild(n)},w=t.isSentByMe?b.t("group_invite_view"):b.t("group_invite_join");v=u.createElement("div",{className:"bubble-actions"},u.createElement("div",{className:"bubble-btn",onClick:T,title:w},w))}else l=u.createElement(h,{msg:t})}var k=void 0,P=void 0,N=t.mentionMap(),x=C.getMatchedEmojis(t.body);if(x){k=g("message-text","large-emoji-text",{"one-emoji-text":1===x.length,"two-emoji-text":2===x.length,"three-emoji-text":3===x.length});var D="❤"===x[0];P=u.createElement(c["default"],{animation:D,emojis:x})}else k=g("message-text"),P=u.createElement(m,{text:t.body,selectable:!0,dirMismatch:t.rtl!==b.isRTL(),direction:t.dir,linkify:i,mention:N,format:!0,wbr:15});return u.createElement("div",{className:r},o,this.props.quotedMsg,u.createElement("div",{className:k,"data-id":t.id},l,u.createElement(f,{msg:t}),P),u.createElement(p,{msg:t}),v)}});e.exports=M},function(e,t,n){"use strict";var i=n(8),a=n(1373),s=i.createClass({displayName:"Unread",propTypes:{count:i.PropTypes.number.isRequired},render:function(){var e=l10n.t("unread_message_count",{count:l10n.n(this.props.count),_plural:this.props.count});return i.createElement("span",{className:"msg-unread-body"},i.createElement(a,null,e))}});e.exports=s},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(453),s=i(a),r=n(8),o=n(1367),l=n(1363),c=n(43),u=r.createClass({displayName:"UnsupportedMsg",propTypes:{msg:r.PropTypes.instanceOf(s["default"]).isRequired,displayAuthor:r.PropTypes.bool},render:function(){var e=this.props.msg,t=this.props.displayAuthor&&l.shouldRender(e),n=t?r.createElement(l,{msg:e}):null,i=c("bubble bubble-placeholder",{"has-author":t}),a="message-text";return r.createElement("div",{className:i},n,r.createElement("div",{className:"icon icon-unknown placeholder-icon"}),r.createElement("div",{className:a},r.createElement("span",null,r.createElement("span",{className:"placeholder-msg"},e.isSentByMe?l10n.t("unsupported_msg_send"):l10n.t("unsupported_msg")))),r.createElement(o,{msg:e}))}});e.exports=u},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(453),s=i(a),r=n(23),o=i(r),l=n(8),c=n(43),u=n(1363),d=n(1367),p=n(10),h=n(459),f=n(1355),m=n(1404),g=n(153),v=n(1628),y=n(1573),E=n(1598),_=n(460),b=n(454),C=l.createClass({displayName:"Vcard",mixins:[g],propTypes:{msg:l.PropTypes.instanceOf(s["default"]).isRequired,quotedMsg:l.PropTypes.element,displayAuthor:l.PropTypes.bool},onMessageClick:function(){var e=this.props.msg.getWAids();e.length>1?p.openModal(l.createElement(v,{vCard:this.props.msg.vcard,onCancel:p.closeModal.bind(p),onSelect:this.openContactChat})):this.openContactChat(o["default"].first(e))},openContactChat:function(e){Store.Chat.find(e).then(function(e){p.closeModal(),p.openChatFromUnread(e).then(function(t){t&&p.focusChatTextInput(e)})})},viewContact:function(){var e=this;this.props.msg.vcard?p.openModal(l.createElement(E,{msg:this.props.msg})):p.openModal(l.createElement(b,{onCancel:p.closeModal.bind(p),onOK:function(){p.closeModal(),_.initDownload(e.props.msg)},okText:l10n.t("web_button_download"),cancelText:l10n.t("web_cancel"),title:l10n.t("download_contact_title")},l10n.t("download_contact_prompt")))},onAddToGroupClick:function(){var e=this.props.msg.getWAids();e.length>1?p.openModal(l.createElement(v,{vCard:this.props.msg.vcard,onCancel:p.closeModal.bind(p),onSelect:this.addContactToGroup,iconClass:"icon icon-add-user"})):this.addContactToGroup(o["default"].first(e))},addContactToGroup:function(e){Store.Contact.find(e).then(function(e){p.openModal(l.createElement(y,{contact:e}),"modal-flow")})},render:function(){var e=this.props.msg,t=e.getWAids(),n="vcard-avatar vcard-avatar-single",i=c(["bubble","bubble-vcard"],{"bubble-attach-caption":!!e.caption,"bubble-vcard-quoted":e.isQuoted}),a=o["default"].truncate(e.subtype||l10n.t("attach_vcard"),{length:120,omission:l10n.t("punctuation_ellipsis")}),s=void 0;t.length>0&&(s=l.createElement("div",{className:"bubble-actions"},l.createElement("div",{className:"bubble-btn",onClick:this.onMessageClick,title:l10n.t("message_author",{author:a})},l10n.t("message")),l.createElement("div",{className:"bubble-btn",onClick:this.onAddToGroupClick,title:l10n.t("add_contact_to_group")},l10n.t("add_contact_to_group"))));var r=this.props.displayAuthor&&u.shouldRender(e)?l.createElement(u,{msg:e}):null,p=this.props.msg.vcard||this.props.msg.chat.isTrusted(),g=c({vcard:!0,"vcard-pointer":p}),v=p?this.viewContact:o["default"].noop;return l.createElement("div",{className:i},r,this.props.quotedMsg,l.createElement("div",{className:"wrapper wrapper-vcard",onClick:v},l.createElement("div",{className:g},l.createElement(m,{className:n,thumb:h.thumbnail(e.body),waid:e.getVCardThumbnailWAid()}),l.createElement("div",{className:"vcard-body"},l.createElement(f,{text:a,element:"div",className:"vcard-name vcard-name-single",selectable:!0,dirMismatch:e.rtl!==l10n.isRTL(),direction:e.dir,wbr:15}))),l.createElement(d,{msg:e,contextMenu:this.contextMenu})),s)}});e.exports=C},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(453),s=i(a),r=n(8),o=n(1356),l=n(154),c=n(231),u=n(1392),d=n(1418),p=n(1367),h=n(1363),f=n(10),m=n(1382),g=n(1384),v=n(75),y=n(76),E=n(460),b=n(454),C=n(1),M=r.createClass({displayName:"Video",mixins:[o,l],propTypes:{msg:r.PropTypes.instanceOf(s["default"]).isRequired,quotedMsg:r.PropTypes.element,isMsgVisible:r.PropTypes.func,displayAuthor:r.PropTypes.bool},getInitialState:function(){return{mediaStage:this.async("msg.mediaData.mediaStage")}},showMediaMissing:function(){f.openModal(r.createElement(m,{msg:this.props.msg}))},downloadMedia:function(){this.props.msg.forceDownloadMedia()},cancelDownload:function(){this.props.msg.cancelDownload()},cancelUpload:function(){this.props.msg.cancelUpload()},resumeUpload:function(){this.props.msg.resumeUpload()},resumeRemoteUpload:function(){v.supportsFeature(v.F.MEDIA_RETRY)?this.props.msg.resumeRemoteUpload():f.openModal(r.createElement(g,{msg:this.props.msg}))},getZoomNode:function(e){var t=this.props.isMsgVisible(e);if(t&&t.getImgNode)return t.getImgNode()},downloadUnsupportedToDesktop:function(e){var t=this;e&&e.stopPropagation(),f.openModal(r.createElement(b,{onCancel:f.closeModal.bind(f),onOK:function(){f.closeModal(),E.initDownload(t.props.msg)},okText:l10n.t("web_button_download"),cancelText:l10n.t("web_cancel"),title:l10n.t("download_unsupported_media_title")},l10n.t("download_unsupported_media_prompt")))},launchMediaViewer:function(e){var t=this.props,n=t.msg,i=t.isMsgVisible;n.downloadMedia(!0),e&&e.stopPropagation(),f.mediaViewerModal(n,i?this.getZoomNode:_.noop)},launchVideoFloater:function(e){e&&e.stopPropagation();var t=this.props,n=t.msg,i=t.isMsgVisible;f.videoPlayerFloater(n,i?this.getZoomNode:_.noop)},stopEvent:function(e){e.stopPropagation()},render:function(){var e=this.props.msg,t=e.mediaData,n=null,i=null;switch(t.mediaStage){case c.STAGE.RESOLVED:case c.STAGE.INIT:n=r.createElement(u.Play,null),i=this.launchMediaViewer;break;case c.STAGE.NEED_POKE:n=r.createElement(u.Download,{filesize:t.size}),i=this.downloadMedia;break;case c.STAGE.UPLOADING:n=r.createElement(u.PendingCancel,null),i=this.cancelUpload;break;case c.STAGE.NEED_UPLOAD:n=r.createElement(u.Upload,{filesize:t.size}),i=this.resumeUpload;break;case c.STAGE.REMOTE_NEED_UPLOAD:n=r.createElement(u.Upload,{filesize:t.size}),i=this.resumeRemoteUpload;break;case c.STAGE.ERROR_MISSING:i=this.showMediaMissing;break;case c.STAGE.ERROR_UNSUPPORTED:e.isUnsentMedia||(n=r.createElement(u.Download,{filesize:t.size}),i=this.downloadUnsupportedToDesktop);break;default:n=r.createElement(u.Pending,null)}var a=null,s=y.durationStr(t.duration);s&&(a=r.createElement("span",{className:"message-duration"},r.createElement("span",{className:"icon-s icon-msg-video-light"}),s));var o=t.preview?{backgroundImage:'url("'+t.preview.url()+'")'}:void 0,l=r.createElement("div",{className:"image-thumb-body",style:o});t.preview||void 0===t.preview||C.assert(!1,"media-preview-invalid","Invalid preview: "+t.preview)();var f=this.props.displayAuthor&&h.shouldRender(e)?r.createElement(h,{msg:e}):null,m=r.createElement("div",{className:"shade"}),g=e.caption?r.createElement(d,{msg:e}):null,v=g?"bubble-image bubble-video bubble-image-caption":"bubble-image bubble-video",E=null;return r.createElement("div",{onClick:this.stopEvent},r.createElement("div",{className:v},f,this.props.quotedMsg,E,r.createElement("div",{className:"image-thumb",onClick:i},n,l,m,a),g,r.createElement(p,{msg:this.props.msg})))}});e.exports=M},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(15),s=i(a),r=n(5),o=i(r),l=n(6),c=i(l),u=n(19),d=i(u),p=n(18),h=i(p),f=n(453),m=i(f),g=n(23),v=i(g),y=n(8),E=n(44),_=n(1544),b=n(1560),C=n(1405),M=n(43),S=n(76),T=n(1409),w=(n(1365),n(9)),k=n(1),P={KEEP_SCROLL_BOTTOM:"KEEP_SCROLL_BOTTOM",KEEP_SCROLL_TOP:"KEEP_SCROLL_TOP",SCROLL_BOTTOM:"SCROLL_BOTTOM",NONE:"NONE",DEFAULT:"DEFAULT"},N={};N[P.KEEP_SCROLL_BOTTOM]=2,N[P.KEEP_SCROLL_TOP]=2,N[P.SCROLL_BOTTOM]=2,N[P.NONE]=1,N[P.DEFAULT]=0;var x=function(e){function t(e){return(0,o["default"])(this,t),(0,d["default"])(this,(0,s["default"])(t).call(this,e))}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"shouldComponentUpdate",value:function(e){return e.updateType!==P.NONE}},{key:"componentWillUpdate",value:function(e){var t=E.findDOMNode(this).parentNode,n=e.updateType;n===P.KEEP_SCROLL_BOTTOM?this.shouldRestoreScroll=t.scrollHeight-t.scrollTop-t.clientHeight:n===P.KEEP_SCROLL_TOP&&(this.shouldRestoreScroll=t.scrollTop)}},{key:"componentDidMount",value:function(){this.maybeNotifyChatRendered()}},{key:"componentDidUpdate",value:function(e){var t=E.findDOMNode(this).parentNode;this.props.updateType===P.SCROLL_BOTTOM?t.scrollTop=t.scrollHeight:void 0!==this.shouldRestoreScroll&&(this.props.updateType===P.KEEP_SCROLL_BOTTOM?t.scrollTop=t.scrollHeight-this.shouldRestoreScroll-t.clientHeight:t.scrollTop=this.shouldRestoreScroll,this.shouldRestoreScroll=void 0),this.maybeNotifyChatRendered()}},{key:"maybeNotifyChatRendered",value:function(){this.props.notifyChatRendered&&(this.props.focusedMsgCtx&&this.props.focusedMsgCtx.msg&&!v["default"].includes(this.props.msgs,this.props.focusedMsgCtx.msg)||this.props.notifyChatRendered())}},{key:"onCopy",value:function(e){var t=window.getSelection();e.clipboardData.setData("text/plain",T.asPlainText(t)),e.stopPropagation(),e.preventDefault()}},{key:"getMsgVisibility",value:function(e){var t=E.findDOMNode(this).parentNode,n=t.scrollTop,i=n+t.clientHeight,a=E.findDOMNode(e);return a?a.offsetTop+a.clientHeight<=n?{visibility:w.VISIBILITY.ABOVE,offset:a.offsetTop-n}:a.offsetTop>=i?{visibility:w.VISIBILITY.BELOW,offset:a.offsetTop-n}:{visibility:w.VISIBILITY.VISIBLE,offset:a.offsetTop-n}:(k.error("getMsgVisibility on invalid ref: "+e)(),{visibility:w.VISIBILITY.VISIBLE,offset:0})}},{key:"render",value:function(){var e,t,n=[],i=this.props.msgs,a=this.props,s=a.focusedMsgCtx,r=a.unreadCount,o=a.selectedMessages,l=!1,c=void 0,u=0;for(t=0;t<i.length;t++)if(e=i[t]){var d=S.dayOfMsg(e);0!==t&&c===d||(n.push(y.createElement(_,{ref:"dateMarker_"+u,key:"msg-"+e.id+"-date",timestamp:e.t})),l=!1,u+=1),c=d,r>0&&s&&s.isUnreadDivider&&s.msg===e&&(n.push(y.createElement("div",{className:"msg-unread",key:"msg-unread"},y.createElement(b,{count:r}))),l=!1);var p=v["default"].matches({from:e.from,startOfDay:e.startOfDay}),h=v["default"].matches({author:e.author,startOfDay:e.startOfDay}),f=e.isGroupMsg?h:p,g=C.Position.SINGLE,E=i[t+1];(E&&r&&s&&s.isUnreadDivider&&s.msg===E||E&&E.isNotification||E&&d!==S.dayOfMsg(E))&&(E=!1),e.isNotification?g=C.Position.SINGLE:f(E)&&!f(l)?g=C.Position.FRONT:f(l)&&f(E)?g=C.Position.MID:f(l)&&!f(E)&&(g=C.Position.END);var T=s&&s.msg===e,k=e.type===m["default"].TYPE.IMAGE||e.type===m["default"].TYPE.VIDEO||e.type===m["default"].TYPE.AUDIO;n.push(y.createElement(C,{key:"msg-"+e.id,ref:e.id.toString(),msg:e,displayType:w.DISP_TYPE.CONVERSATION,isMsgVisible:k?this.props.isMsgVisible:v["default"].noop,selectable:this.props.selectable,selectedMessages:o,onMessageSelect:this.props.onMessageSelect,position:g,isFocusedMsg:T})),l=!e.isNotification&&e}var P=M("message-list",{selectable:this.props.selectable});return y.createElement("div",{className:P,onCopy:this.onCopy.bind(this)},n)}}]),t}(y.Component);x.UpdateTypes=P,x.UpdateTypePriority=N,e.exports=x},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(1354),o=i(r),l=n(464),c=n(8),u=n(1),d=n(10),p=n(1360),h=n(154),f=n(156),m=n(12),g=n(1389),v=n(1397),y=n(1668),E=n(0),b=n(38),C=n(229),M=n(109),S=c.createClass({displayName:"PTT",mixins:[f,h,p],propTypes:{chat:c.PropTypes.instanceOf(o["default"]),onStateChange:c.PropTypes.func.isRequired},statics:{READY:"ready",DELAY:"delay",REC:"recording",PROCESSSING:"processsing",GUM_TIMEOUT:"ptt_gum_timeout",PERMISSION_DENIED:"permission_denied",NOT_SUPPORTED_ERROR:"not_supported_error",MANDATORY_UNSATISFIED_ERROR:"mandatory_unsatisfied_error",CANCEL:"cancel",SEND:"send"},getInitialState:function(){return{state:S.READY,active:void 0,elapsedTime:0,startTime:0}},componentDidMount:function(){this.regNativeListener(window,"blur",this.cancelRecording)},isRecording:function(){var e=this.state.state;return e===S.REC||e===S.DELAY||e===S.PROCESSSING},cancelRecording:function(){this.isRecording()&&(this.state.state!==S.READY&&this.props.onStateChange(S.READY),this.safeIsMounted()&&this.setState({state:S.READY,active:void 0,elapsedTime:0,startTime:0}),this.clearSafeInterval(this.elapsedTimeInterval),delete this.elapsedTimeInterval,this.recorder&&this.recorder.stop(),this.props.chat.markPaused())},startInterval:function(){var e=this;this.elapsedTimeInterval=this.safeInterval(function(){e.setState({elapsedTime:e.state.elapsedTime+1})},1e3),this.setState({elapsedTime:0,startTime:Date.now()})},cancelPTTTimer:function(){this.pttTimer&&(this.clearSafeTimeout(this.pttTimer),delete this.pttTimer)},onPTTReady:function(){delete this.pttTimer,this.state.state===S.DELAY&&this.setState({state:S.REC})},onMouseOverSend:function(){this.setState({active:S.SEND})},onMouseOutSend:function(){this.setState({active:void 0})},onMouseOverCancel:function(){this.setState({active:S.CANCEL})},onMouseOutCancel:function(){this.setState({active:void 0})},onMouseUpCancel:function(){this.state.elapsedTime<1||(this.cancelPTTTimer(),this.cancelRecording())},onMouseUpSend:function(){var e=this;if(!(this.state.elapsedTime<1)){this.cancelPTTTimer();var t=this.props.chat;if(this.state.state===S.REC){this.setState({state:S.PROCESSSING}),this.props.onStateChange(S.READY);var n=t.regCancellablePromise(b.waitForEvent(this.recorder,"dataAvailable").then(function(e){return e.detail}));(0,l.prepRawMedia)(n,{isPtt:!0,precomputedDuration:~~this.recorder.duration}).sendToChat(t,{quotedMsg:t.composeQuotedMsg||void 0,addEvenWhilePreparing:!0}),t.composeQuotedMsg=null,n["catch"](s["default"].CancellationError,_.noop)["finally"](function(){e.cancelRecording()}),this.recorder.stop()}else this.cancelRecording(),u.log("ptt:onMouseUpSend duration too short")()}},onMouseDown:function(){var e=this;if(this.state.state===S.READY){var t=v.start("microphone");s["default"].race([t,this.rejectOnUnmount()]).checkpoint(this.rejectOnUnmount()).then(function(t){e.recorder=new y({bitRate:16e3,encoderSampleRate:16e3,encoderApplication:2048}),e.recorder.initStream(t),e.recorder.start(),e.props.chat.presence.update()["catch"](m.WapDrop,_.noop),e.props.chat.markRecording(),e.setState({state:S.DELAY}),e.props.onStateChange(S.REC),e.pttTimer=e.safeDelay(e.onPTTReady,1500),e.startInterval()})["catch"](m.Unmount,function(){t.then(function(e){return v.stop(e)})["catch"](_.noop)})["catch"](m.GUM.PermissionDeniedError,function(){d.openModal(c.createElement(g,{title:"guide_desktop_mic_title",desc:"guide_desktop_mic_fail_description",type:g.TYPE.GUIDE_UNBLOCK}))})["catch"](m.GUM.GUMError,function(){d.openModal(c.createElement(g,{title:"guide_desktop_mic_missing_title",desc:"guide_desktop_mic_missing_description",type:g.TYPE.GUIDE_NONE}))})["catch"](function(t){e.recorder&&e.recorder.stop(),u.error("PTT Recording Error")(t)})}},render:function(){var e="btn-close btn-border ptt-close";this.state.active===S.CANCEL&&(e+=" is-hover");var t="btn-border ptt-send";this.state.active===S.SEND&&(t+=" is-hover");var n=void 0;this.state.state!==S.DELAY&&this.state.state!==S.REC||(n=c.createElement(C,{displayName:"PTT",popable:!0,escapable:!0,requestDismiss:this.cancelRecording},c.createElement("div",{className:"ptt-recording",key:"recording"},c.createElement("button",{className:e,onMouseOver:this.onMouseOverCancel,onMouseOut:this.onMouseOutCancel,onMouseUp:this.onMouseUpCancel},c.createElement("span",{className:"icon icon-round-x btn-state-default"}),c.createElement("span",{className:"icon icon-round-x-inv btn-state-hover"})),c.createElement("div",{className:"ptt-counter"},E.unix(this.state.elapsedTime).format("m:ss")),c.createElement("button",{className:t,onMouseOver:this.onMouseOverSend,onMouseOut:this.onMouseOutSend,onMouseUp:this.onMouseUpSend},c.createElement("span",{className:"icon icon-round-send btn-state-default"}),c.createElement("span",{className:"icon icon-round-send-inv btn-state-hover"})))));var i=this.state.state===S.READY||this.state.state===S.PROCESSSING?c.createElement("button",{className:"icon btn-icon icon-ptt",onMouseDown:this.onMouseDown,disabled:this.state.state===S.PROCESSSING,key:"button"}):null,a="ptt-container";return n&&(a+=" active"),c.createElement("div",{className:a},c.createElement(M,{transitionName:"ptt"},n||i))}});e.exports=S},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(1354),o=i(r),l=n(8),c=n(454),u=n(10),d=n(153),p=n(38),h=l.createClass({displayName:"Spam",mixins:[d],propTypes:{chat:l.PropTypes.instanceOf(o["default"]).isRequired},componentWillMount:function(){this.addObserver(Store.Blocklist,"add remove reset"),this.addObserver(this.props.chat,"change:trusted")},confirmReportGroupSpam:function(){u.openModal(l.createElement(c,{onOK:this.reportGroupSpam,okText:l10n.t("report_group_spam"),onCancel:u.closeModal.bind(u),cancelText:l10n.t("web_cancel")},l10n.t("report_group_spam_ack")))},reportGroupSpam:function(){var e=this.props.chat,t=e.sendSpamReport(!0);if(!e.isReadOnly){var n=e.sendExit(),i=p.waitForBBEvent(e.msgs,"change:last",function(e){return e.isGroupLeave();
});t=s["default"].all([t,n,i])}t.then(function(){return e.sendDelete()})["catch"](_.noop),u.closeModal()},confirmReportSpam:function(){u.openModal(l.createElement(c,{onOK:this.reportSpam,okText:l10n.t("report_spam"),onCancel:u.closeModal.bind(u),cancelText:l10n.t("web_cancel")},l10n.t("report_spam_ack")))},reportSpam:function(){var e=this.props.chat;e.sendSpamReport().then(function(){return e.contact.setBlock(!0)}).then(function(){return e.sendDelete()})["catch"](_.noop),u.closeModal()},notSpam:function(){this.props.chat.sendNotSpam(!0)["catch"](_.noop)},confirmBlock:function(){u.openModal(l.createElement(c,{onOK:this.block,okText:l10n.t("block"),onCancel:u.closeModal.bind(u),cancelText:l10n.t("web_cancel")},l10n.t("block_ack")))},block:function(){this.props.chat.contact.setBlock(!0)["catch"](_.noop),u.closeModal()},confirmUnblock:function(){u.openModal(l.createElement(c,{okText:l10n.t("unblock_button"),onOK:this.unblock,cancelText:l10n.t("web_cancel"),onCancel:u.closeModal.bind(u)},l10n.t("unblock_confirmation",{contact:this.props.chat.contact.formattedName})))},unblock:function(){this.props.chat.contact.setBlock(!1)["catch"](_.noop),u.closeModal()},render:function(){var e=this.props.chat;if(e.isPSA||!e.isVisible||e.trusted)return null;var t,n=[];if(e.isGroup)t=l10n.t("group_admin_not_a_contact"),n.push(l.createElement("button",{className:"spam-button btn-plain",key:"report_spam",onClick:this.confirmReportGroupSpam},l10n.t("report_spam")));else{t=l10n.t("sender_not_a_contact"),n.push(l.createElement("button",{className:"spam-button btn-plain",key:"report_spam",onClick:this.confirmReportSpam},l10n.t("report_spam")));var i=Store.Blocklist.get(e.id);i?n.push(l.createElement("button",{onClick:this.confirmUnblock,key:"unblock",className:"spam-button btn-plain"},l10n.t("unblock_button"))):n.push(l.createElement("button",{onClick:this.confirmBlock,key:"block",className:"spam-button btn-plain"},l10n.t("block")))}return n.push(l.createElement("button",{onClick:this.notSpam,key:"not_spam",className:"spam-button btn-plain"},l10n.t("not_spam"))),l.createElement("div",{className:"spam"},l.createElement("div",{className:"spam-text"},t),l.createElement("div",{className:"spam-controls"},n))}});e.exports=h},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(1354),o=i(r),l=n(8),c=n(44),u=n(153),d=n(94),p=n(1385),h=n(1539),f=n(1540),m=n(1445),g=n(1479),v=n(10),y=n(39),E=n(109),b=n(1365),C=n(1356),M=n(9),S=n(1501),T=n(229),w=l.createClass({displayName:"ConversationPanel",mixins:[u,C,d],propTypes:{chat:l.PropTypes.instanceOf(o["default"]).isRequired,msgCollection:l.PropTypes.instanceOf(p).isRequired,focusCtx:l.PropTypes.object,notifyChatRendered:l.PropTypes.func,updateOpenedChatInfo:l.PropTypes.func.isRequired},getInitialState:function(){var e=this.props.chat;return this.fillerHeight=e.fillerHeight||0,this.selectedMessages=new b([],function(e){return e.id.toString()}),{canCompose:e.canSend,selectable:!1,wallpaperColor:this.async("chat.ChatPreference.wallpaperColor")}},componentWillMount:function(){var e=this.props.chat;e.fillerHeight=null,this.addObserver(e,"change:canSend",this.onComposeState),this.openEvent=new y.WebcChatOpen({webcUnreadCount:e.unreadCount})},componentDidMount:function(){var e=this.props.chat;e.set({active:!0,viewed:!0}),this.openEvent&&(this.openEvent.markWebcChatOpenT(),this.openEvent.commit(),delete this.openEvent),this.addObserver(Store.ChatPreference,"wallpaper_color_preview",this.onWallpaperColorPreview),this.regCmd("scroll_messages",this.scrollMessages)},componentWillUnmount:function(){this.props.chat.set("active",!1)},onComposeState:function(){var e=this.props.chat.canSend;this.state.canCompose!==e&&this.setState({canCompose:e})},onComposeHeightChange:function(e,t){var n=this,i=e.input,a=e.overlay,r=c.findDOMNode(this.refs.msgPanel);if(r&&this.refs.msgs){var o=this.refs.msgs.getScrollBottom();if(_.isNumber(i))return void this.refs.msgs.composeHeightChange(i);if(t)return this.fillerHeight=a,void(this.refs.filler&&(this.refs.filler.style.height=this.fillerHeight+"px",this.refs.msgs.setScrollBottom(o)));this.fillerHeight+=a,a<0&&(this.refs.filler&&(this.refs.filler.style.height=this.fillerHeight+"px"),this.refs.msgs&&this.refs.msgs.setScrollBottom(o)),this.msgPanelAnimation||(this.msgPanelAnimation=s["default"].resolve()),this.msgPanelAnimation.cancel(),this.msgPanelAnimation=this.msgPanelAnimation.then(function(){return Velocity(r,{translateY:a>0?[-a,0]:[0,a]},{duration:300,easing:[.1,.82,.25,1]})}).then(function(){return n.msgPanelAnimation=null}).cancellable()["catch"](s["default"].CancellationError,function(){Velocity(r,"finish",!0),r.style.transform=""}).then(function(){n.isMounted()&&(a>0&&n.refs.filler&&(n.refs.filler.style.height=n.fillerHeight+"px"),r.style.transform="",n.refs.msgs&&a>0&&n.refs.msgs.setScrollBottom(o))})}},onWallpaperColorPreview:function(e){e?this.state.wallpaperColor!==e&&this.setState({wallpaperColor:e}):this.setState({wallpaperColor:Store.ChatPreference.get("defaultPreference").wallpaperColor})},onSelectMessages:function(){this.state.selectable||this.setState({selectable:!0})},onCancelSelection:function(){this.state.selectable&&(this.selectedMessages.unsetAll(),this.setState({selectable:!1}))},onMessageSelect:function(e,t){this.onSelectMessages(),this.selectedMessages.setVal(e,t)},onPageUpDown:function(e){this.refs.msgs.onPageUpDown(e)},scrollMessages:function(){var e=this.refs.msgs,t=e&&e.refs.scrollContainer;if(t){var n=_.last(e.msgListInfo.visibleMsgOrder);if(n){var i=c.findDOMNode(e.refs.messageList.refs[n.toString()]);if(i){var a=0;1===e.msgListInfo.visibleMsgOrder.length&&(a=i.clientHeight),Velocity(i,"stop"),Velocity(t,"stop"),Velocity(i,"scroll",{duration:300,container:t,offset:a})}}}},onDragStart:function(e){this.state.canCompose&&(this.blockDrop=!0)},onDragEnd:function(e){this.state.canCompose&&(this.blockDrop=!1)},onDragEnter:function(e){this.state.canCompose&&!this.blockDrop&&(_.includes(e.dataTransfer.types,"Files")||_.includes(e.dataTransfer.types,"text/uri-list")||_.includes(e.dataTransfer.types,"text/html"))&&(v.attachMediaDrawer(this.props.chat,void 0),e.stopPropagation(),e.preventDefault())},render:function(){var e,t,n,i=this.props,a=i.chat,s=i.msgCollection,r=i.focusCtx;if(this.state.selectable)t=l.createElement(T,{displayName:"MultiSelect",escapable:!0,requestDismiss:this.onCancelSelection},l.createElement(g,{chat:a,selectedMessages:this.selectedMessages,onCancel:this.onCancelSelection})),e=l.createElement("footer",{className:"pane-footer pane-chat-footer"}),n=l.createElement("div",{ref:"filler",className:"compose-filler"});else if(this.state.canCompose)e=l.createElement(m,{chat:a,ref:"composeBox",className:"pane-footer pane-chat-footer",onComposeHeightChange:this.onComposeHeightChange,onPageUpDown:this.onPageUpDown}),n=l.createElement("div",{ref:"filler",style:{height:this.fillerHeight+"px"},className:"compose-filler"});else{var o;o=a.isGroup?l10n.t("web_cannot_send_not_a_group_participant"):a.isPSA?l10n.t("web_psa_title"):l10n.t("web_cannot_send_to_blocked_contact_1",{contact:a.contact.formattedName}),e=l.createElement("footer",{className:"pane-footer pane-chat-footer"},l.createElement("div",{className:"block-message"},o))}var c={},u={};return this.state.wallpaperColor!==M.DEFAULT_CHAT_WALLPAPER&&(c.background=this.state.wallpaperColor,c.transition="background 0.3s ease",u.display="none"),l.createElement(T,{displayName:"ConversationPanel",state:T.State.INACTIVE,requestFocus:this.requestFocus},l.createElement("div",{id:"main",className:"pane pane-chat pane-two"},l.createElement("div",{className:"pane-chat-tile",style:u}),l.createElement(h,{chat:a,canAttach:this.state.canCompose,onSelectMessages:this.onSelectMessages}),l.createElement("div",{className:"pane-body pane-chat-tile-container",ref:"msgPanel",onDragStart:this.onDragStart,onDragEnd:this.onDragEnd,onDragOver:this.onDragOver,onDragEnter:this.onDragEnter,style:c},l.createElement(f,{ref:"msgs",chat:a,selectable:this.state.selectable,onMessageSelect:this.onMessageSelect,msgCollection:s,onSelectMessages:this.onSelectMessages,focusCtx:r,selectedMessages:this.selectedMessages,notifyChatRendered:this.props.notifyChatRendered,updateOpenedChatInfo:this.props.updateOpenedChatInfo})),n,e,l.createElement(E,{transitionName:"slide-up"},t),l.createElement(S,null)))}});e.exports=w},function(e,t,n){"use strict";var i=n(8),a=n(44),s=n(109),r=n(94),o=n(229),l=n(482),c=n(43),u=n(1268),d=n(23),p=n(92),h=n(93),f={LEFT:"drawer-left",MID:"slide-up",RIGHT:"slide-left",NONE:"none"},m={LEFT:"left",MID:"mid",RIGHT:"right"},g=function(e){return f[e.toUpperCase()]},v=i.createClass({displayName:"DrawerManager",mixins:[r],propTypes:{direction:i.PropTypes.oneOf(d.values(m)),onDrawerIn:i.PropTypes.func,onDrawerOut:i.PropTypes.func,onDrawerAnimationComplete:i.PropTypes.func},getChildContext:function(){var e=this.state.uim||this.context.uim;return{uim:e}},getInitialState:function(){return{drawer:void 0,drawerId:0,transition:g(this.props.direction),uim:void 0}},componentWillMount:function(){this.regCmd("open_drawer_"+this.props.direction,this.openFlow),this.regCmd("exists_drawer_"+this.props.direction,this.existsFlow),this.regCmd("close_drawer_"+this.props.direction,this.closeFlow)},shouldComponentUpdate:function(e,t){return u(this,e,t)},openFlow:function(e){var t=arguments.length<=1||void 0===arguments[1]?g(this.props.direction):arguments[1],n=arguments[2],i=arguments[3];this.state.drawer?t=f.NONE:this.props.onDrawerIn&&this.props.onDrawerIn();var a=d.uniqueId("DrawerManager"+this.props.direction);this.setState({drawer:e,drawerId:a,transition:t,uim:n,option:i})},existsFlow:function(e){e(!!this.state.drawer)},closeFlow:function(e){e&&this.state.drawerId!==e||this.state.drawer&&(this.props.onDrawerOut&&this.props.onDrawerOut(),this.setState({drawer:void 0}))},requestFocus:function(e){var t=a.findDOMNode(this.refs.UIE);t&&!t.contains(document.activeElement)&&p.focus(t)},render:function(){var e=this.props,t=e.onDrawerAnimationComplete,n=e.direction,a=this.state,r=a.drawer,u=a.drawerId,p=a.transition,h=a.option,f=h&&h.noFocus?null:this.requestFocus;r&&(r=i.createElement(o,{displayName:"Drawer"+d.upperFirst(n),escapable:!0,key:u,ref:"UIE",requestFocus:f,requestDismiss:this.closeFlow.bind(null,u)},i.createElement(l,{style:{height:"100%"}},r)));var g=c("pane",{"pane-one":n===m.LEFT,"pane-two":n===m.MID,"pane-three":n===m.RIGHT});return i.createElement(s,{transitionName:p,className:g,onAnimationComplete:t},r)}});v.contextTypes={uim:i.PropTypes.instanceOf(h)},v.childContextTypes={uim:i.PropTypes.instanceOf(h)},v.Dir=m,v.Transition=f,e.exports=v},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(8),s=i(a),r=n(44),o=i(r),l=n(153),c=i(l),u=n(154),d=i(u),p=n(156),h=i(p),f=n(94),m=i(f),g=n(159),v=i(g),y=n(485),E=i(y),b=n(1662),C=i(b),M=n(1355),S=i(M),T=n(92),w=n(110),k=i(w),P=n(1537),N=i(P),x=n(1369),D=i(x),O=n(462),R=i(O),I=n(93),A=i(I),L=n(229),F=i(L),U=n(1454),G=s["default"].createClass({displayName:"EmojiTab",mixins:[c["default"],h["default"],d["default"],m["default"]],propTypes:{tab:s["default"].PropTypes.oneOf(U.PossibleTabs).isRequired,onEmoji:s["default"].PropTypes.func.isRequired,searchText:s["default"].PropTypes.string,focusPrevSection:s["default"].PropTypes.func,focusNextSection:s["default"].PropTypes.func,onFocusRelease:s["default"].PropTypes.func,scrollEmojiIntoViewIfNeeded:s["default"].PropTypes.func,isSuggestion:s["default"].PropTypes.bool,onResultsEmpty:s["default"].PropTypes.func},emojiList:null,lastFocusedElement:null,rowLength:0,getInitialState:function(){var e={skinTonePicker:!1};return this.props.tab===U.Tab.RECENT&&(e.recent=_.uniq(_.filter(Store.RecentEmoji.models.map(function(e){return v["default"].emojiMap[e["char"]]}))),e.variants={}),e},componentDidMount:function(){var e=this;if(this.addObserver(Store.EmojiVariant,"add remove change:variant",function(){return e.forceUpdate()}),this.props.isSuggestion){var t=this.safeDebounce(this.windowResized,100);this.regNativeListener(window,"resize",t),this.windowResized()}},windowResized:function(){var e=this.getEmojiRowLength();this.rowLength!==e&&(this.rowLength=e,this.forceUpdate())},onEmojiClick:function(e){this.stopEvent(e);var t=e.target.dataset.unicode;t&&(!v["default"].skinToneEmojis[t]||this.state.recent||Store.EmojiVariant.getVariant(t)?this.onEmoji(e.target.dataset.variant||t):this.onContextMenu(e))},onEmojiMouseDown:function(e){this.stopEvent(e);var t=e.target.dataset.unicode;t&&v["default"].skinToneEmojis[t]&&this.startPickerTimer(e)},onEmoji:function(e){this.props.onEmoji(e),this.releaseFocus()},releaseFocus:function(){this.props.onFocusRelease&&this.props.onFocusRelease()},setEmojiVariant:function(e,t,n){if(this.stopEvent(e),this.onEmoji(n),Store.EmojiVariant.setVariant(t,n),this.state.recent){var i=this.state.variants;i[t]=n,this.setState({variants:i})}return!1},stopEvent:function(e){e&&(e.preventDefault(),e.stopPropagation())},onContextMenu:function(e){this.stopEvent(e);var t=e.target.dataset.unicode;t&&v["default"].skinToneEmojis[t]&&this._onContextMenu(t,e.target)},_onContextMenu:function(e,t,n){var i=this;n||(this.lastFocusedElement=null),this.clearPickerTimer();var a=v["default"].skinToneEmojis[e],r=U.SKIN_TONE_VARIATIONS.map(function(t){var n=v["default"].variantToUnicode(a,t);return s["default"].createElement(D["default"],{key:n,a8n:"mi-emoji-variant",action:function(t){return i.setEmojiVariant(t,e,n)}},s["default"].createElement("div",{className:"emoji-picker"},s["default"].createElement(S["default"],{text:n,emojiSize:S["default"].EMOJI_SIZE.LARGE,tabIndex:"-1"})))});this.setState({skinTonePicker:{menu:r,anchor:t,type:R["default"].Type.PICKER,menuDirection:{x:R["default"].Direction.X.RIGHT,y:R["default"].Direction.Y.TOP},layoutDirection:R["default"].LayoutDirection.HORIZONTAL,focusFirstOnMount:n}})},closeSkinTonePicker:function(){this.setState({skinTonePicker:!1})},clearPickerTimer:function(){this.pickerTimer&&(this.unregNativeListener(window,"mouseup",this.clearPickerTimer,!0),this.clearSafeTimeout(this.pickerTimer),this.pickerTimer=null)},eatClick:function(e){this.stopEvent(e),this.unregCmd("window_click",this.eatClick)},startPickerTimer:function(e){var t=this;this.stopEvent(e),this.clearPickerTimer();var n=e.target,i=n.dataset.unicode;this.pickerTimer=this.safeDelay(function(){t.regCmd("window_click",t.eatClick),t._onContextMenu(i,n)},250),this.regNativeListener(window,"mouseup",this.clearPickerTimer,!0)},getEmojiRowLength:function(){var e=this.refs.emojiPanel&&this.refs.emojiPanel.offsetWidth;return e?Math.floor(e/U.EMOJI_WIDTH):8},focusPrevSection:function(e){this.props.focusPrevSection&&(this.props.focusPrevSection(this.props.tab,e),this.lastFocusedElement=null)},focusNextSection:function(e){this.props.focusNextSection&&(this.props.focusNextSection(this.props.tab,e),this.lastFocusedElement=null)},onArrow:function(){this.focusEmoji(0)},onEmojiArrowUp:function(e){this.onEmojiArrow(e,"up")},onEmojiArrowDown:function(e){this.onEmojiArrow(e,"down")},onEmojiArrowLeft:function(e){this.onEmojiArrow(e,"left")},onEmojiArrowRight:function(e){this.onEmojiArrow(e,"right")},onEmojiArrow:function(e,t){this.stopEvent(e);var n=e.target.dataset.emojiIndex;if(n){n=Number(n);var i=this.getEmojiList(),a=this.getEmojiRowLength(),s=n;switch(t){case"up":if(this.props.isSuggestion)s=0;else{if(n<a)return void this.focusPrevSection(n%a);s=n-a}break;case"down":if(this.props.isSuggestion)s=a-1;else{if(Math.floor(n/a)>=Math.floor((i.length-1)/a))return void this.focusNextSection(n%a);s=Math.min(n+a,i.length-1)}break;case"left":if(!(n>0))return void this.focusPrevSection(a-1);s=n-1;break;case"right":if(n+1>=i.length)return void this.focusNextSection(0);s=n+1}this.focusEmoji(s)}},shouldComponentUpdate:function(e,t){return this.props.searchText!==e.searchText||this.state.skinTonePicker!==t.skinTonePicker},componentWillUpdate:function(e,t){this.emojiList=null},getEmojiList:function(){if(this.emojiList)return this.emojiList;if(this.props.searchText){var e=(0,C["default"])(this.props.searchText);this.emojiList=_.compact(_.map(e,function(e){return _.get(v["default"].emojiMap,e)}))}else this.state.recent?this.emojiList=this.state.recent:this.emojiList=E["default"][this.props.tab.key];var t=this.getEmojiRowLength();return this.props.isSuggestion&&this.emojiList.length>t?this.emojiList=this.emojiList.slice(0,t):this.props.isSuggestion&&this.props.onResultsEmpty&&!this.emojiList.length&&this.props.onResultsEmpty(),this.emojiList},getEmoji:function(){var e=this,t=this.getEmojiList(),n=t.map(function(t,n){var i=v["default"].codeToEmoji[t],a=void 0;return v["default"].skinToneEmojis[i]&&(a=e.state.recent?e.state.variants[i]:Store.EmojiVariant.getVariant(i),a&&(t=v["default"].emojiMap[a])),s["default"].createElement("span",{key:i,"data-unicode":i,"data-variant":a,tabIndex:"-1","data-emoji-index":n,className:v["default"].getClasses(t,"large")})}),i={up:this.onEmojiArrowUp,down:this.onEmojiArrowDown,left:this.onEmojiArrowLeft,right:this.onEmojiArrowRight,enter:this.onEmojiEnter};return s["default"].createElement(k["default"],{ref:"emojis",onMouseDown:this.onEmojiMouseDown,onClick:this.onEmojiClick,onContextMenu:this.onContextMenu,handlers:i},n)},onEmojiEnter:function(e){this.stopEvent(e);var t=e.target.dataset.emojiIndex;if(t){var n=this.getEmojiList(),i=n[t],a=v["default"].codeToEmoji[i];this.keyboardSelectEmoji(e,a)}},keyboardSelectRow:function(e,t){var n=this.getEmojiRowLength(),i=this.getEmojiList().length,a=0;a=t*n>=i?i-i%n:n*t;var s=this.getEmojiList()[a];if(s){this.stopEvent(e);var r=v["default"].codeToEmoji[s];this.keyboardSelectEmoji(e,r)}},keyboardSelectEmoji:function(e,t){if(v["default"].skinToneEmojis[t])if(this.state.recent&&!this.props.searchText){var n=this.state.variants[t];this.onEmoji(n||t)}else{var i=Store.EmojiVariant.getVariant(t);i?this.onEmoji(i):(this.stopEvent(e),this._onContextMenu(t,e.target,!0))}else this.onEmoji(t)},focusElement:function(e){(0,T.focus)(e),this.lastFocusedElement=e},focusEmoji:function(e){if(!(e<0)){var t=o["default"].findDOMNode(this.refs.emojis).children;if(!(e>=t.length)){var n=t[e];this.focusElement(n),this.props.scrollEmojiIntoViewIfNeeded&&this.props.scrollEmojiIntoViewIfNeeded(n)}}},focusRow:function(e){var t=this.getEmojiRowLength();e*t>=this.getEmojiList().length?this.focusLastRow(0):this.focusEmoji(t*e)},focusFirstRow:function(e){var t=this.getEmojiRowLength();this.focusEmoji(Math.min(t-1,e))},focusLastRow:function(e){var t=this.getEmojiRowLength(),n=this.getEmojiList().length,i=n-n%t+e;i=Math.min(i,n-1),this.focusEmoji(i)},restoreFocus:function(){this.lastFocusedElement&&this.focusElement(this.lastFocusedElement)},render:function(){var e=void 0;this.state.skinTonePicker&&(e=s["default"].createElement(F["default"],{displayName:"SkinTonePicker",popable:!0,escapable:!0,requestDismiss:this.closeSkinTonePicker},s["default"].createElement(N["default"],{tooltip:this.state.skinTonePicker})));var t=void 0;return t=this.props.tab===U.Tab.RECENT&&0===this.getEmojiList().length||this.props.searchText||this.props.isSuggestion?null:s["default"].createElement("div",{className:"emoji-panel-title"},this.props.tab.title()),s["default"].createElement("div",{ref:"emojiPanel",className:this.props.tab.className},t,this.getEmoji(),e)}});G.contextTypes={uim:s["default"].PropTypes.instanceOf(A["default"])},e.exports=G},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e){switch((0,g.gifProvider)()){case"giphy":return s(e);case"tenor":return o(e);default:throw new Error("Unrecognized provider "+(0,g.gifProvider)())}}function s(e){var t=!e,n=void 0;return n=t?N.request("https://api.giphy.com/v1/gifs/trending","GET",{api_key:D,limit:100,rating:"pg-13"},"json"):N.request("https://api.giphy.com/v1/gifs/search","GET",{q:e,api_key:D,limit:100,rating:"pg-13"},"json"),n["catch"](function(){return null}).then(function(e){return e&&e.status<300&&r(e.response,t)})}function r(e,t){if(!e||!_.isArray(e.data))return[];for(var n=e.data,i=[],a=0;a<n.length;a++){var s=n[a];if(s&&s.images){var r=s.images.downsizedSmall,o=s.images.fixed_height,l=s.images.fixed_width,c=void 0,u=void 0;if(l&&l.mp4){var d=parseInt(l.height,10);d===d&&d<R&&(c=l,u=R*g.TARGET_GIF_HEIGHT/d)}if(o&&o.mp4){var p=parseInt(l.width,10);p===p&&p<R&&(c=o,u=p*g.TARGET_GIF_HEIGHT/R)}c&&i.push(new g.GifInfo(i.length,r&&r.url||c.mp4,c.mp4,c.webp||c.gif||void 0,Math.round(u),g.GIPHY,t))}}return i}function o(e){var t=!e,n=l10n.lng().replace("-","_"),i=void 0;return i=t?N.request("https://api.tenor.co/v1/trending","GET",{key:O,limit:50,safesearch:"moderate",locale:n},"json"):N.request("https://api.tenor.co/v1/search","GET",{tag:e,key:O,limit:50,safesearch:"moderate",locale:n},"json"),i["catch"](function(){return null}).then(function(e){return e&&e.status<300&&l(e.response)})}function l(e,t){if(!e||!_.isArray(e.results))return[];for(var n=e.results,i=[],a=0;a<n.length;a++){var s=n[a];if(s&&s.media&&s.media[0]){var r=s.media[0],o=r.tinymp4,l=r.previewmp4,c=r.previewgif;if(o){var u=(0,d["default"])(o.dims,2),p=u[0],h=u[1];i.push(new g.GifInfo(i.length,o.url,l&&l.url||void 0,c&&c.url||void 0,Math.round(p*g.TARGET_GIF_HEIGHT/h),g.TENOR,t))}}}return i}function c(e,t){for(var n=[],i=.9*t,a=e,s=null,r=.05;r<1&&a.length;r+=.05){a.sort(function(e,t){var n=e.rank-t.rank;return Math.abs(n)>8?n:t.width-e.width});for(var o=(1+r)*t,l=[],c=[],u=0;u<a.length;u++){for(var d=a[u],p=!1,h=Math.min(o-d.width,i),f=0;!p&&f<l.length;f++)l[f]<h&&(l[f]+=d.width+g.GAP_SIZE,c[f].push(d),p=!0);p||(l.push(d.width),c.push([d]))}if(1===c.length){a=[];var m=t-l[0]-g.GAP_SIZE;s={gifs:c[0],blankStr:m>0?m+"px":void 0}}else{a=[];for(var v=0;v<c.length;v++)l[v]>i?n.push(c[v]):a.push.apply(a,c[v])}}n.forEach(function(e){return e.sort(function(e,t){return e.rank-t.rank})}),n.sort(function(e,t){return e[0].rank-t[0].rank});var y=n.map(function(e){return{gifs:e,blankStr:void 0}});return s&&y.push(s),y}var u=n(47),d=i(u),p=n(2),h=i(p),f=n(453),m=i(f),g=n(1395),v=n(1453),y=i(v),E=n(8),b=n(44),C=n(12),M=n(39),S=n(78),T=n(60),w=n(1360),k=n(38),P=n(1670),N=n(96),x=n(1572),D="3o85xmWDYKgihhIKSA",O="DLAQBEYLJJIM",R=200,I={giphy:M.GIF_SEARCH_PROVIDER.GIPHY,tenor:M.GIF_SEARCH_PROVIDER.TENOR},A={giphy:m["default"].GIF_ATTRIBUTION.GIPHY,tenor:m["default"].GIF_ATTRIBUTION.TENOR},L=new P(a,{maxCached:6,maxAge:36e4,shouldCache:function(e){return!(!e||!e.length)}}),F=E.createClass({displayName:"GifSearch",mixins:[w],propTypes:{searchText:E.PropTypes.string,onGif:E.PropTypes.func.isRequired},getInitialState:function(){return this._scrollTop=0,this._animatingRow=null,this._containerDom=null,this._didSendGif=!1,{gifRows:[],width:0}},componentWillReceiveProps:function(e){e.searchText!==this.props.searchText&&this.scheduleQuery()},shouldComponentUpdate:function(e,t){return e.onGif!==this.props.onGif||t.gifRows!==this.state.gifRows},componentWillMount:function(){var e=this;this._searchTimer=new T(this.searchForAndSetGifs),this._animateTimer=new T(this.animateGif),this._onlineRestarter=h["default"].loop(function(){return k.waitForBBEvent(S,"change:online",function(){return S.online}).then(function(){return e.scheduleQuery()})}).cancellable(),this._onlineRestarter["catch"](h["default"].CancellationError,_.noop),this.searchForAndSetGifs(),new M.GifSearchSessionStarted({gifSearchProvider:I[(0,g.gifProvider)()]}).commit()},componentWillUnmount:function(){this._animateTimer.cancel(),this._searchTimer.cancel(),this._onlineRestarter.cancel(),this._didSendGif||new M.GifSearchCancelled({gifSearchProvider:I[(0,g.gifProvider)()]}).commit()},scheduleQuery:function(){this._searchTimer.debounceAndCap(200,2e3)},animateOnScroll:function(e){this._scrollTop=e.scrollTop,this._animateTimer.debounce(200)},onSend:function(e){var t=I[e.attribution];new M.GifFromProviderSent({gifSearchProvider:t}).commit(),e.trending||new M.GifSearchResultTapped({gifSearchProvider:t,rank:e.rank}).commit(),this._didSendGif=!0,this.props.onGif(e.url,A[e.attribution])},setGifAnimating:function(e,t){var n=this.refs[e];n&&n.setShouldAnimate(t)},animateGif:function(){var e=this,t=this._animatingRow,n=this._scrollTop;this._starredGifsDom&&(n-=this._starredGifsDom.clientHeight);var i=Math.round(n/(g.TARGET_GIF_HEIGHT+g.GAP_SIZE)),a=this.state.gifRows[i];if(a&&a.gifs.length&&a!==t){if(this._animatingRow=a,t)for(var s=0;s<t.gifs.length;s++)this.setGifAnimating(t.gifs[s].gifId,!1);for(var r=0;r<a.gifs.length;r++)this.setGifAnimating(a.gifs[r].gifId,!0)}[i+1,i-1].forEach(function(t){if(e.state.gifRows[t])for(var n=e.state.gifRows[t].gifs,i=0;i<n.length;i++)e.setGifAnimating(n[i].gifId,!1)})},searchForAndSetGifs:function(){var e=this,t=I[(0,g.gifProvider)()],n=this.props.searchText,i=L.getOrRun(n);i=i.then(),this._pendingQuery=i,i.checkpoint(this.rejectOnUnmount()).then(function(a){if(a&&0===a.length&&new M.GifSearchNoResults({gifSearchProvider:t}).commit(),i===e._pendingQuery&&(e._pendingQuery=null,a)){n||new M.GifTrendingViewed({gifSearchProvider:t}).commit();var s=e._containerDom.clientWidth;s-=2*g.GAP_SIZE,e._resetScroll=!0,e._animateTimer.debounce(0),e.setState({gifRows:c(a,s),width:s})}})["catch"](C.Unmount,h["default"].CancellationError,_.noop),n&&setTimeout(function(){e.rejectOnUnmount().isPending()&&n===e.props.searchText&&new M.GifSearchPerformed({gifSearchProvider:t}).commit()},500)},onStarredGifsMount:function(e){this._starredGifsDom=b.findDOMNode(e)},onContainerMount:function(e){this._containerDom=e,null!==e&&this._resetScroll&&(e.scrollTop=0)},render:function(){var e=this,t=this.state.gifRows;this._gifPreviews={};var n=t.map(function(t,n){var i=t.gifs.map(function(t,n){return E.createElement(y["default"],{key:t.gifId,ref:t.gifId,gif:t,display:!0,onSend:e.onSend})}),a=null;return t.blankStr&&(a=E.createElement("div",{className:"gif-search-blank",style:{flexBasis:t.blankStr}})),E.createElement("div",{key:n,className:"gif-search-row"},i,a)}),i=void 0;n.length&&!this.props.searchText&&(i=E.createElement("div",{className:"gif-section-title"},l10n.t("gif_trending_title")));var a=void 0;return this.props.searchText||(a=E.createElement(x,{onSend:this.onSend,ref:this.onStarredGifsMount})),E.createElement("div",{className:"gif-search-container",ref:this.onContainerMount},a,i,n)}});e.exports=F},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(8),s=i(a),r=n(43),o=i(r),l=n(153),c=i(l),u=n(1453),d=i(u),p=n(1395),h=n(453),f=i(h),m=n(231),g=i(m),v=n(1392),y=i(v),E=n(10),_=i(E),b=n(454),C=i(b),M=s["default"].createClass({displayName:"StarredGifPreview",mixins:[c["default"]],propTypes:{msg:s["default"].PropTypes.instanceOf(f["default"]).isRequired,onSend:s["default"].PropTypes.func.isRequired},animateGif:function(){var e=this;this.uiIdle(function(){e._gifRef&&e._gifRef.setShouldAnimate(!0)})},componentDidMount:function(){this.animateGif()},componentDidUpdate:function(){this.animateGif()},componentWillMount:function(){var e=this.props.msg;this.addObserver(e,"change:mediaData.mediaStage"),this.uiIdle(function(){e.downloadMedia()})},setGifRef:function(e){this._gifRef=e},getGifProvider:function(){var e=this.props.msg.gifAttribution;switch(e){case f["default"].GIF_ATTRIBUTION.GIPHY:return p.GIPHY;case f["default"].GIF_ATTRIBUTION.TENOR:return p.TENOR;default:return}},handleClick:function(e){e.stopPropagation();var t=this.props.msg.mediaData;switch(t.mediaStage){case g["default"].STAGE.NEED_POKE:this.props.msg.downloadMedia(!0);break;case g["default"].STAGE.FETCHING:this.props.msg.cancelDownload();break;case g["default"].STAGE.UPLOADING:this.props.msg.cancelUpload();break;case g["default"].STAGE.ERROR_MISSING:_["default"].openModal(s["default"].createElement(C["default"],{title:l10n.t("missing_photo_title"),onOK:_["default"].closeModal.bind(_["default"]),okText:l10n.t("web_ok")},l10n.t("missing_photo_text")))}},onUnstarMsg:function(){this.props.msg.chat.sendStarMsgs([this.props.msg],!1)},render:function(){var e=this.props.msg,t=e.mediaData,n=new p.GifInfo((void 0),t.renderableUrl,(void 0),(void 0),Math.round(t.thumbWidth*p.TARGET_GIF_HEIGHT/t.thumbHeight),this.getGifProvider(),(!1));if(t.mediaStage===g["default"].STAGE.RESOLVED)return s["default"].createElement(d["default"],{key:e.filehash,ref:this.setGifRef,gif:n,display:!0,onSend:this.props.onSend,isStarred:!0,onUnstarMsg:this.onUnstarMsg});var i=t.preview?t.preview.url():null,a=void 0;switch(t.mediaStage){case g["default"].STAGE.ERROR_MISSING:break;case g["default"].STAGE.NEED_POKE:a=s["default"].createElement(y["default"].Download,null);break;case g["default"].STAGE.FETCHING:case g["default"].STAGE.UPLOADING:a=s["default"].createElement(y["default"].PendingCancel,null);break;default:a=s["default"].createElement(y["default"].Pending,null)}var r=(0,o["default"])("image-thumb-body","image-thumb-gif",{blur:t.mediaStage===g["default"].STAGE.ERROR_MISSING}),l=s["default"].createElement("div",{className:r,style:{backgroundImage:"url("+i+")",height:p.TARGET_GIF_HEIGHT+"px"}});return s["default"].createElement("div",{className:"gif-search-gif-wrapper",style:{flexBasis:n.widthStr},key:e.filehash},s["default"].createElement("div",{style:{width:n.widthStr},onClick:this.handleClick},s["default"].createElement("div",null,a,l)),s["default"].createElement("span",{className:"icon-s icon-star-light",onClick:this.onUnstarMsg}))}});e.exports=M},function(e,t,n){"use strict";var i=n(8),a=n(43),s=n(153),r=n(1571),o=n(1395),l=o.TARGET_GIF_HEIGHT,c=o.GAP_SIZE,u={RIGHT:"RIGHT",LEFT:"LEFT"},d=4,p=i.createClass({displayName:"StarredGifs",mixins:[s],propTypes:{onSend:i.PropTypes.func.isRequired},getInitialState:function(){return{curIndex:0,direction:u.RIGHT}},componentWillMount:function(){var e=Store.StarredGifMsgs;this.addObserver(e,"add remove reset"),e.isSynced||e.sync()},onSlideLeft:function(){this.setState({curIndex:this.state.curIndex-1,direction:u.LEFT})},onSlideRight:function(){this.setState({curIndex:this.state.curIndex+1,direction:u.RIGHT})},render:function(){var e=this,t=Store.StarredGifMsgs.models;if(0===t.length)return i.createElement("div",null);if(t.length<=d){var n=0,s=t.map(function(t){return n+=Math.round(t.mediaData.thumbWidth*l/t.mediaData.thumbHeight),i.createElement(r,{key:t.filehash,msg:t,onSend:e.props.onSend})});return n+=(s.length-1)*c,i.createElement("div",{className:"star-gifs-container"},i.createElement("div",{className:"gif-section-title"},l10n.t("gif_starred_title")),i.createElement("div",{className:"gif-search-row",style:{maxWidth:n+"px"}},s))}var o=void 0,u=void 0,p=this.state.curIndex>0,h=this.state.curIndex+d<t.length,f=p?this.onSlideLeft:null,m=h?this.onSlideRight:null,g=a("star-gifs-pager gifs-pager-left",{"gifs-pager-disabled":!p}),v=a("star-gifs-pager gifs-pager-right",{"gifs-pager-disabled":!h});o=i.createElement("div",{className:g,onClick:f},i.createElement("span",{className:"icon icon-chevron-left-alt"})),u=i.createElement("div",{className:v,onClick:m},i.createElement("span",{className:"icon icon-chevron-right-alt"}));var y=t.slice(this.state.curIndex,this.state.curIndex+d).map(function(t){return i.createElement(r,{key:t.filehash,msg:t,onSend:e.props.onSend})});return i.createElement("div",{className:"star-gifs-container"},i.createElement("div",{className:"gif-section-title"},l10n.t("gif_starred_title")),i.createElement("div",{className:"gif-search-row"},o,i.createElement("div",{className:"starred-gifs-body"},y),u))}});e.exports=p},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(230),s=i(a),r=n(232),o=i(r),l=n(8),c=n(1364),u=n(454),d=n(1355),p=n(10),h=n(1608),f=l.createClass({displayName:"AddContactToGroupFlow",mixins:[c],propTypes:{contact:l.PropTypes.instanceOf(o["default"]).isRequired},getDefaultTransition:function(){var e;return e={},(0,s["default"])(e,c.Dir.PUSH,c.Transition.NONE),(0,s["default"])(e,c.Dir.POP,c.Transition.NONE),e},filter:function(e){var t=e.groupMetadata;return!(!e.isGroup||e.isGroup&&!t.participants.iAmMember())&&(t.participants.get(this.props.contact.id)?l10n.t("already_added_to_group"):!!t.participants.iAmAdmin()||l10n.t("chat_not_an_admin"));
},componentWillMount:function(){this.push(l.createElement(h,{chats:Store.Chat.filter(function(e){return e.isGroup}),filter:this.filter,onCancel:this.pop,onGroup:this.confirmAddToGroup}))},confirmAddToGroup:function(e){this.push(l.createElement(u,{onOK:this.addToGroup.bind(null,e),okText:l10n.t("add_group_participant"),onCancel:this.pop,cancelText:l10n.t("web_cancel")},l.createElement(d,{text:l10n.t("confirm_add_group_participant",{participant:this.props.contact.formattedName,subject:e.contact.name})})))},addToGroup:function(e){e.groupMetadata.participants.addParticipant(this.props.contact).then(function(){p.openChatFromUnread(e).then(function(t){t&&p.focusChatTextInput(e)})})["catch"](_.noop),this.endFlow()}});e.exports=f},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(230),s=i(a),r=n(1354),o=i(r),l=n(8),c=n(1364),u=n(454),d=n(1425),p=n(10),h=n(1355),f=l.createClass({displayName:"AddGroupParticipantFlow",mixins:[c],propTypes:{chat:l.PropTypes.instanceOf(o["default"]).isRequired},getDefaultTransition:function(){var e;return e={},(0,s["default"])(e,c.Dir.PUSH,c.Transition.NONE),(0,s["default"])(e,c.Dir.POP,c.Transition.NONE),e},componentWillMount:function(){this.push(l.createElement(d,{title:l10n.t("add_group_participant"),filter:this.contactFilter,onCancel:this._pop,onSelect:this.confirmAddParticipant}))},contactFilter:function(e){var t=this.props.chat.groupMetadata;return!!Store.Contact.isFilteredContact(e)&&(!t.participants.get(e.id)||l10n.t("already_added_to_group"))},confirmAddParticipant:function(e){var t=this.onAddParticipant.bind(this,e),n=l10n.t("confirm_add_group_participant",{participant:e.formattedName,subject:this.props.chat.contact.name});this.push(l.createElement(u,{onOK:t,okText:l10n.t("add_group_participant"),onCancel:this._pop,cancelText:l10n.t("web_cancel")},l.createElement(h,{text:n})))},_pop:function(){this.pop()},onAddParticipant:function(e){this.props.chat.groupMetadata.participants.addParticipant(e)["catch"](_.noop),p.closeModal()}});e.exports=f},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1354),s=i(a),r=n(8),o=n(1364),l=n(153),c=n(1591),u=n(10),d=n(58),p=n(1631),h=r.createClass({displayName:"AttachMediaFlow",mixins:[o,l],propTypes:{files:r.PropTypes.array,chat:r.PropTypes.instanceOf(s["default"]).isRequired},getInitialState:function(){this.mediaCollection=new p},componentWillMount:function(){u.closeContextMenu(),u.closeTooltip(),this.push(r.createElement(c,{chat:this.props.chat,files:this.props.files,onBack:this.endFlow,onSendMedia:_.once(this.sendMedia),onDropText:_.once(this.setText),mediaCollection:this.mediaCollection}))},componentDidMount:function(){var e=this;this.uiIdle(function(){e.initializeFiles()})},componentWillUnmount:function(){var e=this;d.isGecko?_.defer(function(){return u.focusChatTextInput(e.props.chat)}):u.focusChatTextInput(this.props.chat),this.mediaCollection&&this.mediaCollection["delete"]()},initializeFiles:function(){var e=this.props.files;e&&this.mediaCollection.processFiles(e,this.props.chat)},sendMedia:function(e){var t=this.props.chat;_.delay(function(){e.forEach(function(e,n){var i={};0===n&&(i.quotedMsg=t.composeQuotedMsg,t.composeQuotedMsg=null),i.caption=e.caption,e.mediaPrep.sendToChat(t,i)})},300),this.endFlow()},setText:function(e){var t=this.props.chat;_.delay(function(){u.pasteChatTextInput(t,e)},300),this.endFlow()}});e.exports=h},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1354),s=i(a),r=n(464),o=n(8),l=n(1364),c=n(1397),u=n(1458),d=o.createClass({displayName:"CaptureFlow",mixins:[l],propTypes:{chat:o.PropTypes.instanceOf(s["default"]).isRequired,stream:o.PropTypes.object.isRequired},componentWillMount:function(){this.push(o.createElement(u,{onBack:this.endFlow,caption:!0,onSend:this.sendMedia,stream:this.props.stream}))},componentWillUnmount:function(){this.props.stream&&c.stop(this.props.stream)},sendMedia:function(e){var t=e.file,n=e.caption,i=this.props.chat,a=i.composeQuotedMsg;i.composeQuotedMsg=null,(0,r.prepRawMedia)(t,{}).sendToChat(i,{caption:n||void 0,quotedMsg:a||void 0}),this.endFlow()}});e.exports=d},function(e,t,n){"use strict";var i=n(8),a=n(1364),s=n(1397),r=n(1458),o=n(1461),l=i.createClass({displayName:"EditCaptureFlow",mixins:[a],propTypes:{stream:i.PropTypes.object.isRequired,onFinished:i.PropTypes.func.isRequired},pushCaptureDrawer:function(e){this.push(i.createElement(r,{onBack:this.cleanUp,onCaptured:this.onCaptured,onSend:_.noop,stream:this.props.stream}))},componentWillMount:function(){this.pushCaptureDrawer()},componentWillUnmount:function(){this.closeStream()},closeStream:function(){this.props.stream&&s.stop(this.props.stream)},onFinished:function(e,t){this.props.onFinished(e,t),this.cleanUp()},cleanUp:function(){this.closeStream(),this.endFlow()},onCaptured:function(e,t){this.push(i.createElement(o,{onCancel:this.cleanUp,onRetake:this.pop,onFinished:this.onFinished,size:t,img:e}))}});e.exports=l},function(e,t,n){"use strict";var i=n(8),a=n(1364),s=n(1461),r=i.createClass({displayName:"EditImageFlow",mixins:[a],propTypes:{img:i.PropTypes.string.isRequired,onFinished:i.PropTypes.func.isRequired},componentWillMount:function(){this.push(i.createElement(s,{onCancel:this.pop,onFinished:this.onFinished,img:this.props.img}))},onFinished:function(e,t){this.props.onFinished(e,t),this.endFlow()}});e.exports=r},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(230),s=i(a),r=n(1354),o=i(r),l=n(8),c=n(1606),u=n(1364),d=l.createClass({displayName:"GroupInviteRevokeFlow",mixins:[u],propTypes:{chat:l.PropTypes.instanceOf(o["default"]).isRequired,onConfirm:l.PropTypes.func.isRequired},getDefaultTransition:function(){var e;return e={},(0,s["default"])(e,u.Dir.PUSH,u.Transition.NONE),(0,s["default"])(e,u.Dir.POP,u.Transition.NONE),e},componentWillMount:function(){this.push(l.createElement(c,{chat:this.props.chat,onConfirm:this.props.onConfirm}))}});e.exports=d},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(453),s=i(a),r=n(8),o=n(44),l=n(9),c=n(10),u=n(154),d=n(1360),p=n(153),h=n(1612),f=n(1437),m=n(155),g=n(1),v=n(75),y=n(12),E=n(43),b=n(109),C=r.createClass({displayName:"MediaViewerFlow",mixins:[u,d,p],propTypes:{msg:r.PropTypes.instanceOf(s["default"]).isRequired,getZoomNode:r.PropTypes.func,startTime:r.PropTypes.number},getInitialState:function(){this.zoomIn=!0;var e=this.props.msg;return this.mediaMsgs=e.chat.constructMediaMsgs(e),{activeMsg:e,imgZoomed:!1}},componentWillMount:function(){this.regNativeListener(window,"keydown",this.onKeyDown)},componentDidMount:function(){var e=this;this.zoomIn=!1,v.supportsFeature(v.F.MEDIA_GALLERY)&&this.uiIdle(function(){e.mediaMsgs.loadMoreAroundIfNeeded(e.state.activeMsg)}),this.addObserver(this.mediaMsgs,"remove reset",function(t,n,i){if(e.mediaMsgs.indexOf(t)>-1||e.state.activeMsg!==t)return void e.forceUpdate();var a=i.index;0===e.mediaMsgs.length?e.endFlow():e.mediaMsgs.length===a?e.onSelectThumb(e.mediaMsgs.at(a-1)):e.onSelectThumb(e.mediaMsgs.at(a))}),this.addObserver(this.mediaMsgs,"query_media_after"),this.addObserver(this.mediaMsgs,"query_media_before",function(){var t=o.findDOMNode(e.refs.thumbs);t&&(e.prevScrollWidth=t.scrollWidth,e.forceUpdate())}),this.scrollToActive(),Velocity(this.refs.thumbsContainer,{opacity:[1,0],translateY:["0%","100%"]},{duration:300,delay:100,easing:[.1,.82,.25,1]})},componentDidUpdate:function(e,t){if(t.activeMsg!==this.state.activeMsg)this.scrollToActive(!0);else{var n=o.findDOMNode(this.refs.thumbs);if(!n||!this.prevScrollWidth)return;n.scrollLeft+=n.scrollWidth-this.prevScrollWidth,this.prevScrollWidth=null}},onKeyDown:function(e){37===e.keyCode?this.onPrev():39===e.keyCode&&this.onNext()},onScroll:function(e){this.handleScroll(e.target)},handleScroll:_.throttle(function(e){var t=this;0!==this.mediaMsgs.length&&(this.mediaMsgs.hasMediaBefore&&e.scrollLeft<e.clientWidth&&!function(){var e=t.mediaMsgs.head();t.uiIdle(function(){t.mediaMsgs.queryMedia(e.chat,e),t.forceUpdate()})}(),this.mediaMsgs.hasMediaAfter&&e.scrollLeft+l.SCROLL_FUDGE>e.scrollWidth-2*e.clientWidth&&!function(){var e=t.mediaMsgs.last();t.uiIdle(function(){t.mediaMsgs.queryMedia(e.chat,e,"after"),t.forceUpdate()})}())},100),onNext:function(e){var t=this;if(e&&e.stopPropagation(),!this.state.imgZoomed){var n=this.state.activeMsg,i=this.mediaMsgs.getAfter(n);return i?void this.onSelectThumb(i):void(v.supportsFeature(v.F.MEDIA_GALLERY)&&this.mediaMsgs.hasMediaAfter&&(this._queryMediaAfter||(this._queryMediaAfter=this.mediaMsgs.queryMedia(n.chat,n,"after").checkpoint(this.rejectOnUnmount()).then(function(e){e.length>0&&t.state.activeMsg===n&&t.onNext()})["catch"](y.Unmount,_.noop)["catch"](function(e){g.error("query media msgs error: ",e)})["finally"](function(){t._queryMediaAfter=null}))))}},onPrev:function(e){var t=this;if(e&&e.stopPropagation(),!this.state.imgZoomed){var n=this.state.activeMsg,i=this.mediaMsgs.getBefore(n);return i?void this.onSelectThumb(i):void(v.supportsFeature(v.F.MEDIA_GALLERY)&&this.mediaMsgs.hasMediaBefore&&(this._queryMediaBefore||(this._queryMediaBefore=this.mediaMsgs.queryMedia(n.chat,n,"before").checkpoint(this.rejectOnUnmount()).then(function(e){e.length>0&&t.state.activeMsg===n&&t.onPrev()})["catch"](y.Unmount,_.noop)["catch"](function(e){g.error("query media msgs error: ",e)})["finally"](function(){t._queryMediaBefore=null}))))}},onImgZoomIn:function(e){this.setState({imgZoomed:e})},endFlow:function(){c.closeModalMedia()},willEndFlow:function(){Velocity(this.refs.thumbsContainer,{opacity:[0,1],translateY:["100%","0%"]},{duration:300,easing:[.1,.82,.25,1]})},onSelectThumb:function(e,t){var n=this;v.supportsFeature(v.F.MEDIA_GALLERY)&&this.uiIdle(function(){n.mediaMsgs.loadMoreAroundIfNeeded(e)}),this.setState({activeMsg:e})},scrollToActive:function(){var e=!(arguments.length<=0||void 0===arguments[0])&&arguments[0],t=this.refs.thumbsContainer,n=o.findDOMNode(this.refs.thumbs),i=o.findDOMNode(this.refs.activeThumb);if(t&&n&&i){var a=i.clientWidth/2-t.clientWidth/2;Velocity(n,"stop");var s=0;e&&(s=300),Velocity(i,"scroll",{duration:s,container:n,offset:a,axis:"x",easing:[.1,.82,.25,1]})}},getThumbs:function(){var e=this,t=this.mediaMsgs.map(function(t){var n=E("media-thumb",{active:t===e.state.activeMsg});return r.createElement(f,{classes:n,msg:t,ref:t===e.state.activeMsg?"activeThumb":null,key:"media-"+t.id.id,onClick:e.onSelectThumb.bind(e,t)})});return t.push(r.createElement("div",{className:"media-thumb-spinner media-thumb",key:"spinner-right"},this.mediaMsgs.queryMediaAfter?r.createElement(m,{stroke:6,size:24}):null)),t.unshift(r.createElement("div",{className:"media-thumb-spinner media-thumb",key:"spinner-left"},this.mediaMsgs.queryMediaBefore?r.createElement(m,{stroke:6,size:24}):null)),t.push(r.createElement("div",{className:"media-thumb-padding",key:"padding-right"})),t.unshift(r.createElement("div",{className:"media-thumb-padding",key:"padding-left"})),t},render:function(){var e=this.mediaMsgs.last(),t=this.mediaMsgs.hasMediaAfter||this.state.activeMsg!==e?this.onNext:null,n=this.mediaMsgs.head(),i=this.mediaMsgs.hasMediaBefore||this.state.activeMsg!==n?this.onPrev:null,a=this.getThumbs(),s=v.supportsFeature(v.F.MEDIA_GALLERY)?this.onScroll:null;return r.createElement("div",{className:this.state.imgZoomed?"img-zoomed-in":null},r.createElement("div",{className:"media-collection media-viewer-thumbs-container",ref:"thumbsContainer"},r.createElement("div",{onScroll:s,style:{width:"100%"},dir:"ltr"},r.createElement(b,{className:"media-viewer-thumbs",ref:"thumbs",transitionName:"thumb-scale"},a))),r.createElement(h,{msg:this.state.activeMsg,onBack:this.endFlow,onExitAnimation:this.willEndFlow,onNext:t,onPrev:i,onImgZoomIn:this.onImgZoomIn,getZoomNode:this.props.getZoomNode,startTime:this.props.startTime,zoomIn:this.zoomIn}))}});e.exports=C},function(e,t,n){"use strict";var i=n(8),a=n(1364),s=n(1595),r=n(10),o=i.createClass({displayName:"NewChatFlow",mixins:[a],componentWillMount:function(){this.push(i.createElement(s,{title:l10n.t("new_chat_flow_title"),onBack:this.endFlow,onClick:this.onClick}))},onClick:function(e,t){Store.Chat.find(t.id).then(r.openChatFromUnread.bind(r)),this.endFlow()}});e.exports=o},function(e,t,n){"use strict";var i=n(8),a=n(1364),s=n(1615),r=n(1616),o=i.createClass({displayName:"NewGroupFlow",mixins:[a],componentWillMount:function(){this.push(i.createElement(s,{onBack:this.endFlow,onContinue:this.groupParticipants}))},groupParticipants:function(e,t,n){this.push(i.createElement(r,{subject:e,thumb:t,full:n,onBack:this.participantsBack,onContinue:_.once(this.createGroup)}))},createGroup:function(e,t,n,i){Store.Chat.createGroup(e,t,n,i),this.endFlow()},participantsBack:function(e,t,n){this.pop()}});e.exports=o},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(230),o=i(r),l=n(1354),c=i(l),u=n(1482),d=i(u),p=n(8),h=n(1364),f=n(10),m=n(9),g=n(1424),v=n(461),y=p.createClass({displayName:"SendGroupInviteFlow",mixins:[h],propTypes:{chat:p.PropTypes.instanceOf(c["default"]).isRequired},getDefaultTransition:function(){var e;return e={},(0,o["default"])(e,h.Dir.PUSH,h.Transition.NONE),(0,o["default"])(e,h.Dir.POP,h.Transition.NONE),e},componentWillMount:function(){var e=this;this.push(p.createElement(g,{onChat:this.onForwardConfirmed,title:l10n.t("group_invite_send_link_title")}));var t=this.props.chat;this.linkPreview={canonicalUrl:m.GROUP_INVITE_LINK_URL,description:l10n.t("whatsapp_group_invite"),matchedText:t.groupMetadata.groupInviteLink,title:t.title()};var n=t.contact.profilePicThumb;n&&n.imgFull?v.generateLinkPreview(n.imgFull).then(function(t){e.linkPreview.thumbnail=t}):(0,d["default"])(t.groupMetadata.groupInviteLink).then(function(t){var n=(t.url,t.data);(n.title||n.description)&&(e.linkPreview.thumbnail=n.thumbnail)})["catch"](_.noop)},onForwardConfirmed:function(e){var t=this;s["default"].map(e,function(e){var n=void 0;n=e.isUser&&e.contact.isBlocked()?e.contact.setBlock(!1):s["default"].resolve(!0),n.then(function(n){e.sendMessage(t.props.chat.groupMetadata.groupInviteLink,t.linkPreview)})}),this.endFlow(),f.openChatFromUnread(_.head(e))}});e.exports=y},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(8),o=n(1364),l=n(10),c=n(1424),u=n(23),d=r.createClass({displayName:"SendMsgMultiFlow",mixins:[o],propTypes:{msgText:r.PropTypes.string.isRequired},componentWillMount:function(){this.push(r.createElement(c,{onChat:this.onForwardConfirmed,title:l10n.t("msg_send_title")}))},onForwardConfirmed:function(e){var t=this.props.msgText;1===e.length?!function(){var n=void 0,i=u.head(e);n=i.isUser&&i.contact.isBlocked()?i.contact.setBlock(!1):s["default"].resolve(!0),n.then(function(e){return t&&i.setComposeContents({text:t}),l.openChatFromUnread(i).then(function(e){e&&l.focusChatTextInput(i)})})}():(s["default"].map(e,function(e){var n=void 0;n=e.isUser&&e.contact.isBlocked()?e.contact.setBlock(!1):s["default"].resolve(!0),n.then(function(n){e.sendMessage(t)})}),l.openChatFromUnread(u.head(e))),this.endFlow()}});e.exports=d},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1619),s=i(a),r=n(8),o=n(1364),l=n(1592),c=n(1464),u=n(1617),d=n(1609),p=n(1630),h=n(33),f=r.createClass({displayName:"SettingsFlow",mixins:[o],componentWillMount:function(){this.push(r.createElement(s["default"],{profileId:Store.Conn.me,onWallpaper:this.showWallpaperDrawer,onBlocked:this.showBlockedDrawer,onProfile:this.showProfileDrawer,onNotifications:this.showNotifications,onHelp:this.showHelp,onClose:this._pop}))},showWallpaperDrawer:function(){this.push(r.createElement(p,{onClose:this._pop}))},showBlockedDrawer:function(){this.push(r.createElement(l,{onClose:this._pop}))},showProfileDrawer:function(){this.push(r.createElement(c,{id:Store.Conn.me,onClose:this._pop}))},showNotifications:function(){this.push(r.createElement(u,{onClose:this._pop}))},showHelp:function(){h.upload("help-page-opened"),this.push(r.createElement(d,{onClose:this._pop}))},_pop:function(){this.pop()}});e.exports=f},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(15),s=i(a),r=n(5),o=i(r),l=n(6),c=i(l),u=n(19),d=i(u),p=n(18),h=i(p),f=n(8),m=i(f),g=n(1587),v=i(g),y=n(1622),E=i(y),_=n(1625),b=i(_),C=n(453),M=(i(C),n(1374)),S=(i(M),function(e){function t(){(0,o["default"])(this,t);var e=(0,d["default"])(this,(0,s["default"])(t).apply(this,arguments));return e.openStatusViewer=e.openStatusViewer.bind(e),e}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"componentWillMount",value:function(){this.push(m["default"].createElement(E["default"],{onOpenStatus:this.openStatusViewer}))}},{key:"openStatusViewer",value:function(e,t){this.push(m["default"].createElement(b["default"],{initialStatusV3:e}))}}]),t}(v["default"]));e.exports=S},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(15),s=i(a),r=n(5),o=i(r),l=n(6),c=i(l),u=n(19),d=i(u),p=n(18),h=i(p),f=n(8),m=i(f),g=n(1),v=i(g),y=n(23),E=i(y),_=n(109),b=i(_),C=n(43),M=i(C),S=n(93),T=i(S),w=n(229),k=i(w),P=function(e){function t(){var e,n,i,a;(0,o["default"])(this,t);for(var r=arguments.length,l=Array(r),c=0;c<r;c++)l[c]=arguments[c];return n=i=(0,d["default"])(this,(e=(0,s["default"])(t)).call.apply(e,[this].concat(l))),i.state={_stack:[],_transition:"default",_activeKey:0},a=n,(0,d["default"])(i,a)}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"push",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?"default":arguments[1];this.setState({_stack:this.state._stack.concat(e),_transition:t,_activeKey:++this.state._activeKey})}},{key:"pop",value:function(){var e=arguments.length<=0||void 0===arguments[0]?"default":arguments[0],t=E["default"].dropRight(this.state._stack);t.length?this.setState({_stack:t,_transition:e,_activeKey:--this.state._activeKey}):this.end()}},{key:"end",value:function(e){this.context.uim.uie.requestDismiss(e)}},{key:"render",value:function(){var e=this,t=this.state,n=t._stack,i=t._transition,a=t._activeKey,s=E["default"].last(n);v["default"].assert(!!s,"empty-flow",s)(),s=m["default"].createElement(k["default"],{displayName:"FlowDrawer"+a,key:a,escapable:!0,requestDismiss:function(){return e.pop()}},s);var r=(0,M["default"])("flow-drawer-container");return m["default"].createElement(b["default"],{transitionName:i,className:r},s)}}]),t}(f.Component);P.contextTypes={uim:m["default"].PropTypes.instanceOf(T["default"])},t["default"]=P},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(158),s=i(a),r=n(234),o=i(r),l=n(15),c=i(l),u=n(5),d=i(u),p=n(6),h=i(p),f=n(19),m=i(f),g=n(18),v=i(g),y=n(8),E=i(y),_=n(23),b=i(_),C=n(1371),M=i(C),S=n(1406),T=i(S);e.exports=function(e){var t,n;return n=t=function(t){function n(){var e,t,i,a;(0,d["default"])(this,n);for(var s=arguments.length,r=Array(s),l=0;l<s;l++)r[l]=arguments[l];return t=i=(0,m["default"])(this,(e=(0,c["default"])(n)).call.apply(e,[this].concat(r))),i.timers=new o["default"],i.timerId=0,i.setInterval=function(e,t){var n=setInterval(e,t);return i.reg(function(){return clearInterval(n)})},i.clearInterval=function(e){var t=i.timers.get(e);t&&t()},i.setTimeout=function(e,t){var n=setTimeout(e,t);return i.reg(function(){return clearTimeout(n)})},i.clearTimeout=function(e){var t=i.timers.get(e);t&&t()},i.debounce=function(e,t,n){var a=++i.timerId,s=b["default"].debounce(function(){i.timers["delete"](a),e()},t,n),r=s.cancel.bind(s);return s.cancel=function(){i.timers["delete"](a),r()},i.timers.set(a,s.cancel),s},i.reg=function(e){var t=++i.timerId;return i.timers.set(t,function(){i.timers["delete"](t),e()}),t},a=t,(0,m["default"])(i,a)}return(0,v["default"])(n,t),(0,h["default"])(n,[{key:"componentWillUnmount",value:function(){this.timers.forEach(function(e){return e()})}},{key:"render",value:function(){return E["default"].createElement(e,(0,s["default"])({ref:C.HOCRef,setInterval:this.setInterval,clearInterval:this.clearInterval,setTimeout:this.setTimeout,clearTimeout:this.clearTimeout,debounce:this.debounce},this.props))}}]),n}(M["default"]),t.displayName="Timer("+(0,T["default"])(e)+")",n}},function(e,t,n){"use strict";var i=n(8),a=n(458),s=n(43),r=n(9),o=n(58),l=i.createClass({displayName:"IntroPanel",propTypes:{animate:i.PropTypes.bool,className:i.PropTypes.string},componentDidMount:function(){var e=this.refs.image,t=this.refs.text;this.props.animate?(Velocity(e,{scale:[1,0],opacity:[1,0]},{delay:1340,duration:180,easing:[.05,1.02,0,1.01]}),Velocity(t,{translateY:[0,80],opacity:[1,0]},{delay:1300,duration:140,easing:[.05,1.02,0,1.01]})):(e.style.opacity=1,t.style.opacity=1)},render:function(){var e=void 0,t=void 0;switch(o.os){case r.OS_TYPE.MAC:t=l10n.t("intro_native_mac");break;case r.OS_TYPE.WINDOWS:t=l10n.t("intro_native_windows")}return t&&(e=i.createElement(c,null,i.createElement("span",{className:"icon icon-laptop intro-secondary-icon"}),t,i.createElement("a",{href:"https://www.whatsapp.com/download",className:"intro-secondary-link",target:"_blank"},l10n.t("intro_native_link")))),i.createElement("div",{className:s("intro",this.props.className)},i.createElement("div",{className:"intro-body"},i.createElement("div",{ref:"image",className:"intro-image"}),i.createElement("div",{ref:"text",className:"intro-text-container"},i.createElement("h1",{"data-a8n":a.key("intro-title"),className:"intro-title"},l10n.t("intro_title")),i.createElement("div",{"data-a8n":a.key("intro-text"),className:"intro-text"},l10n.t("intro_connection")),e)))}}),c=i.createClass({displayName:"IntroSecondary",propTypes:{children:i.PropTypes.node.isRequired},render:function(){return i.createElement("div",{className:"intro-secondary"},i.createElement("div",{className:"intro-divider"}),i.createElement("div",{className:"intro-secondary-text"},this.props.children))}});e.exports=l},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1366),s=i(a),r=n(1390),o=i(r),l=n(110),c=i(l),u=n(8),d=n(44),p=n(10),h=n(1357),f=n(1359),m=n(1358),g=n(1370),v=n(153),y=n(1372),E=n(92),_=n(93),b=u.createClass({displayName:"ArchivedDrawer",mixins:[v],getInitialState:function(){this.selection=new y([],function(e){return e.id})},componentDidMount:function(){this.addObserver(Store.Chat,"change:archive add remove"),this.refs.list&&E.focus(d.findDOMNode(this.refs.list))},onClick:function(e,t){p.openChatFromUnread(t).then(function(e){e&&p.focusChatTextInput(t)}),this.onClose()},onClose:function(){this.context.uim.uie.requestDismiss()},getList:function(){return Store.Chat.filter("archive")},onNextChat:function(e){e.preventDefault(),e.stopPropagation(),this.selection.setNext()},onPrevChat:function(e){e.preventDefault(),e.stopPropagation(),this.selection.setPrev()},render:function(){var e=this,t=void 0,n=this.getList();if(this.selection.init(n,!0),n.length>0){var i=n.map(function(t){return u.createElement(o["default"],{chat:t,mode:r.Mode.LAST,key:t.id,active:e.selection,onClick:e.onClick})}),a={down:this.onNextChat,up:this.onPrevChat};t=u.createElement(c["default"],{handlers:a,ref:"list",className:"drawer-section-main chatlist","data-list-scroll-container":!0},u.createElement(s["default"],{data:i,height:s["default"].DEFAULT_HEIGHT,extraItems:4}))}else t=u.createElement(g.Archived,null);return u.createElement(h,{id:"blocked",onCancel:this.onClose},u.createElement(f,{title:l10n.t("archived_flow_title"),onBack:this.onClose,type:f.Type.LARGE}),u.createElement(m,null,t))}});b.contextTypes={uim:u.PropTypes.instanceOf(_)},e.exports=b},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(453),s=i(a),r=n(110),o=i(r),l=n(1354),c=i(l),u=n(8),d=n(44),p=n(12),h=n(1467),f=n(154),m=n(156),g=n(1360),v=n(153),y=n(9),E=n(10),b=n(1481),C=n(43),M=n(1387),S=n(1410),T=n(1357),w=n(1359),k=n(1358),P=n(1412),N=n(1490),x=n(1488),D=n(1491),O=n(1489),R=n(92),I=n(59),A=n(155),L=n(456),F=n(109),U=n(457),G=s["default"].TYPE,j=G.IMAGE,B=G.VIDEO,V=G.DOCUMENT,q=G.AUDIO,H=n(113),z=_.pickBy(H.MIMETYPES,function(e){return e.msgType===V}),W=function(e){return 150+15*e},Y=400,K=h.STATE.PROCESSING,Q=u.createClass({displayName:"AttachMediaDrawer",mixins:[f,m,g,v],propTypes:{chat:u.PropTypes.instanceOf(c["default"]),files:u.PropTypes.array,mediaCollection:u.PropTypes.object.isRequired,onBack:u.PropTypes.func.isRequired,onSendMedia:u.PropTypes.func.isRequired,onDropText:u.PropTypes.func.isRequired},getDefaultProps:function(){return{isDragging:!1}},getInitialState:function(){return this.transition="media-scale",{activeMedia:null}},componentWillMount:function(){this.regNativeListener(window,"drop",this.onWindowDrop)},componentDidMount:function(){this.addObserver(this.props.mediaCollection,"add remove reset"),this.addObserver(this.props.mediaCollection,"change:state",this.onProcessComplete),this.addObserver(this.props.mediaCollection,"max_upload_limit",this.showIgnoredToast)},componentWillUpdate:function(e,t){var n=t.activeMedia,i=this.state.activeMedia;return i&&n&&i!==n?void(this.props.mediaCollection.indexOf(n)>this.props.mediaCollection.indexOf(i)?this.transition="media-slide-forward":this.transition="media-slide-back"):void(this.transition="media-scale")},componentDidUpdate:function(e,t){!t.activeMedia&&this.state.activeMedia&&this.refs.emojiInput?this.refs.emojiInput.restoreFocus():!d.findDOMNode(this).contains(document.activeElement)&&this.refs.sendButton&&R.focus(this.refs.sendButton)},onProcessComplete:function(){if(!this.props.mediaCollection.some({state:K})){var e=this.props.mediaCollection.getValidMedias(),t=this.props.mediaCollection.uiProcessMsgs(),n=t.activeMedia,i=t.errorMsgs;i&&e.length>0&&E.openToast(u.createElement(L,{msg:i,id:L.genId()})),n?this.setState({activeMedia:n}):this.forceUpdate()}},showIgnoredToast:function(e){if(e>0){var t=l10n.t("too_many_files_uploaded",{number:e,_plural:e,max:y.MAX_FILES});E.openToast(u.createElement(L,{msg:t,id:L.genId()}))}},onDragStart:function(e){this.blockDrop=!0},onDragEnd:function(e){this.blockDrop=!1},onDragOver:function(e){this.state.isDragging||this.blockDrop||this.setState({isDragging:!0})},onWindowDrop:function(e){_.isEmpty(this.props.files)&&_.isEmpty(this.props.mediaCollection)&&this.props.onBack()},onDrop:function(e){this.blockDrop||(this.setState({isDragging:!1}),this.onFilePick(e))},onDragLeave:function(e){this.props.mediaCollection.length||this.props.onBack(),this.setState({isDragging:!1})},onKeyDown:function(e){if(this.state.activeMedia&&!e.repeat)if(37===e.keyCode){var t=this.state.activeMedia,n=this.refs.emojiInput&&this.refs.emojiInput.refs.inputLine;(t&&!t.caption||n&&(n.isAtBeginning()||null===n.getCursor()))&&this.onPrev()}else if(39===e.keyCode){var i=this.state.activeMedia,a=this.refs.emojiInput&&this.refs.emojiInput.refs.inputLine;(i&&!i.caption||a&&(a.isAtEnd()||null===a.getCursor()))&&this.onNext()}else 13===e.keyCode&&this.onSend()},onNext:function(){var e=this.props.mediaCollection.getAfter(this.state.activeMedia);e&&(this.refs.sendButton&&R.focus(this.refs.sendButton),this.setState({activeMedia:e}))},onPrev:function(){var e=this.props.mediaCollection.getBefore(this.state.activeMedia);e&&(this.refs.sendButton&&R.focus(this.refs.sendButton),this.setState({activeMedia:e}))},onSelectThumb:function(e,t){e!==this.state.activeMedia&&this.setState({activeMedia:e})},onSend:function(e){this.props.onSendMedia(_.map(this.props.mediaCollection.getValidMedias(),function(e){var t=e.caption;return t&&(t=_.trim(e.caption)),t&&(t=U.emojify(t)),e.caption=t||void 0,e})),e&&e.preventDefault()},onAddFileClick:function(e){var t=this.refs.input;t.click()},onFilePick:function(e){var t=this;b.getFiles(e).then(function(e){return t.props.mediaCollection.processFiles(e,t.props.chat)}).checkpoint(this.rejectOnUnmount())["catch"](p.Unmount,_.noop)["catch"](p.MediaDragDropError,function(e){if(t.props.mediaCollection.length)throw e;t.props.onDropText(e.src)}),e.target.value=""},onRemoveThumb:function(e,t){t.stopPropagation(),t.preventDefault();var n=this.props.mediaCollection.getBefore(e)||this.props.mediaCollection.getAfter(e);this.props.mediaCollection.remove(e),this.setState({activeMedia:n})},onCaptionChange:function(e){var t=this.state.activeMedia;t.caption=e.target.value,this.setState({media:t})},onPaste:function(e){e.preventDefault(),e.stopPropagation();var t=new S(e.clipboardData);t.hasFiles()&&this.onFiles(t)},onFiles:function(e){var t=_.filter(e.getFiles(),function(e){var t=I.typeFromMimetype(e.type);return"image"===t||"video"===t});this.props.mediaCollection.processFiles(t,this.props.chat)},getMedia:function(){var e=void 0,t=void 0,n=this.state.activeMedia;switch(n.media.type){case j:case B:var i=void 0;n.media.fullWidth&&n.media.fullHeight&&(i={width:n.media.fullWidth,height:n.media.fullHeight}),e=u.createElement(N,{mimeType:n.media.mimetype,url:n.url,isGif:!!n.media.isGif,size:i}),t=u.createElement("div",{className:"media-caption"},u.createElement(M,{ref:"emojiInput",editable:!0,value:n.caption,placeholder:l10n.t("add_a_caption"),maxLength:y.MAX_CAPTION_LENGTH,showRemaining:!0,onEnter:this.onSend,onChange:this.onCaptionChange,onFiles:this.onFiles,supportsEmoji:!0}));break;case q:e=u.createElement(x,{mimeType:n.media.mimetype,url:n.url});break;case V:switch(H.previewType(n.media.mimetype)){case"pdf":e=u.createElement(D,{preview:n.generatedPreview,mimeType:n.media.mimetype,filename:n.media.filename});break;case"msoffice":e=u.createElement(O,{preview:n.generatedPreview,mimeType:n.media.mimetype,filename:n.media.filename});break;default:e=u.createElement(P,{mimeType:n.media.mimetype,filename:n.media.filename})}}return u.createElement("div",{className:"media-body-container",key:n.id},e,t)},getThumbs:function(e){var t=this;return e.map(function(e,n){var i=C("media-thumb","stagger-delay",{active:e===t.state.activeMedia}),a=t.props.mediaCollection.indexOf(t.state.activeMedia),s=Math.max(t.props.mediaCollection.length-a-1,1),r=W(n)/s*Math.max(0,n-a)+"ms";return u.createElement(X,{className:i,key:"media-"+e.id,media:e,onClick:t.onSelectThumb.bind(null,e),onClose:t.onRemoveThumb.bind(null,e),staggerDelay:r})})},render:function(){var e=void 0,t=void 0,n=void 0,i=0,a=this.props.mediaCollection.getValidMedias();a.length>y.MAX_FILES&&(a=a.slice(0,y.MAX_FILES)),this.props.mediaCollection.some({state:K})?e=u.createElement(A,{key:"processing"}):this.state.activeMedia?e=this.getMedia():0===a.length&&this.props.mediaCollection.errorMsgs&&(e=u.createElement("div",{className:"invalid-media-container",key:"pending"},u.createElement("div",{className:"invalid-media"},this.props.mediaCollection.errorMsgs))),a.length>0&&(t=this.getThumbs(a),i=1===a.length?Y:Y+W(a.length),n=u.createElement("div",{className:"drawer-controls",tabIndex:"-1",ref:"sendButton",onKeyPress:function(e){return e.preventDefault()}},u.createElement("button",{className:"btn btn-round btn-l",onClick:this.onSend},u.createElement("span",{className:"icon icon-send-light"}))));var s=this.state.isDragging?u.createElement("div",{key:"container",className:"drag-drop"},u.createElement("div",{className:"stitching"},l10n.t("drag_media_here"))):null,r=a.length<y.MAX_FILES?u.createElement("div",{key:"media-more",className:"media-thumb btn-add-media",onClick:this.onAddFileClick},u.createElement("button",{className:"btn-fill"},u.createElement("span",{className:"icon icon-add-alt"}),l10n.t("add_media"))):null,l={enter:this.onKeyDown,left:this.onKeyDown,right:this.onKeyDown};return u.createElement(o["default"],{handlers:l},u.createElement(T,{key:"attach-image-modal",ref:"container",position:"right",id:"media",variant:"noheader",onDrop:this.onDrop,onDragOver:this.onDragOver,onDragLeave:this.onDragLeave},u.createElement(w,{title:l10n.t("web_preview_msg"),type:w.Type.OFFSET,onCancel:this.props.onBack}),u.createElement(k,{tabIndex:"-1",onDragStart:this.onDragStart,
onPaste:this.onPaste,onDragEnd:this.onDragEnd},s,u.createElement("div",{className:"media-body"},u.createElement(F,{transitionName:this.transition},e)),u.createElement(F,{transitionName:"thumb-scale",className:"media-collection"},t,r),u.createElement(F,{transitionName:"btn",delay:i},n),u.createElement("input",{ref:"input",type:"file",accept:y.IMAGE_MIMES+","+y.VIDEO_MIMES,style:{display:"none"},onChange:this.onFilePick,multiple:!0}))))}}),X=u.createClass({displayName:"AttachMediaThumb",propTypes:{media:u.PropTypes.instanceOf(h).isRequired,className:u.PropTypes.string,onClick:u.PropTypes.func,onClose:u.PropTypes.func},render:function(){var e=this.props,t=e.media,i=e.className,a=e.onClick,s=e.onClose,r=void 0,o=void 0,l=void 0;switch(t.media.type){case j:l={backgroundImage:"url("+t.url+")"},r=u.createElement("div",{className:"media-thumb-body",style:l});break;case B:l={backgroundImage:"url(data:image/jpeg;base64,"+t.preview+")"},r=u.createElement("div",{className:"media-thumb-body",style:l});break;case q:r=u.createElement("div",{className:"attach-media-audio-thumb"});break;case V:var c=n(1);if(c.log("media is",t)(),t.media.documentPreview&&t.media.documentPreview.thumbUrl){var d={backgroundImage:"url("+t.media.documentPreview.thumbUrl+")"};z[t.media.mimetype]&&(o=z[t.media.mimetype].icon),o=C(o,"icon-doc","icon-doc-thumb-filetype"),r=u.createElement("div",{className:"media-thumb-body",style:d},u.createElement("div",{className:o}));break}z[t.media.mimetype]&&(o=z[t.media.mimetype].icon);default:o=C(o,"icon-doc"),r=u.createElement("div",{className:"media-thumb-body"},u.createElement("div",{className:o}))}return u.createElement("div",{className:i,onClick:a},u.createElement("span",{className:"btn-delete icon icon-x-alt-light",onClick:s}),r)}});e.exports=Q},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1366),s=i(a),r=n(8),o=n(10),l=n(1357),c=n(1359),u=n(1358),d=n(1370),p=n(1376),h=n(454),f=n(153),m=n(1425),g=r.createClass({displayName:"BlockedDrawer",mixins:[f],propTypes:{onClose:r.PropTypes.func},componentWillMount:function(){this.addObserver(Store.Blocklist,"add remove")},onBlockConfirm:function(e){e.setBlock(!0)["catch"](_.noop),o.closeModal()},onBlock:function(e){var t=function(e){return!!Store.Contact.isFilteredContact(e)&&(!Store.Blocklist.get(e.id)||l10n.t("participant_already_blocked"))};o.openModal(r.createElement(m,{title:l10n.t("add_blocked_title"),filter:t,onCancel:o.closeModal.bind(o),onSelect:_.once(this.onBlockConfirm)}))},onUnblockConfirm:function(e){e.setBlock(!1)["catch"](_.noop),o.closeModal()},onUnblockCancel:function(){o.closeModal()},onUnblock:function(e,t){o.openModal(r.createElement(h,{okText:l10n.t("unblock_button"),onOK:this.onUnblockConfirm.bind(this,t),cancelText:l10n.t("web_cancel"),onCancel:this.onUnblockCancel},l10n.t("unblock_confirmation",{contact:t.formattedName})))},render:function(){var e=this,t=void 0,n=void 0;if(Store.Blocklist.length>0){var i=Store.Blocklist.map(function(t){return r.createElement(p,{contact:t.contact,key:t.contact.id,onClick:e.onUnblock,onDelete:e.onUnblock})});t=r.createElement("div",{className:"drawer-section-main chatlist","data-list-scroll-container":!0},r.createElement(s["default"],{data:i,height:s["default"].DEFAULT_HEIGHT,extraItems:4})),n=r.createElement("div",{className:"hint"},l10n.t("add_blocked_description"))}else t=r.createElement(d.Blocked,null);return r.createElement(l,{id:"blocked",onCancel:this.props.onClose},r.createElement(c,{title:l10n.t("blocked_flow_title"),onBack:this.props.onClose,type:c.Type.LARGE}),r.createElement(u,null,r.createElement("div",{className:"list-action",onClick:this.onBlock},r.createElement("div",{className:"list-action-icon"},r.createElement("span",{className:"icon icon-add-user"})),r.createElement("div",{className:"list-action-body"},l10n.t("add_blocked_title"))),t,n))}});e.exports=g},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1354),s=i(a),r=n(1366),o=i(r),l=n(8),c=n(1356),u=n(153),d=n(10),p=n(76),h=n(1376),f=n(1357),m=n(1358),g=n(1381),v=n(1388),y=n(1361),E=n(1399),_=n(93),b=n(75),C=l.createClass({displayName:"BroadcastInfoDrawer",mixins:[c,u],propTypes:{chat:l.PropTypes.instanceOf(s["default"]).isRequired},getInitialState:function(){return{everyoneEncrypted:this.async("chat.contact.plaintextDisabled")}},componentWillMount:function(){var e=this.props.chat.groupMetadata;this.addObserver(e.participants,"add remove sort reset")},onParticipantClick:function(e,t){Store.Conn.me!==t.id&&Store.Chat.find(t.id).then(function(e){d.openChatFromUnread(e).then(function(t){t&&d.focusChatTextInput(e)})})},onClose:function(){this.props.onClose?this.props.onClose():this.context.uim.uie.requestDismiss()},onDelete:function(){d.deleteOrExitChat(this.props.chat)},render:function(){var e=this.props.chat,t=e.groupMetadata,n=this.onParticipantClick,i=t.participants.map(function(e){var t=Store.Contact.get(e.id)||Store.Contact.add({id:e.id});return l.createElement(h,{contact:t,admin:!!e.isAdmin,onClick:n,key:e.id})}),a=null;if(this.props.onMediaGallery){var s=l.createElement("span",{className:"icon icon-chevron-right-alt"}),r=b.supportsFeature(b.F.LINK_DOC_GALLERY)?l10n.t("media_links_docs"):l10n.t("media");a=l.createElement(g,{title:r,titleOnClick:this.props.onMediaGallery,subtitle:s,classes:"animate-enter2",noContainer:!0},l.createElement(E,{chat:e,mediaMsgs:e.getMediaMsgs()}))}var c,u=null,d=i.length?l.createElement(g,{classes:"animate-enter1 well-simple-body",title:l10n.t("web_recipients_title"),subtitle:l10n.n(i.length),"data-list-scroll-offset":!0},l.createElement("div",{className:"drawer-section-body chatlist"},l.createElement(o["default"],{data:i,height:72,extraItems:4}))):null;e.canDelete()&&(c=l.createElement("div",{className:"drawer-section chatlist list-icons animate-enter2 well-simple"},l.createElement(v,{iconClass:"icon-delete-danger",a8n:"li-delete-broadcast",className:"danger first",onClick:this.onDelete},l10n.t("web_delete_list"))));var _;e.groupMetadata.creation?(_=p.timeStr(e.groupMetadata.creation),_=l.createElement("div",{className:"header-secondary"},l10n.t("web_group_creation_time",{when:_}))):_=null;var C=null,M=null;return(u||C)&&(M=l.createElement(g,{classes:"well-simple animate-enter2"},u,C)),l.createElement(f,{key:"contact-info-modal",id:"info",variant:"panel",onCancel:this.onClose},l.createElement("header",{className:"pane-header"},l.createElement("div",{className:"header-close"},l.createElement("button",{onClick:this.onClose},l.createElement("span",{className:"icon icon-x"}))),l.createElement("div",{className:"header-body"},l.createElement("div",{className:"header-main"},l.createElement("div",{className:"header-title"},l10n.t("broadcast_list_info")),_))),l.createElement(m,{expands:!!i.length,"data-list-scroll-container":!0},l.createElement(g,{classes:"drawer-scale drawer-section-photo"},l.createElement(y,{id:e.id,size:y.Size.LARGE})),a,M,d,c))}});C.contextTypes={uim:l.PropTypes.instanceOf(_)},e.exports=C},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1354),s=i(a),r=n(8),o=n(458),l=n(10),c=n(75),u=n(1379),d=n(1355),p=n(454),h=r.createClass({displayName:"ClearChatPopup",propTypes:{onCancel:r.PropTypes.func,onDeleteOrExit:r.PropTypes.func,chat:r.PropTypes.instanceOf(s["default"]).isRequired},getInitialState:function(){return{keepStarred:!0}},getText:function(){var e=this.props.chat;switch(e.kind){case s["default"].KIND.GROUP:return l10n.t("clear_chat_group",{name:e.title()});case s["default"].KIND.CHAT:return l10n.t("clear_chat_chat",{name:e.title()});case s["default"].KIND.BROADCAST:return l10n.t("clear_chat_broadcast");default:return""}},onCancel:function(){l.closeModal()},onClear:function(){var e=this.props.chat;e.pendingAction++,e.sendClear(c.supportsFeature(c.F.STARRED)&&c.supportsFeature(c.F.CHAT_CLEAR_STARRED)&&this.state.keepStarred)["finally"](function(){e.pendingAction--}),l.closeModal()},onToggleStarred:function(){this.setState({keepStarred:!this.state.keepStarred})},render:function(){var e=void 0;return c.supportsFeature(c.F.STARRED)&&c.supportsFeature(c.F.CHAT_CLEAR_STARRED)&&(e=r.createElement("div",{className:"controls-section controls-section-popup",onClick:this.onToggleStarred},r.createElement("div",{"data-a8n":o.key("menu-icon-clear-chat"),className:"control"},r.createElement(u,{onChange:this.onToggleStarred,checked:this.state.keepStarred})),r.createElement("div",{className:"label"},l10n.t("keep_starred")))),r.createElement(p,{title:l10n.t("are_you_sure"),onOK:this.onClear,okText:l10n.t("clear_button"),onCancel:this.onCancel},r.createElement("div",null,r.createElement(d,{text:this.getText()}),e))}});e.exports=h},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1391),s=i(a),r=n(110),o=i(r),l=n(8),c=n(1357),u=n(1359),d=n(1358),p=n(1433),h=n(1370),f=n(156),m=n(92),g=n(1371),v=g.GetRef,y=l.createClass({displayName:"ContactDrawer",mixins:[f],propTypes:{onBack:l.PropTypes.func.isRequired,onClick:l.PropTypes.func.isRequired},getInitialState:function(){return{searchText:"",active:!1}},componentDidMount:function(){var e=this;this.safeDefer(function(){e.setState({active:!0})})},getFilteredContacts:function(){var e=Store.Contact.getFilteredContacts(),t=this.state.searchText;return t?(t=l10n.accentFold(t),e.filter(function(e){return e.searchMatch(t)})):e},onSearch:function(e){this.setState({searchText:e})},onFocusList:function(e){this.refs.list&&(e.preventDefault(),e.stopPropagation(),o["default"].flashFocus=Date.now(),this.refs.list.focusFirst())},onSelectFirst:function(e){e.preventDefault(),e.stopPropagation();var t=_.head(this.getFilteredContacts());t&&(o["default"].flashFocus=Date.now(),this.props.onClick(e,t))},onFocusSearch:function(e){o["default"].flashFocus=Date.now(),m.focus(this.search)},render:function(){var e=void 0;if(this.state.active){var t=this.getFilteredContacts();e=0===t.length?l.createElement(h.SearchContacts,null):l.createElement(p,{ref:"list",contacts:t,onFocusSearch:this.onFocusSearch,onClick:this.props.onClick})}else e=null;var n={down:this.onFocusList,enter:this.onSelectFirst};return l.createElement(c,{key:"contact-modal",onCancel:this.props.onBack},l.createElement(u,{title:this.props.title,type:u.Type.LARGE,onBack:this.props.onBack}),l.createElement(o["default"],{handlers:n},l.createElement(s["default"],{ref:v("search",this),onSearch:this.onSearch,placeholder:l10n.t("search_contacts")})),l.createElement(d,{"data-list-scroll-container":!0},e))}});e.exports=y},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1366),s=i(a),r=n(1390),o=i(r),l=n(1417),c=i(l),u=n(232),d=i(u),p=n(8),h=n(1356),f=n(156),m=n(1360),g=n(153),v=n(1409),y=n(10),E=n(1),b=n(1463),C=n(454),M=n(1399),S=n(1357),T=n(1358),w=n(1388),k=n(1381),P=n(1361),N=n(1513),x=n(1355),D=n(1416),O=n(12),R=n(75),I=n(93),A=n(1439),L=n(20),F=n(9),U=p.createClass({displayName:"ContactInfoDrawer",mixins:[h,f,m,g],propTypes:{contact:p.PropTypes.instanceOf(d["default"]).isRequired,onVerification:p.PropTypes.func},getInitialState:function(){return this.asyncState({status:"contact.Status.status",encryptionStatus:"contact.plaintextDisabled"},{commonGroups:void 0,contactIsBlocked:!!Store.Blocklist.get(this.props.contact.id)})},componentDidMount:function(){this.addObserver(Store.Blocklist,"add remove reset sync",this.onBlocklistChange),this.uiIdle(this._init)},_init:function(){var e=this;this.props.contact.findCommonGroups().checkpoint(this.rejectOnUnmount()).then(function(t){e.setState({commonGroups:t}),e.addObserver(Store.GroupMetadata,"group_participant_change",e.commonGroupsUpdate)})["catch"](O.Unmount,_.noop)["catch"](O.WapDrop,_.noop)["catch"](_.noop),R.supportsFeature(R.F.QUERY_IDENTITY)&&this.props.contact.queryIdentity()["catch"](function(e){E.error("contactInfoDrawer:queryIdentity error: "+e)()})},onBlocklistChange:function(e){this.state.contactIsBlocked!==!!Store.Blocklist.get(this.props.contact.id)&&this.setState({contactIsBlocked:!!Store.Blocklist.get(this.props.contact.id)})},commonGroupsUpdate:function(e){var t=this.state.commonGroups,n=this.props.contact.updateCommonGroups(t,e);n&&this.setState({commonGroups:n})},onDeleteChat:function(){var e=Store.Chat.get(this.props.contact.id);y.deleteOrExitChat(e)},onBlockContact:function(){y.openModal(p.createElement(C,{title:l10n.t("block"),onOK:this.blockContact,okText:l10n.t("block"),onCancel:y.closeModal.bind(y),cancelText:l10n.t("web_cancel")},l10n.t("block_confirmation",{contact:this.props.contact.formattedName})))},onUnblockContact:function(){y.openModal(p.createElement(C,{okText:l10n.t("unblock_button"),onOK:this.unblockContact,cancelText:l10n.t("web_cancel"),onCancel:y.closeModal.bind(y)},l10n.t("unblock_confirmation",{contact:this.props.contact.formattedName})))},blockContact:function(){this.props.contact.setBlock(!0),y.closeModal()},unblockContact:function(){this.props.contact.setBlock(!1),y.closeModal()},onClose:function(){this.props.onClose?this.props.onClose():this.context.uim.uie.requestDismiss()},onCopy:function(e){var t=v.extractIsolatedBlocks(window.getSelection());e.clipboardData.setData("text/plain",t),e.stopPropagation(),e.preventDefault()},onViewPicture:function(e){if(this.canViewPicture){var t=e.target,n=function(e){e(t)};y.openModalMedia(p.createElement(b,{contact:this.props.contact,animateBorderRadius:!0,getZoomNode:n}),"profile-viewer")}},onDetailImageLoad:function(e){this.canViewPicture=!0},onClick:function(e,t){y.openChatFromUnread(t).then(function(e){e&&y.focusChatTextInput(t)}),this.onClose()},render:function(){var e,t,n=this,i=this.props.contact,a=this.state.commonGroups;a=_.compact(_.values(a)),_.isArray(a)&&a.length&&(e=a.map(function(e){return p.createElement(o["default"],{chat:e,mode:r.Mode.INFO,onClick:n.onClick,key:e.id})}),e=p.createElement(k,{classes:"animate-enter well-simple-body",title:l10n.t("web_groups_participation_you_and_name"),subtitle:l10n.n(a.length),"data-list-scroll-offset":!0,noContainer:!0},p.createElement("div",{className:"drawer-section-body chatlist"},p.createElement(s["default"],{data:e,height:72,extraItems:4}))));var u=Store.Chat.get(i.id);_.isArray(a)&&u&&u.canDelete()&&(t=p.createElement("div",{className:"drawer-section chatlist list-icons animate-enter2 well-simple"},p.createElement(w,{iconClass:"icon-delete-danger",className:"danger first",a8n:"li-delete-chat",onClick:this.onDeleteChat},l10n.t("delete_chat"))));var d=null;this.props.contact.canBlock()&&(d=this.state.contactIsBlocked?p.createElement("div",{className:"drawer-section chatlist list-icons animate-enter2 well-simple"},p.createElement(w,{className:"success first",a8n:"li-unblock",iconClass:"icon-settings-blocked-success",onClick:this.onUnblockContact},l10n.t("unblock_contact"))):p.createElement("div",{className:"drawer-section chatlist list-icons animate-enter2 well-simple"},p.createElement(w,{className:"first",a8n:"li-block",iconClass:"icon-settings-blocked",onClick:this.onBlockContact},l10n.t("block_contact"))));var h=null;if(this.props.onMediaGallery&&u){var f=p.createElement("span",{className:"icon icon-chevron-right-alt"}),m=R.supportsFeature(R.F.LINK_DOC_GALLERY)?l10n.t("media_links_docs"):l10n.t("media");h=p.createElement(k,{title:m,titleOnClick:this.props.onMediaGallery,subtitle:f,classes:"animate-enter2",noContainer:!0},p.createElement(M,{chat:u,mediaMsgs:u.getMediaMsgs()}))}var g=null,v=u&&u.mute.canMute()?p.createElement(A,{chat:u}):null,y=null,E=null,b=null;(v||y||E)&&(b=p.createElement(k,{classes:"well-simple animate-enter2"},v,y,E));var C=F.STATUS_V2?p.createElement(D,{classes:"row-drawer-item"},p.createElement(N,{dir:"auto"},p.createElement(x,{className:"title",selectable:!0,direction:"auto",text:this.state.status}))):null,O=p.createElement(D,{classes:"row-drawer-item last"},p.createElement(N,{className:"selectable-text title",dir:"auto"},L.formattedUser(i.id))),I=l10n.t("contact_info_status_phone"),U=l10n.t("contact_info_phone_number"),G=p.createElement(k,{classes:"animate-enter2 well-simple-body",title:F.STATUS_V2?I:U},C,O),j=u&&u.presence?p.createElement(c["default"],{presence:u.presence,chatstate:u.presence.chatstate,location:l.Location.LIST}):null;return p.createElement(S,{key:"contact-info-modal",id:"info",variant:"panel"},p.createElement("header",{className:"pane-header"},p.createElement("div",{className:"header-close"},p.createElement("button",{onClick:this.onClose},p.createElement("span",{className:"icon icon-x"}))),p.createElement("div",{className:"header-body"},p.createElement("div",{className:"header-main"},p.createElement("div",{className:"header-title"},l10n.t("web_contact_info"))))),p.createElement(T,{"data-list-scroll-container":!0,onCopy:this.onCopy},p.createElement("div",{className:"well well-chat"},p.createElement(P,{id:i.id,size:P.Size.LARGE,loader:!0,className:"drawer-scale well-chat-avatar",onLoad:this.onDetailImageLoad,onClick:this.onViewPicture,quality:P.Quality.HIGH}),p.createElement("div",{className:"well-chat-name"},p.createElement(N,{dir:"auto"},p.createElement(x,{selectable:!0,text:i.formattedUser}))),p.createElement("div",{className:"well-chat-secondary"},j)),h,b,G,g,e,d,t))}});U.contextTypes={uim:p.PropTypes.instanceOf(I)},e.exports=U},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(453),s=i(a),r=n(8),o=n(10),l=n(1356),c=n(153),u=n(1360),d=n(1357),p=n(1359),h=n(1358),f=n(1381),m=n(1495),g=n(1405),v=n(155),y=n(456),E=n(12),b=n(43),C=n(9),M=n(93),S=r.createClass({displayName:"ContactMsgInfoDrawer",mixins:[l,c,u],propTypes:{msg:r.PropTypes.instanceOf(s["default"])},getInitialState:function(){return{msgInfo:void 0,star:this.async("msg.star")}},componentWillMount:function(){var e=this;Store.MsgInfo.find(this.props.msg.id).checkpoint(this.rejectOnUnmount()).then(function(t){e.setState({msgInfo:t}),e.addObserver(t,"change:playedRemaining change:readRemaining change:deliveryRemaining")})["catch"](E.Unmount,_.noop)["catch"](function(){e.setState({unimplemented:!0}),o.openToast(r.createElement(y,{msg:l10n.t("msg_info_failed"),id:y.genId("msg_info_failed")}))})},componentDidMount:function(){if(this.props.msg.type===s["default"].TYPE.IMAGE&&(this.refs.scrollable.scrollTop=this.refs.scrollable.scrollHeight),this.props.msg.isGif){var e=this.getMsgComponent();e.play()}},isMsgVisible:function(e){var t=!(arguments.length<=1||void 0===arguments[1])&&arguments[1];return e===this.props.msg.id&&(!!t||this.getMsgComponent())},getMsgComponent:function(){var e=this.refs.wrapper;if(e)return e.refs.component&&e.refs.component.refs.msg},onClose:function(){this.context.uim.uie.requestDismiss()},render:function(){var e=this.props.msg,t=this.state,n=t.msgInfo,i=t.star,a=t.unimplemented,o=void 0,l=void 0;if(n){var c=[],u=void 0,y=void 0,E=void 0;n.isPTT&&(l=l10n.t("message_info_seen"),u=n.played.head(),y=u&&u.t,E=r.createElement("span",{className:"icon icon-status icon-status-ptt-blue"}),c.push(r.createElement(m,{title:l10n.t("message_info_played"),t:y,icon:E,key:"played"}))),u=n.read.head(),y=u&&u.t,E=r.createElement("span",{className:"icon icon-ack icon-status-dblcheck-ack"}),l=l||l10n.t("message_info_read"),c.push(r.createElement(m,{title:l,t:y,icon:E,key:"read"})),u=n.delivery.head(),y=u&&u.t,E=r.createElement("span",{className:"icon icon-ack icon-status-dblcheck"}),c.push(r.createElement(m,{title:l10n.t("message_info_delivered"),t:y,icon:E,key:"delivery"})),o=r.createElement(f,{classes:"drawer-section-info well animate-enter"},c)}var _=void 0;n||a||(_=r.createElement(f,{classes:"drawer-section-spinner",key:"spinner"},r.createElement(v,{size:50,stroke:4})));var M=b("pane-preview-wrapper","pane-preview-wrapper-bg",{"pane-preview-resize":e.type===s["default"].TYPE.PTT||e.type===s["default"].TYPE.IMAGE||e.type===s["default"].TYPE.LOCATION||e.type===s["default"].TYPE.VCARD||e.isGif});return r.createElement(d,{key:"message-info-modal",id:"info",variant:"panel",onCancel:this.onClose},r.createElement(p,{title:l10n.t("message_info"),type:p.Type.SMALL,onCancel:this.onClose}),r.createElement("div",{className:M,ref:"scrollable"},r.createElement("div",{className:"pane-preview"},r.createElement("div",{className:"pane-chat-tile"}),r.createElement(g,{msg:e,key:"star-"+i.toString(),ref:"wrapper",displayType:C.DISP_TYPE.MSG_INFO,isMsgVisible:this.isMsgVisible,position:g.Position.END}))),r.createElement(h,{classes:"drawer-body-msg-info"},_,o))}});S.contextTypes={uim:r.PropTypes.instanceOf(M)},e.exports=S},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(453),s=i(a),r=n(110),o=i(r),l=n(8),c=n(10),u=n(1383),d=n(1357),p=n(1359),h=n(1358),f=n(1466),m=n(459),g=l.createClass({displayName:"ContactViewerModal",propTypes:{msg:l.PropTypes.instanceOf(s["default"]).isRequired},render:function(){return this.props.msg.vcard?l.createElement(u,{type:u.BOX},l.createElement(d,{key:"vcard-modal",onCancel:function(){return c.closeModal()}},l.createElement(p,{title:l10n.t("contact_viewer"),type:p.Type.POPUP,onCancel:function(){return c.closeModal()}}),l.createElement(h,null,l.createElement(o["default"],null,l.createElement(f,{parsedVCard:this.props.msg.vcard,thumbnail:m.thumbnail(this.props.msg.body),className:"chatlist column"}))))):null}});e.exports=g},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1354),s=i(a),r=n(454),o=i(r),l=n(8),c=n(1),u=n(10),d=n(1356),p=n(1355),h=l.createClass({displayName:"DeleteChatPopup",mixins:[d],propTypes:{onCancel:l.PropTypes.func,onDeleteOrExit:l.PropTypes.func,chat:l.PropTypes.instanceOf(s["default"]).isRequired},getInitialState:function(){return{isReadOnly:this.async("chat.isReadOnly")}},getText:function(){var e=this.props.chat,t=e.title();return e.isGroup?this.state.isReadOnly?l10n.t("web_delete_group_dialog_title",{groupName:t}):l10n.t("web_exit_group_dialog_title",{groupName:t}):e.isUser?l10n.t("delete_chat_dialog_title",{name:t}):e.isBroadcast?l10n.t("delete_list_dialog_title"):void 0},getButton:function(){var e=this.props.chat;return e.isGroup?this.state.isReadOnly?l10n.t("web_delete"):l10n.t("web_exit"):e.isUser||e.isBroadcast?l10n.t("web_delete"):void 0},onCancel:function(){u.closeModal(),_.isFunction(this.props.onCancel)&&this.props.onCancel()},onDelete:function(){var e,t=this.props.chat;t.isGroup?e=this.state.isReadOnly?t.sendDelete():t.sendExit():t.isUser||t.isBroadcast?e=t.sendDelete():c.error("deleteChatPopup:onDelete Unsupported chat type")(),_.isFunction(this.props.onDeleteOrExit)&&e&&this.props.onDeleteOrExit(e),u.closeModal()},render:function(){return l.createElement(o["default"],{onOK:this.onDelete,okText:this.getButton(),onCancel:this.onCancel},l.createElement(p,{text:this.getText()}))}});e.exports=h},function(e,t,n){"use strict";var i=n(8),a=n(458),s=n(1),r=n(10),o=n(1379),l=n(456),c=n(43),u=n(0),d={title:0,hour:1,day:24,week:168},p=i.createClass({displayName:"DoNotDisturbSettings",getInitialState:function(){return{notifications:Store.Mute.getGlobalNotifications(),sounds:Store.Mute.getGlobalSounds(),previews:Store.Mute.getGlobalPreviews(),dnd:d.title}},componentWillUnmount:function(){this.state.dnd!==d.title&&r.openToast(i.createElement(l,{msg:this.globalMuteDurationLabel(this.state.dnd),id:l.genId()}))},globalMuteDurationLabel:function(e){switch(this.state.dnd){case 1:return l10n.t("global_muted_1hour");case 24:return l10n.t("global_muted_1day");case 168:return l10n.t("global_muted_1week");default:return s.log("DoNotDisturbSettings:globalMuteDurationLabel non standard global mute duration:"+e)(),l10n.t("global_muted")}},onSounds:function(){var e=!this.state.sounds;this.setState({sounds:e}),Store.Mute.setGlobalSounds(e)},onNotifications:function(){var e=!this.state.notifications;this.setState({notifications:e}),Store.Mute.setGlobalNotifications(e)},onPreviews:function(){var e=!this.state.previews;this.setState({previews:e}),Store.Mute.setGlobalPreviews(e)},onDND:function(e){var t=parseInt(e.target.value,10);if(0===t)return this.setState({dnd:d.title}),void Store.Mute.globalMute().unmute();this.setState({dnd:t});var n=u().unix()+60*e.target.value*60;Store.Mute.globalMute().mute(n)},onClose:function(e){r.closeModal()},render:function(){var e=[];if(window.Notification){e.push(i.createElement("div",{className:"controls-section",onClick:this.onNotifications,key:0},i.createElement("div",{"data-a8n":a.key("menu-icon-notifications"),className:"control"},i.createElement(o,{onChange:this.onNotifications,checked:this.state.notifications})),i.createElement("div",{className:"label"},l10n.t("option_desktop_notifications"))));var t=c("controls-section",{disabled:!this.state.notifications});e.push(i.createElement("div",{className:t,onClick:this.onPreviews,key:1},i.createElement("div",{"data-a8n":a.key("menu-icon-notifications"),className:"control"},i.createElement(o,{onChange:this.onPreviews,checked:this.state.previews})),i.createElement("div",{className:"label"},l10n.t("option_msg_previews"),i.createElement("div",{className:"hint"},l10n.t("option_msg_previews_hint_text")))))}return i.createElement("div",{className:"controls-container drawer-section"},i.createElement("div",{className:"controls-section",onClick:this.onSounds},i.createElement("div",{"data-a8n":a.key("menu-icon-notifications"),className:"control"},i.createElement(o,{onChange:this.onSounds,checked:this.state.sounds})),i.createElement("div",{className:"label"},l10n.t("option_sounds"))),e,i.createElement("div",{className:"controls-section controls-section-wide"},i.createElement("div",{className:"select"},i.createElement("select",{value:this.state.dnd,onChange:this.onDND},i.createElement("option",{value:d.title,disabled:this.state.state===d.title},l10n.t("option_select_mute")),i.createElement("option",{value:d.hour,disabled:this.state.state===d.hour},l10n.t("mute_1hour")),i.createElement("option",{value:d.day,disabled:this.state.state===d.day},l10n.t("mute_1day")),i.createElement("option",{value:d.week,disabled:this.state.state===d.week},l10n.t("mute_1week"))))))}});e.exports=p},function(e,t,n){"use strict";var i=n(8),a=n(43),s=i.createClass({displayName:"DrawerSectionFooter",propTypes:{children:i.PropTypes.node.isRequired,separator:i.PropTypes.bool},getDefaultProps:function(){return{separator:!1}},render:function(){var e=a("drawer-section-footer",{separator:this.props.separator});return i.createElement("div",{className:e},i.createElement("div",{className:"col-main"},this.props.children))}});e.exports=s},function(e,t,n){"use strict";var i=n(8),a=n(10),s=n(9),r=n(46),o=n(20),l=n(454),c=n(93),u=i.createClass({displayName:"E2EInfoModal",propTypes:{e2eSubtype:i.PropTypes.string.isRequired,jid:i.PropTypes.string,chatId:i.PropTypes.string,unencryptedContact:i.PropTypes.string},onLearnMore:function(){var e;switch(this.props.e2eSubtype){case"info_encrypted":case"info_unencrypted":e=s.E2E_FAQ_LINK;break;case"identity":e=s.CODE_CHANGE_FAQ_LINK;break;case"encrypt":default:e=s.SECURITY_LINK}var t=r.build(e,{lg:Store.Conn.lg,lc:Store.Conn.lc});window.open(t,"_blank")},onVerificationClick:function(){a.closeModal(),a.verificationDrawer(this.props.jid)},render:function(){var e,t=null,n=null,s=a.closeModal.bind(a),r=l10n.t("web_ok");switch(this.props.e2eSubtype){case"info_encrypted":o.isGroup(this.props.chatId)?e=l10n.t("web_group_info_encrypted_description"):o.isBroadcast(this.props.chatId)&&(e=l10n.t("web_broadcast_info_encrypted_description"));break;case"info_unencrypted":e=o.isGroup(this.props.chatId)?l10n.t("web_group_info_unencrypted_description"):o.isBroadcast(this.props.chatId)?l10n.t("web_broadcast_info_unencrypted_description"):l10n.t("web_contact_info_unencrypted_description",{contact:this.props.unencryptedContact});break;case"identity":var c=Store.Contact.get(this.props.jid),u=c?c.formattedName:"";e=l10n.t("web_security_code_change_description",{name:u}),t=s,n=r,s=this.onVerificationClick,r=l10n.t("web_verify_button");break;case"encrypt":default:e=o.isGroup(this.props.chatId)?l10n.t("web_group_encryption_state_change_description"):o.isBroadcast(this.props.chatId)?l10n.t("web_broadcast_encryption_state_change_description"):l10n.t("web_individual_chat_encryption_state_change_description")}var d=i.createElement("span",{className:"action",onClick:this.onLearnMore},l10n.t("learn_more"));return i.createElement(l,{onOK:s,okText:r,onCancel:t,cancelText:n},e," ",d)}});u.contextTypes={uim:i.PropTypes.instanceOf(c)},e.exports=u},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1354),s=i(a),r=n(1366),o=i(r),l=n(8),c=n(1356),u=n(153),d=n(10),p=n(76),h=n(1376),f=n(1399),m=n(1357),g=n(1358),v=n(1381),y=n(1388),E=n(1414),_=n(1355),b=n(1369),C=n(454),M=n(1574),S=n(456),T=n(457),w=n(1387),k=n(1380),P=n(229),N=n(93),x=n(1439),D=n(75),O=n(9),R=S.genId("max_participant_toast"),I=l.createClass({displayName:"GroupInfoDrawer",mixins:[c,u],propTypes:{chat:l.PropTypes.instanceOf(s["default"]).isRequired},getInitialState:function(){return{imgFull:this.async("chat.ProfilePicThumb.imgFull"),name:this.async("chat.contact.name")||"",isReadOnly:this.async("chat.isReadOnly"),pendingSubject:!1,pendingPhoto:!1,everyoneEncrypted:this.async("chat.contact.plaintextDisabled"),contextMenu:!1}},componentWillMount:function(){var e=this.props.chat.groupMetadata;this.addObserver(e.participants,"add remove reset sort change:isAdmin")},onImageSet:function(e,t){var n=Store.ProfilePicThumb.get(this.props.chat.id);this.setState({pendingPhoto:!0});var i;i=e&&t?n.setPicture(e,t):n.deletePicture(),i.bind(this).then(function(){this.isMounted()&&this.setState({pendingPhoto:!1})})},onParticipantClick:function(e,t){Store.Conn.me!==t.id&&Store.Chat.find(t.id).then(function(e){d.openChatFromUnread(e).then(function(t){t&&d.focusChatTextInput(e)})})},menuEnabled:function(e){var t=this.props.chat.groupMetadata.participants,n=t.get(e.id);return n&&(t.canPromote(n)||t.canRemove(n)||t.canVerifyIdentity(n))},onParticipantMenu:function(e,t){var n=this.props.chat.groupMetadata.participants,i=n.get(t.id);if(this.menuEnabled(t)){var a=[];if(n.canPromote(i)){var s=this.confirmParticipantPromote.bind(this,i);a.push(l.createElement(b,{a8n:"mi-grp-promote-admin",key:"promote",action:s},l10n.t("menuitem_make_group_admin")))}if(n.canRemove(i)){var r=this.confirmParticipantRemove.bind(this,i);a.push(l.createElement(b,{a8n:"mi-grp-remove-participant",key:"remove",action:r,shortcut:"d"},l10n.t("menuitem_remove")))}e.event&&e.event.persist(),this.setState({contextMenu:{contactId:t.id,menu:a,anchor:e.anchor,event:e.event}})}},contextClose:function(){this.setState({contextMenu:!1})},confirmParticipantRemove:function(e){var t=this.onParticipantRemove.bind(this,e),n=l10n.t("confirm_remove_group_participant",{participant:e.contact.formattedName,subject:this.props.chat.contact.name});d.openModal(l.createElement(C,{onOK:t,okText:l10n.t("remove"),onCancel:d.closeModal.bind(d),cancelText:l10n.t("web_cancel")},l.createElement(_,{text:n})))},onParticipantRemove:function(e){e.contact.pendingAction++,this.props.chat.groupMetadata.participants.removeParticipant(e).then(function(){e.contact.pendingAction--}),d.closeModal()},confirmParticipantPromote:function(e){var t=this.onParticipantPromote.bind(this,e),n=l10n.t("confirm_promote_group_participant",{participant:e.contact.formattedName,subject:this.props.chat.contact.name});d.openModal(l.createElement(C,{onOK:t,okText:l10n.t("menuitem_make_group_admin"),onCancel:d.closeModal.bind(d),cancelText:l10n.t("web_cancel")},l.createElement(_,{text:n})))},onParticipantPromote:function(e){e.contact.pendingAction++,this.props.chat.groupMetadata.participants.promoteParticipant(e).then(function(){e.contact.pendingAction--}),d.closeModal()},onVerifyIdentity:function(e){this.props.onVerification(e.contact)},openAddGroupParticipantFlow:function(){if(this.props.chat.groupMetadata.participants.length>=O.MAX_GROUP_SIZE){var e=l10n.t("action_group_create_failed_participant",{max:O.MAX_GROUP_SIZE});d.openToast(l.createElement(S,{msg:e,id:R}))}else{var t=l.createElement(M,{
chat:this.props.chat});d.openModal(t,"modal-flow")}},onClose:function(){this.props.onClose?this.props.onClose():this.context.uim.uie.requestDismiss()},onExitOrDeleteGroup:function(){d.deleteOrExitChat(this.props.chat)},onSubjectChange:function(e){this.setState({name:e.target.value})},validateSubject:function(){var e=arguments.length<=0||void 0===arguments[0]?"":arguments[0];return!!e.trim()},onSetSubjectError:function(){d.openModal(l.createElement(C,{onOK:d.closeModal.bind(d),okText:l10n.t("web_ok")},l10n.t("action_group_subject_empty")))},onSetSubject:function(e){var t=this.props.chat,n=t.groupMetadata;if(n.canSetSubject()){var i=T.emojify(this.state.name);if(i===t.contact.name)return this.setState({name:i});this.setState({pendingSubject:!0}),t.setSubject(i).bind(this)["finally"](function(){this.isMounted()&&this.setState({name:t.contact.name,pendingSubject:!1})})}},onCancelSubject:function(){this.setState({name:this.props.chat.contact.name})},render:function(){var e,t,n=this.props.chat,i=n.groupMetadata,a=this,s=i.participants.map(function(e){var t=e.contact,n=a.state.contextMenu&&t.id===a.state.contextMenu.contactId;return l.createElement(h,{contact:t,key:e.id,admin:!!e.isAdmin,onClick:a.onParticipantClick,contextEnabled:a.menuEnabled.bind(a,t),contextMenu:n,onContext:a.onParticipantMenu,showNotifyName:!0})});n.canDelete()&&(t=l.createElement("div",{className:"drawer-section chatlist list-icons animate-enter2 well-simple"},l.createElement(y,{iconClass:"icon-exit",a8n:"li-delete-group",className:"danger first",onClick:this.onExitOrDeleteGroup},n.isReadOnly?l10n.t("web_delete_group"):l10n.t("web_exit_group")))),i.participants.canAdd()&&(e=l.createElement("div",{className:"list-action list-action-alt",title:l10n.t("add_group_participant"),onClick:this.openAddGroupParticipantFlow},l.createElement("div",{className:"list-action-icon"},l.createElement("span",{className:"icon icon-add-user-light"})),l.createElement("div",{className:"list-action-body ellipsify"},l10n.t("add_group_participant"))));var r=void 0;i.participants.iAmAdmin()&&this.props.onGroupInviteLink&&(r=l.createElement("div",{className:"list-action list-action-alt",title:l10n.t("group_invite_link"),onClick:this.props.onGroupInviteLink},l.createElement("div",{className:"list-action-icon"},l.createElement("span",{className:"icon icon-link"})),l.createElement("div",{className:"list-action-body ellipsify"},l10n.t("group_invite_link"))));var c=s.length?l.createElement(v,{title:l10n.t("web_participants_title"),subtitle:l10n.t("web_participants_count",{count:s.length,max:O.MAX_GROUP_SIZE}),"data-list-scroll-offset":!0,classes:"animate-enter2 well-simple-body",ref:"container",noContainer:!0},e,r,l.createElement("div",{className:"drawer-section-body chatlist"},l.createElement(o["default"],{data:s,height:o["default"].DEFAULT_HEIGHT,extraItems:4}))):null,u=null;if(this.props.onMediaGallery){var d=l.createElement("span",{className:"icon icon-chevron-right-alt"}),_=D.supportsFeature(D.F.LINK_DOC_GALLERY)?l10n.t("media_links_docs"):l10n.t("media");u=l.createElement(v,{title:_,titleOnClick:this.props.onMediaGallery,subtitle:d,classes:"animate-enter2",noContainer:!0},l.createElement(f,{chat:n,mediaMsgs:n.getMediaMsgs()}))}var b=n.contact.profilePicThumb,C=E.Type.GROUP,M=n.isReadOnly||!b.canDelete()&&!b.canSet(),S=l.createElement(E,{className:"well-chat-avatar",type:C,id:n.contact.id,pending:this.state.pendingPhoto,startImage:this.state.imgFull,readOnly:M,onImageSet:this.onImageSet}),T=null;n.groupMetadata.creation&&(T=l.createElement("div",{className:"well-chat-secondary well-chat-secondary-group"},l10n.t("web_group_creation_time",{when:p.relativeDateAndTimeStr(n.groupMetadata.creation)})));var N=null,R=n&&n.mute.canMute()?l.createElement(x,{chat:n}):null,I=null,A=void 0;this.state.contextMenu&&(A=l.createElement(P,{displayName:"ChatContextMenu",escapable:!0,popable:!0,requestDismiss:this.contextClose},l.createElement(k,{contextMenu:this.state.contextMenu})));var L=null;return(R||I||N)&&(L=l.createElement(v,{classes:"well-simple animate-enter2"},R,I,N)),l.createElement(m,{key:"contact-info-modal",id:"info",variant:"panel",onCancel:this.onClose},l.createElement("header",{className:"pane-header"},l.createElement("div",{className:"header-close"},l.createElement("button",{onClick:this.onClose},l.createElement("span",{className:"icon icon-x"}))),l.createElement("div",{className:"header-body"},l.createElement("div",{className:"header-main"},l.createElement("div",{className:"header-title"},l10n.t("web_group_info"))))),l.createElement(g,{"data-list-scroll-container":!0},l.createElement("div",{className:"well well-chat"},S,l.createElement("div",{className:"well-chat-name"},l.createElement(w,{value:this.state.name,editable:i.canSetSubject(),pending:this.state.pendingSubject,showRemaining:!0,validate:this.validateSubject,maxLength:O.MAX_SUBJECT_LENGTH,onChange:this.onSubjectChange,onSave:this.onSetSubject,onError:this.onSetSubjectError,onCancel:this.onCancelSubject,supportsEmoji:!0,lockable:!0,lowProfile:!0,className:"text-input-large"})),T),u,L,c,t),A)}});I.contextTypes={uim:l.PropTypes.instanceOf(N)},e.exports=I},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(1354),o=i(r),l=n(8),c=n(1357),u=n(1359),d=n(1358),p=n(155),h=n(1360),f=n(12),m=n(153),g=n(1361),v=n(1355),y=n(1388),E=n(1579),b=n(1583),C=n(10),M=n(456),S={LOADING:0,REVOKING:1,SUCCESS:2},T=l.createClass({displayName:"GroupInviteLinkDrawer",mixins:[h,m],propTypes:{chat:l.PropTypes.instanceOf(o["default"]).isRequired,onBack:l.PropTypes.func.isRequired},getInitialState:function(){return{state:S.LOADING}},getErrorMessageFromStatusCode:function(e){switch(e){case 401:return l10n.t("group_invite_query_401");case 403:return l10n.t("group_invite_query_403");case 404:return l10n.t("group_invite_query_404");default:return l10n.t("group_invite_query_406")}},handleLoadingStatusCode:function(e){if(200===e)this.setState({state:S.SUCCESS});else{var t=this.getErrorMessageFromStatusCode(e);this.props.onBack(),C.openToast(l.createElement(M,{msg:t,id:M.genId()}))}},componentWillMount:function(){this.addObserver(this.props.chat.groupMetadata,"change:inviteCode"),this.props.chat.groupMetadata.groupInviteCode().checkpoint(this.rejectOnUnmount).then(this.handleLoadingStatusCode)["catch"](f.Unmount,_.noop)},onRevokeGroupInvite:function(){C.openModal(l.createElement(E,{chat:this.props.chat,onConfirm:this.onConfirmRevokeGroupInvite}),"modal-flow")},handleRevokingStatusCode:function(e){if(200===e)C.openToast(l.createElement(M,{msg:l10n.t("group_invite_revoke_success"),id:M.genId()})),this.setState({state:S.SUCCESS});else{var t=this.getErrorMessageFromStatusCode(e);this.props.onBack(),C.openToast(l.createElement(M,{msg:t,id:M.genId()}))}},onConfirmRevokeGroupInvite:function(){var e=this;this.setState({state:S.REVOKING}),s["default"].props({_:s["default"].delay(500),status:this.props.chat.groupMetadata.revokeGroupInvite()}).checkpoint(this.rejectOnUnmount).then(function(t){var n=t.status;e.handleRevokingStatusCode(n)})["catch"](f.Unmount,_.noop)},onSendGroupInviteLink:function(){C.openModal(l.createElement(b,{chat:this.props.chat}),"modal-flow")},onClickGroupInviteLink:function(e){e.preventDefault(),this.onSendGroupInviteLink()},onCopyLink:function(){window.getSelection().removeAllRanges();var e=document.querySelector("#group-invite-link-anchor"),t=document.createRange();t.selectNode(e),window.getSelection().addRange(t);var n=void 0;try{n=document.execCommand("copy"),window.getSelection().removeAllRanges()}catch(i){n=!1}n?C.openToast(l.createElement(M,{msg:l10n.t("group_invite_link_copy_success"),id:M.genId()})):C.openToast(l.createElement(M,{msg:l10n.t("group_invite_link_copy_failed"),id:M.genId()}))},renderDrawerBody:function(){var e=this.props.chat.groupMetadata,t=void 0;if(this.state.state===S.LOADING)t=l.createElement("div",{className:"group-invite-loading-container"},l.createElement(p,{className:"group-invite-spinner",size:55,stroke:3}),l.createElement("span",null,l10n.t("group_invite_check_link")));else if(this.state.state===S.REVOKING)t=l.createElement("div",{className:"group-invite-loading-container"},l.createElement(p,{className:"group-invite-spinner",size:55,stroke:3}),l.createElement("span",null,l10n.t("group_invite_revoke_in_progress",{groupName:this.props.chat.contact.name})));else{var n=e.groupInviteLink,i=null;document.queryCommandSupported("copy")&&(i=l.createElement(y,{iconClass:"icon-copy",a8n:"li-copy-link",onClick:this.onCopyLink},l10n.t("group_invite_drawer_copy_link"))),t=l.createElement(d,{wide:!0},l.createElement("div",{className:"chatlist list-identity list-invite"},l.createElement("div",{className:"chat chat-idle","data-ignore-capture":"any"},l.createElement("div",{className:"chat-avatar"},l.createElement(g,{id:this.props.chat.id,size:82,quality:g.Quality.HIGH})),l.createElement("div",{className:"chat-body"},l.createElement("div",{className:"chat-main"},l.createElement("div",{className:"chat-title"},l.createElement("span",{className:"emojitext ellipsify",dir:"auto"},l.createElement(v,{text:this.props.chat.contact.name,direction:"auto"})))),l.createElement("div",{className:"chat-status"},l.createElement("a",{id:"group-invite-link-anchor",href:n,onClick:this.onClickGroupInviteLink},n))))),l.createElement("div",{className:"controls-container drawer-section"},l.createElement("div",{className:"controls-section"},l10n.t("group_invite_link_description"))),l.createElement("div",{className:"chatlist list-icons list-actions"},l.createElement(y,{iconClass:"icon-share",a8n:"li-share-link",onClick:this.onSendGroupInviteLink},l10n.t("group_invite_drawer_send_link")),i,l.createElement(y,{iconClass:"icon-revoke",a8n:"li-revoke-link",onClick:this.onRevokeGroupInvite},l10n.t("group_invite_drawer_revoke_link"))))}return t},render:function(){return l.createElement(c,{id:"invite",onCancel:this.props.onBack},l.createElement(u,{title:l10n.t("group_invite_link"),onBack:this.props.onBack,type:u.Type.SMALL}),this.renderDrawerBody())}});e.exports=T},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(160),o=i(r),l=n(1377),c=i(l),u=n(1407),d=i(u),p=n(8),h=n(454),f=n(155),m=n(1361),g=n(1360),v=n(10),y=n(12),E=n(9),b=n(45),C={LOADING:0,SUCCESS:1,ACCEPT_ERROR:2,QUERY_ERROR:3},M=p.createClass({displayName:"GroupInviteModal",mixins:[g],props:{groupCode:p.PropTypes.string.isRequired},getInitialState:function(){return{state:C.LOADING,status:void 0,groupMetadata:void 0}},componentWillMount:function(){var e=this;b.groupInviteInfo(this.props.groupCode).checkpoint(this.rejectOnUnmount).then(function(t){var n=t.status,i=(0,o["default"])(t,["status"]);if(200===n){var a=new d["default"](i);Store.Contact.gadd(i.id),e.setState({status:n,groupMetadata:a,state:C.SUCCESS})}else e.setState({status:n,state:C.QUERY_ERROR})})["catch"](y.Unmount,_.noop)},onViewGroup:function(){v.openChatFromUnread(Store.Chat.get(this.state.groupMetadata.id)),v.closeModal()},onJoinGroup:function(){var e=this;b.acceptGroupInvite(this.props.groupCode).then(function(e){var t=e.status,n=e.gid;return 200===t?Store.Chat.find(n):s["default"].reject(t)}).then(function(e){v.openChatFromUnread(e).then(function(t){t&&v.focusChatTextInput(e)}),v.closeModal()}).checkpoint(this.rejectOnUnmount)["catch"](y.Unmount,_.noop)["catch"](function(t){e.setState({state:C.ACCEPT_ERROR,status:t})})},onCancel:function(){v.closeModal()},render:function(){var e=this.state,t=e.state,n=e.status,i=e.groupMetadata,a={cancelText:l10n.t("group_invite_cancel"),onCancel:this.onCancel},s=void 0;if(t===C.LOADING)s=p.createElement("div",{className:"group-invite-loading-container"},p.createElement(f,{className:"group-invite-spinner",size:55,stroke:3}),p.createElement("span",null,l10n.t("group_invite_check_link")));else if(t===C.SUCCESS){var r=i.participants.map(function(e){return p.createElement("div",{key:e.id,className:"participant-wrapper"},p.createElement(m,{className:"participant-image",size:50,id:e.id}),p.createElement("span",{className:"participant-text"},e.contact.formattedName))}),o=Store.Contact.gadd(i.owner).formattedName,l=""+E.GROUP_INVITE_URL+this.props.groupCode;s=p.createElement("div",{className:"group-invite-modal"},p.createElement("div",{className:"metadata-container"},p.createElement("div",{className:"metadata-icon"},p.createElement("div",{className:"icon-group-default"}),p.createElement(c["default"],{src:l})),p.createElement("div",{className:"metadata-text"},p.createElement("span",{className:"metadata-title"},i.subject),p.createElement("span",{className:"metadata-subtitle"},l10n.t("group_invite_created_by",{participant:o})))),p.createElement("span",{className:"participants-title"},l10n.t("group_invite_participants",{count:r.length,_plural:r.length})),p.createElement("div",{className:"participants-container"},r));var u=Store.Chat.get(i.id),d=!!u&&!u.isReadOnly;a.onOK=d?this.onViewGroup:this.onJoinGroup,a.okText=d?l10n.t("group_invite_view"):l10n.t("group_invite_join")}else{var g=void 0;if(t===C.QUERY_ERROR)switch(n){case 401:g=l10n.t("group_invite_query_401");break;case 403:g=l10n.t("group_invite_query_403");break;case 404:g=l10n.t("group_invite_query_404");break;case 406:g=l10n.t("group_invite_query_406");break;case 410:g=l10n.t("group_invite_query_410");break;default:g=l10n.t("group_invite_query_500")}else if(t===C.ACCEPT_ERROR)switch(n){case 401:g=l10n.t("group_invite_accept_401");break;case 404:g=l10n.t("group_invite_accept_404");break;case 410:g=l10n.t("group_invite_accept_410");break;case 419:g=l10n.t("group_invite_accept_419");break;default:g=l10n.t("group_invite_accept_500")}a.cancelText=l10n.t("web_ok"),s=p.createElement("div",null,g)}return p.createElement(h,a,s)}});e.exports=M},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1354),s=i(a),r=n(8),o=n(454),l=n(10),c=r.createClass({displayName:"GroupInviteRevokeModal",propTypes:{chat:r.PropTypes.instanceOf(s["default"]).isRequired,onConfirm:r.PropTypes.func.isRequired},onCancel:function(){l.closeModal()},onOK:function(){this.props.onConfirm(),l.closeModal()},render:function(){return r.createElement(o,{title:l10n.t("group_invite_drawer_revoke_link"),onOK:this.onOK,okText:l10n.t("group_invite_drawer_revoke_link"),onCancel:this.onCancel,cancelText:l10n.t("web_cancel")},r.createElement("div",{className:"textfield-static"},l10n.t("group_invite_revoke_confirmation_text",{groupName:this.props.chat.contact.name})))}});e.exports=c},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(453),s=i(a),r=n(8),o=n(10),l=n(1356),c=n(153),u=n(1360),d=n(1357),p=n(1359),h=n(1358),f=n(1381),m=n(1601),g=n(1496),v=n(1405),y=n(155),E=n(456),b=n(1664),C=n(12),M=n(43),S=n(93),T=n(9),w=r.createClass({displayName:"GroupMsgInfoDrawer",mixins:[l,c,u],propTypes:{msg:r.PropTypes.instanceOf(s["default"])},getInitialState:function(){return{msgInfo:void 0,star:this.async("msg.star")}},componentWillMount:function(){var e=this;Store.MsgInfo.find(this.props.msg.id).checkpoint(this.rejectOnUnmount()).then(function(t){e.setState({msgInfo:t}),e.addObserver(t.played,"add remove"),e.addObserver(t.read,"add remove"),e.addObserver(t.delivery,"add remove"),e.addObserver(t,"change:playedRemaining change:readRemaining change:deliveryRemaining")})["catch"](C.Unmount,_.noop)["catch"](function(){e.setState({unimplemented:!0}),o.openToast(r.createElement(E,{msg:l10n.t("msg_info_failed"),id:E.genId("msg_info_failed")}))})},getAnimateEnterClass:function(e){return"animate-enter"+(e===-1?"":e)},componentDidMount:function(){if(this.props.msg.type===s["default"].TYPE.IMAGE&&(this.refs.scrollable.scrollTop=this.refs.scrollable.scrollHeight),this.props.msg.isGif){var e=this.getMsgComponent();e.play()}},isMsgVisible:function(e){var t=!(arguments.length<=1||void 0===arguments[1])&&arguments[1];return e===this.props.msg.id&&(!!t||this.getMsgComponent())},getMsgComponent:function(){var e=this.refs.wrapper;if(e)return e.refs.component&&e.refs.component.refs.msg},onClose:function(){this.context.uim.uie.requestDismiss()},render:function(){var e,t=this.props.msg,n=this.state,i=n.msgInfo,a=n.star,o=n.unimplemented,l=-1,c=24,u=26,E=void 0,_=void 0;if(i&&i.isPTT){var C=r.createElement("span",{className:"icon icon-status icon-status-ptt-blue"}),S=i.played.map(function(e){return r.createElement(g,{participant:e,key:e.id})}),w=S.length>0?r.createElement("div",{className:"chatlist chatlist-plain"},S):null,k=i.playedRemaining>0?r.createElement(m,null,l10n.t("message_info_remaining",{count:i.playedRemaining,_plural:i.playedRemaining})):null,P=M(this.getAnimateEnterClass(l),"well-simple-body");_=l10n.t("message_info_seen_by"),e=k?c+u:c,A=b.minHeight(S,e),E=r.createElement(f,{classes:P,key:"played-section",style:A,title:l10n.t("message_info_played_by"),subtitle:C,footer:k},w)}var N=void 0;if(i&&(i.read.length>0||i.playedRemaining>0)){var x=r.createElement("span",{className:"icon icon-ack icon-status-dblcheck-ack"}),D=i.read.map(function(e){return r.createElement(g,{participant:e,key:e.id})}),O=D.length>0?r.createElement("div",{className:"chatlist chatlist-plain"},D):null,R=i.readRemaining>0?r.createElement(m,null,l10n.t("message_info_remaining",{count:i.readRemaining,_plural:i.readRemaining})):null,I=M(this.getAnimateEnterClass(l),"well-simple-body");_=_||l10n.t("message_info_read_by"),e=R?c+u:c;var A=b.minHeight(D,e);N=r.createElement(f,{classes:I,key:"read-section",title:_,style:A,subtitle:x,footer:R},O)}var L=void 0;if(i&&(i.delivery.length>0||i.deliveryRemaining>0)){var F=r.createElement("span",{className:"icon icon-ack icon-status-dblcheck"}),U=i.delivery.map(function(e){return r.createElement(g,{participant:e,key:e.id})}),G=U.length>0?r.createElement("div",{className:"chatlist chatlist-plain"},U):null,j=i.deliveryRemaining>0?r.createElement(m,null,l10n.t("message_info_remaining",{count:i.deliveryRemaining,_plural:i.deliveryRemaining})):null,B=M(this.getAnimateEnterClass(l),"well-simple-body");e=j?c+u:c,A=b.minHeight(U,e),L=r.createElement(f,{classes:B,key:"delivered-section",style:A,title:l10n.t("message_info_delivered_to"),subtitle:F,footer:j},G)}var V=void 0;i||o||(V=r.createElement(f,{classes:"drawer-section-spinner",key:"spinner"},r.createElement(y,{size:50,stroke:4})));var q=M("pane-preview-wrapper","pane-preview-wrapper-bg",{"pane-preview-resize":t.type===s["default"].TYPE.PTT||t.type===s["default"].TYPE.IMAGE||t.type===s["default"].TYPE.LOCATION||t.type===s["default"].TYPE.VCARD||t.isGif});return r.createElement(d,{key:"message-info-modal",id:"info",variant:"panel",onCancel:this.onClose},r.createElement(p,{title:l10n.t("message_info"),type:p.Type.SMALL,onCancel:this.onClose}),r.createElement("div",{className:q,ref:"scrollable"},r.createElement("div",{className:"pane-preview"},r.createElement("div",{className:"pane-chat-tile"}),r.createElement(v,{msg:t,key:"star-"+a.toString(),ref:"wrapper",displayType:T.DISP_TYPE.MSG_INFO,isMsgVisible:this.isMsgVisible,position:v.Position.END}))),r.createElement(h,{classes:"drawer-body-msg-info"},V,E,N,L))}});w.contextTypes={uim:r.PropTypes.instanceOf(S)},e.exports=w},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(1354),o=i(r),l=n(1390),c=i(l),u=n(8),d=n(1462),p=n(1372),h=n(1370),f=u.createClass({displayName:"GroupsModal",propTypes:{chats:u.PropTypes.arrayOf(u.PropTypes.instanceOf(o["default"])),filter:u.PropTypes.func,onCancel:u.PropTypes.func.isRequired,onGroup:u.PropTypes.func.isRequired},getDefaultProps:function(){return{filter:function(){return!0}}},getInitialState:function(){return this.selection=new p,{loading:!0,searchFilter:void 0}},componentWillMount:function(){var e=this,t=this.props.chats;s["default"].delay(300).then(function(){return s["default"].all(_.map(_.filter(t,function(e){return e.groupMetadata.stale}),function(e){return e.groupMetadata.update()["catch"](_.noop)}))}).then(function(){return e.setState({loading:!1})})},onSelect:function(e,t){var n=t.props.chat;this.props.filter(n)===!0&&this.props.onGroup(t.props.chat)},onSearch:function(e){this.setState({searchFilter:e})},render:function(){var e=this,t=this.props,n=t.chats,i=t.onGroup,a=t.filter,s=t.onCancel,r=void 0;return this.state.loading?r=u.createElement(h.Loading,null):!function(){var t=l10n.accentFold(e.state.searchFilter),s=n.filter(function(e){return a(e)&&(!t||t&&e.contact.searchMatch(t))});s.length?(e.selection.init(_.map(s.filter(function(e){return a(e)===!0}),"id")),r=s.map(function(t){var n=void 0,s=void 0;return _.isString(a(t))&&(n=u.createElement("div",{className:"chat-status ellipsify",title:a(t)},a(t)),s="member"),u.createElement(c["default"],{chat:t,mode:l.Mode.INFO,active:e.selection,secondary:n,noContext:!0,className:s,onClick:_.isString(a(t))?void 0:i.bind(null,t),key:t.id})})):r=u.createElement(h.SearchGroups,null)}(),u.createElement(d,{title:l10n.t("web_groups"),selection:this.selection,onSearch:this.onSearch,searchPlaceholder:l10n.t("search_groups"),onSelect:this.onSelect,onCancel:s},r)}});e.exports=f},function(e,t,n){"use strict";var i=n(8),a=n(1357),s=n(1359),r=n(1358),o=n(1388),l=n(1618),c=n(10),u=n(241),d=n(46),p=n(9),h="animated-doodle",f=n(1673),m={"class":".animated-doodle",low:{"default":f},high:{"default":f}},g=i.createClass({displayName:"HelpDrawer",propTypes:{onClose:i.PropTypes.func.isRequired},componentWillMount:function(){u.isAssetLoaded(h)||u.loadAsset(m,h)},onTOS:function(){var e="https://www.whatsapp.com/legal/";e=d.build(e,{lg:l10n.getLocale()}),window.open(e,"_blank")},onFAQ:function(){var e="http://www.whatsapp.com/faq/web";e=e=d.build(e,{lg:l10n.getLocale()}),window.open(e,"_blank")},onContactUs:function(){c.openModal(i.createElement(l,null))},render:function(){return i.createElement(a,{onCancel:this.onBack,id:"help"},i.createElement(s,{a8n:"drawer-title-help",title:l10n.t("help_drawer_title"),onBack:this.props.onClose,type:s.Type.LARGE}),i.createElement(r,{wide:!0},i.createElement("div",{className:"controls-section animated-doodle"}),i.createElement("div",{className:"controls-section version"},l10n.t("version",{version:p.VERSION_STR})),i.createElement("div",{className:"chatlist list-icons list-actions"},i.createElement(o,{className:"drawer-list-item",a8n:"li-faq",onClick:this.onFAQ},l10n.t("web_settings_faq")),i.createElement(o,{className:"drawer-list-item",a8n:"li-contact-us",onClick:this.onContactUs},l10n.t("send_logs_title")),i.createElement(o,{className:"drawer-list-item",a8n:"li-tos",onClick:this.onTOS},l10n.t("terms_and_privacy_link")))))}});e.exports=g},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(15),s=i(a),r=n(5),o=i(r),l=n(6),c=i(l),u=n(19),d=i(u),p=n(18),h=i(p),f=n(1354),m=(i(f),n(453)),g=(i(m),n(8)),v=n(1399),y=n(1514),E=n(1509),_=n(229),b=n(1357),C=n(1359),M=n(1358),S=n(1479),T=n(1365),w=n(109),k=n(157),P=n(75),N=n(23),x=n(43),D={MEDIA:"media",DOCS:"docs",LINKS:"links"},O=function(e){function t(){(0,o["default"])(this,t);var e=(0,d["default"])(this,(0,s["default"])(t).apply(this,arguments));return e.onSelectMessages=function(){e.state.selectable||e.setState({selectable:!0})},e.onCancelSelection=function(){e.state.selectable&&(e.selectedMessages.unsetAll(),e.setState({selectable:!1}))},e.onMessageSelect=function(t,n){e.onSelectMessages(),e.selectedMessages.setVal(t,n)},e.selectedMessages=new T([],function(e){return e.id.toString()}),e.state={selected:D.MEDIA,direction:null,selectable:!1},e}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"onSelectTab",value:function(e){var t=N.values(D).indexOf(this.state.selected),n=N.values(D).indexOf(e),i=n>t?"right":"left";this.setState({selected:e,direction:i})}},{key:"getTabs",value:function(){var e=this;if(!P.supportsFeature(P.F.LINK_DOC_GALLERY))return null;var t=[{tab:D.MEDIA,title:k.t("media")},{tab:D.DOCS,title:k.t("docs")},{tab:D.LINKS,title:k.t("links")}].map(function(t){var n=x("menu-item",{active:e.state.selected===t.tab});return g.createElement("button",{className:n,onClick:e.onSelectTab.bind(e,t.tab),key:t.tab,title:t.title},t.title)});return g.createElement("div",{className:"menu-tabs menu-tabs-lists","data-active-tab":this.state.selected},t)}},{key:"getContent",value:function(){var e=this.props.chat;if(!P.supportsFeature(P.F.LINK_DOC_GALLERY))return g.createElement(v,{chat:e,mediaMsgs:e.getMediaMsgs(),selectable:this.state.selectable,onMessageSelect:this.onMessageSelect,selectedMessages:this.selectedMessages,fullCollection:!0});var t=void 0;switch(this.state.selected){case D.MEDIA:t=g.createElement(v,{chat:e,mediaMsgs:e.getMediaMsgs(),selectable:this.state.selectable,onMessageSelect:this.onMessageSelect,selectedMessages:this.selectedMessages,fullCollection:!0});break;case D.LINKS:t=g.createElement(y,{chat:e,linkMsgs:e.getLinkMsgs(),selectable:this.state.selectable,onMessageSelect:this.onMessageSelect,selectedMessages:this.selectedMessages});break;case D.DOCS:t=g.createElement(E,{chat:e,docMsgs:e.getDocMsgs(),selectable:this.state.selectable,onMessageSelect:this.onMessageSelect,selectedMessages:this.selectedMessages})}return t}},{key:"render",value:function(){var e=this.props.chat,t=this.getTabs(),n=this.getContent(),i=this.state.selectable?g.createElement(_,{displayName:"MediaMultiSelect",escapable:!0,requestDismiss:this.onCancelSelection},g.createElement(S,{chat:e,noSortOnForward:!0,selectedMessages:this.selectedMessages,onCancel:this.onCancelSelection})):null,a="right"===this.state.direction?"slide-forward":"slide-back",s=P.supportsFeature(P.F.LINK_DOC_GALLERY)?" ":k.t("media");return g.createElement(b,{id:"multimedia-gallery",onCancel:this.props.onBack},g.createElement(C,{title:s,onBack:this.props.onBack,type:C.Type.LARGE}),i,t,g.createElement(M,{"data-list-scroll-container":!0},g.createElement(w,{transitionName:a,className:"column"},g.createElement("div",{className:"multimedia-gallery",key:this.state.selected},g.createElement("div",{className:"column"},n)))))}}]),t}(g.Component);e.exports=O},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(453),s=i(a),r=n(8),o=n(1356),l=n(76),c=n(43),u=n(1361),d=n(1355),p=n(75),h=r.createClass({displayName:"MediaPanelHeader",propTypes:{msg:r.PropTypes.instanceOf(s["default"]).isRequired,onGoToMsgClick:r.PropTypes.func.isRequired,onUnstarClick:r.PropTypes.func.isRequired,onStarClick:r.PropTypes.func.isRequired,openForwardFlow:r.PropTypes.func.isRequired,onDownloadClick:r.PropTypes.func.isRequired,onClose:r.PropTypes.func.isRequired},mixins:[o],getInitialState:function(){return{renderableUrl:this.async("msg.mediaData.renderableUrl")}},getMenuBtns:function(){var e=this.props.msg,t=null,n=null,i=null,a=null,s=null,o="menu-item menu-item-hover";if(t=r.createElement("div",{className:o,onClick:this.props.onGoToMsgClick},r.createElement("span",{className:"icon icon-bubble",title:l10n.t("go_to_message")})),p.supportsFeature(p.F.STARRED)){var l=void 0,u=void 0,d=void 0;e.star?(l=this.props.onUnstarClick,u="icon icon-unstar-btn",d=l10n.t("unstar_message")):(l=this.props.onStarClick,u="icon icon-star-btn",d=l10n.t("star_message")),n=r.createElement("div",{className:o,onClick:l},r.createElement("span",{className:u,title:d}))}return i=r.createElement("div",{className:o,onClick:this.props.openForwardFlow},r.createElement("span",{className:"icon btn-media-forward icon-forward",title:l10n.t("forward")})),a=r.createElement("div",{className:c(o,{disabled:!this.state.renderableUrl}),onClick:this.props.onDownloadClick},r.createElement("a",{className:"icon icon-download",title:l10n.t("web_button_download")})),{btnGoToMsg:t,btnStar:n,btnForward:i,btnDownload:a,btnMinimize:s}},render:function(){var e=this.props.msg,t=e.displayName(!0,!0);e.isGroupMsg&&(t+=" @ "+e.chat.title());var n=this.getMenuBtns(),i=n.btnGoToMsg,a=n.btnStar,s=n.btnForward,o=n.btnDownload,p=n.btnMinimize,h=c("media-panel-header",{});return r.createElement("div",{className:h},r.createElement("div",{className:"chat media-chat"},r.createElement("div",{className:"chat-avatar"},r.createElement(u,{id:e.sender,size:40})),r.createElement("div",{className:"chat-body"},r.createElement("div",{className:"chat-main"},r.createElement(d,{ellipsify:!0,text:t})),r.createElement("div",{className:"chat-secondary"},r.createElement("div",{className:"chat-status ellipsify"},l.relativeDateAndTimeStr(e.t))))),r.createElement("div",{className:"menu menu-horizontal media-panel-tools"},p,i,a,s,o,r.createElement("div",{className:"menu-item menu-item-hover"},r.createElement("button",{className:"icon icon-x-viewer",title:l10n.t("web_close"),onClick:this.props.onClose}))))}});e.exports=h},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(453),s=i(a),r=n(1377),o=i(r),l=n(1371),c=n(8),u=n(44),d=n(1356),p=n(154),h=n(1355),f=n(1403),m=n(1434),g=n(1378),v=n(1392),y=n(10),E=n(1423),b=n(454),C=n(231),M=n(1611),S=n(460),T=n(75),w=n(1480),k=n(472),P=n(43),N=n(229),x=500,D=2,O=c.createClass({displayName:"MediaViewerModal",mixins:[d],propTypes:{msg:c.PropTypes.instanceOf(s["default"]).isRequired,zoomIn:c.PropTypes.bool,getZoomNode:c.PropTypes.func,onBack:c.PropTypes.func.isRequired,onExitAnimation:c.PropTypes.func,onNext:c.PropTypes.func,onPrev:c.PropTypes.func,onImgZoomIn:c.PropTypes.func},getDefaultProps:function(){return{getZoomNode:_.noop}},getInitialState:function(){return{star:this.async("msg.star"),mediaStage:this.async("msg.mediaData.mediaStage"),imgZoomed:!1}},componentWillMount:function(){if(this.props.msg.mediaData.mediaStage===C.STAGE.RESOLVED&&this.props.zoomIn){var e=this.props.getZoomNode(this.props.msg.id);this.setState({zoomElement:e}),this.style={opacity:0}}},componentDidMount:function(){this.style={}},onImageLoad:function(e){var t=this.state.zoomElement;t&&e&&this.props.zoomIn&&!this.zoomed&&(this.animateZoom(t,e),this.zoomed=!0)},animateZoom:function(e,t){var n=this,i=t.getBoundingClientRect(),a=e.getBoundingClientRect(),s=a.top-i.top,r=a.left-i.left,o=e.clientWidth/t.clientWidth,l=(t.clientHeight-e.clientHeight)/2,c=(t.clientWidth-e.clientWidth)/2;s-=l,r-=c,Velocity(t,{opacity:0,translateX:r,translateY:s,scale:o},{duration:0}).then(function(){var e=[],i=Velocity(t,{opacity:[1,0],translateX:[0,r],translateY:[0,s],scale:[1,i]},{duration:x,easing:[.1,.82,.25,1]});e.push(i);var a=u.findDOMNode(n.refs.caption);if(a){var o=Velocity(a,{opacity:[1,0]},{duration:x});e.push(o)}return e})},openForwardFlow:function(e){e.stopPropagation();var t=this.props.msg;t.isUnsentMedia?y.openModal(c.createElement(b,{title:l10n.t("err_unsent_forward_title"),onOK:y.closeModal.bind(y),okText:l10n.t("web_ok")},l10n.t("err_unsent_forward_text"))):y.openModal(c.createElement(E,{msgs:[this.props.msg]}),"modal-flow")},onScroll:function(e){Math.abs(e.deltaY)>7&&this.onClose()},onImgZoomIn:function(e){if(e&&this.refs.media){var t=this.refs.media;this.listenToMouseMove=t.heightOveflow>0||t.widthOveflow>0}this.setState({imgZoomed:e}),this.props.onImgZoomIn(e)},onZoomOut:function(){this.refs.media&&this.state.imgZoomed&&this.refs.media.onImageClick()},onMouseMove:function(e){this.handleMouseMove(e.pageX,e.pageY)},handleMouseMove:_.throttle(function(e,t){var n=this.refs.media&&this.refs.media.refs.image,i=u.findDOMNode(n);if(i){var a=i.parentNode,s=a.parentNode,r=this.refs.media.getTranslatePosition(s,e,t),o=r.translateX,l=r.translateY;Velocity(a,"stop"),Velocity(a,{translateX:o,translateY:l,scale:D},{duration:0})}},42),onDownloadClick:function(e){e.stopPropagation(),S.initDownload(this.props.msg)},onStarClick:function(e){e.stopPropagation(),this.props.msg.chat.sendStarMsgs([this.props.msg],!0)},onUnstarClick:function(e){e.stopPropagation(),this.props.msg.chat.sendStarMsgs([this.props.msg],!1)},onGoToMsgClick:function(e){e.stopPropagation(),this.onClose(),y.existsDrawerRight(function(e){e&&2===w.column&&y.closeDrawerRight()});var t=this.props.msg;y.openChatAt(t.chat,t.chat.getSearchContext(t))},getMenuBtns:function(){var e=this.props.msg,t=null,n=null,i=null,a=null,s=P("menu-item menu-item-hover",{
disabled:!e.mediaData.renderableUrl});if(t=c.createElement("div",{className:"menu-item menu-item-hover",onClick:this.onGoToMsgClick},c.createElement("span",{className:"icon icon-bubble",title:l10n.t("go_to_message")})),T.supportsFeature(T.F.STARRED)){var r=void 0,o=void 0,l=void 0;e.star?(r=this.onUnstarClick,o="icon icon-unstar-btn",l=l10n.t("unstar_message")):(r=this.onStarClick,o="icon icon-star-btn",l=l10n.t("star_message")),n=c.createElement("div",{className:s,onClick:r},c.createElement("span",{className:o,title:l}))}return i=c.createElement("div",{className:s,onClick:this.openForwardFlow},c.createElement("span",{className:"icon btn-media-forward icon-forward",title:l10n.t("forward")})),a=c.createElement("div",{className:s,onClick:this.onDownloadClick},c.createElement("a",{className:"icon icon-download",title:l10n.t("web_button_download")})),{btnGoToMsg:t,btnStar:n,btnForward:i,btnDownload:a}},onClose:function(){var e=this;if(!this.closing){this.closing=!0,_.isFunction(this.props.onExitAnimation)&&this.props.onExitAnimation();var t=this.props.getZoomNode(this.props.msg.id);if(!t)return this.props.onBack();var n=this.refs.media,i=void 0;if(n&&n.refs){var a=this.props.msg.mediaData.type;a===C.TYPE.IMAGE?i=n.image:this.props.msg.mediaData.isGif&&(i=n.refs.player)}if(!i)return this.props.onBack();i=u.findDOMNode(i);var s=i.getBoundingClientRect(),r=t.getBoundingClientRect(),o=r.top-s.top,l=r.left-s.left,c=t.clientWidth/i.clientWidth,d=(i.clientHeight-t.clientHeight)/2,p=(i.clientWidth-t.clientWidth)/2;o-=d,l-=p,Velocity(i,{translateX:[l,0],translateY:[o,0],scale:[c,1]},{duration:200,easing:[.1,.82,.25,1]}).then(function(){e.props.onBack()});var h=u.findDOMNode(this.refs.caption);h&&Velocity(h,{opacity:[0,1]},{duration:200,easing:[.1,.82,.25,1]})}},onMinimizeClick:function(){var e=u.findDOMNode(this.refs.media).querySelector("video"),t=e.currentTime;y.videoPlayerFloater(this.props.msg,this.props.zoomNode,t),this.onClose()},render:function(){var e,t=this.props.msg,n=t.mediaData;switch(n.type){case C.TYPE.IMAGE:e=c.createElement(R,{msg:t,key:t.id,style:this.style,onLoad:this.onImageLoad,onImgZoomIn:this.onImgZoomIn,ref:"media"});break;case C.TYPE.VIDEO:e=c.createElement(I,{msg:t,key:t.id,onLoad:n.isGif?this.onImageLoad:null,startTime:this.props.startTime,ref:"media"});break;case C.TYPE.AUDIO:e=c.createElement(L,{msg:t,key:t.id})}var i=void 0;if(t.caption){var a=t.mentionMap(),s=this.props.zoomIn&&(n.isGif||n.type===C.TYPE.IMAGE);i=c.createElement(h,{ref:"caption",className:{"media-caption":!0,"caption-hidden":s},linkify:!0,format:!0,mention:a,text:t.caption})}var r=P("media",{"media-with-caption":!!i}),o=c.createElement("span",{className:"icon icon-chevron-right icon-l",title:l10n.t("next_button")}),l=P("btn btn-round btn-media-next",{"disabled-btn":!this.props.onNext}),u=c.createElement("div",{role:"button",className:l,onClick:this.props.onNext||function(e){return e.stopPropagation()}},o),d=c.createElement("span",{className:"icon icon-chevron-left icon-l",title:l10n.t("previous_button")}),p=P("btn btn-round btn-media-prev",{"disabled-btn":!this.props.onPrev}),f=c.createElement("div",{role:"button",className:p,onClick:this.props.onPrev||function(e){return e.stopPropagation()}},d),m=P("media-viewer",{"media-viewer-animate":this.props.zoomIn,"cursor-zoom-out":this.state.imgZoomed}),g=this.state.imgZoomed?null:this.onScroll,v=this.state.imgZoomed?null:this.onClose,y=this.state.imgZoomed&&this.listenToMouseMove?this.onMouseMove:null,E=this.state.imgZoomed?this.onZoomOut:null;return c.createElement(N,{displayName:"MediaViewer",escapable:!0,requestDismiss:this.onClose},c.createElement("div",{className:m,onClick:E,onMouseMove:y},c.createElement(M,{msg:this.props.msg,onGoToMsgClick:this.onGoToMsgClick,onUnstarClick:this.onUnstarClick,onStarClick:this.onStarClick,openForwardFlow:this.openForwardFlow,onDownloadClick:this.onDownloadClick,onMinimizeClick:this.onMinimizeClick,onClose:this.onClose}),c.createElement("div",{className:"media-content",dir:"ltr",ref:"container",onWheel:g,onClick:v},f,c.createElement("div",{className:r},c.createElement(F,{msg:t}),e,i),u)))}}),R=c.createClass({displayName:"MediaImage",mixins:[d,p],propTypes:{msg:c.PropTypes.instanceOf(s["default"]).isRequired,style:c.PropTypes.object,onLoad:c.PropTypes.func,onImgZoomIn:c.PropTypes.func},getInitialState:function(){return{mediaStage:this.async("msg.mediaData.mediaStage"),zoomIn:null}},componentDidMount:function(){this.props.msg.forceDownloadMedia()},onImageClick:function(e){if(e&&e.stopPropagation(),this.state.zoomIn)return this.props.onImgZoomIn(!1),void this.setState({zoomIn:null});var t=u.findDOMNode(this.image),n=t.parentNode,i=n.parentNode;this.heightOveflow=n.clientHeight*D-i.clientHeight,this.widthOveflow=n.clientWidth*D-i.clientWidth;var a=this.getTranslatePosition(i,e.pageX,e.pageY),s=a.translateX,r=a.translateY;this.props.onImgZoomIn(!0),this.setState({zoomIn:{factor:D,translateX:s,translateY:r}})},getTranslatePosition:function(e,t,n){var i=window.innerWidth/2-t,a=window.innerHeight/2-n,s=this.widthOveflow>0?Math.round(1.5*i*this.widthOveflow/e.clientWidth):0,r=this.heightOveflow>0?Math.round(1.5*a*this.heightOveflow/e.clientHeight):0;return{translateX:s,translateY:r}},render:function(){var e=this,t=this.props.msg,n=t.mediaData,i=this.state.zoomIn,a=P("media-viewer-img",{"cursor-zoom-in":!i});if(n.mediaStage===C.STAGE.RESOLVED){var s={width:n.fullWidth,height:n.fullHeight},r=c.createElement(o["default"],{src:n.renderableUrl,ref:(0,l.GetRef)("image",this),onClick:this.onImageClick,style:this.props.style,className:a});return i&&(r=c.createElement(N,{displayName:"ZoomInImage",ref:"image",escapable:!0,requestDismiss:function(){return e.onImageClick()}},r)),c.createElement(g,{type:g.TYPES.ZOOM_IN,size:s,zoomIn:this.state.zoomIn,onObjectLoad:this.props.onLoad},r)}return c.createElement(A,{msg:t})}}),I=c.createClass({displayName:"MediaVideo",mixins:[d,p],propTypes:{msg:c.PropTypes.instanceOf(s["default"]).isRequired,style:c.PropTypes.object,onLoad:c.PropTypes.func},getInitialState:function(){return{played:!1,mediaStage:this.async("msg.mediaData.mediaStage"),size:{width:0,height:0}}},componentWillMount:function(){this.updateSize()},componentWillReceiveProps:function(){this.updateSize()},componentDidMount:function(){var e=this.props.msg;e.forceDownloadMedia()},updateSize:function(){var e=this.props.msg.mediaData;e.mediaStage===C.STAGE.RESOLVED&&e.fullWidth&&e.fullHeight&&this.setState({size:this.getSize()})},onPlayerError:function(e){},onPlayerClick:function(e){e.stopPropagation();var t=u.findDOMNode(this.refs.player);e.clientY>t.clientHeight+t.offsetTop-44||(t.paused?t.play():t.pause())},onResize:function(e){this.setState({size:e})},stopPropagation:function(e){e.stopPropagation()},getSize:function(){var e=this.props.msg.mediaData,t=330;return!e.isGif||e.fullWidth>=t?{width:e.fullWidth,height:e.fullHeight}:{width:t,height:e.fullHeight*t/e.fullWidth}},render:function(){var e=this.props.msg,t=e.mediaData,n=t.isGif,i=t.mediaStage===C.STAGE.RESOLVED;return i?c.createElement(g,{type:g.TYPES.SCALE_DOWN,size:this.state.size,onObjectLoad:this.props.onLoad,style:this.props.style},c.createElement(f,{msg:e,ref:"player",className:"media-viewer-img",onError:this.onPlayerError,onClick:n?this.stopPropagation:this.onPlayerClick,autoPlay:!0,controls:!n,loop:n,startTime:this.props.startTime,onResize:this.onResize},l10n.t("video_playback_not_supported"))):c.createElement(A,{msg:e})}}),A=c.createClass({displayName:"BlurredImage",stopPropagation:function(e){e.stopPropagation()},render:function(){var e=this.props.msg.mediaData,t=e.preview&&e.preview.url(),n=k.boundHeightWidth(10*e.thumbHeight,10*e.thumbWidth,500,500),i={width:n.width,height:n.height};return c.createElement("div",{className:"media-viewer-blur-crop",style:i,onClick:this.stopPropagation},c.createElement("img",{className:"media-viewer-blur-img",src:t}))}}),L=c.createClass({displayName:"MediaAudio",mixins:[d],propTypes:{msg:c.PropTypes.instanceOf(s["default"]).isRequired},getInitialState:function(){return{mediaStage:this.async("msg.mediaData.mediaStage")}},render:function(){var e=this.props.msg;return e.mediaData.mediaStage===C.STAGE.RESOLVED?c.createElement(m,{msg:e,className:"media-viewer-img media-viewer-audio",autoPlay:!0,controls:!0},l10n.t("audio_playback_not_supported")):c.createElement("div",{className:"image-audio"})}}),F=c.createClass({displayName:"MediaStage",mixins:[d],propTypes:{msg:c.PropTypes.instanceOf(s["default"]).isRequired},getInitialState:function(){return{mediaStage:this.async("msg.mediaData.mediaStage")}},onUnsupportedDownloadClick:function(e){var t=this;e.stopPropagation(),y.openModal(c.createElement(b,{onCancel:y.closeModal.bind(y),onOK:function(){y.closeModal(),S.initDownload(t.props.msg)},okText:l10n.t("web_button_download"),cancelText:l10n.t("web_cancel"),title:l10n.t("download_unsupported_media_title")},l10n.t("download_unsupported_media_prompt")))},downloadMedia:function(e){e.stopPropagation(),this.props.msg.forceDownloadMedia()},stopPropagation:function(e){e.stopPropagation()},render:function(){var e=this.props.msg.mediaData,t=null;switch(e.mediaStage){case C.STAGE.RESOLVED:case C.STAGE.ERROR_MISSING:return null;case C.STAGE.ERROR_UNSUPPORTED:return t=this.onUnsupportedDownloadClick,c.createElement(v.Download,{filesize:e.size,onClick:t});case C.STAGE.NEED_POKE:return t=this.downloadMedia,c.createElement(v.Download,{filesize:e.size,onClick:t});default:return t=this.stopPropagation,c.createElement("div",{onClick:t},c.createElement(v.Pending,null))}}});e.exports=O},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(453),s=i(a),r=n(110),o=i(r),l=n(8),c=n(1383),u=n(1357),d=n(1359),p=n(1358),h=n(10),f=n(459),m=n(1466),g=l.createClass({displayName:"MultiVCardModal",propTypes:{msg:l.PropTypes.instanceOf(s["default"]).isRequired},_renderVCard:function(e,t){var n=f.parse(e.vcard);return n?l.createElement(m,{key:t,parsedVCard:n,thumbnail:f.thumbnail(e.vcard),className:"multi-vcard-dialog-contact"}):null},render:function(){var e=this,t=this.props.msg;return l.createElement(c,{type:c.BOX},l.createElement(u,{onCancel:function(){return h.closeModal()}},l.createElement(d,{title:l10n.t("multi_vcard_number_of_contacts",{count:t.vcardList.length,_plural:t.vcardList.length}),type:d.Type.POPUP,onCancel:function(){return h.closeModal()}}),l.createElement(p,null,l.createElement(o["default"],null,l.createElement("div",{className:"multi-vcard-dialog-body"},t.vcardList.map(function(t,n){return e._renderVCard(t,n)}))))))}});e.exports=g},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1354),s=i(a),r=n(8),o=n(44),l=n(10),c=n(1355),u=n(0),d=n(92),p=function(){return[{label:l10n.t("web_mute_8hours"),duration:8},{label:l10n.t("web_mute_1week"),duration:168},{label:l10n.t("web_mute_1year"),duration:8760}]},h=r.createClass({displayName:"MutePopup",propTypes:{onCancel:r.PropTypes.func,onMute:r.PropTypes.func.isRequired,chat:r.PropTypes.instanceOf(s["default"]).isRequired},getInitialState:function(){return{mute:8}},onChange:function(e){this.setState({mute:parseInt(e.target.value,10)})},onMute:function(e){e.stopPropagation(),l.closeModal(),this.props.onMute(3600*this.state.mute+u().unix(),!0)},componentDidMount:function(){d.focus(o.findDOMNode(this.refs.button))},render:function(){var e=this.props.onCancel||function(){l.closeModal()},t=this.state.mute,n=this,i=p().map(function(e){var i=e.duration;return r.createElement("li",{key:"mute-"+i},r.createElement("label",null,r.createElement("input",{type:"radio",name:"duration",value:e.duration,checked:t===i,onChange:n.onChange}),e.label))});return r.createElement("div",{className:"backdrop"},r.createElement("div",{className:"popup-container"},r.createElement("div",{className:"popup"},r.createElement("div",{className:"popup-body"},r.createElement("div",{className:"popup-title",dir:"auto"},r.createElement(c,{text:l10n.t("mute_time",{name:this.props.chat.title()})})),r.createElement("div",{className:"popup-contents"},r.createElement("form",{ref:"form"},r.createElement("ol",{className:"choices"},i)))),r.createElement("div",{className:"popup-controls"},r.createElement("button",{className:"btn-plain popup-controls-item",onClick:e},l10n.t("web_cancel")),r.createElement("button",{ref:"button",className:"btn-plain btn-default popup-controls-item",onClick:this.onMute},l10n.t("web_menuitem_mute"))))))}});e.exports=h},function(e,t,n){"use strict";var i=n(8),a=n(1357),s=n(1359),r=n(1358),o=n(1387),l=n(1414),c=n(109),u=n(457),d=i.createClass({displayName:"NewGroupDrawer",propTypes:{thumb:i.PropTypes.string,full:i.PropTypes.string,subject:i.PropTypes.string,onBack:i.PropTypes.func.isRequired,onContinue:i.PropTypes.func.isRequired},getInitialState:function(){return{text:this.props.subject||"",thumb:this.props.thumb,full:this.props.full,emojiActive:!1}},componentDidMount:function(){this.refs.emojiInput.restoreFocus()},preventBlur:function(e){e.preventDefault(),e.stopPropagation(),this.refs.emojiInput.restoreFocus()},onImageSet:function(e,t){this.setState({thumb:e,full:t})},onContinue:function(){var e=u.emojify(this.state.text.trim());this.props.onContinue(e,this.state.thumb,this.state.full)},onInputChange:function(e){var t=e.target.value;this.setState({text:t})},render:function(){var e=this.state.text.trim().length>0,t=e?i.createElement("div",{className:"drawer-section drawer-controls"},i.createElement("button",{className:"btn btn-round",onClick:this.onContinue},i.createElement("span",{className:"icon icon-forward-light icon-l"}))):null;return i.createElement(a,{id:"new-group",onCancel:this.props.onBack},i.createElement(s,{title:l10n.t("new_group_flow_title"),type:s.Type.LARGE,onBack:this.props.onBack}),i.createElement(r,{wide:!0},i.createElement("div",{className:"drawer-section"},i.createElement(l,{type:l.Type.GROUP,startImage:this.state.full,onImageSet:this.onImageSet,ref:"photoPicker"})),i.createElement("div",{className:"drawer-section",onMouseDown:this.preventBlur},i.createElement(o,{ref:"emojiInput",value:this.state.text,maxLength:25,showRemaining:!0,onChange:this.onInputChange,placeholder:l10n.t("group_subject"),onEnter:e?this.onContinue:_.noop,supportsEmoji:!0})),i.createElement(c,{transitionName:"btn"},t)))}});e.exports=d},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(110),s=i(a),r=n(8),o=n(1357),l=n(1359),c=n(1358),u=n(1433),d=n(1505),p=n(153),h=n(1360),f=n(9),m=n(10),g=n(456),v=n(92),y=n(454),E=n(12),b=n(155),C=n(109),M=g.genId("max_participant_toast"),S=r.createClass({displayName:"NewGroupParticipantsDrawer",mixins:[p,h],propTypes:{thumb:r.PropTypes.string,full:r.PropTypes.string,subject:r.PropTypes.string.isRequired,onBack:r.PropTypes.func.isRequired,onContinue:r.PropTypes.func.isRequired},getInitialState:function(){var e=this;return this.props.uimContext&&(this.props.uimContext.uimClose=function(){e.onBack()}),{searchText:"",participants:[],shouldFocus:!0,isBusy:!1}},getFilteredContacts:function(){var e=Store.Contact.getFilteredContacts();e=_.difference(e,this.state.participants);var t=this.state.searchText;return t?(t=l10n.accentFold(t),e.filter(function(e){return e.searchMatch(t)})):e},componentDidMount:function(){this.focus()},componentDidUpdate:function(){this.adjustInput()},onKeyDown:function(e){if("Backspace"!==e.key||this.state.searchText||_.isEmpty(this.state.participants))"Enter"===e.key&&_.size(this.state.participants)&&this.onContinue();else{e.preventDefault();var t=this.state.participants;this.setState({participants:t.slice(0,t.length-1),shouldFocus:!0})}},onInput:function(e){this.setState({searchText:e.target.value})},adjustInput:function(){var e=this.refs.input.offsetParent.offsetWidth-10,t=this.refs.sizer.offsetWidth,n=t>e?e:t;this.refs.input.style.width=n+"px";var i;i=e-this.refs.input.offsetLeft-n>0?e-this.refs.input.offsetLeft:e,this.refs.input.style.width=i+"px",this.state.shouldFocus&&this.focus()},onReset:function(){this.setState({searchText:"",shouldFocus:!0})},focus:function(){v.focus(this.refs.input)},onBack:function(){var e=this.props;e.onBack(e.subject,e.thumb,e.full)},onContinue:function(){var e=this.props;e.onContinue(e.subject,e.thumb,e.full,this.state.participants)},onDelete:function(e,t){var n=_.without(this.state.participants,t);this.setState({participants:n,shouldFocus:!n.length})},onContactClick:function(e,t){var n=this,i=_.includes(this.state.participants,t);i?this.removeContact(t):t.isBlocked()?m.openModal(r.createElement(y,{title:l10n.t("add_blocked_title"),onOK:function(){n.unblockAndAddContact(t),m.closeModal()},onCancel:m.closeModal.bind(m),okText:l10n.t("web_yes"),cancelText:l10n.t("web_no")},l10n.t("add_blocked_contact_to_group"))):this.addContact(t)},addContact:function(e){var t=this.state.participants;if(t.length>=f.MAX_GROUP_SIZE){var n=l10n.t("action_group_create_failed_participant",{max:f.MAX_GROUP_SIZE});m.openToast(r.createElement(g,{msg:n,id:M}))}else this.setState({participants:t.concat(e),searchText:"",shouldFocus:!0})},removeContact:function(e){var t=this.state.participants;this.setState({participants:_.without(t,e),shouldFocus:!0})},unblockAndAddContact:function(e){var t=this;this.setState({isBusy:!0}),e.setBlock(!1).checkpoint(this.rejectOnUnmount()).then(function(){t.addContact(e),t.setState({isBusy:!1})})["catch"](E.Unmount,_.noop)["catch"](function(e){t.setState({isBusy:!1})})},onFocusList:function(e){this.refs.list&&(e.preventDefault(),e.stopPropagation(),s["default"].flashFocus=Date.now(),this.refs.list.focusFirst())},onFocusParticipants:function(e){e.repeat||0!==this.refs.input.selectionStart||this.refs.participantList&&(e.preventDefault(),e.stopPropagation(),s["default"].flashFocus=null,this.refs.participantList.focusLast())},onSelectFirst:function(e){e.preventDefault(),e.stopPropagation();var t=_.head(this.getFilteredContacts());t&&this.onContactClick(e,t)},onFocusSearch:function(e){s["default"].flashFocus=Date.now(),v.focus(this.refs.input)},render:function(){var e=void 0;this.state.isBusy?e=r.createElement(b,null):_.size(this.state.participants)&&(e=r.createElement("button",{className:"btn btn-round",onClick:this.onContinue},r.createElement("span",{className:"icon icon-checkmark-light"})));var t=_.size(this.state.participants)?" ":l10n.t("group_participant_hint"),n={down:this.onFocusList,enter:this.state.searchText?this.onSelectFirst:_.size(this.state.participants)?this.onContinue:_.noop,up:this.onFocusParticipants};return n[l10n.LR("left","right")]=this.onFocusParticipants,r.createElement(o,{id:"new-group",onCancel:this.onBack},r.createElement(l,{title:l10n.t("add_group_participants_title"),type:l.Type.LARGE,onBack:this.onBack}),r.createElement(c,null,r.createElement("div",{className:"drawer-section new-group-search"},r.createElement("div",{className:"input-clear input-ext"},r.createElement(s["default"],{handlers:n,className:"input input-line"},r.createElement("div",{className:"list-names list-deletable new-group-preview"},r.createElement("div",{className:"new-group-participants","data-list-scroll-container":!0},r.createElement(d,{ref:"participantList",contacts:this.state.participants,onDelete:this.onDelete,onFocusSearch:this.onFocusSearch}))),r.createElement("input",{className:"inputarea",ref:"input",placeholder:t,onKeyDown:this.onKeyDown,onChange:this.onInput,value:this.state.searchText}),r.createElement("span",{className:"inputarea-sizer",ref:"sizer"},this.state.searchText)))),r.createElement("div",{className:"new-group-contacts","data-list-scroll-container":!0},r.createElement(u,{ref:"list",contacts:this.getFilteredContacts(),onFocusSearch:this.onFocusSearch,onClick:this.onContactClick})),r.createElement(C,{transitionName:"btn",className:"drawer-section drawer-controls"},e)))}});e.exports=S},function(e,t,n){"use strict";var i=n(8),a=n(1357),s=n(1359),r=n(1358),o=n(1600),l=i.createClass({displayName:"NotificationsDrawer",propTypes:{onClose:i.PropTypes.func.isRequired},render:function(){return i.createElement(a,{onCancel:this.onBack,id:"notifications"},i.createElement(s,{a8n:"drawer-title-notifications",title:l10n.t("notifications_drawer_title"),onBack:this.props.onClose,type:s.Type.LARGE}),i.createElement(r,{wide:!0},i.createElement(o,{key:"notifications"})))}});e.exports=l},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(110),s=i(a),r=n(8),o=n(156),l=n(454),c=n(10),u=n(238),d=n(483),p=n(33),h=n(1387),f=n(456),m=320,g=50,v=10,y=500,E=r.createClass({displayName:"SendLogsPopup",mixins:[o],getInitialState:function(){return{email:"",emailError:void 0,confirmEmail:"",confirmEmailError:void 0,subject:l10n.t("send_logs_default_subject"),subjectError:void 0,description:"",descriptionError:void 0}},componentDidMount:function(){this.refs.emailAddr.restoreFocus()},onSend:function(){var e={},t=this.state.email.trim(),n=this.state.confirmEmail.trim();if(this.validateEmail(t)||(e.emailError=l10n.t("send_logs_email_invalid")),this.validateConfirmEmail(n)||(e.confirmEmailError=l10n.t("send_logs_email_nomatch")),this.validateDescription()||(e.descriptionError=l10n.t("send_logs_too_short")),this.validateSubject()||(e.subjectError=l10n.t("send_logs_subject_error")),_.isEmpty(e)){this.setState({email:t,confirmEmail:n,emailError:void 0,confirmEmailError:void 0,descriptionError:void 0,subjectError:void 0});var i=Store.Conn.me?d.format(Store.Conn.me.split("@")[0]):null,a=this.state.subject.trim()||l10n.t("send_logs_default_subject");p.uploadUserReport(i,t,a,this.state.description),c.closeModal(),c.openToast(r.createElement(f,{msg:l10n.t("send_logs_sent"),id:f.genId()}))}else e.email=t,e.confirmEmail=n,this.setState(e)},onCancel:function(){c.closeModal()},onSubjectChange:function(e){var t={subject:e.target.value};this.state.subjectError&&this.validateSubject(t.subject)&&(t.subjectError=void 0),this.setState(t)},onSubjectBlur:function(){var e=void 0;this.validateSubject()||(e=l10n.t("send_logs_subject_error")),this.state.subjectError!==e&&this.setState({subjectError:e})},onDescriptionChange:function(e){var t={description:e.target.value};this.state.descriptionError&&this.validateDescription(t.description)&&(t.descriptionError=void 0),this.setState(t)},onDescriptionBlur:function(){var e=void 0;!this.state.description&&!this.state.descriptionError||this.validateDescription()||(e=l10n.t("send_logs_too_short")),this.state.descriptionError!==e&&this.setState({descriptionError:e})},onEmailChange:function(e){var t={email:e.target.value};this.state.emailError&&this.validateEmail(t.email)&&(t.emailError=void 0),this.setState(t)},onEmailBlur:function(){var e=void 0,t=this.state.email.trim(),n={};!this.state.email&&!this.state.emailError||this.validateEmail(t)||(e=l10n.t("send_logs_email_invalid")),this.state.emailError!==e&&(n.emailError=e),this.state.email!==t&&(n.email=t),_.isEmpty(n)||this.setState(n)},onConfirmEmailChange:function(e){var t={confirmEmail:e.target.value};this.state.confirmEmailError&&this.validateConfirmEmail(t.confirmEmail)&&(t.confirmEmailError=void 0),this.setState(t)},onConfirmEmailBlur:function(){var e=void 0,t=this.state.confirmEmail.trim(),n={};!this.state.confirmEmail&&!this.state.confirmEmailError||this.validateConfirmEmail(t)||(e=l10n.t("send_logs_email_nomatch")),this.state.confirmEmailError!==e&&(n.confirmEmailError=e),this.state.confirmEmail!==t&&(n.confirmEmail=t),_.isEmpty(n)||this.setState(n)},validateEmail:function(){var e=arguments.length<=0||void 0===arguments[0]?this.state.email:arguments[0];return u.validateEmail(e)},validateConfirmEmail:function(){var e=arguments.length<=0||void 0===arguments[0]?this.state.confirmEmail:arguments[0];return this.state.email===e},validateDescription:function(){var e=arguments.length<=0||void 0===arguments[0]?this.state.description:arguments[0];return e.length>v},validateSubject:function(){arguments.length<=0||void 0===arguments[0]?this.state.subject:arguments[0];return!0},stopPropagation:function(e){e.stopPropagation()},render:function(){var e={enter:this.stopPropagation};return r.createElement(l,{title:l10n.t("send_logs_title"),okText:l10n.t("send_logs_confirm"),onOK:this.onSend,onCancel:this.onCancel},r.createElement(s["default"],{handlers:e},r.createElement(h,{className:"send-logs-input",ref:"emailAddr",value:this.state.email,error:this.state.emailError,maxLength:m,onChange:this.onEmailChange,onBlur:this.onEmailBlur,placeholder:l10n.t("send_logs_email_address")}),r.createElement(h,{className:"send-logs-input",editable:!0,value:this.state.confirmEmail,error:this.state.confirmEmailError,maxLength:m,onChange:this.onConfirmEmailChange,onBlur:this.onConfirmEmailBlur,placeholder:l10n.t("send_logs_email_confirm")}),r.createElement(h,{className:"send-logs-input",value:this.state.subject,error:this.state.subjectError,maxLength:g,onChange:this.onSubjectChange,onBlur:this.onSubjectBlur,placeholder:l10n.t("send_logs_email_subject")}),r.createElement(h,{className:"send-logs-input",value:this.state.description,error:this.state.descriptionError,maxLength:y,onChange:this.onDescriptionChange,onBlur:this.onDescriptionBlur,placeholder:l10n.t("describe_logs"),multiline:!0})))}});e.exports=E},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(15),s=i(a),r=n(5),o=i(r),l=n(6),c=i(l),u=n(19),d=i(u),p=n(18),h=i(p),f=n(1408),m=(i(f),n(1368)),g=i(m),v=n(8),y=n(1357),E=n(1359),_=n(1358),b=n(1388),C=n(157),M=n(1361),S=n(1355),T=n(9),w=function(e){function t(){var e,n,i,a;(0,o["default"])(this,t);for(var r=arguments.length,l=Array(r),c=0;c<r;c++)l[c]=arguments[c];return n=i=(0,d["default"])(this,(e=(0,s["default"])(t)).call.apply(e,[this].concat(l))),i.status=window.Store.Status.gaddUp(i.props.profileId),a=n,(0,d["default"])(i,a)}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"componentWillMount",value:function(){this.props.listeners.add(this.status,"change:status")}},{key:"render",value:function(){var e=T.STATUS_V2?v.createElement("div",{className:"chat-status"},v.createElement("span",{className:"emojitext ellipsify",dir:"auto"},v.createElement(S,{text:this.status.status||C.t("contact_status_loading"),direction:"auto"}))):null;return v.createElement(y,{id:"settings",onCancel:this.props.onClose},v.createElement(E,{title:C.t("settings_flow_title"),onBack:this.props.onClose,type:E.Type.LARGE}),v.createElement(_,null,v.createElement("div",{className:"chatlist list-identity"},v.createElement("div",{className:"chat",onClick:this.props.onProfile,"data-ignore-capture":"any"},v.createElement("div",{className:"chat-avatar"},v.createElement(M,{id:window.Store.Conn.me,size:82,quality:M.Quality.HIGH})),v.createElement("div",{className:"chat-body"},v.createElement("div",{className:"chat-main"},v.createElement("div",{className:"chat-title"},v.createElement("span",{className:"emojitext ellipsify",dir:"auto"},v.createElement(S,{text:window.Store.Conn.pushname,direction:"auto"})))),e))),v.createElement("div",{className:"chatlist list-icons list-actions"},v.createElement(b,{a8n:"li-notifications",iconClass:"icon-settings-notifications",onClick:this.props.onNotifications},C.t("menuitem_notifications")),v.createElement(b,{a8n:"li-chat_wallpaper",iconClass:"icon-settings-wallpaper",onClick:this.props.onWallpaper},C.t("menuitem_wallpaper")),v.createElement(b,{a8n:"li-blocked",iconClass:"icon-settings-blocked",onClick:this.props.onBlocked},C.t("menuitem_blocked")),v.createElement(b,{a8n:"li-help",iconClass:"icon-settings-help",onClick:this.props.onHelp},C.t("menuitem_help")))))}}]),t}(v.Component);t["default"]=(0,g["default"])(w)},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(15),s=i(a),r=n(5),o=i(r),l=n(6),c=i(l),u=n(19),d=i(u),p=n(18),h=i(p),f=n(1456),m=i(f),g=n(23),v=i(g),y=n(453),E=(i(y),n(8)),_=n(457),b=n(1452),C=n(1422),M=n(462),S=n(229),T=n(1380),w=n(1420),k=n(109),P=n(43),N=n(157),x=function(e){function t(){(0,o["default"])(this,t);var e=(0,d["default"])(this,(0,s["default"])(t).apply(this,arguments));return e.state={replyCaption:void 0,focused:!1,emojiPicker:void 0,chat:void 0},e.onReplyCaptionChangeHandler=e.onReplyCaptionChange.bind(e),e.onSendHandler=e.onSend.bind(e),e.onFocus=e.onFocus.bind(e),e.onBlur=e.onBlur.bind(e),e.onEmojiPicker=e.onEmojiPicker.bind(e),e.onEmoji=e.onEmoji.bind(e),e.restoreFocus=e.restoreFocus.bind(e),e.restoreEmojiPickerFocus=e.restoreEmojiPickerFocus.bind(e),e.emojiPickerClose=e.emojiPickerClose.bind(e),Store.Chat.find(e.props.msg.sender).checkpoint(e.props.rejectOnUnmount()).then(function(t){e.setState({chat:t})}),e}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"componentDidUpdate",value:function(e,t){this.shouldPausePlayback(t)&&!this.shouldPausePlayback(this.state)?this.props.playbackController.resume():!this.shouldPausePlayback(t)&&this.shouldPausePlayback(this.state)&&this.props.playbackController.pause()}},{key:"shouldPausePlayback",value:function(e,t){return e.emojiPicker||e.focused}},{key:"onReplyCaptionChange",value:function(e){this.setState({replyCaption:e.target.value})}},{key:"onSend",value:function(e){var t=this;if(this.state.replyCaption){var n=this.state.replyCaption.trim();n.length&&(Store.Chat.find(this.props.msg.sender).then(function(e){e.sendMessage(_.emojify(n),{},t.props.msg)}),this.setState({replyCaption:void 0}))}}},{key:"onFocus",value:function(e){this.setState({focused:!0}),console.log("compose box focus")}},{key:"onBlur",value:function(e){this.setState({focused:!1}),console.log("compose box blur")}},{key:"onEmojiPicker",value:function(e){e&&(e.preventDefault(),e.stopPropagation());var t=E.createElement(C,{onEmoji:this.onEmoji,onFocusRelease:this.restoreFocus});this.setState({emojiPicker:{menu:t,menuDirection:{y:M.Direction.Y.TOP},type:M.Type.EMOJI_PICKER,anchor:e.target}})}},{key:"onEmoji",value:function(e){this.refs.inputLine.replaceSelection(e)}},{key:"restoreFocus",value:function(){this.refs.inputLine&&this.refs.inputLine.restoreFocus()}},{key:"restoreEmojiPickerFocus",value:function(){this.refs.emojiPickerUIE&&this.refs.emojiPickerUIE.getRef()&&this.refs.emojiPickerUIE.getRef().getElement()&&this.refs.emojiPickerUIE.getRef().getElement().restoreFocus()}},{key:"emojiPickerClose",value:function(){this.setState({emojiPicker:void 0})}},{key:"render",value:function(){var e,t=P("status-v3-compose-box-wrapper",{focused:this.state.focused});v["default"].isEmpty(this.state.replyCaption)&&(e=N.t("type_a_reply"));var n=void 0,i=void 0;this.state.emojiPicker&&(n=E.createElement(S,{displayName:"EmojiPicker",escapable:!0,popable:!0,ref:"emojiPickerUIE",requestDismiss:this.emojiPickerClose,requestFocus:this.restoreEmojiPickerFocus},E.createElement(T,{contextMenu:this.state.emojiPicker})),i=E.createElement(S,{displayName:"EmojiPicker",escapable:!0,requestFocus:this.restoreEmojiPickerFocus},E.createElement("div",null,n)));var a=void 0;return this.state.chat&&this.state.focused&&!this.state.emojiPicker&&(a=E.createElement(k,{transitionName:"status-v3-viewer",transitionAppear:!0},E.createElement(S,{displayName:"ComposeBoxQuotedMsg",escapable:!0},E.createElement("div",{className:"compose-popup-panel"},E.createElement(w,{msg:this.props.msg,key:this.props.msg.id.toString(),chat:this.state.chat}))))),E.createElement("div",null,a,E.createElement("div",{className:t},E.createElement("button",{className:"icon icon-emoji icon-status-v3-smiley",onClick:this.onEmojiPicker}),E.createElement("div",{className:"status-v3-input-line-wrapper"},E.createElement(b,{ref:"inputLine",value:this.state.replyCaption,className:"input-text",spellCheck:!0,onFocus:this.onFocus,onBlur:this.onBlur,onChange:this.onReplyCaptionChangeHandler,onEnter:this.onSendHandler,editable:!0}),E.createElement("span",{className:"status-v3-input-placeholder"},e)),E.createElement("button",{className:"icon btn-icon icon-ptt"}),i))}}]),t}(E.Component);e.exports=(0,m["default"])(x)},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(15),s=i(a),r=n(5),o=i(r),l=n(6),c=i(l),u=n(19),d=i(u),p=n(18),h=i(p),f=n(8),m=i(f),g=n(1366),v=i(g),y=n(1655),E=i(y),_=n(1374),b=(i(_),
n(453)),C=(i(b),n(1375)),M=i(C),S=n(23),T=i(S),w=n(157),k=i(w),P=n(76),N=i(P),x=function(e){function t(){return(0,o["default"])(this,t),(0,d["default"])(this,(0,s["default"])(t).apply(this,arguments))}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"render",value:function(){var e=this,t=Store.StatusV3.getUnexpired(!0),n=Store.StatusV3.getUnexpired(!1),i=T["default"].concat(t,n).map(function(t){return m["default"].createElement(E["default"],{statusV3:t,onClick:function(){return e.props.onOpenStatus(t,t.msgs.head())},contact:t.contact,key:t.id})}),a=m["default"].createElement("button",{className:"icon icon-status-v3-create-l"}),s=m["default"].createElement("div",{className:"status-v3-list-panel-header"},m["default"].createElement(M["default"],{id:"",image:a,primary:k["default"].t("status_v3_my_status"),secondary:N["default"].relativeDateAndTimeStr((new Date).getTime()),contextEnabled:function(){return!1}}),m["default"].createElement("button",{className:"icon icon-status-v3-create"}),m["default"].createElement("button",{className:"icon icon-menu-white"}));return m["default"].createElement("div",{className:"status-v3-list-panel","data-list-scroll-container":!0},s,m["default"].createElement("div",{className:"status-v3-list-body"},m["default"].createElement(v["default"],{data:i,height:72,animate:!0,extraItems:4})))}}]),t}(m["default"].Component);e.exports=x},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(15),s=i(a),r=n(5),o=i(r),l=n(6),c=i(l),u=n(19),d=i(u),p=n(18),h=i(p),f=n(1374),m=(i(f),n(453)),g=(i(m),n(8)),v=n(1621),y=n(1624),E=function(e){function t(e){return(0,o["default"])(this,t),(0,d["default"])(this,(0,s["default"])(t).call(this,e))}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"componentWillMount",value:function(){Store.StatusV3.sync().then(function(e){})}},{key:"render",value:function(){var e=this.props.onOpenStatus;return g.createElement("div",{className:"status-v3-modal-background"},g.createElement("div",{className:"status-v3-main-wrapper"},g.createElement(v,{onOpenStatus:e}),g.createElement(y,null)))}}]),t}(g.Component);e.exports=E},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(15),s=i(a),r=n(5),o=i(r),l=n(6),c=i(l),u=n(19),d=i(u),p=n(18),h=i(p),f=n(8),m=i(f),g=n(1362),v=i(g),y=n(1377),E=i(y),_=n(1403),b=i(_),C=n(1660),M=i(C),S=n(1659),T=n(453),w=(i(T),n(1374)),k=(i(w),n(1354)),P=(i(k),n(44)),N=n(1620),x=n(1355),D=n(1361),O=n(231),R=n(76),I=n(1),A=function(e){function t(){(0,o["default"])(this,t);var e=(0,d["default"])(this,(0,s["default"])(t).apply(this,arguments));e.state={chat:void 0};var n=e.props.msg.mediaData;return n.type===O.TYPE.IMAGE?e.playbackController=new S.StatusV3CountdownController(3750):n.type===O.TYPE.VIDEO&&(e.props.msg.isGif?e.playbackController=new S.StatusV3GifController:e.playbackController=new S.StatusV3VideoController),e}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"componentWillMount",value:function(){var e=this.props.msg.mediaData;e.mediaStage!==O.STAGE.RESOLVED&&this.props.msg.forceDownloadMedia()}},{key:"componentDidMount",value:function(){var e=this,t=this.refs.progressBar;this.playbackController.addListeners(t.onStart.bind(t),t.onPause.bind(t),function(){t.onEnded()["finally"](function(){e.props.onNext()})}),this.props.media.mediaStage===O.STAGE.RESOLVED&&(this.playbackController.play(),this.props.markRead(this.props.statusV3,this.props.msg))}},{key:"componentDidUpdate",value:function(){this.props.media.mediaStage===O.STAGE.RESOLVED&&(this.playbackController.play(),this.props.markRead(this.props.statusV3,this.props.msg))}},{key:"componentWillUnmount",value:function(){this.playbackController.stop()}},{key:"render",value:function(){var e,t=this.props.msg,n=this.props.statusV3,i=t.mediaData;i.preview&&(e={backgroundImage:"url("+i.preview.url()+")"});var a;switch(i.type){case O.TYPE.IMAGE:a=m["default"].createElement(F,{ref:"media",media:t.mediaData,playbackController:this.playbackController});break;case O.TYPE.VIDEO:a=m["default"].createElement(G,{ref:"media",media:t.mediaData,msg:t,playbackController:this.playbackController});break;default:I.error("Invalid status v3 image type: "+i.type)()}var s=m["default"].createElement(M["default"],{ref:"progressBar",current:this.props.msgIdx,total:this.props.totalMsgs}),r=m["default"].createElement(x,{ref:"caption",className:"media-caption",text:t.caption}),o=m["default"].createElement("div",{className:"status-v3-profile"},m["default"].createElement(D,{id:n.contact.id,size:34}),m["default"].createElement("div",{className:"status-v3-msg-info"},m["default"].createElement(x,{text:n.contact.formattedName}),m["default"].createElement("div",{className:"status-v3-timestamp"},R.relativeDateAndTimeStr(t.t))));return m["default"].createElement("div",{className:"status-v3-player-wrapper",key:t.id},o,m["default"].createElement("div",{className:"progress-bar-backdrop"}),s,m["default"].createElement("div",{className:"caption-backdrop"},r),m["default"].createElement("div",{className:"status-v3-player-background",style:e}),m["default"].createElement("div",{className:"status-v3-player-content"},a),m["default"].createElement(N,{msg:this.props.msg,playbackController:this.playbackController}))}}]),t}(m["default"].Component);A.CONCERNS={media:["mediaStage"]};var L=function(e){function t(){return(0,o["default"])(this,t),(0,d["default"])(this,(0,s["default"])(t).apply(this,arguments))}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"render",value:function(){var e=this.props.media;return e.mediaStage===O.STAGE.RESOLVED?m["default"].createElement(E["default"],{src:e.renderableUrl}):m["default"].createElement(E["default"],{src:e.preview.url()})}}]),t}(m["default"].PureComponent);L.CONCERNS={media:["mediaStage","renderableUrl","preview"]};var F=(0,v["default"])(L),U=function(e){function t(){return(0,o["default"])(this,t),(0,d["default"])(this,(0,s["default"])(t).apply(this,arguments))}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"render",value:function(){var e=this.props.media,t=e.preview?e.preview.url():void 0;return m["default"].createElement(b["default"],{msg:this.props.msg,ref:"player",poster:t})}},{key:"componentDidMount",value:function(){var e=P.findDOMNode(this.refs.player),t=this.props.playbackController;t.setVideo(e)}}]),t}(m["default"].Component);U.CONCERNS={media:["preview"]};var G=(0,v["default"])(U);e.exports=(0,v["default"])(A)},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(15),s=i(a),r=n(5),o=i(r),l=n(6),c=i(l),u=n(19),d=i(u),p=n(18),h=i(p),f=n(8),m=function(e){function t(){return(0,o["default"])(this,t),(0,d["default"])(this,(0,s["default"])(t).apply(this,arguments))}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"render",value:function(){return f.createElement("div",{className:"status-v3-update-panel"},"Update Panel")}}]),t}(f.Component);e.exports=m},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(15),s=i(a),r=n(5),o=i(r),l=n(6),c=i(l),u=n(19),d=i(u),p=n(18),h=i(p),f=n(8),m=i(f),g=n(1),v=i(g),y=n(1623),E=i(y),_=n(1374),b=(i(_),n(453)),C=(i(b),n(109)),M=n(23),S=n(231),T=function(e){function t(){(0,o["default"])(this,t);var e=(0,d["default"])(this,(0,s["default"])(t).apply(this,arguments));e.statusSnapshot=e.getStatusSnapshot(e.props.initialStatusV3);var n=e.getFirstUnread(e.props.initialStatusV3);return n?e.state=n:v["default"].error("Status viewer initialization failed: getFirstUnread for initial status v3 returned null"),e.onNext=e.onNext.bind(e),e.onPrev=e.onPrev.bind(e),e.getNext=e.getNext.bind(e),e.getPrev=e.getPrev.bind(e),e.markRead=e.markRead.bind(e),e}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"componentDidMount",value:function(){this.preloadNextStatus()}},{key:"componentDidUpdate",value:function(){this.preloadNextStatus()}},{key:"render",value:function(){var e=this,t=this.statusSnapshot[this.state.statusIdx],n=t.statusV3,i=t.msgs[this.state.msgIdx],a=void 0;this.getPrev()&&(a=m["default"].createElement("button",{className:"icon icon-chevron-left",onClick:this.onPrev}));var s=void 0;return this.getNext()&&(s=m["default"].createElement("button",{className:"icon icon-chevron-right",onClick:function(){e.onNext(),e.markRead(n,i)}})),m["default"].createElement("div",{className:"status-v3-viewer"},a,s,m["default"].createElement(C,{transitionName:"status-v3-viewer",transitionAppear:!0},m["default"].createElement("div",{className:"status-v3-player-container",key:n.id},m["default"].createElement(E["default"],{key:i.id,statusV3:n,msg:i,media:i.mediaData,msgIdx:this.state.msgIdx,totalMsgs:t.msgs.length,markRead:this.markRead,onNext:this.onNext,onPrev:this.onPrev}))))}},{key:"preloadNextStatus",value:function(){var e=this.getNext();if(e){var t=this.statusSnapshot[e.statusIdx],n=t.msgs[e.msgIdx],i=n.mediaData;i.mediaStage!==S.STAGE.RESOLVED&&n.forceDownloadMedia()}}},{key:"getStatusSnapshot",value:function(e){if(!(e.unreadCount>0)){var t=M.takeRight(e.msgs.models,e.totalCount),n=M.map(t,function(e){return e.id}),i=[{statusV3:e,msgs:t,readMsgKeys:n}];return i}var a=function(){var e=Store.StatusV3.getUnexpired(!0),t=[];return M.forEach(e,function(e){var n=M.takeRight(e.msgs.models,e.totalCount),i=M.take(n,e.totalCount-e.unreadCount),a=M.map(i,function(e){return e.id});t.push({statusV3:e,msgs:n,readMsgKeys:a})}),{v:t}}();if("object"==typeof a)return a.v}},{key:"getFirstUnread",value:function(e){var t=this,n=M.findIndex(this.statusSnapshot,{statusV3:e});if(n===-1)return v["default"].error("StatusV3 object not found in playback session")(),null;var i=function(){var e=t.statusSnapshot[n],i=e.readMsgKeys,a=M.findIndex(e.msgs,function(e){return i.indexOf(e.id)===-1});return{v:{statusIdx:n,msgIdx:a!==-1?a:0}}}();return"object"==typeof i?i.v:void 0}},{key:"markRead",value:function(e,t){e.sendReadStatus(t.id);var n=M.find(this.statusSnapshot,{statusV3:e});n&&n.readMsgKeys.push(t.id)}},{key:"getNext",value:function(){var e=this.statusSnapshot[this.state.statusIdx];if(this.state.msgIdx+1<e.msgs.length)return{statusIdx:this.state.statusIdx,msgIdx:this.state.msgIdx+1};if(this.state.statusIdx+1<this.statusSnapshot.length){var t=this.statusSnapshot[this.state.statusIdx+1],n=this.getFirstUnread(t.statusV3);return n}return null}},{key:"onNext",value:function(){var e=this.getNext();e&&this.setState(e)}},{key:"getPrev",value:function(){if(this.state.msgIdx>0)return{statusIdx:this.state.statusIdx,msgIdx:this.state.msgIdx-1};if(this.state.statusIdx>0){var e=this.statusSnapshot[this.state.statusIdx-1],t=this.getFirstUnread(e.statusV3);return t}return null}},{key:"onPrev",value:function(){var e=this.getPrev();e&&this.setState(e)}}]),t}(m["default"].Component);e.exports=T},function(e,t,n){"use strict";var i=n(8),a=n(153),s=n(10),r=n(16),o=i.createClass({displayName:"TermsOfServiceModal",mixins:[a],componentDidMount:function(){this.addObserver(Store.Conn,"change:tos",this.close)},close:function(){0===Store.Conn.tos&&s.closeModal()},logout:function(){s.closeModal(),r.logout()},render:function(){var e,t=null;switch(Store.Conn.tos){default:case 1:e=l10n.t("web_terms_of_service_1"),t=i.createElement("div",{className:"popup-controls"},i.createElement("button",{className:"btn-plain btn-default popup-controls-item",onClick:s.closeModal.bind(s)},l10n.t("ok_got_it")));break;case 2:e=l10n.t("web_terms_of_service_2"),t=i.createElement("div",{className:"popup-controls"},i.createElement("button",{className:"btn-plain popup-controls-item",onClick:this.logout},l10n.t("menuitem_logout")))}return i.createElement("div",{className:"backdrop"},i.createElement("div",{className:"popup-container"},i.createElement("div",{className:"popup"},i.createElement("div",{className:"popup-body"},i.createElement("div",{className:"popup-contents"},e)),t)))}});e.exports=o},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1354),s=i(a),r=n(453),o=i(r),l=n(8),c=n(10),u=n(1355),d=n(454),p=l.createClass({displayName:"UnstarAllPopup",propTypes:{chat:l.PropTypes.instanceOf(s["default"]),msgs:l.PropTypes.arrayOf(l.PropTypes.instanceOf(o["default"]))},onCancel:function(){c.closeModal()},onUnstar:function(){var e=this.props.chat,t=this.props.msgs;e&&e.pendingAction++,Store.Chat.unstarAllMessages(t,e)["finally"](function(){e&&e.pendingAction--}),c.closeModal()},render:function(){return l.createElement(d,{title:l10n.t("are_you_sure"),onOK:this.onUnstar,okText:l10n.t("unstar_all_button"),onCancel:this.onCancel},l.createElement("div",null,l.createElement(u,{text:l10n.t("unstar_all_confirm")})))}});e.exports=p},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(15),s=i(a),r=n(5),o=i(r),l=n(6),c=i(l),u=n(19),d=i(u),p=n(18),h=i(p),f=n(8),m=n(1383),g=n(1357),v=n(1359),y=n(1358),E=n(1460),_=n(20),b=n(459),C=window._,M=window.l10n,S=function(e){function t(){return(0,o["default"])(this,t),(0,d["default"])(this,(0,s["default"])(t).apply(this,arguments))}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"renderContacts",value:function(){var e=this,t=C.filter(this.props.vCard.TEL,function(e){return e.properties.waid});return t.map(function(t){var n=_.numberToWid(C.first(t.properties.waid));return f.createElement(E,{title:_.formattedUser(n),onClick:function(){return e.onSelect(n)},icon:f.createElement("span",{className:e.props.iconClass}),key:"vCard-"+t.index},b.getType(t))})}},{key:"onSelect",value:function(e){this.props.onSelect(e)}},{key:"render",value:function(){return f.createElement(m,{type:m.BOX},f.createElement(g,null,f.createElement(v,{onCancel:this.props.onCancel,type:v.Type.POPUP,title:M.t("choose_phone_number")}),f.createElement(y,null,f.createElement("div",{className:"chatlist column"},f.createElement("div",{className:"drawer-item-container-compact"},this.renderContacts())))))}}]),t}(f.Component);S.defaultProps={iconClass:"icon icon-chat",onCancel:C.noop,onSelect:C.noop},e.exports=S},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){var n=new Uint8Array(e),i=new Uint8Array(t),a=n.length,s=i.length;if(a!==s)return!1;for(var r=0;r<a;r++)if(n[r]!==i[r])return!1;return!0}var s=n(2),r=i(s),o=n(232),l=i(o),c=n(8),u=n(44),d=n(1356),p=n(10),h=n(1654).CombinedFingerprint,f=n(9),m=n(1357),g=n(1381),v=n(1358),y=n(12),E=n(1389),b=n(1),C=n(1397),M=n(1360),S=n(1351),T=n(481),w=n(155),k=n(156),P=n(1444),N=n(93),x=n(154),D=c.createClass({displayName:"VerificationFilePicker",propTypes:{mime:c.PropTypes.string.isRequired,onPick:c.PropTypes.func.isRequired},stopPropagation:function(e){e.stopPropagation()},render:function(){return c.createElement("input",{accept:this.props.mime,type:"file",style:{display:"none"},onChange:this.props.onPick,onClick:this.stopPropagation})}}),O=c.createClass({displayName:"VerificationQRCode",propTypes:{binary:c.PropTypes.object,contact:c.PropTypes.instanceOf(l["default"]).isRequired,visible:c.PropTypes.bool},getDefaultProps:function(){return{binary:null}},getInitialState:function(){return{hover:!1,currentQRBinary:null,currentQRDataURL:null}},componentDidMount:function(){this.props.binary&&this.generateQRCode()},componentDidUpdate:function(e,t){this.generateQRCode()},shouldComponentUpdate:function(e,t){return!(this.compareBinary(e.binary,this.props.binary)&&this.compareBinary(t.currentQRBinary,this.state.currentQRBinary)&&e.visible===this.props.visible&&t.hover===this.state.hover&&t.currentQRDataURL===this.state.currentQRDataURL)},onMouseOver:function(e){this.state.hover||this.setState({hover:!0})},onMouseEnter:function(e){this.state.hover||this.setState({hover:!0})},onMouseLeave:function(e){this.state.hover&&this.setState({hover:!1})},fingerprintsMatched:function(e,t){return a(e.publicKey,t.publicKey)&&a(e.identifier,t.identifier)},compareBinary:function(e,t){if(!e&&!t)return!0;var n=h.parse(e),i=h.parse(t);if(!n&&!i)return!0;if(!(n.version||i.version||n.localFingerprint||i.localFingerprint||n.remoteFingerprint||i.remoteFingerprint))return!0;if(n.version!==i.version)return!1;var a=this.fingerprintsMatched(n.localFingerprint,i.localFingerprint),s=this.fingerprintsMatched(n.remoteFingerprint,i.remoteFingerprint);return a&&s},generateQRCode:function(){var e=u.findDOMNode(this.refs.QRCodeContainer),t=this.props.binary;if(!e||!t)return void this.setState({currentQRBinary:null,currentQRDataURL:null});if(!this.compareBinary(this.state.currentQRBinary,t)){this.qr&&delete this.qr,this.qr=new T(e,{text:t,width:f.QR_EDGE/2,height:f.QR_EDGE/2,correctLevel:T.CorrectLevel.L}),this.setState({currentQRBinary:t});var n=e.getElementsByTagName("canvas")[0];if(!n)return void this.setState({currentQRDataURL:null});var i=n.toDataURL("image/png");this.setState({currentQRDataURL:i})}},render:function(){var e=null;if(this.props.visible){var t=null;if(this.state.hover&&this.state.currentQRDataURL){var n=this.props.contact.formattedUser,i=Store.Contact.get(Store.Conn.me).formattedUser,a="Verification Code between "+i+" and "+n+".png";t=c.createElement("a",{href:this.state.currentQRDataURL,download:a},c.createElement("div",{className:"avatar-overlay",key:"avatar-overlay"},c.createElement("div",{className:"avatar-overlay-text"},l10n.t("web_verify_download_code"))))}e=c.createElement("div",{onMouseOver:this.onMouseOver,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave},t,c.createElement("div",{className:"verification-circle",ref:"QRCodeContainer"}))}return e}}),R=c.createClass({displayName:"VerificationSpinner",propTypes:{visible:c.PropTypes.bool},render:function(){var e=null;return this.props.visible&&(e=c.createElement("div",{className:"verification-circle"},c.createElement("div",{className:"spinner"},c.createElement(w,{size:40,stroke:4})))),e}}),I=c.createClass({displayName:"VerificationCircle",propTypes:{binary:c.PropTypes.object,contact:c.PropTypes.instanceOf(l["default"]).isRequired,visible:c.PropTypes.bool},render:function(){var e=null;return this.props.visible&&(e=c.createElement("div",{className:"verification-circle-container"},c.createElement(O,{visible:!!this.props.binary,binary:this.props.binary,contact:this.props.contact}),c.createElement(R,{visible:!this.props.binary}))),e}}),A=c.createClass({displayName:"VerificationString",NUM_ROWS:3,NUM_BLOCKS_PER_ROW:4,NUM_DIGITS_PER_BLOCK:5,propTypes:{string:c.PropTypes.string},getDefaultProps:function(){return{string:null}},shouldComponentUpdate:function(e,t){return e.string!==this.props.string},numDigitsInVerificationString:function(){return this.NUM_ROWS*this.NUM_BLOCKS_PER_ROW*this.NUM_DIGITS_PER_BLOCK},render:function(){if(!this.props.string)return c.createElement("div",null,l10n.t("loading"));var e=this.props.string;if(e.length!==this.numDigitsInVerificationString())return b.error("verificationString:render this.props.stringshould be "+this.numDigitsInVerificationString()+" characters long instead of "+e.length+".")(),c.createElement("div",null,l10n.t("web_verify_string_error"));for(var t=[],n=0;n<this.NUM_ROWS;n++){for(var i=[],a=0;a<this.NUM_BLOCKS_PER_ROW;a++){for(var s=[],r=0;r<this.NUM_DIGITS_PER_BLOCK;r++){var o=e.charAt(n*this.NUM_DIGITS_PER_BLOCK*this.NUM_BLOCKS_PER_ROW+a*this.NUM_DIGITS_PER_BLOCK+r);s.push(c.createElement("span",{className:"digit",key:r},o))}i.push(c.createElement("span",{className:"block",key:a},s," "))}t.push(c.createElement("div",{className:"code-row",key:n},i))}return c.createElement("div",{className:"textfield-static selectable-text"},t)}}),L=c.createClass({displayName:"VerificationCheckmark",propTypes:{visible:c.PropTypes.bool},render:function(){var e=null;return this.props.visible&&(e=c.createElement("div",{className:"verification-checkmark-container"},c.createElement("div",{className:"verification-checkmark"},"✓ "))),e}}),F=c.createClass({displayName:"VerificationError",propTypes:{visible:c.PropTypes.bool},render:function(){var e=null;return this.props.visible&&(e=c.createElement("div",{className:"verification-error-container"},c.createElement("div",{className:"verification-error"},"!"))),e}}),U=c.createClass({displayName:"VerificationBanner",propTypes:{children:c.PropTypes.node.isRequired},render:function(){return c.createElement("div",{className:"error-banner"},this.props.children)}}),G=c.createClass({displayName:"VerificationWebcam",CAPTURE_INTERVAL:200,propTypes:{stream:c.PropTypes.object.isRequired,onCapture:c.PropTypes.func.isRequired,onClose:c.PropTypes.func.isRequired},mixins:[k,x],getInitialState:function(){return{videoURL:window.URL.createObjectURL(this.props.stream)}},componentDidMount:function(){this.regNativeListener(window,"resize",this.adjustOverlayPosition)},componentWillUnmount:function(){if(this.clearSafeInterval(this.captureInterval),this.state.videoURL){var e=this.props.stream;C.stop(e),window.URL.revokeObjectURL(this.state.videoURL)}},onVideoLoaded:function(e){this.captureInterval||(this.adjustOverlayPosition(),this.captureInterval=this.safeInterval(this.capture,this.CAPTURE_INTERVAL))},capture:function(){var e=this;if(this.refs.verificationVideo){var t=document.createElement("canvas"),n=u.findDOMNode(this.refs.verificationVideo);t.width=n.videoWidth/2,t.height=n.videoHeight/2;var i=t.getContext("2d");i.drawImage(n,t.width/2,t.height/2,t.width,t.height,0,0,t.width,t.height),t.toBlob(function(t){var n=window.URL.createObjectURL(t);b.log(n),e.props.onCapture(n)},"image/jpeg",1)}},adjustOverlayPosition:function(){var e=u.findDOMNode(this.refs.verificationVideo),t=u.findDOMNode(this.refs.verificationOverlay);if(e&&t){var n=e.offsetHeight,i=e.offsetWidth,a=i/3,s=a,r=(i-a)/2,o=(n-s)/2;t.style.width=a+"px",t.style.height=s+"px",t.style.margin=o+"px "+r+"px"}},render:function(){var e=null;return this.state.videoURL&&(e=c.createElement("div",{className:"webcam"},c.createElement(P,{autoPlay:!0,ref:"verificationVideo",onPlay:this.onVideoLoaded,src:this.state.videoURL}),c.createElement("div",{className:"overlay",ref:"verificationOverlay"}),c.createElement("button",{onClick:this.props.onClose},c.createElement("span",{className:"icon icon-x-alt"})))),e}}),j=c.createClass({displayName:"VerificationDrawer",ICON_DELAY:3e3,BANNER_DELAY:5e3,HINT_DELAY:7e3,ERROR_TYPE:{CORRECT:0,PUBLIC_KEY_MISMATCHED:1,REMOTE_MISMATCHED:2,LOCAL_MISMATCHED:3,BOTH_MISMATCHED:4,INVALID_QR_CODE:5},mixins:[d,M,k],propTypes:{contact:c.PropTypes.instanceOf(l["default"]).isRequired,isFirstLevel:c.PropTypes.bool},getInitialState:function(){return this.asyncState({binary:"contact.verificationBinary",string:"contact.verificationString"},{circleVisible:!0,checkmarkVisible:!1,errorIconVisible:!1,webcamVisible:!1,bannerVisible:!1,bannerText:null,stream:null,isDragging:!1})},componentDidUpdate:function(e,t){(t.binary&&!this.state.binary||t.string&&!this.state.string)&&this.props.contact.queryIdentity()["catch"](function(e){b.error("VerificationDrawer:queryIdentity error: "+e)()})},componentWillMount:function(){this.props.contact.queryIdentity()["catch"](function(e){b.error("verificationDrawer:queryIdentity error: "+e)()})},onDragStart:function(){this.blockDrop=!0},onDragEnd:function(){this.blockDrop=!1},onDragOver:function(){this.state.isDragging||this.blockDrop||this.setState({isDragging:!0})},onDrop:function(e){this.blockDrop||(this.setState({isDragging:!1}),this.state.binary&&this.state.string&&this.onUploadSelect(e))},onDragLeave:function(e){this.setState({isDragging:!1})},showWebcamStream:function(e){this.setState({webcamVisible:!0,circleVisible:!0,checkmarkVisible:!1,errorIconVisible:!1,stream:e}),this.hintTimer&&(this.clearSafeTimeout(this.hintTimer),delete this.hintTimer),this.hintTimer=this.safeDelay(this.showWebcamHint,this.HINT_DELAY)},showWebcamHint:function(){this.state.webcamVisible&&!this.state.bannerVisible&&this.showBanner(l10n.t("web_verify_webcam_hint"))},onWebcamOpen:function(e){var t=this,n=C.start("camera");r["default"].race([n,this.rejectOnUnmount()]).checkpoint(this.rejectOnUnmount()).then(function(e){return t.showWebcamStream(e)})["catch"](y.Unmount,function(){n.then(function(e){return C.stop(e)})["catch"](_.noop)})["catch"](y.GUM.PermissionDeniedError,function(){p.openModal(c.createElement(E,{title:"guide_desktop_camera_title",desc:"guide_desktop_camera_fail_description",type:E.TYPE.GUIDE_UNBLOCK}))})["catch"](y.GUM.GUMError,function(){p.openModal(c.createElement(E,{title:"guide_desktop_camera_missing_title",desc:"guide_desktop_camera_missing_description",type:E.TYPE.GUIDE_NONE}))})},onWebcamClose:function(e){this.setState({webcamVisible:!1,bannerVisible:!1,stream:null})},onWebcamCapture:function(e){this.verifyImage(e,!0)},onUploadClick:function(){u.findDOMNode(this.refs.verificationFilePicker).click()},onUploadSelect:function(e){e.stopPropagation();var t=e.target.files||e.dataTransfer.files;if(t&&t[0]){var n=t[0],i=URL.createObjectURL(n);this.verifyImage(i,!1);var a=u.findDOMNode(this.refs.verificationFilePickerForm);a&&a.reset()}},componentWillUnmount:function(){clearTimeout(this.iconTimer),clearTimeout(this.bannerTimer),clearTimeout(this.hintTimer)},onClose:function(e){this.props.onClose?this.props.onClose():this.context.uim.uie.requestDismiss()},getErrorBannerText:function(e){var t=void 0,n=this.props.contact.formattedShortName;switch(e){case this.ERROR_TYPE.REMOTE_MISMATCHED:t=l10n.t("web_verify_error_remote_mismatched",{contact:n});break;case this.ERROR_TYPE.LOCAL_MISMATCHED:case this.ERROR_TYPE.BOTH_MISMATCHED:t=l10n.t("web_verify_error_local_mismatched",{contact:n});break;case this.ERROR_TYPE.INVALID_QR_CODE:default:t=l10n.t("web_verify_error_invalid_upload")}return t},showCheckmark:function(){this.onWebcamClose(),this.setState({circleVisible:!1,checkmarkVisible:!0,errorIconVisible:!1,bannerVisible:!1}),this.iconTimer&&(this.clearSafeTimeout(this.iconTimer),delete this.iconTimer),this.iconTimer=this.safeDelay(this.hideCheckmark,this.ICON_DELAY)},showErrorIcon:function(){this.onWebcamClose(),this.setState({circleVisible:!1,checkmarkVisible:!1,errorIconVisible:!0,bannerVisible:!1}),this.iconTimer&&(this.clearSafeTimeout(this.iconTimer),delete this.iconTimer),this.iconTimer=this.safeDelay(this.hideError,this.ICON_DELAY)},showErrorBanner:function(e){var t=this.getErrorBannerText(e);this.showBanner(t)},showBanner:function(e){this.setState({circleVisible:!0,checkmarkVisible:!1,errorIconVisible:!1,bannerVisible:!0,bannerText:e}),this.bannerTimer&&(this.clearSafeTimeout(this.bannerTimer),delete this.bannerTimer),this.bannerTimer=this.safeDelay(this.hideBanner,this.BANNER_DELAY)},hideCheckmark:function(){this.state.errorIconVisible||this.setState({circleVisible:!0}),this.setState({checkmarkVisible:!1})},hideError:function(){this.state.checkmarkVisible||this.setState({circleVisible:!0}),this.setState({errorIconVisible:!1})},hideBanner:function(){this.setState({bannerVisible:!1})},validateFingerprint:function(e){if(!e||0===!e.version||!e.localFingerprint||!e.remoteFingerprint)return this.ERROR_TYPE.INVALID_QR_CODE;var t=h.parse(this.state.binary),n=a(e.remoteFingerprint.identifier,t.localFingerprint.identifier),i=a(e.localFingerprint.identifier,t.remoteFingerprint.identifier);if(!n&&!i)return this.ERROR_TYPE.BOTH_MISMATCHED;if(!n)return this.ERROR_TYPE.REMOTE_MISMATCHED;if(!i)return this.ERROR_TYPE.LOCAL_MISMATCHED;var s=a(e.remoteFingerprint.publicKey,t.localFingerprint.publicKey),r=a(e.localFingerprint.publicKey,t.remoteFingerprint.publicKey);return s&&r?this.ERROR_TYPE.CORRECT:this.ERROR_TYPE.PUBLIC_KEY_MISMATCHED},decodeQRCode:function(e){return new r["default"](function(t,n){S.callback=function(e,i){if(i)n(i);else if(e.length<1)n("QR decoder did not return decoded binary");else{var a=new Uint8Array(e[0]);t(a)}},S.decode(e)})},verifyImage:function(e,t){var n=this;this.decodeQRCode(e).then(h.parse).then(function(e){var i=n.validateFingerprint(e);i?t&&i===n.ERROR_TYPE.INVALID_QR_CODE||(n.setState({errorType:i}),i===n.ERROR_TYPE.PUBLIC_KEY_MISMATCHED?n.showErrorIcon():n.showErrorBanner(i)):n.showCheckmark()})["catch"](function(e){t||(n.setState({errorType:n.ERROR_TYPE.INVALID_QR_CODE}),n.showErrorBanner(n.ERROR_TYPE.INVALID_QR_CODE))})["finally"](function(){window.URL.revokeObjectURL(e)})},render:function(){var e=null,t=null,n=null;this.state.binary&&(navigator.getUserMedia&&(e=c.createElement(g,{classes:"animate-enter2"},c.createElement("button",{className:"btn btn-info",onClick:this.state.webcamVisible?this.onWebcamClose:this.onWebcamOpen},this.state.webcamVisible?l10n.t("web_verify_webcam_close_button"):l10n.t("web_verify_webcam_open_button")))),t=c.createElement(g,{classes:"animate-enter2"},c.createElement("button",{className:"btn btn-info",onClick:this.onUploadClick},l10n.t("web_verify_upload_button")),c.createElement("p",{className:"drag-and-drop-explanation"},this.state.isDragging?l10n.t("web_verify_drag_and_drop_dragging"):null)),n=c.createElement("form",{ref:"verificationFilePickerForm"},c.createElement(D,{mime:"image/*",onPick:this.onUploadSelect,ref:"verificationFilePicker"})));var i=null;this.state.webcamVisible&&(i=c.createElement(G,{stream:this.state.stream,onCapture:this.onWebcamCapture,onClose:this.onWebcamClose}));var a=null;this.state.bannerVisible&&(a=c.createElement(U,null,this.state.bannerText));var s="icon icon-";return s+=this.props.isFirstLevel?"x":"back",c.createElement(m,{id:"verification",onDrop:this.onDrop,onDragOver:this.onDragOver,onDragLeave:this.onDragLeave,onCancel:this.onClose},c.createElement("header",{className:"pane-header"},c.createElement("div",{className:"header-close"},c.createElement("button",{onClick:this.onClose},c.createElement("span",{className:s}))),c.createElement("div",{className:"header-body"},c.createElement("div",{className:"header-main"},c.createElement("div",{className:"header-title"},l10n.t("web_verify_title"))),c.createElement("div",{className:"header-secondary"},l10n.t("web_you"),", ",this.props.contact.formattedUser))),i,a,c.createElement(v,{classes:this.state.webcamVisible?"webcam-visible":null,info:!0,onDragStart:this.onDragStart,onDragEnd:this.onDragEnd},c.createElement(g,{classes:"drawer-scale drawer-section-photo"},c.createElement(I,{binary:this.state.binary,contact:this.props.contact,visible:this.state.circleVisible}),c.createElement(L,{visible:this.state.checkmarkVisible}),c.createElement(F,{visible:this.state.errorIconVisible})),c.createElement(g,{classes:"animate-enter2"},c.createElement("div",{className:"verification-string"},c.createElement(A,{string:this.state.string}))),c.createElement(g,{classes:"animate-enter2"},c.createElement("p",{className:"verification-explanation"},c.createElement("span",null,l10n.t("web_verify_explanation")," "),c.createElement("a",{target:"_blank",href:f.E2E_FAQ_LINK},l10n.t("learn_more")))),e,t,n))}});j.contextTypes={uim:c.PropTypes.instanceOf(N)},e.exports=j},function(e,t,n){"use strict";var i=n(8),a=n(1357),s=n(1359),r=n(1358),o=n(1356),l=n(10),c=n(456),u=n(9),d=i.createClass({displayName:"ColorCanvas",propTypes:{colorHex:i.PropTypes.string.isRequired,isSelected:i.PropTypes.bool.isRequired,isDefault:i.PropTypes.bool.isRequired},getInitialState:function(){return{hover:!1}},onClick:function(e){var t=this.encodeColor(this.props.colorHex);t!==Store.ChatPreference.get("defaultPreference").wallpaperColor&&(Store.ChatPreference.get("defaultPreference").set("wallpaperColor",t),l.openToast(i.createElement(c,{msg:l10n.t("wallpaper_color_set"),id:c.genId()})))},onMouseOver:function(e){this.state.hover||(this.setState({hover:!0}),Store.ChatPreference.trigger("wallpaper_color_preview",this.encodeColor(this.props.colorHex)))},onMouseEnter:function(e){this.state.hover||(this.setState({hover:!0}),Store.ChatPreference.trigger("wallpaper_color_preview",this.encodeColor(this.props.colorHex)))},onMouseLeave:function(e){this.state.hover&&(this.setState({hover:!1}),Store.ChatPreference.trigger("wallpaper_color_preview"))},encodeColor:function(e){return"#ede9e4"===e?u.DEFAULT_CHAT_WALLPAPER:e},render:function(){var e="wallpaper-color-canvas";this.state.hover&&(e+=" canvas-hover"),this.props.isSelected&&(e+=" canvas-active");var t=this.props.isDefault?i.createElement("span",{className:"wallpaper-default-title"
},l10n.t("default_wallpaper")):null;return i.createElement("span",{className:e,style:{backgroundColor:this.props.colorHex},onMouseOver:this.onMouseOver,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,onClick:this.onClick},t)}}),p=i.createClass({displayName:"ColorGrid",mixins:[o],propTypes:{id:i.PropTypes.string.isRequired,colors:i.PropTypes.array.isRequired},getInitialState:function(){return{wallpaperColor:this.async("id.ChatPreference.wallpaperColor")}},render:function(){for(var e=!0,t=this.state.wallpaperColor,n=this.props.colors.map(function(n){var a=!1,s=!1;return(t===n||t===u.DEFAULT_CHAT_WALLPAPER&&e)&&(a=!0),e&&(s=!0,e=!1),i.createElement(d,{colorHex:n,isSelected:a,isDefault:s,key:n})}),a=0;a<2;a++)n.push(i.createElement("div",{key:"emptyEl"+a,className:"wallpaper-color-empty"}));return i.createElement("div",{className:"wallpaper-color-grid"},n)}}),h=i.createClass({displayName:"WallpaperDrawer",propTypes:{onClose:i.PropTypes.func},render:function(){var e=i.createElement(p,{colors:u.WALLPAPER_COLOR,id:"defaultPreference"});return i.createElement(a,{id:"wallpaper",onCancel:this.props.onClose},i.createElement(s,{title:l10n.t("wallpaper_flow_title"),onBack:this.props.onClose,type:s.Type.LARGE}),i.createElement(r,null,e))}});e.exports=h},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(455),o=n(1467),l=n(59),c=n(9),u=n(12),d=o.STATE,p=d.READY,h=d.ERROR,f=l.FILETYPE,m=f.IMAGE,g=f.VIDEO,v=f.DOCUMENT,y=f.AUDIO,E=1,_=r.extend({model:o,initialize:function(){this.errorMsgs=null,this.ignored=0,r.prototype.initialize.call(this)},removeSingleton:function(e,t){e.url&&window.URL.revokeObjectURL(e.url),e.original&&e.original.url&&window.URL.revokeObjectURL(e.original.url)},remove:function(e,t){var n=this;Array.isArray(e)?e.forEach(function(e){return n.removeSingleton(e,t)}):this.removeSingleton(e,t),r.prototype.remove.call(this,e,t)},"delete":function(){var e=this;this.models.forEach(function(t){return e.removeSingleton(t)}),r.prototype["delete"].call(this)},contains:function(e){return this.indexOf(e)>-1},getValidMedias:function(){return this.filter({state:p})},getAfter:function(e){var t=this.getValidMedias(),n=t.indexOf(e);return n<0||n===t.length-1?null:t[n+1]},getBefore:function(e){var t=this.getValidMedias(),n=t.indexOf(e);return n<=0?null:t[n-1]},processFiles:function(e,t){var n=this,i=this.getValidMedias().length,a=e.length+i>c.MAX_FILES?Math.max(c.MAX_FILES-i,0):e.length,r=e.length-a;0===a?r&&this.trigger("max_upload_limit",r):this.ignore(r);var l=e.slice(0,a).map(function(e){var i=E++,a=new o({id:i,file:e,chat:t,uiProcessed:!1});return n.add(a)});return s["default"].map(l,function(e){return e.processPromise})},ignore:function(e){e>0&&(this.ignored+=e)},uiProcessMsgs:function(){var e=[],t=void 0,n=void 0,i=0,a=0,s=0,r=0,o=0,l=!1,d=c.MAX_MEDIA_UPLOAD_SIZE/1024/1024;if(this.forEach(function(e){if(!e.uiProcessed&&(e.uiProcessed=!0,t||e.state!==p||(t=e),e.state===h))if(e.exception instanceof u.MediaFileTooLarge)switch(e.getFileType()){case m:i+=1;break;case g:a+=1;break;case y:s+=1;break;case v:r+=1}else e.exception instanceof u.MediaFileFailedLoad?l=!0:o+=1}),i>0&&e.push(l10n.t("image_too_big",{number:i,_plural:i,maxSize:d+"MB"})),a>0&&e.push(l10n.t("video_too_big",{number:a,_plural:a,maxSize:d+"MB"})),s>0&&e.push(l10n.t("audio_too_big",{number:s,_plural:s,maxSize:d+"MB"})),r>0&&e.push(l10n.t("document_too_big",{number:r,_plural:r,maxSize:d+"MB"})),o>0&&e.push(l10n.t("files_not_supported",{number:o,_plural:o})),l&&(e=[],e.push(l10n.t("media_failed_load"))),e.length>1){e=[];var f=i+a+s+r+o;0===o?e.push(l10n.t("files_too_big",{number:f,_plural:f,maxSize:d+"MB"})):e.push(l10n.t("files_not_added",{number:f,_plural:f}))}return this.errorMsgs=e.join(" "),this.ignore(this.getValidMedias().length-c.MAX_FILES),n=this.ignored,this.ignored=0,n&&this.trigger("max_upload_limit",n),{activeMedia:t,errorMsgs:this.errorMsgs}}});e.exports=_},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1468),s=i(a),r=n(455),o=r.extend({model:s["default"],handle:function(e){var t=e.shift(),n=t.blocklist,i=_.map(n,function(e){return{id:e}});this.set(i)}});e.exports=new o},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1469),s=i(a),r=n(467),o=i(r),l=n(455),c=l.extend({model:s["default"],handle:function(e){var t=e.shift();switch(t.type){case"offer":case"offer_video":case"accept":case"reject":case"terminate":o["default"].tosShowCallNotification&&this.add(t,{merge:!0})}}});e.exports=new c},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(24),s=i(a),r=n(2),o=i(r),l=n(1354),c=i(l),u=n(8),d=n(9),p=n(1),h=n(455),f=n(45),m=n(38),g=n(30),v=n(10),y=n(12),E=n(111).ActionToast,b=n(111).ActionType,C=n(20),M=n(16),S=h.extend({model:c["default"],comparator:function(e,t){return e.t?t.t?""+e.t+e.id>""+t.t+t.id?-1:1:-1:1},initialize:function(){var e=this;h.prototype.initialize.call(this),this.notSpam={},this.promises={sendUnstarAll:null},this.listenTo(this,"change:t change:isVisible",this.sort),this.listenTo(M,"change:stream",function(){M.stream===M.STREAM.RESUMING&&e.forEach(function(e){e.pendingMsgs=!1})})},active:function T(){var T=_.head(this.filter("active"));return T?T.id:void 0},_find:function(e){return o["default"].resolve({id:e,createdLocally:!0})},_findQuery:function(e){var t=this;return f.chatFindQuery(!!e.retry).then(function(e){return"preempted"===e?o["default"].reject("chats preempted"):(Store.Conn.platform===Store.Conn.PLATFORMS.IPHONE&&(_.isEmpty(e)?Store.Msg.trigger(d.COLLECTION_HAS_SYNCED):setTimeout(function(){Store.Msg.trigger(d.COLLECTION_HAS_SYNCED)},2500)),t.trigger(d.COLLECTION_HAS_SYNCED),o["default"].resolve(e))})},handle:function(e){var t=e.shift(),n=this;if(_.isArray(t)){var i=[],a=[];t.forEach(function(e){if("c.us"===e.id)a.push(e);else{var t=!!n.get(e.id),r=["delete","clear","archive","unarchive","star","unstar","spam","modify_tag"].indexOf(e.type)>-1;r?t&&r?a.push(e):p.log("Model:chat:handle received junk chat record: "+(0,s["default"])(e))():i.push(e)}});var r=_.findIndex(i,function(e){return C.isPSA(e.id)});r>-1&&(i[r].name=l10n.t("whatsapp_psa_contact_name")),n.add(i,{merge:!0}),a.forEach(function(e){var t=e.type;if("c.us"===e.id)switch(t){case"clear":p.log("Model:chat:handle:clear:all before:"+e.before+" kind:"+e.kind)(),n.forEach(function(t){"number"==typeof e.before?t.deleteMsgsOlderThan(e.before,e.star,e.kind):t.deleteMsgs(e.star,e.kind)});break;case"delete":p.log("Model:chat:handle:delete:all")(),n.forEach(function(e){e["delete"]()});break;case"archive":p.log("Model:chat:handle:archive:all")(),n.forEach(function(e){e.archive=!0});break;case"unarchive":p.log("Model:chat:handle:unarchive:all")(),n.forEach(function(e){e.archive=!1});break;case"unstar":p.log("Model:chat:handle:unstar:all")(),Store.AllStarredMsgs["delete"](),n.forEach(function(e){e.unstarAll()});break;default:p.error("Model:chat:handle unknown "+(0,s["default"])(e),e)()}else{var i=n.get(e.id);if(!i)return;switch(t){case"clear":case"star":case"unstar":if(e.keys){for(var a=e.keys.length,r="star"===t,o=[],l=[],c=[],u=!1,d=0;d<a;d++){var h,f,m,v,y,E=e.keys[d];_.isArray(E)?(h=E[0],f=E[1],m=E[2],v=new g({fromMe:f,remote:e.id,id:h,participant:m}),y=Store.Msg.get(v),y?"clear"===t?y["delete"]():(y.star=r,r&&c.push(y)):r&&(u=!0)):_.isObject(E)&&"star"===t&&(v=E.id,y=Store.Msg.get(E.id),y?(y.star=!0,c.push(y)):l.push(E)),o.push(v.toString())}"star"!==t&&"unstar"!==t||Store.AllStarredMsgs.process(r,l,c,u),p.log("model:Chat:handle:messages:"+[t,e.id,o.join(),e.modifyTag].join())()}else"clear"===t?("number"==typeof e.before?i.deleteMsgsOlderThan(e.before,e.star,e.kind):i.deleteMsgs(e.star,e.kind),p.log("model:Chat:handle cleared chat:"+[e.id,e.before,e.modifyTag,e.kind].join())()):"unstar"===t&&(i.unstarAll(),p.log("model:Chat:handle unstarred chat: "+e.id)());isNaN(e.modifyTag)||(i.modifyTag=e.modifyTag);break;case"delete":i["delete"](),p.log("model:Chat:handle deleted chat for "+e.id)();break;case"archive":i.archive=!0;break;case"unarchive":i.archive=!1;break;case"spam":i.notSpam=e.notSpam;break;case"modify_tag":i.modifyTag=e.modifyTag}}})}else if("leave"===t.cmd)t.gids.forEach(function(e){var t=n.get(e);t&&t.exit()});else if("preempt"===t.cmd)Store.Chat.add(t.response,{merge:!0}),Store.Conn.platform===Store.Conn.PLATFORMS.IPHONE&&(_.isEmpty(t.response)?Store.Msg.trigger(d.COLLECTION_HAS_SYNCED):setTimeout(function(){Store.Msg.trigger(d.COLLECTION_HAS_SYNCED)},2500)),this.trigger(d.COLLECTION_HAS_SYNCED);else if("action"===t.cmd){var o=t.id,l=t.data;if("create"===l[0]||"introduce"===l[0]){var c=l[1],u=l[2],h=_.map(u.admins,function(e){return{id:e,isAdmin:!0}}).concat(_.map(u.regulars,function(e){return{id:e,isAdmin:!1}}));Store.GroupMetadata.add({id:o,creation:u.creation,owner:c,participants:h,stale:!1},{merge:!0}),Store.Contact.add({id:o,name:u.subject},{merge:!0});var f=Store.Chat.get(o);if(!f)return;var m=f.msgs.last();if(!m)return;"gp2"===m.type&&"add"===m.subtype&&_.head(m.recipients)===Store.Conn.me&&v.alertNewMsg(m)}else{var y=Store.Chat.get(t.id);y?y.handleGroupAction.apply(y,t.data):p.error("model:chat: unknown chat for action "+(0,s["default"])(t))()}}else p.error("model:chat: unknown payload: "+(0,s["default"])(t))()},createGroup:function(e,t,n,i,a){var s=this,r=_.map(i,"id"),o=f.createGroup(e,r),l=new b(l10n.t("action_group_creating"));a=a||E.genId();var c=o.then(function(e){return 200===e.status?new b(l10n.t("action_group_created")):406===e.status?new b(l10n.t("action_group_create_failed")+" "+l10n.t("action_group_create_failed_406")):void 0})["catch"](function(r){return p.error("models:chatCollection:createGroup dropped")(r),new b(l10n.t("action_group_create_failed"),l10n.t("action_try_again"),s.createGroup.bind(s,e,t,n,i,a))});return v.openToast(u.createElement(E,{id:a,initialAction:l,pendingAction:c})),o.then(function(e){if(200===e.status&&e.gid&&Store.Chat.find(e.gid).then(function(e){v.openChatBottom(e).then(function(t){t&&v.focusChatTextInput(e)})}),200===e.status&&!e._duplicate&&t&&n){var i=Store.ProfilePicThumb.gadd(e.gid);return i.setPicture(t,n)}200===e.status&&e._duplicate&&p.error("createGroup failed to set picture.")()})},sync:function(){return this.findQuery({})["catch"](y.WapDrop,_.noop),o["default"].all([m.waitForBBEvent(this,d.COLLECTION_HAS_SYNCED),Store.Msg._hasSynced()])},resyncMessages:function(){p.log("ChatStore:resyncMessages")();var e=Store.Chat.filter(function(e){return e.isVisible}),t=e.map(function(e){var t=e.id,n={wid:t,archive:e.archive,mute:e.mute.expiration,active:e.active,isReadOnly:e.isReadOnly,modifyTag:e.modifyTag,unreadCount:e.unreadCount,notSpam:e.notSpam},i=e.lastReceivedKey;if(i){var a=i;n.id=a.id,n.fromMe=a.fromMe.toString(),n.participant=a.participant}return n});return f.resyncMessages(t).then(function(e){return e.status>=400?(p.error("ChatStore:resyncMessages resume error "+e.status)(),o["default"].reject(new Error("ChatStore:resyncMessages resume error "+e.status))):(p.log("ChatStore:resyncMessages resume success")(),e.checksum&&Store.Contact.resyncContacts(e.checksum),e.statusChecksum&&Store.StatusV3.sync(e.statusChecksum),e.data.forEach(function(e){if(e.disableUnreadAnchor=!1,"delete"!==e.type&&!C.isPSA(e.id)){var t=Store.Contact.get(e.id);t?e.name&&(t.name=e.name):Store.Contact.add({id:e.id,name:e.name})}var n=Store.Chat.get(e.id);return n?void("clear"===e.type?!function(){n.resetMediaMsgs();var t=[];n.msgs.forEach(function(e){return t.push(e)}),n.msgChunks.length&&n.msgChunks.forEach(function(e){e.models.forEach(function(e){return t.push(e)})}),n.set({t:e.t,unreadCount:e.unreadCount,createdLocally:!1,archive:e.archive,isReadOnly:e.isReadOnly,modifyTag:e.modifyTag,msgs:[],notSpam:e.notSpam,unreadMsgAnchor:void 0,disableUnreadAnchor:e.disableUnreadAnchor,pendingMsgs:e.pendingMsgs}),n.mute.setMute(e.muteExpiration),_.each(t,function(e){e["delete"]()}),p.log("model:chat:resume: cleared chat for "+e.id)()}():"delete"===e.type?(n["delete"](),p.log("model:chat:resume: deleted chat for "+e.id)()):(n.set(e,{merge:!0}),n.mute.setMute(e.muteExpiration))):void Store.Chat.add(e)}),o["default"].resolve())})["catch"](y.WapDrop,function(e){return p.error("ChatStore:resyncMessages resume dropped")(),o["default"].reject(e)})},unstarAllMessages:function(e,t){var n=this,i=t?t.promises:this.promises,a=t?t.id:void 0;if(i.sendUnstarAll)return i.sendUnstarAll;i.sendUnstarAll=f.sendUnstarAll(a);var s=new b(l10n.t("action_message_unstarring_all")),r=i.sendUnstarAll.then(function(e){return 200===e.status?new b(l10n.t("action_message_unstarred_all")):e.status>=400?new b(l10n.t("action_message_unstar_all_failed")):void 0})["catch"](function(i){return p.error("models:chat:sendUnstarAll dropped")(i),new b(l10n.t("action_message_unstar_all_failed"),l10n.t("action_try_again"),function(){return n.unstarAllMessages(e,t)})});return v.openToast(u.createElement(E,{id:E.genId(),initialAction:s,pendingAction:r})),i.sendUnstarAll.then(function(n){200===n.status&&(_.forEach(e,function(e){e.set("star",!1)}),t?Store.AllStarredMsgs.remove(e):(Store.AllStarredMsgs.reset(),Store.StarredGifMsgs.reset()))})["finally"](function(){i.sendUnstarAll=null})}});e.exports=new S},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1474),s=i(a),r=n(455),o=n(9),l=r.extend({model:s["default"],initialize:function(){r.prototype.initialize.call(this,{CachePolicy:{id:"chat_preference",policy:r.CACHE_POLICY.LOAD,delay:1e3}})},initializeFromCache:function(){this.get("defaultPreference")||this.add({id:"defaultPreference",wallpaperColor:o.DEFAULT_CHAT_WALLPAPER})},get:function(e,t){return r.prototype.get.call(this,e,t)||r.prototype.get.call(this,"defaultPreference")}});e.exports=new l},function(e,t,n){"use strict";var i=n(9),a=n(1),s=n(33),r=n(12),o={handle:function(e){var t=e.shift();switch(t.type){case"const":i[t.key]=t.value;break;case"read":if(t.isStatus){Store.StatusV3.handle([t]);break}case"unread":var n=Store.Chat.get(t.jid);n&&("read"===t.type?n.markSeen():"unread"===t.type&&n.markUnseen());break;case"picture":Store.ProfilePicThumb.imageChanged(t.jid,t.tag);break;case"log":s.upload("server-requested");break;case"privacy":t.jid?(Store.Presence.update(t.jid)["catch"](r.WapDrop,_.noop),Store.ProfilePicThumb.update(t.jid)["catch"](r.WapDrop,_.noop),Store.Status.update(t.jid)["catch"](r.WapDrop,_.noop)):a.error("Store:Cmd:handle:privacy no jid",t)();break;case"identity":if(t.jid){var o=Store.Contact.get(t.jid);o?o.updateIdentity(t):a.error("Store:Cmd:handle:identity no contact",t)()}else a.error("Store:Cmd:handle:identity no jid",t)();break;default:a.warn("Store.Cmd:handle:unknown "+t.type,t)()}}};e.exports=o},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1475),s=i(a),r=n(455),o=n(159),l=r.extend({model:s["default"],initialize:function(){r.prototype.initialize.call(this,{CachePolicy:{id:"emoji_variant_collection",policy:r.CACHE_POLICY.LOAD,delay:1e3}})},setVariant:function(e,t){var n=o.skinToneEmojis[e];if(!n)throw new Error("attempt to store variantless emoji");this.gadd({id:n,"char":n,variant:t})},getVariant:function(e){if(o.skinToneEmojis[e]){var t=this.get(e);return t?t.variant:null}throw new Error("attempt to get variantless emoji")}});e.exports=new l},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(1407),o=i(r),l=n(1),c=n(455),u=n(45),d=n(12),p=n(20),h=c.extend({model:o["default"],initialize:function(){c.prototype.initialize.call(this,{staleCollection:!0})},onResume:function(){_.union(Store.Chat.where({active:!0}).filter(function(e){return e.isGroup||e.isBroadcast}),Store.Chat.where({isBroadcast:!0})).forEach(function(e){Store.GroupMetadata.find(e.id)["catch"](d.WapDrop,_.noop)})},_find:function(e){var t=this;if(p.isGroup(e)){var n=Store.Chat.get(e);return n&&n.isReadOnly?u.groupMetadataFindFromPhone(e).then(function(t){return"ok"===t.status?t.data:"missing"===t.status?void _.defer(function(){Store.Chat.get(e)["delete"]()}):"error"===t.status?(l.error("model:GroupMetadata:find error "+t.info)(),s["default"].reject(new Error("model:GroupMetadata:find error"))):void 0}):u.groupMetadataFind(e).then(function(n){if(n.status>=400)return{id:e,stale:!1};var i=[],a=t.get(e);return a?a.participants.set(n.participants):i=n.participants,t.updateSubject(e,n.subject),{id:n.id,owner:n.owner,creation:n.creation,participants:i}})}return p.isBroadcast(e)?u.contactFindBroadcast(e).then(function(t){if(200===t.status){var n=Store.GroupMetadata.get(e);if(n&&!n.stale)return s["default"].resolve(n);var i=[];return n?n.participants.set(t.recipients):i=t.recipients,{id:e,participants:i}}return 404===t.status?s["default"].reject("False broadcast list query."):(l.error("models:GroupMetadataCollection:_find:bclist error: "+t.status)(),s["default"].reject(new Error("models:GroupMetadataCollection:_find:bclist error: "+t.status)))}):(l.log("groupMetadata:find trying to fetch non-group/bclist wid "+e)(),s["default"].reject(new Error("groupMetadata:find trying to fetch non-group/bclist wid "+e)))},_handle:function(e){return e},updateSubject:function(e,t){_.isString(t)&&Store.Contact.find(e).then(function(e){e.name||(e.name=t)})}});e.exports=new h},function(e,t,n){"use strict";var i=n(1428),a=n(1648);e.exports={Blocklist:n(1632),Call:n(1633),Chat:n(1634),Cmd:n(1636),GroupMetadata:n(1638),Msg:n(1640),MsgInfo:n(1641),AllStarredMsgs:new i,StarredGifMsgs:new a,Mute:n(1642),Presence:n(1643),ProfilePicThumb:n(1644),Props:n(1645),RecentEmoji:n(1647),EmojiVariant:n(1637),Status:n(1649),ChatPreference:n(1635),StatusV3:n(1650),StatusV3Privacy:n(1651)}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e){if(!S.supportsFeature(S.F.CONTACT_HAS_PUSHNAME)&&e.notifyName){var t=Store.Contact.get(e.sender);t&&!t.isMe&&(!t._notifyName||t._notifyName.t<e.t)&&(t._notifyName={name:e.notifyName,t:e.t},t.trigger("change:_notifyName",e.notifyName))}}function s(e,t,n,i){var s=[],r=[],o=null;t.forEach(function(t,l){t.id instanceof k||(E.error("msgCollection:_processMultipleMessages: el.id is not a MsgKey"+(new Error).stack)(),D.upload("forgot-to-create-msgkey"),t.id=new k({from:t.from,to:t.to,id:t.id,participant:t.participant,self:t.self})),_.isString(e)&&M.isBroadcast(e)&&delete t.broadcast,"ptt"===t.type&&!t.id.fromMe&&t.ack<0&&(t.ack=0);var c=Store.Msg.get(t.id);if(t.type===v["default"].TYPE.PROTOCOL)switch(t.subtype){case"revoke":if(c=Store.Msg.get(t.protocolMessageKey)){var u=new v["default"](t);c.sender===u.sender?c.revoke(u.id):E.warn("model:Msg:processMM revoke sender mismatch "+u.id.toString()+", "+c.id.toString())()}break;default:E.info("unknown protocolMessage "+t.id.toString())(t)}else if(c){t.ack<c.ack&&delete t.ack;for(var d in t)t.hasOwnProperty(d)&&"undefined"==typeof t[d]&&delete t[d];t.id.fromMe&&!c.clientUrl&&t.clientUrl&&(t.phoneUploading=!1),n.isHistory&&(t.isNewMsg=!1);var p=c.t?_.omit(t,"t"):t,h=c.applyUpdate(p)["return"](c);o?o.push(h):o=[h],n.isHistory&&(c.recvFresh||i)&&!c.search?(E.warn("model:Msg:handle:processMM:"+(c.recvFresh?"dup:":"overlap:")+c.id)(),r.push(c)):n.isHistory&&c.search?(c.search=!1,E.warn("model:Msg:handle:processMM load search as history "+c.id)(),s.push({id:c.id})):"search"!==n.add&&"resync"!==n.add||s.push({id:c.id}),a(c)}else v["default"].typeIsMMS(t.type)&&!t.clientUrl&&(t.phoneUploading=t.id.fromMe&&0===t.ack),"search"===n.add&&(t.search=!0),n.update||s.push(t)});var c=o?m["default"].all(o):m["default"].resolve();return c.then(function(){if(0===s.length&&0===r.length){if(e&&n.pendingMsgsDone){var o=Store.Chat.get(e);o&&(o.pendingMsgs=!1)}return t.map(function(e){return Store.Msg.get(e.id)})}var c=Store.Msg.add(s,{merge:!0}),d=m["default"].map(c,function(e){return a(e),e.waitForPrep()["catch"](function(e){E.assert(!1,"bad-msg-prep",""+e)(e)})});if(e){var p;if(M.isStatusV3(e)){var h=t[0],f=h.id.fromMe?Store.Conn.me:h.author;p=Store.StatusV3.find(f)}else p=Store.Chat.find(e);return d["return"](p).then(function(a){var s,o,d="after"===n.add||"last"===n.add,p=!n.isHistory,h=!1;if("unread"===n.add?(s=i,a.msgChunks.push(s),o=n.firstUnreadKey):"last"===n.add&&n.resume?(s=i,h=!0):s="function"==typeof i?i():i,l(t,c,r,a,d,s||a.msgs,o,h),n.pendingMsgsDone&&(a.pendingMsgs=!1),p&&M.isBroadcast(e)&&!M.isStatusV3(e)&&c.forEach(function(t){if("broadcast_notification"===t.type){var n=Store.GroupMetadata.get(e);"add"===t.subtype?n.participants.add({id:t.body},{merge:!0}):"remove"===t.subtype&&n.participants.remove(t.body),a.groupMetadata.stale=!1}else t.recvFresh&&!t.isNotification&&u(t)}),S.supportsFeature(S.F.RECENT_EMOJI_SYNC)&&!Store.RecentEmoji.syncDue)for(var f=0;f<c.length;f++){var m=c[f];if(m.isNewMsg&&m.isSentByMe&&m.containsEmoji){Store.RecentEmoji.periodicSync();break}}return t.map(function(e){return Store.Msg.get(e.id)})})}return d["return"](t.map(function(e){return Store.Msg.get(e.id)}).filter(function(e){return!!e.chat}))})}function r(e,t,n,i,a,s){var r=i||t.msgs;if(e=_.isArray(e)?e:[e],0!==e.length){var o=r===t.msgs;if(s){o&&E.error("models:msg:store:resetMostRecentMsgs .msgs === cmc !")(),o=!0,t.lastReceivedKey=_.last(e).id,r.add(e);var l=new x;l.replace(t.msgs),t.msgChunks.push(l),t.replaceMsgsCollection(r),t.msgs.trigger("change:last",t.msgs.last())}else n?(o&&(t.lastReceivedKey=_.last(e).id),r.add(e)):r.add(e,{at:0,silent:_.every(e,d)});if(n&&o||!Store.Msg.lastReceivedReceipt[t.id])for(var c=e.length,u=c-1;u>=0;u--){var p=e[u],h=p.id;if(h.fromMe&&!p.isNotification){Store.Msg.updateLastReceipt(h.remote,p.t);break}}a&&!t.unreadMsgAnchor&&(t.disableUnreadAnchor?t.disableUnreadAnchor=!1:t.unreadMsgAnchor=_.find(e,function(e){return e.id.toString()===a.toString()}))}}function o(e,t,n,i,a){var s,r,o,l={},c={},u=n.length,d=a;if(0===u)return{msgs:t,collection:d};for(s=0;s<u;s++)r=n[s],c[r.id]=r;for(u=t.length,s=0;s<u;s++)r=t[s],l[r.id]=r;var p=[];for(u=e.length,s=0;s<u;s++)if(r=e[s],o=l[r.id],o&&p.push(o),o=c[r.id])if(o.recvFresh)p.push(o),i.removeMsg(o),o.unset("recvFresh");else{var h=i.getAllCMCs(),f=_.find(h,function(e){return e.get(r.id)});a&&f===a||(f?(f.forEach(function(e){p.push(e),delete c[e.id]}),f===i.msgs?(i.replaceMsgsCollection(a),d=i.msgs):(i.notifyMsgCollectionMerge(a,f,a),i.removeMsgsCollection(f))):(E.error("models:Msg:reorder trying to merge CMC of orphaned message "+r.id,r)(),p.push(c[r.id])))}return{msgs:p,collection:d}}function l(e,t,n,i,a,s,l,c){var u=o(e,t,n,i,s);r(u.msgs,i,a,u.collection,l,c)}function c(e){return _.isObject(e)?JSON.parse((0,h["default"])(e)):e}function u(e){function t(t){var n=new k({from:e.from,to:t,id:i.id});if(!Store.Msg.some(_.matches({id:n}))){var a=c(e);a.to=t,a.id=n,a.broadcast=!0;var s=Store.Msg.add(a,{merge:!0});Store.Chat.find(t).then(function(e){r(s,e,!0)})}}var n,i=e.id;if(!e.invis)if(e.recipients&&0!==e.recipients.length)n=e.recipients,e.recipients.forEach(t);else{var a=Store.GroupMetadata.get(i.remote);a?(n=c(a.participants),_.map(n,"id").forEach(t)):E.log("model:msgs:broadcastFanout no group_metadata rec for bclist, cant fanout: "+i.remote)()}return n}function d(e){return"i"===e.eventType}var p=n(24),h=i(p),f=n(2),m=i(f),g=n(453),v=i(g),y=n(9),E=n(1),b=n(455),C=n(12),M=n(20),S=n(75),T=n(38),w=n(46),k=n(30),P=n(16),N=n(45),x=n(1385),D=n(33),O=6e4,R=b.extend({model:v["default"],initialize:function(){b.prototype.initialize.call(this),this.lastReceivedReceipt={},this.preAck={},this.pendingAdd={},this.ftsCache={},this.listenTo(P,"change:stream",function(){P.stream===P.STREAM.DISCONNECTED&&(this.preAck={})}),this.listenTo(this,"remove",this.removeFromCollection)},removeFromCollection:function(e){e.chat&&e.chat.removeFromCollection(e)},_findQuery:function(e){var t,n=this;switch(e.direction){case"before":case"after":t=e.direction;break;default:t="before"}return N.msgFindQuery(t,e).then(function(i){if(i.status>=400)return E.error("model:Msg:findQuery error "+i.status)(),m["default"].reject(i.status);var a=function(){var t=n.get(e),i=Store.Chat.get(e.remote);return t?t.msgChunk:i?i.msgs:void 0};return i.forEach(function(e){e.invis=!0}),E.log("model:Msg:findQuery:got:"+i.length+":"+e.direction)(),n.processMultipleMessages(e.remote,i,{add:t,isHistory:!0},a)})},resyncChatMsgs:function(e,t){var n=this,i="number"!=typeof t||isNaN(t)?y.PAGE_SIZE:t;return N.msgFindQuery("before",{remote:e,count:i}).then(function(e){return e.status>=400?(E.error("model:Msg:resyncChatMsgs error "+e.status)(),m["default"].reject(e.status)):n.processMultipleMessages(void 0,e,{add:"resync"})})},getStarred:function(e,t,n,i){var a=this,s={count:"number"!=typeof t||isNaN(t)?y.PAGE_SIZE:t,chat:e&&_.isString(e)?e:void 0,remote:n&&n.remote,id:n&&n.id,fromMe:n&&n.fromMe,participant:n&&n.participant,media:i?"gif":void 0};return N.msgFindQuery("star",s).then(function(e){var t=e.status;return e.status>=400?(499===t?E.log("model:Msg:getStarred error 499 (unimplemented)")():E.error("model:Msg:getStarred error "+t)(),m["default"].reject(t)):a.processMultipleMessages(void 0,e,{add:"search"})})},incrementalStarredUpdate:function(e){return this.processMultipleMessages(void 0,e,{add:"search"})},search:function I(e){var t=arguments.length<=1||void 0===arguments[1]?1:arguments[1],n=this,i=arguments[2],a=arguments[3];if(1!==t||a)return this._search(e,t,i,a);var s=this.ftsCache[e];if(s)return s;var I=this._search(e,t,i,a);this.ftsCache[e]=I;var r=function(){n.ftsCache[e]=null};return _.delay(r,O),I["catch"](r),I},_search:function(e,t,n,i){var a=this,s={searchTerm:e,page:t&&_.isNumber(t)?t:1,count:n&&_.isNumber(n)?n:y.PAGE_SIZE,remote:i};return N.msgFindQuery("search",s).then(function(e){if(e.status>=400)return E.error("model:Msg:search error "+e.status)(),m["default"].reject(e.status);var t=_.isArray(e)?e:e.messages,n=!!_.isArray(e)||e.eof;return m["default"].props({messages:a.processMultipleMessages(void 0,t,{add:"search"}),eof:n})})},queryMedia:function(e,t,n,i,a){var s=this,r={remote:e,count:t&&_.isNumber(t)?t:y.PAGE_SIZE,id:i&&i.id,fromMe:i&&i.fromMe,participant:i&&i.participant,direction:n||"before",media:a};return N.msgFindQuery("media",r).then(function(e){return e.status>=400?(E.error("model:Msg:media error "+e.status)(),m["default"].reject(e.status)):a?s.processMultipleMessages(void 0,e,{add:"search"}):m["default"].props({docCount:e.docCount,linkCount:e.linkCount,mediaCount:e.mediaCount,messages:s.processMultipleMessages(void 0,e.messages,{add:"search"})})})},getContext:function(e,t){var n=this,i=this.get(e);return i?m["default"].all([N.msgFindQuery("before",e),N.msgFindQuery("after",e)]).spread(function(a,s){return _.isArray(a)&&_.isArray(s)?(i.search=!1,m["default"].all([n.processMultipleMessages(e.remote,a,{add:"before",isHistory:!0},t),n.processMultipleMessages(e.remote,s,{add:"after",isHistory:!0},t)])):(E.error("model:msg:getContext fetch error",a,s)(),m["default"].reject(a.status||s.status))}):N.msgFindQuery("after",e).then(function(i){return _.isArray(i)?M.isStatusV3(i[0].id.remote)?m["default"].reject("statusV3, stop querying before the msg"):n.processMultipleMessages(e.remote,i,{add:"after",isHistory:!0},t):(E.error("model:msg:getContext:after fetch error",i)(),m["default"].reject(i.status))}).then(function(t){var i=t[0],a=i.id.clone();return a.count=e.count+1,m["default"].all([N.msgFindQuery("before",a).then(function(t){if(!_.isArray(t))return E.error("model:msg:getContext:before fetch error",t)(),m["default"].reject(t.status);var a=t[t.length-1],s=a.id;if(!s.equals(e))return E.error("model:msg:getContext:before ctx message mismatch",t)(),m["default"].reject(405);var r=function(){return i.msgChunk};return n.processMultipleMessages(e.remote,t,{add:"before",isHistory:!0},r)}),m["default"].resolve(t)])})},handle:function(e){function t(e,t){var n=new k({from:r.from,to:e,id:t,participant:r.participant,selfDir:r.self||"out"}),i=s.get(n);if(i){i.updateAck(r.ack),s.updateLastReceipt(n.remote,r.t);var a=n.remote;M.isUser(a)&&(Store.MsgInfo.update(t,r.from,e,r.ack,a,r.t),M.isBroadcast(r.broadcast)&&Store.MsgInfo.update(t,r.from,r.broadcast,r.ack,a,r.t))}else E.log("Msg:out of order ack",r)(),s.preAck[n]=r}var n,i,a,s=this,r=e.shift();if("ack"===r.cmd){var o=[r.to];if(M.isBroadcast(r.to)&&1===r.ack){var l=Store.GroupMetadata.get(r.to);l&&Array.prototype.push.apply(o,_.map(l.participants.toArray(),"id"))}return o.forEach(function(e){t(e,r.id)}),!0}if("acks"===r.cmd)return r.id.forEach(function(e){t(r.to,e)}),!0;if(r.msg)return M.isStatusV3(r.chat)&&!Store.StatusV3.handleUpdate(r.msg,r.meta.checksum)||(r.msg.recvFresh=!0,r.msg.isNewMsg=!0,this.processMultipleMessages(r.chat,[r.msg],{add:"after",update:"update"===r.meta.add,isHistory:!1})["catch"](C.LogoutDrop,_.noop)),!0;if(r.msgs){var c=r.msgs.length;if(!c)return!1;i=r.meta,i.isHistory=!0,"unread"===i.add&&(i.firstUnreadKey=new k({fromMe:i.unreadFromMe,remote:r.chat,id:i.unreadId,participant:i.unreadParticipant}),a=new x);for(var u=0;u<c;u++)n=r.msgs[u],n.invis=!0;return Store.Conn.platform===Store.Conn.PLATFORMS.IPHONE&&this.trigger(y.COLLECTION_HAS_SYNCED),this.processMultipleMessages(r.chat,r.msgs,i,a)["catch"](C.LogoutDrop,_.noop),!0}if(r.recent){i=r.meta,delete r.recent,delete r.meta,this.trigger(y.COLLECTION_HAS_SYNCED),i.isHistory=!0;for(var d in r)"last"===i.add&&i.resume&&(a=new x),n=r[d],n.invis=!0,this.processMultipleMessages(d,[n],i,a)["catch"](C.LogoutDrop,_.noop)}else E.log("************** Msg else clause. something strange is going on")()},_hasSynced:function(){return T.waitForBBEvent(this,y.COLLECTION_HAS_SYNCED)},"delete":function(){b.prototype["delete"].call(this),this.lastReceivedReceipt={},this.preAck={}},send:function(e){return m["default"].callSynchronously(function(){var t=e.id,n=e.toJSON();if(S.supportsFeature(S.F.SPAM)&&Store.Chat.find(e.id.remote).then(function(e){e.isTrusted()||e.sendNotSpam()["catch"](_.noop)}),e.isNewMsg=!0,!e.isGroupMsg&&Store.Blocklist.get(e.to))return m["default"].reject(new C.ContactBlocked("Contact is blocked"));if(M.isBroadcast(n.to))var i=u(n);delete n.status,delete n.mimetype,delete n.height,delete n.width,delete n.recipients,delete n.chat,delete n.broadcast,delete n.ack,delete n.invis,delete n.filehash,delete n.recvFresh,delete n.mediaData,w.isHttp(e.url)||delete n.url,w.isHttp(e.clientUrl)||delete n.clientUrl;for(var a in n)null!==n[a]&&"undefined"!=typeof n[a]||delete n[a];return e.isMMS&&(n.avparams=e.avParams()),"chat"!==n.type||"url"!==n.subtype||S.supportsFeature(S.F.URL)||delete n.subtype,n.quotedMsg&&!S.supportsFeature(S.F.REPLIES_OUT)&&(delete n.quotedMsg,delete n.quotedStanzaID,delete n.quotedRemoteJid,delete n.quotedParticipant),n.mentionedJidList&&!S.supportsFeature(S.F.MENTIONS_OUT)&&delete n.mentionedJidList,Store.Chat.find(e.id.remote).then(function(t){return t.sendSeen(),m["default"].props({reply:N.msgCreateRecord(n,e.local),chat:t})}).then(function(n){var a=n.reply,s=n.chat;if(200===a.status){var r=t.remote,o=t.fromMe&&t.remote===Store.Conn.me?3:a.data?a.data.ack:1;return e.updateAck(o),s.lastReceivedKey=t,Store.Msg.updateLastReceipt(r,a.t),M.isBroadcast(r)&&(i?i.forEach(function(e){var n=new k({from:Store.Conn.me,to:e.id,id:t.id}),i=Store.Msg.get(n);i&&(i.ack=1,Store.Msg.updateLastReceipt(e,i.t),Store.Chat.find(e).then(function(e){e.lastReceivedKey=n}))}):E.log("model:msg:createRecord bclist server ack, no recipients")()),"success"}return 408!==a.status&&E.assert(!1,"send-not-200","Phone responded "+a.status)(),"dropped"})["catch"](function(e){return E.error("model:msg:createRecord dropped msg: "+n.id)(n.type),E.assert(!1,"send-msg-error","Got error "+e)(e),"dropped"})})},resyncReceipts:function(){E.log("Msg:resyncReceipts")();var e=[];for(var t in Store.Msg.lastReceivedReceipt){var n,i=Store.Chat.get(t);if(n=i?S.gte([0,5])?i.getFirstMsgWithStatus():i.getFirstMsgFromMe():void 0){var a=n.id;a.t=Store.Msg.lastReceivedReceipt[t]||n.t||0,e.push(a)}else E.error("Msg:resyncReceipts wid in lastReceivedReceipt, but no msg: "+t)()}return 0===e.length?m["default"].resolve():N.resyncReceipts(e).then(function(e){
_.isArray(e)?(E.log("Msg:resyncReceipts success")(),e.forEach(function(e){Store.Msg.updateLastReceipt(e.id,e.t),e.acks.forEach(function(t){if(4===t.length){var n=new k({fromMe:t[1],remote:e.id,id:t[0],participant:t[2]}),i=Store.Msg.get(n);i&&i.updateAck(t[3])}else E.error("Msg:resyncReceipts invalid response: "+(0,h["default"])(t))()})})):E.error("Msg:resyncReceipts error",e)()})["catch"](C.LogoutDrop,C.EphemeralDrop,C.BrowserReplacedDrop,_.noop)["catch"](function(e){throw E.error("Msg:resyncReceipts dropped "+e+" "+(e?e.stack:"no stack"))(),new Error("Msg:resyncReceipts dropped")})},updateLastReceipt:function(e,t){var n=this.lastReceivedReceipt[e];(!n||t>n)&&(this.lastReceivedReceipt[e]=t)},processMultipleMessages:function(e,t,n,i){var a=this,r=function(){return s.call(a,e,t,n,i)};if(e){var o,l=this.pendingAdd[e];return o=l?l.then(r):r(),o["finally"](function(){a.pendingAdd[e]===o&&(a.pendingAdd[e]=null)})["catch"](_.noop),this.pendingAdd[e]=o}return r()}});e.exports=new R},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(453),o=i(r),l=n(1477),c=i(l),u=n(1),d=n(20),p=n(30),h=n(455),f=n(16),m=n(45),g=h.extend({model:c["default"],initialize:function(){h.prototype.initialize.call(this,{staleCollection:!0})},_initializeStaleCollection:function(){var e=this;this.listenTo(f,"change:stream",function(){f.stream===f.STREAM.DISCONNECTED&&e.forEach(function(e){e.settled||e.set("stale",!0)})})},_find:function(e){var t=Store.Msg.get(e);return t?t.isSentByMe?m.queryMsgInfo(t.id).then(function(e){return e.status>=400?(u.log("model:MsgInfo:findQuery error "+e.status)(),s["default"].reject(e.status)):(e.id=t.id,e.isPTT=t.type===o["default"].TYPE.PTT,s["default"].resolve(e))}):s["default"].reject("message not sent by me"):s["default"].reject("No message found for id: "+e)},update:function(e,t,n,i,a,s){var r=new p({from:t,to:n,id:e,participant:a}),o=new p({from:t,to:n,id:e}),l=this.get(r)?this.get(r):this.get(o),c=d.isUser(o.remote),h=void 0,f=void 0;if(l)switch(i){case 4:if(h=l.played.get(a),h||(l.played.add({id:a,t:s}),l.playedRemaining-=1),c)break;case 3:if(f=l.read.filter(function(e){return e.id===a}),l.read.remove(f),3===i&&(l.read.add({id:a,t:s}),0===f.length&&(l.readRemaining-=1)),c)break;case 2:f=l.delivery.filter(function(e){return e.id===a}),l.delivery.remove(f),2===i&&(l.delivery.add({id:a,t:s}),0===f.length&&(l.deliveryRemaining-=1));break;default:u.error("model:MsgInfo:handle ack err: "+i,arguments)()}},handle:function(e){var t=this,n=e.shift();switch(n.cmd){case"ack":this.update(n.id,n.from,n.to,n.ack,n.participant,n.t);break;case"acks":n.id.forEach(function(e){t.update(e,n.from,n.to,n.ack,n.participant,n.t)})}}});e.exports=new g},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1426),s=i(a),r=n(1),o=n(455),l=n(29),c="global_mute",u=!0,d=!0,p=!0,h=o.extend({model:s["default"],initialize:function(){o.prototype.initialize.call(this,{CachePolicy:{id:"mute",policy:o.CACHE_POLICY.LOAD,delay:1e3}})},initializeFromCache:function(){var e=l.getGlobalSounds();this.setGlobalSounds(e);var t=l.getGlobalNotifications();this.setGlobalNotifications(t);var n=l.getGlobalPreviews();this.setGlobalPreviews(n)},saveToCache:function(){if(Store.Conn.me){var e=this._config.CachePolicy.id;r.log("models:mute:cache-save: "+e)(),l.setCollection(e,[this.globalMute().toJSON()])}},globalMute:function(){var e=this.get(c);return e?e:this.add({id:c})},getGlobalSounds:function(){return u},setGlobalSounds:function(e){u=e,l.setGlobalSounds(e)},getGlobalNotifications:function(){return d},setGlobalNotifications:function(e){d=e,l.setGlobalNotifications(e)},getGlobalPreviews:function(){return p},setGlobalPreviews:function(e){p=e,l.setGlobalPreviews(e)},handle:function(e){for(var t=0;t<e.length;t++){var n=e[t],i=Store.Chat.get(n.id);i&&"mute"===n.type&&i.mute.setMute(n.muteExpiration)}}});e.exports=new h},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(1396),o=i(r),l=n(112),c=i(l),u=n(1),d=n(455),p=n(45),h=n(12),f=d.extend({model:o["default"],initialize:function(){d.prototype.initialize.call(this,{staleCollection:!0}),this.listenTo(c["default"],"change:phoneActive",this.onPresenceSubscribabilityChange)},_find:function(e){var t=this.gadd(e);return t.isUser?(t.isSubscribed=!0,p.presenceSubscribe(e)["catch"](function(e){return t.isSubscribed=!1,s["default"].reject(e)})["catch"](h.WapDrop,_.noop),p.lastseenFind(e).then(function(n){return 423===n.status?{id:e,stale:!0,hasData:!1}:401===n.status?(t.handle({id:e,deny:!0}),{id:e}):(n.id=e,t.handle(n),{id:e})})):s["default"].resolve({id:e})},handle:function(e){var t=e.shift();if(t.id===Store.Conn.me)"unavailable"===t.type?this.forEach(function(e){"unavailable"===e.type||e.stale||this.add({id:e.id,type:"unavailable",t:t.t,stale:!1},{merge:!0})}.bind(this)):u.log('models:presence:handle for self is not "unavailable" !')();else{var n=this.get(t.id);n&&("unsubscribe"===t.type?n.set({isSubscribed:!1,stale:!0}):(n.handle(t),n.stale=!1))}},onPresenceSubscribabilityChange:function(){c["default"].phoneActive?Store.Chat.forEach(function(e){e.active&&e.presence.isUser&&e.presence.update()["catch"](h.WapDrop,_.noop)}):this.forEach(function(e){e.reset(),e.set({stale:!0,isSubscribed:!1})})}});e.exports=new f},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(1427),o=i(r),l=n(112),c=i(l),u=n(1),d=n(455),p=n(29),h=n(45),f=n(12),m=n(20),g=n(473),v=n(16),y=d.extend({model:o["default"],initialize:function(){d.prototype.initialize.call(this,{staleCollection:!0,CachePolicy:{id:"profile_pic_thumb",trigger:"change:tag change:raw",policy:d.CACHE_POLICY.LOAD,delay:5e3}}),this.listenTo(c["default"],"change:phoneActive",function(){c["default"].phoneActive&&this.onPhoneActive()})},get:function(e){var t=d.prototype.get.call(this,e);if(!_.isString(e))return t;var n=d.prototype.get.call(this,g(e));if(n){if(this.remove(n,{silent:!0}),t)return t;var i=n.toJSON();return i.id=e,this.add(i,{silent:!0})}return t?t:void 0},saveToCache:function(){if(Store.Conn.me){var e=this._config.CachePolicy.id,t=this.models.filter(function(e){return m.isWid(e.id)});t=t.map(function(e){return e=e.toJSON(),e.id=g(e.id),e}),u.log("models:profilePic:cache-save: "+e)(),p.setCollection(e,t)}},onPhoneActive:function(){if(v.stream===v.STREAM.CONNECTED){var e=[];this.forEach(function(t){t._uiObservers&&t.stale&&(t.tag||t.unset("tag",{silent:!0}),e.push(t))}),this.resyncPictures(e)}},onResume:function(){var e=this.filter(_.property("_uiObservers")).map(function(e){return e.tag||e.unset("tag",{silent:!0}),e});this.resyncPictures(e)},_find:function(e){var t=Store.Chat.get(e);return t&&t.isReadOnly?h.profilePicFindThumbFromPhone(e,this.get(e)):h.profilePicFind(e).then(function(t){return 401===t.status?{id:e,raw:void 0,tag:""}:423===t.status?{id:e,stale:!0}:t.status>=400?{id:e,tag:null}:"undefined"==typeof t.status?{id:e,tag:t.tag,raw:null,eurl:t.eurl}:void 0})["catch"](f.WapDrop,function(){return{id:e,stale:!0}})},imageChanged:function(e,t){var n=Store.ProfilePicThumb.get(e);n&&("remove"===t?n.unset("tag"):n.tag!==t&&n.update()["catch"](f.WapDrop,_.noop))},resyncPictures:function(e){return 0===e.length?s["default"].resolve():h.resyncPictures(e.map(function(e){return{id:e.id,tag:e.tag}})).then(function(e){if(423===e.status)u.warn("ProfilePicThumbStore:resyncPictures blocked")();else{if(e.status>=400)throw u.error("ProfilePicThumbStore:resyncPictures error "+e.status)(e),new Error("ProfilePicThumbStore:resyncPictures error");if(!_.isArray(e))throw u.error("ProfilePicThumbStore:resyncPictures unknown reply",e)(),new Error("ProfilePicThumbStore:resyncPictures unknown reply");u.log("ProfilePicThumbStore:resyncPictures success")(),e.forEach(function(e){var t=Store.ProfilePicThumb.get(e.id);t&&t.set({tag:e.tag,raw:void 0,stale:!1})})}})["catch"](f.WapDrop,_.noop)["catch"](function(e){u.error("ProfilePicThumbStore:resyncPictures dropped: "+e)()})}});e.exports=new y},function(e,t,n){"use strict";function i(e){return"number"==typeof e&&e>0?e-1:c.MAX_GROUP_SIZE}function a(e){return"number"==typeof e&&e>0?1024*e*1024:c.MAX_MEDIA_UPLOAD_SIZE}function s(e){return"number"==typeof e&&e>0?1024*e*1024:c.MAX_FILE_SIZE}function r(e){return"number"==typeof e&&e>0?1024*e:c.IMG_MAX_BYTES}function o(e){return d.updateDocMimes(e),e}function l(e){var t;u.Global.webcBucket=e.bucket||null;for(t in f)if("undefined"!=typeof e[t]){var n,i,a=f[t];_.isArray(a)?(n=a[0],i=a[1](e[t])):(n=a,i=e[t]),n&&(c[n]=i)}for(t in h.F)"undefined"!=typeof e[t]&&h.setFeature(t,e[t])}var c=n(9),u=n(39),d=n(113),p=n(45),h=n(75),f={bucket:null,gifSearch:"SHOW_GIF_SEARCH",imageMaxEdge:"IMG_MAX_EDGE",imageMaxKBytes:["IMG_MAX_BYTES",r],maxParticipants:["MAX_GROUP_SIZE",i],maxSubject:"MAX_SUBJECT_LENGTH",media:["MAX_MEDIA_UPLOAD_SIZE",a],maxFileSize:["MAX_FILE_SIZE",s],statusV2:"STATUS_V2",statusV3:"STATUS_V3",fbCrashlog:"USE_FB_CLB",docTypes:["DOC_TYPES",o]},m={handle:function(e){var t=e.shift();"number"==typeof t.status&&t.status>=400||l(t)},fetch:function(){return p.queryServerProps().then(function(e){"number"==typeof e.status&&e.status>=400||l(e)})}};e.exports=m},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.MediaProxy=t.MsgLoadProxy=t.StatusV3Proxy=t.ContactProxy=t.StreamProxy=t.ConnProxy=t.ChatPreferenceProxy=t.StatusProxy=t.EmojiVariantProxy=t.RecentEmojiProxy=t.ProfilePicThumbProxy=t.ChatstateProxy=t.PresenceProxy=t.MuteProxy=t.MsgInfoProxy=t.MsgProxy=t.GroupMetadataProxy=t.ChatProxy=t.CallProxy=t.BlocklistProxy=void 0;var a=n(1468);Object.defineProperty(t,"BlocklistProxy",{enumerable:!0,get:function(){return a.BlocklistProxy}});var s=n(1469);Object.defineProperty(t,"CallProxy",{enumerable:!0,get:function(){return s.CallProxy}});var r=n(1354);Object.defineProperty(t,"ChatProxy",{enumerable:!0,get:function(){return r.ChatProxy}});var o=n(1407);Object.defineProperty(t,"GroupMetadataProxy",{enumerable:!0,get:function(){return o.GroupMetadataProxy}});var l=n(453);Object.defineProperty(t,"MsgProxy",{enumerable:!0,get:function(){return l.MsgProxy}});var c=n(1477);Object.defineProperty(t,"MsgInfoProxy",{enumerable:!0,get:function(){return c.MsgInfoProxy}});var u=n(1426);Object.defineProperty(t,"MuteProxy",{enumerable:!0,get:function(){return u.MuteProxy}});var d=n(1396);Object.defineProperty(t,"PresenceProxy",{enumerable:!0,get:function(){return d.PresenceProxy}}),Object.defineProperty(t,"ChatstateProxy",{enumerable:!0,get:function(){return d.ChatstateProxy}});var p=n(1427);Object.defineProperty(t,"ProfilePicThumbProxy",{enumerable:!0,get:function(){return p.ProfilePicThumbProxy}});var h=n(1478);Object.defineProperty(t,"RecentEmojiProxy",{enumerable:!0,get:function(){return h.RecentEmojiProxy}});var f=n(1475);Object.defineProperty(t,"EmojiVariantProxy",{enumerable:!0,get:function(){return f.EmojiVariantProxy}});var m=n(1408);Object.defineProperty(t,"StatusProxy",{enumerable:!0,get:function(){return m.StatusProxy}});var g=n(1474);Object.defineProperty(t,"ChatPreferenceProxy",{enumerable:!0,get:function(){return g.ChatPreferenceProxy}});var v=n(467);Object.defineProperty(t,"ConnProxy",{enumerable:!0,get:function(){return v.ConnProxy}});var y=n(112);Object.defineProperty(t,"StreamProxy",{enumerable:!0,get:function(){return y.StreamProxy}});var E=n(232);Object.defineProperty(t,"ContactProxy",{enumerable:!0,get:function(){return E.ContactProxy}});var _=n(1374);Object.defineProperty(t,"StatusV3Proxy",{enumerable:!0,get:function(){return _.StatusV3Proxy}});var b=n(1385);Object.defineProperty(t,"MsgLoadProxy",{enumerable:!0,get:function(){return b.MsgLoadProxy}});var C=n(231),M=i(C);t.MediaProxy=M["default"].Proxy},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(1478),o=i(r),l=n(9),c=n(1),u=n(455),d=n(45),p=n(12),h=n(159),f=n(75),m=u.extend({model:o["default"],comparator:function(e,t){return e.weight>t.weight?-1:1},initialize:function(){u.prototype.initialize.call(this,{CachePolicy:{id:"recent_emoji_collection",policy:u.CACHE_POLICY.LOAD,delay:2e3}}),this.listenTo(this,"change:weight change:length",this.sortTrimScale),this.dirty=!1,this.syncDue=!1},"delete":function(){u.prototype["delete"].call(this),this.dirty=!1,this.syncDue=!1},_findQuery:function(e){return f.supportsFeature(f.F.RECENT_EMOJI_SYNC)?d.recentEmojiQuery(e?this.toArray():void 0).then(function(e){return _.isArray(e)?(e.forEach(function(e){e["char"]=h.normalizeEmoji(e["char"]),e.id=e["char"]}),s["default"].resolve(e)):(c.error("models:recentEmoji:findQuery error",e)(),s["default"].reject("recent emoji fetch error"))}):s["default"].reject("gk recent emoji sync unsupported")},sync:function(){var e=this;return this.findQuery(this.dirty)["finally"](function(){e.dirty=!1})["catch"](p.WapDrop,_.isString,_.noop)},_sync:_.throttle(function(e,t){e.sync()["finally"](t)},l.EMOJI_SYNC_DELAY,{leading:!1}),periodicSync:function(){f.supportsFeature(f.F.RECENT_EMOJI_SYNC)&&(c.log("models:recentEmoji:periodicSync due:"+this.syncDue+" dirty: "+this.dirty)(),this.syncDue=!0,this._sync(this,function(){this.syncDue=!1}.bind(this)))},sortTrimScale:function(){var e=this.length;e&&(this.sort(),e>30&&this.remove(this.models.slice(30)),_.head(this.models).weight<10&&_.last(this.models).weight>.01||this.forEach(function(t,n){t.weight=1+3*((e-n)/e)}))},increment:function(e){this.forEach(function(t){t["char"]===e?t.weight+=1:t.weight*=.9,t.weight=Math.round(1e3*t.weight)/1e3}),this.get(e)||this.add({id:e,"char":e,weight:1}),this.dirty=!0,this.periodicSync()}});e.exports=new m},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(453),o=i(r),l=n(455),c=n(16),u=n(75),d=n(1),p=l.extend({model:o["default"],initialize:function(){var e=this;l.prototype.initialize.call(this,{staleCollection:!0}),this.syncPromise=null,this.isSynced=!1,this.listenTo(c,"change:stream",function(){c.stream===c.STREAM.DISCONNECTED&&(e.isSynced=!1)})},comparator:function(e,t){return t.t-e.t},onResume:function(){this.isSynced=!1,this.sync()},sync:function(){var e=this;return this.isSynced?s["default"].resolve():this.syncPromise?this.syncPromise:u.supportsFeature(u.F.STARRED_GIFS)?(this.syncPromise=Store.Msg.getStarred(void 0,void 0,void 0,!0).then(function(t){var n=[];t&&t.length&&(n=_.filter(t,function(e){return e.isGif&&!e.isUnsentMedia})),e.set(n)})["catch"](function(e){499!==e&&d.error("starred gif msgs sync error: ",e)()})["finally"](function(){e.syncPromise=null,e.isSynced=!0}),this.syncPromise):s["default"].resolve()},add:function(e,t){if(e&&u.supportsFeature(u.F.STARRED_GIFS)&&(!this.isModel(e)||e.isGif&&!this.get(e))){var n=_.filter(e,function(e){return e.isGif});return l.prototype.add.call(this,n,t)}},remove:function(e,t){if(e&&u.supportsFeature(u.F.STARRED_GIFS)&&(!this.isModel(e)||e.isGif&&this.get(e))){var n=_.filter(e,function(e){return e.isGif});l.prototype.remove.call(this,n,t)}}});e.exports=p},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(1408),o=i(r),l=n(112),c=i(l),u=n(8),d=n(1),p=n(455),h=n(45),f=n(12),m=n(16),g=n(10),v=n(75),y=n(111).ActionToast,E=n(111).ActionType,b=n(9),C=p.extend({model:o["default"],initialize:function(){p.prototype.initialize.call(this,{staleCollection:!0}),this.listenTo(c["default"],"change:phoneActive",function(){c["default"].phoneActive&&this.onPhoneActive()})},onPhoneActive:function(){m.stream===m.STREAM.CONNECTED&&this.onResume()},onResume:function(){this.filter(_.property("_uiObservers")).forEach(function(e){Store.Status.find(e.id)["catch"](f.WapDrop,_.noop)})},_find:function(e){var t=b.STATUS_V2?h.statusFind(e).then(function(t){return _.isNumber(t.status)?423===t.status?{id:e,stale:!0,status:""}:t.status>=400?{id:e,status:""}:void 0:{id:e,status:t.status}})["catch"](f.WapDrop,function(){return{id:e,stale:!0,status:""}}):s["default"].resolve({id:e,status:""});return t},_handle:function(e){return e},canSetMyStatus:function(){return v.supportsFeature(v.F.SET_STATUS)&&!!b.STATUS_V2},setMyStatus:function(){var e=this,t=arguments.length<=0||void 0===arguments[0]?"":arguments[0],n=arguments[1];if(t=t.trim(),!t)return s["default"].reject(new f.ActionError);if(!this.canSetMyStatus())return s["default"].reject(new f.ActionError);var i=h.sendSetStatus(t),a=new E(l10n.t("action_status_setting")),r=this.get(Store.Conn.me).status;n=n||y.genId();var o=i.then(function(t){return 200===t.status?new E(l10n.t("action_status_set"),l10n.t("action_undo"),e.setMyStatus.bind(e,r,n)):t.status>=400?new E(l10n.t("action_status_set_failed")):void 0})["catch"](function(i){throw d.error("models:statusCollection:setMyStatus dropped")(i),new E(l10n.t("action_status_set_failed"),l10n.t("action_try_again"),e.setMyStatus.bind(e,t,n))});return g.openToast(u.createElement(y,{id:n,initialAction:a,pendingAction:o})),i.bind(this).then(function(e){200!==e.status||e._duplicate||(this.get(Store.Conn.me).status=t)})}});e.exports=new C},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(1374),o=i(r),l=n(76),c=i(l),u=n(455),d=n(22),p=n(9),h=n(12),f=n(1),m=n(45),g=86400,v=u.extend({model:o["default"],initialize:function(){u.prototype.initialize.call(this)},"delete":function(){u.prototype["delete"].call(this),delete this.checksum},_find:function(e){return s["default"].resolve({id:e})},_findQuery:function(e){var t=this;return m.statusQuery().then(function(e){return t.checksum=e.checksum,e.statuses})},loadMore:function(e,t,n){return m.statusQuery(e,t,n&&n.id,"after").then(function(e){return e.status>=400?(f.error("model:statusv3:findQuery error "+e.status)(),s["default"].reject(e.status)):(e.forEach(function(e){e.invis=!0}),f.log("model:statusv3:loadMore:"+e.length)(),Store.Msg.processMultipleMessages(p.STATUS_WID,e,{add:"after",isHistory:!0}))})},sync:function(e){return!e||this.checksum&&this.checksum!==e?this.findQuery({},{set:this.hasSynced()})["catch"](h.WapDrop,_.noop):s["default"].resolve(void 0)},hasSynced:function(){return!!this.checksum},handleUpdate:function(e,t){var n=e.author;if(this.updateChecksum(t),this.hasSynced()){var i=this.get(n);if(i){var a=i.totalCount===i.msgs.length;return e.invis||i.unreadCount++,i.totalCount++,i.t=e.t,!a&&e.body&&(i.pic=d.decode(e.body)),a}return this.add({id:n,t:e.t,unreadCount:e.invis?0:1,totalCount:1,_msgs:[e]}),!1}return!1},updateChecksum:function(e){e?this.hasSynced()&&(this.checksum=e):f.error("models:statusV3:no_checksum")()},handle:function(e){var t=e.shift();if(_.isArray(t))f.warn("models:statusV3:unexpected update")(t);else switch(t.type){case"read":this.updateChecksum(t.checksum);var n=this.get(t.chat);n?n.handleReadStatus(t.key):f.log("models:statusV3:read:no_status:"+[t.chat,t.key].join())(t);break;case"privacy":Store.StatusV3Privacy.update(t);break;default:f.warn("models:statusV3:unknown:"+t.type,t)()}},addStatusMessages:function(e,t){return Store.Msg.processMultipleMessages(p.STATUS_WID,t,{add:"after",isHistory:!0})},getUnexpired:function(e){var t=this.filter(function(e){return e.totalCount>0&&c["default"].globalUnixTime()-e.t<=g});if(e){var n=_.sortBy(_.filter(t,function(e){return e.unreadCount>0}),function(e){return e.t});return n.reverse(),n}var i=_.sortBy(_.filter(t,function(e){return 0===e.unreadCount}),function(e){return e.t});return i.reverse(),i}});e.exports=new v},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(77),o=i(r),l=n(1),c=n(16),u=n(45),d=n(20),p=(0,r.defineState)("StatusPrivacy",{props:{blacklist:{type:"array","default":function(){return[]}},whitelist:{type:"array","default":function(){return[]}},type:"string"},session:{isValid:"boolean"},initialize:function(){var e=this;o["default"].prototype.initialize.call(this),this.isValid=!1,this.listenTo(c,"change:stream",function(){c.stream===c.STREAM.RESUMING&&(e.isValid=!1)})},query:function(){var e=this;return u.getStatusPrivacy().then(function(t){switch(t.status){case 200:e.set({blacklist:t.blacklist,whitelist:t.whitelist,type:t["default"],isValid:!0});break;case 404:e.set({type:"contacts",isValid:!0});break;default:return l.error("statusV3Privacy:query:error:"+t.status,t)(),s["default"].reject(t.status)}})},update:function(e){this.isValid&&(e.whitelist&&this.set({type:"whitelist",whitelist:e.whitelist}),e.blacklist&&this.set({type:"blacklist",blacklist:e.blacklist}),e.contacts&&(this.type="contacts"))},sendSetPrivacy:function(e,t){var n=this;if(!this.isValid)return s["default"].reject("called setPrivacy when isValid false");var i;switch(e){case"blacklist":case"whitelist":if(i=_.isArray(t)?t.filter(function(e){return d.isUser(e)}):void 0,!_.isArray(i)||0===i.length)return s["default"].reject("called setPrivacy blacklist/whitelist with no valid jids");break;case"contacts":break;default:e="contacts"}return u.setStatusPrivacy(e,i).then(function(t){if(200===t.status){var a={};a[e]=i,n.update(a)}return t})["catch"](function(e){})}}),h=p.StatusPrivacy;e.exports=new h({id:1})},function(e,t){"use strict";e.exports={Action:"keyboard_action",Event:"keyboard_event",Events:{LOGGED_IN:"logged_in",LOGGED_OUT:"logged_out",ARCHIVE:"archived",MUTE:"muted",READ:"read",READ_ONLY:"read_only",CHAT_KIND:"chat_kind",ZOOM:"zoom",LAUNCH:"launch"},Actions:{PREFERENCES:"preferences",NEW_CHAT:"new_chat",NEW_GROUP:"new_group",PROFILE_STATUS:"profile_status",LOGOUT:"logout",SEARCH:"search",ZOOM_IN:"zoom_in",ZOOM_OUT:"zoom_out",ZOOM_RESET:"zoom_reset",TOGGLE_UNREAD:"toggle_unread",DELETE_CHAT:"delete_chat",DELETE_GROUP:"delete_group",EXIT_GROUP:"exit_group",TOGGLE_ARCHIVE:"toggle_archive",TOGGLE_MUTE:"toggle_mute",SEARCH_CHAT:"search_chat",NEXT_CHAT:"next_chat",PREV_CHAT:"prev_chat",CONTACT_US:"contact_us",METRIC_UPDATE:"metric_update"},Metrics:{BETA_UPDATES:"beta_updates"}}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(112),o=i(r),l=n(8),c=n(9),u=n(94),d=n(153),p=n(154),h=n(20),f=n(12),m=n(457),g=n(246),v=l.createClass({displayName:"NotificationManager",mixins:[u,d,p],componentWillMount:function(){this.tone=new Audio(c.NOTIFICATION_TONE_PATH),this.regCmd("alert_new_msg",this.alertNewMsg),this.regCmd("alert_call",this.showCallNotification),this.regCmd("cancel_call",this.cancelCallNotification),this.addObserver(Store.Chat,"add remove reset change:archive change:unreadCount",this.updateUnreadCount),this.addObserver(Store.Chat,"change:hasUnread",this.closeNotifications),this.addObserver(o["default"],"change:displayInfo",this.updateUnreadCount)},componentDidMount:function(){this.updateUnreadCount()},componentWillUnmount:function(){g.setTitleAndIcon(0),g.closeAllNotifications()},closeNotifications:function(e,t){t||g.closeChatNotifications(e.id)},updateUnreadCount:function(){var e;e=o["default"].displayInfo===o["default"].INFO.OFFLINE?-1:o["default"].displayInfo===o["default"].INFO.TIMEOUT?-1:Store.Chat.filter(function(e){return!e.archive&&e.isDirty()}).length,this.count!==e&&(this.count=e,g.setTitleAndIcon(e))},alertNewMsg:function(e){var t=e.chat;if(!(document.hasFocus()&&t.get("active")||Store.Mute.globalMute().isMuted)){if(t.mute.isMuted){if(!e.isGroupMsg)return;if(!e.isMentioned(Store.Conn.me)&&!e.isQuoted(Store.Conn.me))return;var n=Store.Chat.get(e.sender);if(n&&n.mute.isMuted)return}if(Store.Mute.getGlobalNotifications()&&this.showDesktopNotification(e),Store.Mute.getGlobalSounds())if(t.isGroup){var i=Date.now(),a=t.squelch||0;i>a&&(this.playAudioNotification(),Store.GroupMetadata.find(t.id).then(function(e){var n=e.participants.length,a=1e3*Math.min(120,30+5*n);t.squelch=i+a})["catch"](f.WapDrop,function(){t.squelch=i+6e4}))}else this.playAudioNotification()}},showCallNotification:function(e,t,n){if(window.Notification&&window.Notification.permission===c.PERMISSION_ALLOWED){var i=Store.Contact.get(t),a=i?i.get("formattedName"):h.formattedUser(t),r=n?l10n.t("incoming_video_call_notification_title",{name:a}):l10n.t("incoming_voice_call_notification_title",{name:a}),o=l10n.t("incoming_call_notification_text");Store.ProfilePicThumb.find(t).timeout(1e3,"showCallNotificationTimeout").then(function(n){var i=n&&n.get("img")?n.get("img"):c.USER_DEFAULT_ICON;g.showNotification(t,e,r,o,i,!0)})["catch"](f.WapDrop,s["default"].TimeoutError,function(n){g.showNotification(t,e,r,o,c.USER_DEFAULT_ICON,!0)}),Store.Mute.getGlobalSounds()&&this.playAudioNotification()}},cancelCallNotification:function(e){g.closeNotification(e),Store.Call.remove(Store.Call.get(e))},showDesktopNotification:function(e){if(window.Notification&&window.Notification.permission===c.PERMISSION_ALLOWED){var t=e.get("chat"),n=t.get("id"),i=m.asDesktopNotification(e);i&&i.charCodeAt(0)>=128&&(i=" "+i);var a=t.isGroup?c.GROUP_DEFAULT_ICON:c.USER_DEFAULT_ICON,r=t.isGroup?l10n.t("default_group_message_notification_title"):l10n.t("default_contact_message_notification_title");Store.ProfilePicThumb.find(n).timeout(1500,"showDesktopNotificationTimeout").then(function(s){var o=t.contact.formattedName||r,l=s?s.img:"";g.showNotification(n,e.id,o,i,l||a,!1)})["catch"](f.WapDrop,s["default"].TimeoutError,function(s){var o=t.contact.formattedName||r;g.showNotification(n,e.id,o,i,a,!1)})}},playAudioNotification:function(){this.tone.play()},render:function(){return null}});e.exports=v},function(e,t,n){"use strict";function i(e){o(this,i,e)}function a(e){o(this,a,e)}var s=n(116),r=s.defineProtobufClass,o=s.construct,l=3,c=13,u=14;r(i,{publicKey:[1,c],identifier:[2,c]}),r(a,{version:[1,l],localFingerprint:[2,u,i],remoteFingerprint:[3,u,i]}),e.exports={FingerprintData:i,CombinedFingerprint:a}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(15),s=i(a),r=n(5),o=i(r),l=n(6),c=i(l),u=n(19),d=i(u),p=n(18),h=i(p),f=n(8),m=i(f),g=n(1362),v=i(g),y=n(1375),E=i(y),_=n(1656),b=i(_),C=n(1374),M=(i(C),n(232)),S=(i(M),n(76)),T=i(S),w=function(e){function t(){return(0,o["default"])(this,t),(0,d["default"])(this,(0,s["default"])(t).apply(this,arguments))}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"render",value:function(){var e=this.props,t=e.statusV3,n=e.contact;return m["default"].createElement(E["default"],{id:t.id,key:t.id,image:m["default"].createElement(b["default"],{statusV3:t}),primary:n.formattedName,secondary:T["default"].relativeDateAndTimeStr(t.t),onClick:this.props.onClick,contextEnabled:function(){return!1}})}}]),t}(f.PureComponent);w.CONCERNS={statusV3:["id","t","unreadCount","totalCount","renderedThumbnail"],contact:["formattedName"]},t["default"]=(0,v["default"])(w)},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(15),s=i(a),r=n(5),o=i(r),l=n(6),c=i(l),u=n(19),d=i(u),p=n(18),h=i(p),f=n(8),m=i(f),g=n(1362),v=i(g),y=n(1374),E=(i(y),n(1657)),_=i(E),b=function(e){function t(){return(0,o["default"])(this,t),(0,d["default"])(this,(0,s["default"])(t).apply(this,arguments))}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"render",value:function(){var e=this.props.statusV3;return m["default"].createElement("div",{className:"status-image-container"},m["default"].createElement(_["default"],{statusV3:e}),m["default"].createElement("img",{className:"status-image",src:e.renderedThumbnail}))}}]),t}(f.PureComponent);b.CONCERNS={statusV3:["unreadCount","totalCount","renderedThumbnail"]},t["default"]=(0,v["default"])(b)},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(158),s=i(a),r=n(15),o=i(r),l=n(5),c=i(l),u=n(6),d=i(u),p=n(19),h=i(p),f=n(18),m=i(f),g=n(8),v=i(g),y=n(1362),E=i(y),_=n(1374),b=(i(_),n(43)),C=i(b),M=50,S=10,T=function(e){function t(){return(0,c["default"])(this,t),(0,h["default"])(this,(0,o["default"])(t).apply(this,arguments))}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"genCircle",value:function(e){var t=2*M+this.props.stroke;return v["default"].createElement("circle",(0,s["default"])({cx:t/2,cy:t/2,r:M,fill:"none",strokeLinecap:"round",strokeWidth:this.props.stroke},e))}},{key:"genDasharray",value:function(e,t,n){for(var i="",a=0;a<e;a++)i+=a===e-1?t+" "+(n-e*(S+t)+S)+" ":t+" "+S+" ";return i}},{key:"render",value:function(){var e=this.props,t=e.statusV3,n=e.stroke,i=e.size,a=2*M+n,s="0 0 "+a+" "+a,r=Math.PI*M*2,o=(r-S*t.totalCount)/t.totalCount,l=r/4-S/2,c=void 0,u=t.totalCount-t.unreadCount;if(u){var d=l+t.totalCount*(S+o),p=void 0;1!==t.totalCount&&(p=this.genDasharray(u,o,r)),c=this.genCircle({strokeDashoffset:d,strokeDasharray:p,className:"image-ring-read"})}var h=void 0;if(t.unreadCount){var f=l+t.unreadCount*(S+o),m=void 0;1!==t.unreadCount&&(m=this.genDasharray(t.unreadCount,o,r)),h=this.genCircle({strokeDashoffset:f,strokeDasharray:m,className:"image-ring-unread"})}return v["default"].createElement("svg",{className:(0,C["default"])("status-image-ring",this.props.className),width:i,height:i,viewBox:s},c,h)}}]),t}(g.PureComponent);T.CONCERNS={statusV3:["unreadCount","totalCount"]},T.defaultProps={size:57,stroke:3},t["default"]=(0,E["default"])(T)},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(15),s=i(a),r=n(5),o=i(r),l=n(6),c=i(l),u=n(19),d=i(u),p=n(18),h=i(p),f=n(8),m=i(f),g=n(1368),v=i(g),y=n(157),E=i(y),_=n(1586),b=i(_),C=n(10),M=i(C),S=n(1393),T=S.MenuBarItem,w=function(e){function t(){var e,n,i,a;(0,o["default"])(this,t);for(var r=arguments.length,l=Array(r),c=0;c<r;c++)l[c]=arguments[c];return n=i=(0,d["default"])(this,(e=(0,s["default"])(t)).call.apply(e,[this].concat(l))),i.state={hasUnread:!1},i.onUnreadChange=function(){var e=Store.StatusV3.some(function(e){return e.unreadCount>0});e!==i.state.hasUnread&&i.setState({hasUnread:e})},a=n,(0,d["default"])(i,a)}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"componentWillMount",value:function(){this.props.listeners.add(Store.StatusV3,"add remove change:unreadCount",this.onUnreadChange)}},{key:"onStatus",value:function(e){e.preventDefault(),M["default"].openModalMedia(m["default"].createElement(b["default"],null),"status-v3-modal")}},{key:"render",value:function(){var e=this.state.hasUnread?"status-v3-unread":"status-v3";return m["default"].createElement(T,{icon:e,a8n:"menu-bar-status",title:E["default"].t("web_menuitem_status"),onClick:this.onStatus})}}]),t}(f.PureComponent);w.CONCERNS={statusV3:["unreadCount","totalCount","renderedThumbnail"]},t["default"]=(0,v["default"])(w)},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.StatusV3GifController=t.StatusV3CountdownController=t.StatusV3VideoController=void 0;var a=n(5),s=i(a),r=n(6),o=i(r),l=n(1),c=t.StatusV3VideoController=function(){function e(){(0,s["default"])(this,e),this._onPlayingHandler=this._onPlayingHandler.bind(this),this._onPauseHandler=this._onPauseHandler.bind(this),this._onEndedHandler=this._onEndedHandler.bind(this)}return(0,o["default"])(e,[{key:"addListeners",value:function(e,t,n){this._onStart=e,this._onPause=t,this._onEnded=n}},{key:"setVideo",value:function(e){this._video=e,this._video.addEventListener("playing",this._onPlayingHandler),this._video.addEventListener("pause",this._onPauseHandler),this._video.addEventListener("ended",this._onEndedHandler)}},{key:"play",value:function(){this._video&&this._video.play()}},{key:"pause",value:function(){this._video&&!this._video.paused&&this._video.pause()}},{key:"resume",value:function(){this._video&&this._video.play()}},{key:"stop",value:function(){this._video&&!this._video.paused&&this._video.pause()}},{key:"_onPlayingHandler",value:function(){var e=this._onStart;e&&e(1e3*(this._video.duration-this._video.currentTime),1e3*this._video.duration)}},{key:"_onPauseHandler",value:function(){var e=this._onPause;e&&e()}},{key:"_onEndedHandler",
value:function(){var e=this._onEnded;e&&e(),this.stop()}}]),e}(),u=t.StatusV3CountdownController=function(){function e(t){(0,s["default"])(this,e),this._duration=t,this._timeout=this._duration,this._start=0,this._onTimeup=this._onTimeup.bind(this)}return(0,o["default"])(e,[{key:"addListeners",value:function(e,t,n){this._onStart=e,this._onPause=t,this._onEnded=n}},{key:"play",value:function(){if(this._timer)return void l.error("Duplicate timer start")();this._timer=setTimeout(this._onTimeup,this._timeout),this._start=(new Date).getTime();var e=this._onStart;e&&e(this._timeout,this._duration)}},{key:"stop",value:function(){if(this._timer){clearTimeout(this._timer),this._timer=null;var e=(new Date).getTime();this._timeout-=e-this._start;var t=this._onPause;t&&t()}else l.error("Timer stop called on stopped timer")()}},{key:"resume",value:function(){this.play()}},{key:"pause",value:function(){this.stop()}},{key:"_onTimeup",value:function(){var e=this._onEnded;e&&e()}}]),e}(),d=6e3,p=3;t.StatusV3GifController=function(){function e(){(0,s["default"])(this,e),this._playCounter=0,this._timerEnded=!1,this._videoEnded=!1,this._onVideoStartHandler=this._onVideoStartHandler.bind(this),this._onVideoPauseHandler=this._onVideoPauseHandler.bind(this),this._onVideoEndedHandler=this._onVideoEndedHandler.bind(this),this._onTimerEndedHandler=this._onTimerEndedHandler.bind(this),this._videoController=new c,this._countdownController=new u(d),this._videoController.addListeners(this._onVideoStartHandler,this._onVideoPauseHandler,this._onVideoEndedHandler),this._countdownController.addListeners(null,null,this._onTimerEndedHandler)}return(0,o["default"])(e,[{key:"addListeners",value:function(e,t,n){this._onStart=e,this._onPause=t,this._onEnded=n}},{key:"setVideo",value:function(e){this._video=e,this._videoController.setVideo(e)}},{key:"_onVideoStartHandler",value:function(){var e=this._onStart,t=Math.max(p*this._video.duration*1e3,d);e&&e(t-1e3*this._video.duration*this._playCounter-1e3*this._video.currentTime,t)}},{key:"_onVideoPauseHandler",value:function(){var e=this._onPause;e&&e()}},{key:"_onVideoEndedHandler",value:function(){var e=this;this._playCounter++;var t=this._onEnded;this._playCounter===p&&(this._videoEnded=!0,this._timerEnded&&t&&t()),this._video.currentTime=0,this._videoEnded&&this._timerEnded||setTimeout(function(){e._videoController.play()},0)}},{key:"_onTimerEndedHandler",value:function(){var e=this._onEnded;this._timerEnded=!0,e&&this._videoEnded&&e()}},{key:"play",value:function(){this._videoController.play(),this._countdownController.play()}},{key:"stop",value:function(){this._videoController.stop(),this._countdownController.stop()}},{key:"resume",value:function(){this._videoController.resume(),this._countdownController.resume()}},{key:"pause",value:function(){this._videoController.pause(),this._countdownController.pause()}}]),e}()},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(15),s=i(a),r=n(5),o=i(r),l=n(6),c=i(l),u=n(19),d=i(u),p=n(18),h=i(p),f=n(8),m=i(f),g=n(44),v=n(463),y=n(43),E=function(e){function t(){return(0,o["default"])(this,t),(0,d["default"])(this,(0,s["default"])(t).apply(this,arguments))}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"render",value:function(){for(var e=[],t=100/this.props.total+"%",n=0;n<this.props.total;++n){var i=y("progress-bar-fg",{filled:n<this.props.current,empty:n>this.props.current,active:n===this.props.current}),a={width:t},s=void 0;n===this.props.current&&(s="bar");var r=m["default"].createElement("div",{className:"progress-bar-wrapper",style:a,key:n},m["default"].createElement("div",{className:"progress-bar-bg"}),m["default"].createElement("div",{className:"progress-bar-mask"},m["default"].createElement("div",{className:i,ref:s})));e.push(r)}return m["default"].createElement("div",{className:"progress-bar-container"},e)}},{key:"onStart",value:function(e,t){var n=g.findDOMNode(this.refs.bar),i="-"+e/t*100+"%";v(n,"stop"),v(n,{translateX:["0%",i]},{duration:e,easing:"linear"})}},{key:"onPause",value:function(){var e=g.findDOMNode(this.refs.bar);v(e,"stop")}},{key:"onEnded",value:function(){var e=g.findDOMNode(this.refs.bar);return v(e,{translateX:"0%"})}}]),t}(m["default"].Component);e.exports=E},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(1669),o=n(113),l=n(1),c={enrich:function(e){switch(o.previewType(e.mimetype)){case"pdf":return this.enrichPdf(e);case"msoffice":return this.enrichDoc(e);default:return s["default"].resolve({media:e})}},enrichPdf:function(e){var t,n=e.mediaBlob;return r.fileToPdf(n).then(function(n){return t=n,r.pdfToImg(n,1).then(function(t){var i=t;return i.pdfPages=n.numPages,{media:e,documentPreview:i}})})["catch"](function(t){return l.log("pdf preview generation failed",t)(),{media:e}})["finally"](function(){t&&r.releasePdf(t)})},enrichDoc:function(e){return s["default"].resolve({media:e})}};e.exports=c},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e){var t=s(),n=t.getMatches(e).sort(function(e,t){return e.keyword.length-t.keyword.length}),i=_.uniq(_.flatMap(n,function(e){return e.value}));return _.union(_.intersection(_.map(Store.RecentEmoji.models,"char"),i),_.intersection(u,i),i)}function s(){if(!d){var e=_.map(o["default"],function(e,t){return{value:e,keyword:t}});d=(0,c["default"])(e,"keyword")}return d}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=a;var r=n(1674),o=i(r),l=n(1269),c=i(l),u=["😂","😍","😘","🤣","😀","❤️","😉","😊","🤔","😭","😁","😜","👏","😎","👍","😬","😆","🙂","😇","😠","😅","☺️","🤗","😄","😒","😃","😏","😌","👌","😝","🙃","😋","🎂","😡","😱","🙏","😔","😢","😳","😞","🤤","👊","😛","😚","🙄","💕","✌️","💪","💞","🌹"],d=null},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(5),s=i(a),r=n(6),o=i(r),l=function(){function e(){(0,s["default"])(this,e)}return(0,o["default"])(e,[{key:"trigger",value:function(e){}}]),e}();e.exports=new l},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1366),s=i(a),r=3;e.exports={minHeight:function(e,t){return{minHeight:e.length>r?r*s["default"].DEFAULT_HEIGHT+t:e.length*s["default"].DEFAULT_HEIGHT+t}}}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(15),s=i(a),r=n(5),o=i(r),l=n(6),c=i(l),u=n(19),d=i(u),p=n(18),h=i(p),f=n(115),m=n(240),g=n(58),v=n(233),y=v.matchAll,E=function(e){function t(e){(0,o["default"])(this,t);var n=(0,d["default"])(this,(0,s["default"])(t).call(this));return n._length=e,n._regex=new RegExp("("+m.arabic+"{"+e+"})("+m.arabic+")","g"),n}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"mutate",value:function(e,t){return t[1]+"​"+t[2]}},{key:"match",value:function(e){return g.isWebkit?e.length<=this._length?null:y(this._regex,e):null}},{key:"isFragment",get:function(){return!0}},{key:"alwaysApply",get:function(){return!0}}]),t}(f);e.exports=E},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(234),s=i(a),r=n(15),o=i(r),l=n(5),c=i(l),u=n(6),d=i(u),p=n(19),h=i(p),f=n(18),m=i(f),g=n(245),v=n(490),y=function(e){function t(e){(0,c["default"])(this,t);var n=(0,h["default"])(this,(0,o["default"])(t).call(this,e));return n.handlers=new s["default"],n.defaultHandler=null,n}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"onMutatorNode",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=t[0].mutator,a=this.getHandler(i)||this.defaultHandler;return v(a,'Missing handler for "'+i.constructor+'"'),a.call.apply(a,[this].concat(t,[this.args]))}},{key:"addHandler",value:function(e,t){this.handlers.set(e,t)}},{key:"setDefaultHandler",value:function(e){this.defaultHandler=e}},{key:"getHandler",value:function(e){return this.handlers.get(e.constructor)}}]),t}(g);e.exports=y},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(15),s=i(a),r=n(5),o=i(r),l=n(6),c=i(l),u=n(19),d=i(u),p=n(18),h=i(p),f=n(479),m=i(f),g=n(160),v=i(g),y=n(47),E=i(y),_=n(1666),b=n(1352),C=n(10),M=n(233),S=M.jsx,T=n(8),w=n(237),k=w.dir,P=n(468),N=n(1483),x=n(474),D=n(475),O=n(477),R=n(478),I=n(1484),A=n(476),L=n(1512),F=function(e,t){var n=t.match.href;return{href:n,title:n,rel:"noopener noreferrer",target:"_blank"}},U=function(e,t,n){var i=(0,E["default"])(n,1),a=i[0];return{emoji:a}},G=function(){return{className:"matched-text"}},j=function(){var e=arguments.length<=0||void 0===arguments[0]||arguments[0];return function(t,n){var i=n.match,a=i.jid,s=i.display,r=function(){var e=Store.Contact.gadd({id:a}),t=Store.Chat.gadd(e.id);C.chatInfoDrawer(t)};return{onClick:e?r:void 0,className:"matched-mention","data-jid":a,"data-display":"@"+s}}},B=function(e){var t=e.children,n=(0,v["default"])(e,["children"]),i=(0,m["default"])(t),a=i[0],s=i.slice(1);return T.createElement("span",n,T.createElement("span",{className:"at-symbol selectable-text"},"@"),T.createElement("span",{dir:k(a)||"auto",className:"selectable-text"},(a||"").substring(1),s))},V=function(e){function t(e){var n;(0,o["default"])(this,t);for(var i=arguments.length,a=Array(i>1?i-1:0),r=1;r<i;r++)a[r-1]=arguments[r];var l=(0,d["default"])(this,(n=(0,s["default"])(t)).call.apply(n,[this,e].concat(a)));return l.addHandler(N,S.make(L,N,U)),l.addHandler(D,S.make("a",D,F)),l.addHandler(P,S.make("code",P)),l.addHandler(R,S.make("strong",R)),l.addHandler(x,S.make("em",x)),l.addHandler(O,S.make("del",O)),l.addHandler(I,S.make("span",I,G)),l.addHandler(A,S.make(B,A,j(e.get("mentionUseOnClick")))),l}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"onRoot",value:function(e){return b(e.reduce(function(e,t,n){return e["root-child-"+n]=t,e},{}))}},{key:"onDelimiter",value:function(){return null}}]),t}(_);e.exports=V},function(e,t,n){"use strict";var i=n(491),a=function s(e){if(!s.isRecordingSupported())throw"Recording is not supported in this browser";this.audioContext=new window.AudioContext,this.config=e=e||{},this.config.command="encode-init",this.config.bufferLength=e.bufferLength||4096,this.config.monitorGain=e.monitorGain||0,this.config.numberOfChannels=e.numberOfChannels||1,this.config.originalSampleRate=this.audioContext.sampleRate,this.config.encoderSampleRate=e.encoderSampleRate||48e3,this.config.streamPages=e.streamPages||!1,this.config.leaveStreamOpen=e.leaveStreamOpen||!1,this.config.maxBuffersPerPage=e.maxBuffersPerPage||40,this.config.encoderApplication=e.encoderApplication||2049,this.config.encoderFrameSize=e.encoderFrameSize||20,this.config.streamOptions=e.streamOptions||{optional:[],mandatory:{googEchoCancellation:!1,googAutoGainControl:!1,googNoiseSuppression:!1,googHighpassFilter:!1}},this.storePage=this._storePage.bind(this),this.streamPage=this._streamPage.bind(this),this.state="inactive",this.eventTarget=document.createDocumentFragment(),this.createAudioNodes()};a.isRecordingSupported=function(){return window.AudioContext&&navigator.getUserMedia},a.prototype.addEventListener=function(e,t,n){this.eventTarget.addEventListener(e,t,n)},a.prototype.clearStream=function(){this.stream&&(this.stream.getTracks().forEach(function(e){e.stop()}),delete this.stream)},a.prototype.createAudioNodes=function(){var e=this;this.scriptProcessorNode=this.audioContext.createScriptProcessor(this.config.bufferLength,this.config.numberOfChannels,this.config.numberOfChannels),this.scriptProcessorNode.onaudioprocess=function(t){e.encodeBuffers(t.inputBuffer)},this.monitorNode=this.audioContext.createGain(),this.setMonitorGain(this.config.monitorGain),this.config.sampleRate<this.audioContext.sampleRate&&this.createButterworthFilter()},a.prototype.createButterworthFilter=function(){this.filterNode=this.audioContext.createBiquadFilter(),this.filterNode2=this.audioContext.createBiquadFilter(),this.filterNode3=this.audioContext.createBiquadFilter(),this.filterNode.type=this.filterNode2.type=this.filterNode3.type="lowpass";var e=this.config.sampleRate/2;this.filterNode.frequency.value=this.filterNode2.frequency.value=this.filterNode3.frequency.value=e-e/3.5355,this.filterNode.Q.value=.51764,this.filterNode2.Q.value=.70711,this.filterNode3.Q.value=1.93184,this.filterNode.connect(this.filterNode2),this.filterNode2.connect(this.filterNode3),this.filterNode3.connect(this.scriptProcessorNode)},a.prototype.encodeBuffers=function(e){if("recording"===this.state){for(var t=[],n=0;n<e.numberOfChannels;n++)t[n]=e.getChannelData(n);this.encoder.postMessage({command:"encode",buffers:t}),this.duration+=e.duration,this.eventTarget.dispatchEvent(new CustomEvent("duration",{detail:this.duration}))}},a.prototype.initStream=function(e){if(this.stream)return void this.eventTarget.dispatchEvent(new Event("streamReady"));if(e)return this.stream=e,this.sourceNode=this.audioContext.createMediaStreamSource(e),this.sourceNode.connect(this.filterNode||this.scriptProcessorNode),this.sourceNode.connect(this.monitorNode),void this.eventTarget.dispatchEvent(new Event("streamReady"));var t=this;navigator.getUserMedia({audio:this.config.streamOptions},function(e){t.stream=e,t.sourceNode=t.audioContext.createMediaStreamSource(e),t.sourceNode.connect(t.filterNode||t.scriptProcessorNode),t.sourceNode.connect(t.monitorNode),t.eventTarget.dispatchEvent(new Event("streamReady"))},function(e){t.eventTarget.dispatchEvent(new ErrorEvent("streamError",{error:e}))})},a.prototype.pause=function(){"recording"===this.state&&(this.state="paused",this.eventTarget.dispatchEvent(new Event("pause")))},a.prototype.removeEventListener=function(e,t,n){this.eventTarget.removeEventListener(e,t,n)},a.prototype.resume=function(){"paused"===this.state&&(this.state="recording",this.eventTarget.dispatchEvent(new Event("resume")))},a.prototype.setMonitorGain=function(e){this.monitorNode.gain.value=e},a.prototype.start=function(){"inactive"===this.state&&this.stream&&(this.encoder=new i,this.config.streamPages?this.encoder.addEventListener("message",this.streamPage):(this.recordedPages=[],this.totalLength=0,this.encoder.addEventListener("message",this.storePage)),this.encodeBuffers=function(){delete this.encodeBuffers},this.duration=0,this.state="recording",this.monitorNode.connect(this.audioContext.destination),this.scriptProcessorNode.connect(this.audioContext.destination),this.eventTarget.dispatchEvent(new Event("start")),this.eventTarget.dispatchEvent(new CustomEvent("duration",{detail:this.duration})),this.encoder.postMessage(this.config))},a.prototype.stop=function(){"inactive"!==this.state&&(this.state="inactive",this.audioContext.close&&this.audioContext.close(),this.monitorNode.disconnect(),this.scriptProcessorNode.disconnect(),this.config.leaveStreamOpen||this.clearStream(),this.encoder.postMessage({command:"encode-done"}))},a.prototype._storePage=function(e){var t=e.data;if(this.recordedPages.push(t),this.totalLength+=t.length,4&t[5]){this.encoder.removeEventListener("message",this.storePage);for(var n=new Uint8Array(this.totalLength),i=0,a=0;a<this.recordedPages.length;a++)n.set(this.recordedPages[a],i),i+=this.recordedPages[a].length;this.eventTarget.dispatchEvent(new CustomEvent("dataAvailable",{detail:new Blob([n],{type:"audio/ogg; codecs=opus"})})),this.recordedPages=[],this.eventTarget.dispatchEvent(new Event("stop"))}},a.prototype._streamPage=function(e){var t=e.data;this.eventTarget.dispatchEvent(new CustomEvent("dataAvailable",{detail:new Blob([t],{type:"audio/ogg; codecs=opus"})})),4&t[5]&&(this.encoder.removeEventListener("message",this.streamPage),this.eventTarget.dispatchEvent(new Event("stop")))},e.exports=a},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(){return u["default"].loop(function(e,t,i){var a=u["default"].delay(p.expBackoff(i,12e4,0,0));return new u["default"](function(t,i){n.e(86).then(function(i){var a=n(1430);a.PDFJS.workerSrc="./pdf.worker.js",e(a),t(a)}.bind(null,n))["catch"](function(e){n.oe(e)})})["catch"](function(e){return a})})}var s=n(5),r=i(s),o=n(6),l=i(o),c=n(2),u=i(c),d=n(461),p=n(62);n(1675);var h=function(){function e(){(0,r["default"])(this,e)}return(0,l["default"])(e,null,[{key:"fileToPdf",value:function(e){var t=URL.createObjectURL(e);return a().then(function(e){return e.PDFJS.getDocument(t)})}},{key:"releasePdf",value:function(e){return e.destroy()}},{key:"pdfToImg",value:function(e,t){var n=document.createElement("canvas");return e.getPage(t).then(function(e){var t=e.getViewport(1),i=n.getContext("2d");n.height=t.height,n.width=t.width;var a={canvasContext:i,viewport:t};return e.render(a)}).then(function(){return d.canvasToBlob(n)}).then(function(e){var t=n.height,i=n.width,a=URL.createObjectURL(e);return{url:a,thumbUrl:a,width:i,height:t}})}}]),e}();e.exports=h},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(21),s=i(a),r=n(6),o=i(r),l=n(5),c=i(l),u=function p(e){(0,c["default"])(this,p),this.promise=e,this.lastUsedTime=this.createdTime=+Date.now()},d=function(){function e(t,n){var i=n.maxCached,a=void 0===i?10:i,s=n.maxAge,r=void 0===s?1/0:s,o=n.shouldCache;(0,c["default"])(this,e),this._cache={},this._maxCached=a,this._maxAge=r,this._createPromiseFunc=t,this._shouldCacheFunc=o}return(0,o["default"])(e,[{key:"getOrRun",value:function(){for(var e=this,t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];var a=n[0],r=this._cache;if(this._maxAge!==1/0)for(var o=Date.now()-this._maxAge,l=(0,s["default"])(r),c=0;c<l.length;c++){var d=l[c];r[d].createdTime<o&&delete r[d]}var p=r[a];if(p)return p.lastUsedTime=+Date.now(),p.promise;var h=(0,s["default"])(r);if(h.length>=this._maxCached){for(var f=void 0,m=void 0,g=0;g<h.length;g++){var v=h[g],y=r[v];(!m||y.lastUsedTime<m)&&(m=y.lastUsedTime,f=v)}delete r[f]}var E=this._createPromiseFunc.apply(void 0,n);return r[a]=new u(E),E.then(function(t){var n=e._shouldCacheFunc;n&&e._cache[a]===E&&!n(t)&&delete e._cache[a]})["catch"](function(){e._cache[a]===E&&delete e._cache[a]}),E}}]),e}();e.exports=d},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=!1;try{var i={get passive(){n=!0}};window.addEventListener("test",null,i)}catch(a){}t["default"]=n},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a,s,r=n(15),o=i(r),l=n(5),c=i(l),u=n(6),d=i(u),p=n(19),h=i(p),f=n(18),m=i(f),g=n(8),v=i(g),y=n(44),E=n(155),_=i(E),b=n(1403),C=i(b),M=n(10),S=i(M),T=n(1368),w=i(T),k=n(1362),P=i(k),N=n(231),x=i(N),D=n(472),O=i(D),R=n(157),I=i(R),A=n(109),L=i(A),F=(0,P["default"])((s=a=function(e){function t(){var e,n,i,a;(0,c["default"])(this,t);for(var s=arguments.length,r=Array(s),l=0;l<s;l++)r[l]=arguments[l];return n=i=(0,h["default"])(this,(e=(0,o["default"])(t)).call.apply(e,[this].concat(r))),i.handleFullscreen=function(){var e=i.props.onFullscreen;e&&e(i.getCurrentTime())},a=n,(0,h["default"])(i,a)}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"getMsg",value:function(){return Store.Msg.get(this.props.msg.id)}},{key:"isResolved",value:function(e){return e.media.mediaStage===x["default"].STAGE.RESOLVED}},{key:"getCurrentTime",value:function(){var e=(0,y.findDOMNode)(this.refs.player);return e.currentTime}},{key:"getMediaDimensions",value:function(){var e=this.props.media,t=O["default"].boundHeightWidth(10*e.thumbHeight,10*e.thumbWidth,240,240);return{width:t.width,height:t.height}}},{key:"renderMedia",value:function(){if(this.isResolved(this.props))return v["default"].createElement(C["default"],{msg:this.getMsg(),autoPlay:!0,className:"media-viewer-img",ref:"player",startTime:this.props.startTime},I["default"].t("video_playback_not_supported"));var e=this.props.media.preview;return e?v["default"].createElement("div",null,v["default"].createElement(_["default"],{size:50,stroke:3}),v["default"].createElement("img",{src:e.url()})):null}},{key:"render",value:function(){return v["default"].createElement("div",{className:"video-floater"},v["default"].createElement("button",{className:"video-floater-close",onClick:this.props.onClose},I["default"].t("web_close")),v["default"].createElement("button",{className:"video-floater-fullscreen",onClick:this.handleFullscreen},v["default"].createElement("i",{className:"icon icon-search-light"})),v["default"].createElement("div",{className:"video-floater-media",style:this.getMediaDimensions()},this.renderMedia()))}}]),t}(g.Component),a.CONCERNS={msg:["id"],media:["mediaStage","thumbWidth","thumbHeight","preview"]},s));F.displayName="VideoPlayer";var U=function(e){function t(){var e,n,i,a;(0,c["default"])(this,t);for(var s=arguments.length,r=Array(s),l=0;l<s;l++)r[l]=arguments[l];return n=i=(0,h["default"])(this,(e=(0,o["default"])(t)).call.apply(e,[this].concat(r))),i.state={msg:null,zoomNode:null,startTime:null},i.handleMediaRequest=function(e,t,n){e.forceDownloadMedia(),i.setState({msg:e,zoomNode:t,startTime:n})},i.handleClose=function(){i.setState({msg:null,zoomNode:null,startTime:null})},i.handleFullscreen=function(e){i.handleClose(),S["default"].mediaViewerModal(i.state.msg,i.state.zoomNode,e)},a=n,(0,h["default"])(i,a)}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"componentDidMount",value:function(){this.props.listeners.add(S["default"],"media_viewer_modal",this.handleClose),this.props.listeners.add(S["default"],"video_player_floater",this.handleMediaRequest)}},{key:"renderVideoPlayer",value:function(){return this.state.msg?v["default"].createElement(F,{key:this.state.msg.id,msg:this.state.msg,media:this.state.msg.mediaData,startTime:this.state.startTime,onClose:this.handleClose,onFullscreen:this.handleFullscreen}):null}},{key:"render",value:function(){return v["default"].createElement(L["default"],{transitionName:"pop"},this.renderVideoPlayer())}}]),t}(g.Component);t["default"]=(0,w["default"])(U)},function(e,t,n){e.exports=n.p+"img/600127bdb5f7627ede5cd4ef320f55b0.png"},function(e,t){e.exports={1:["1⃣","🕐","🕜"],2:["2⃣","🕑","🕝"],3:["🕒","🕞"],4:["4⃣","🍀","🕓","🕟"],5:["5⃣","🕔","🕠"],6:["6⃣","🕕","🕡"],7:["7⃣","🕖","🕢"],8:["8⃣","🎱","🕗","🕣"],9:["9⃣","🕘","🕤"],10:["🕙","🕥"],11:["🕚","🕦"],12:["🕛","🕧"],18:["🔞"],24:["🏪"],30:["🕜","🕝","🕞","🕟","🕠","🕡","🕢","🕣","🕤","🕥","🕦","🕧"],100:["💯"],143:["💏","💑","💓","💕","💖","💗","💘","💙","💚","💛","💜","💝","💞","💟","😍","😗","😘","😙","😚"],1234:["🔢"],hash:["#⃣"],hashtag:["#⃣"],pound:["#⃣","👊","💷"],keycap:["#️⃣","*️⃣","0️⃣","1️⃣","2️⃣","3️⃣","4️⃣","5️⃣","6️⃣","7️⃣","8️⃣","9️⃣"],one:["1⃣","🕐","🕜"],two:["2⃣","🕑","🕝"],four:["4⃣","🍀","🕓","🕟"],five:["5⃣","✋","🕔","🕠","🙏"],six:["6⃣","🕕","🕡"],seven:["7⃣","🕖","🕢"],eight:["8⃣","🎱","🕗","🕣"],nine:["9⃣","🕘","🕤"],copyright:["©"],registered:["®"],exclamation:["‼","⁉","❕","❗","❣"],mark:["‼","⁉","™","❓","❕","❗","❣","〽","📑","🔖","🔛"],punctuation:["‼","⁉","❓","❔","❕","❗","❣","〰"],"double exclamation mark":["‼"],bangbang:["‼"],question:["⁉","❓","❔","🙋"],"exclamation question mark":["⁉"],interrobang:["⁉"],tm:["™"],trademark:["™"],"trade mark":["™"],information:["ℹ","💁"],i:["ℹ"],arrow:["↔","↕","↖","↗","↘","↙","↩","↪","⏩","⏪","⏫","⏬","⏭","⏮","⏯","▶","◀","➡","⤴","⤵","⬅","⬆","⬇","🏹","💘","📩","📲","🔀","🔁","🔂","🔃","🔄","🔙","🔚","🔛","🔜","🔝","🔼","🔽"],"left-right arrow":["↔"],"up-down arrow":["↕"],northwest:["↖"],direction:["↖","↗","↘","↙","➡","⬅","⬆","⬇"],intercardinal:["↖","↗","↘","↙"],"up-left arrow":["↖"],northeast:["↗"],"up-right arrow":["↗"],"down-right arrow":["↘"],southeast:["↘"],"down-left arrow":["↙"],southwest:["↙"],"right arrow curving left":["↩"],"left arrow curving right":["↪"],clock:["⌚","⏰","⏱","⏲","🕐","🕑","🕒","🕓","🕔","🕕","🕖","🕗","🕘","🕙","🕚","🕛","🕜","🕝","🕞","🕟","🕠","🕡","🕢","🕣","🕤","🕥","🕦","🕧","🕰"],time:["⌚","⌛","⏰"],watch:["⌚"],hourglass:["⌛","⏳"],sand:["⌛","⏳"],timer:["⌛","⏲","⏳"],computer:["⌨","💻","💽","💾","💿","📀","🖥","🖨","🖱","🖲","👨‍💻","👩‍💻"],keyboard:["⌨","🎹"],fast:["⏩","🏃","👟","💨"],"fast-forward button":["⏩"],"double":["⏩","⏪","⏫","⏬","⏸","➿"],forward:["⏩"],rewind:["⏪","🔄"],"fast reverse button":["⏪"],"fast up button":["⏫"],down:["⏬","⤵","⬇","👇","👎","📉","📩","🔻","🔽"],"fast down button":["⏬"],triangle:["⏭","⏮","⏯","▶","◀","📐"],"next track button":["⏭"],"next scene":["⏭"],nexttrack:["⏭"],"last track button":["⏮"],"previous scene":["⏮"],"previous track":["⏮"],play:["⏯","▶"],right:["⏯","▶","👉"],"play or pause button":["⏯"],pause:["⏯","⏸"],alarm:["⏰"],hours:["⏰","⏳"],hrs:["⏰"],late:["⏰"],waiting:["⏰","⏳"],"alarm clock":["⏰"],stopwatch:["⏱"],"timer clock":["⏲"],yolo:["⏳","🎆","💀","😜","😝"],"hourglass with flowing sand":["⏳"],"pause button":["⏸"],stop:["⏹","✋","🖐","🚏","🛑"],"stop button":["⏹"],square:["⏹","▪","▫","◻","◼","◽","◾","⬛","⬜","🔲","🔳"],record:["⏺","🎥"],"record button":["⏺"],circle:["⏺","Ⓜ","⚪","⚫","⭕","🔴","🔵"],"circled M":["Ⓜ"],m:["Ⓜ"],"black small square":["▪"],geometric:["▪","▫","◻","◼","◽","◾","⚪","⚫","⬛","⬜","💠","🔘","🔲","🔳","🔴","🔵","🔶","🔷","🔸","🔹","🔺","🔻"],"white small square":["▫"],"play button":["▶"],"reverse button":["◀"],left:["◀","👈"],reverse:["◀"],"white medium square":["◻"],"black medium square":["◼"],"white medium-small square":["◽"],"black medium-small square":["◾"],bright:["☀","🌝","🌞","🔆","😎"],rays:["☀"],space:["☀","☄","🌌","🌑","🌒","🌓","🌔","🌕","🌖","🌗","🌘","🌙","🌚","🌛","🌠","👽","👾","🚀","🛰","👨‍🚀","👩‍🚀"],sun:["☀","⛅","⛱","🌄","🌅","🌆","🌇","🌞","🌤","🌥","🌦","🌻","😎"],sunny:["☀","🌞"],weather:["☀","☁","☔","⛅","❄","🌀","🌈","🌞","🌡","🌤","🌥","🌦","🌧","🌨","🌩","🌪","🌫","💧"],cloud:["☁","⛅","⛈","🌤","🌥","🌦","🌧","🌨","🌩","🌪","🌫","🌬","💨","💭"],rain:["☂","☔","⛈","⛱","🌂","🌦","🌧"],umbrella:["☂","☔","⛱","🌂","🏖"],cold:["☃","⛄","❄","🌨","🏔","💧","😅","😓","😰","😷"],snow:["☃","⛄","⛷","❄","🌨","🎿","🏂","🏔"],snowman:["☃","⛄"],comet:["☄"],phone:["☎","📞","📱","📲","📳","📴","📵","📶","🤳"],telephone:["☎","📞","📱","📲","📳","📴","📵","📶"],ballot:["☑","🗳"],box:["☑","🍱","🎁","📤","📥","📦","🗃","🗳"],check:["☑","✅","✔"],"checked off":["☑"],done:["☑","✅","✔"],drop:["☔","💧"],"umbrella with rain drops":["☔"],caffeine:["☕"],coffee:["☕"],drink:["☕","🍵","🍶","🍷","🍸","🍹","🍼","🍾","🥛","🥂"],hot:["☕","♨","🌶","💣","🔥","😳"],morning:["☕","🌄","🌅","💖","😘"],starbucks:["☕"],steaming:["☕","♨","🍜"],tea:["☕","🍵"],"hot beverage":["☕"],beverage:["☕","🍵","🍷"],plant:["☘","🌱","🌴","🌵","🌷","🌸","🌹","🌺","🌻","🌼","🌾","🌿","🍀","🎍","🏵","💐"],shamrock:["☘"],irish:["☘","🍀"],hand:["☝","✊","✋","✌","✍","👆","👇","👈","👉","👊","👋","👌","👍","👎","👏","👐","👬","👭","💁","🖐","🖕","🖖","🙅","🙆","🙋","🙌","🙏","🤘","🤞","🤙","🤝"],index:["☝","👆","👇","👈","👉","📇","🗂"],finger:["☝","👆","👇","👈","👉","🖐","🖕","🖖","🤘","🤞"],point:["☝","👆","👇","👈","👉"],"index pointing up":["☝"],up:["☝","🆙","👆","👍","🔝"],death:["☠","⚰","⚱","💀"],dead:["☠","💀","😐","😑","😳","😵"],monster:["☠","👹","👺","👻","👽","👾","💀","💩","🤖"],skull:["☠","💀"],"skull and crossbones":["☠"],crossbones:["☠"],radioactive:["☢"],sign:["☢","☣","🛑"],biohazard:["☣"],christian:["☦","✝"],religion:["☦","☪","☯","☸","⛩","⛪","✝","✡","📿","🕉","🕋","🕌","🕍","🕎","🛐"],cross:["☦","⛑","⛪","✝","🎌","🤞"],"orthodox cross":["☦"],Christian:["☦","⛪","✝"],islam:["☪","🕋","🕌"],Muslim:["☪","🕋","🕌"],"star and crescent":["☪"],healing:["☮"],peace:["☮","✌","🕊","😌"],peaceful:["☮","😇"],"peace symbol":["☮"],difficult:["☯"],lives:["☯"],neither:["☯"],tao:["☯"],taoist:["☯"],total:["☯"],yang:["☯"],yin:["☯"],"yin yang":["☯"],buddhist:["☸"],dharma:["☸"],wheel:["☸","🎡"],"wheel of dharma":["☸"],Buddhist:["☸"],face:["☹","☺","⛑","🌚","🌛","🌜","🌝","🌞","🌬","🐭","🐮","🐯","🐰","🐱","🐲","🐳","🐴","🐵","🐶","🐷","🐸","🐹","🐺","🐻","🐼","🐽","👀","👹","👺","👻","👼","👽","👾","👿","💀","💆","💩","🗣","🗿","😀","😁","😂","😃","😄","😅","😆","😇","😈","😉","😊","😋","😌","😍","😎","😏","😐","😑","😒","😓","😔","😕","😖","😗","😘","😙","😚","😛","😜","😝","😞","😟","😠","😡","😢","😣","😤","😥","😦","😧","😨","😩","😪","😫","😬","😭","😮","😯","😰","😱","😲","😳","😴","😵","😶","😷","😸","😹","😺","😻","😼","😽","😾","😿","🙀","🙁","🙂","🙃","🙄","🙈","🙉","🙊","🤐","🤑","🤒","🤓","🤔","🤕","🤖","🤗","🦁","🦄","🤣","🤤","🤠","🤡","🤥","🤢","🤧","🦊"],frown:["☹","😕","😦","🙁","🙍"],"frowning face":["☹"],sad:["☹","💔","💧","😓","😕","😖","😞","😟","😢","😥","😩","😪","😫","😭","😿","🙁"],relaxed:["☺","😎"],smile:["☺","😀","😁","😃","😄","😅","😆","😇","😈","😊","😋","😍","😎","😙","😬","😸","😺","😻","😼","🙂"],smiling:["☺","😀","😁","😃","😄","😆","😇","😊","😋","😬","🙂"],"smiling face":["☺"],outlined:["☺","❔","❕","🔳"],happy:["☺","😀","😁","😂","😃","😄","😆","😇","🙂","🙋"],ram:["♈","🐏"],zodiac:["♈","♉","♊","♋","♌","♍","♎","♏","♐","♑","♒","♓","⚖","⛎","🏹","🏺","🐂","🐍","🐏","🐐","🐟","👬","🦀","🦁","🦂"],Aries:["♈","🐏"],bull:["♉","🎯","🐂"],ox:["♉","🐂"],Taurus:["♉","🐂"],Gemini:["♊","👬"],twins:["♊","👬"],crab:["♋","🦀"],Cancer:["♋","🦀"],Leo:["♌","🦁"],lion:["♌","🦁"],Virgo:["♍"],justice:["♎","⚖"],scales:["♎","⚖"],balance:["♎","⚖"],Libra:["♎","⚖"],scorpion:["♏","🦂"],scorpio:["♏","🦂"],Scorpius:["♏","🦂"],archer:["♐","🏹"],Sagittarius:["♐","🏹"],capricorn:["♑","🐐"],goat:["♑","🐐"],Capricorn:["♑","🐐"],aquarius:["♒"],water:["♒","🌊","🐃","💧","🚰","🚱","🚾","🚿"],bearer:["♒","⛎","🐍"],Aquarius:["♒","🏺"],fish:["♓","🍥","🎣","🐟","🐠","🐡","🦈"],Pisces:["♓","🐟"],game:["♠","♣","♥","♦","🀄","🃏","🎮","🎯","🎰","🎱","🎲","🎳","🎴","🏁","🏏","🏐","🏑","🏒","🏓","🏸","👾","🕹"],spade:["♠"],"spade suit":["♠"],card:["♠","♣","♥","♦","🃏","🎴","💳","📇","🗂","🗃"],club:["♣","🍷","🍸","🍹"],clubs:["♣"],"club suit":["♣"],emotion:["♥","❤","💋","💓","💔","💕","💖","💗","💘","💙","💚","💛","💜","💝","💞","💟"],heart:["♥","❤","💋","💌","💏","💑","💓","💕","💖","💗","💘","💙","💚","💛","💜","💝","💞","💟","😍","😘","😻","🖤"],hearts:["♥","💕","😍"],"heart suit":["♥"],"diamond suit":["♦"],diamond:["♦","💍","💎","💠","🔶","🔷","🔸","🔹"],hotsprings:["♨"],springs:["♨"],"hot springs":["♨"],recycle:["♻"],"recycling symbol":["♻"],wheelchair:["♿"],"wheelchair symbol":["♿"],access:["♿"],handicap:["♿"],hammer:["⚒","⛏","🔨","🛠"],tool:["⚒","⚓","⚖","⚗","⚙","⛏","✂","🏹","🏺","💉","🔍","🔎","🔥","🔦","🔧","🔨","🔩","🔪","🔫","🔬","🔭","🔮","🔰","🔱","🗜","🛠"],pick:["⚒","⛏"],"hammer and pick":["⚒"],anchor:["⚓","🔱"],ship:["⚓","🔱","🚢","🛳"],crossed:["⚔","🎌","🔀"],weapon:["⚔","🏹","🏺","🔪","🔫","🗡","🛡"],"crossed swords":["⚔"],swords:["⚔"],weight:["⚖","🏋"],"balance scale":["⚖"],alembic:["⚗"],chemistry:["⚗"],gear:["⚙"],atheist:["⚛"],atom:["⚛"],"atom symbol":["⚛"],"fleur-de-lis":["⚜"],knights:["⚜","🐉"],warning:["⚠"],caution:["⚠"],danger:["⚡"],electric:["⚡","💡","🔌","🔦","🚃"],electricity:["⚡","🔌"],lightning:["⚡","🌩"],messenger:["⚡"],nature:["⚡","🌅","🌈","🌊","🌋","🌵","🐌","🐝","🐞","💧","🗻"],voltage:["⚡"],zap:["⚡"],"high voltage":["⚡"],thunder:["⚡","⛈"],"white circle":["⚪"],"black circle":["⚫"],coffin:["⚰"],vampire:["⚰","🦇"],funeral:["⚱"],urn:["⚱"],"funeral urn":["⚱"],ashes:["⚱"],ball:["⚽","⚾","⛹","🍙","🎊","🎱","🎳","🎾","🏀","🏈","🏉","🏌","🏏","🏐","🏑","🏓","🔮"],football:["⚽","🏈","🏉"],futbol:["⚽"],messi:["⚽"],ronaldo:["⚽"],soccer:["⚽"],sport:["⚽","⚾","⛳","🎣","🎳","🎾","🎿","🏀","🏁","🏂","🏄","🏆","🏇","🏈","🏉","🏊","🚴","🚵"],"soccer ball":["⚽"],baseball:["⚾"],"snowman without snow":["⛄"],cloudy:["⛅"],"cloud with lightning and rain":["⛈"],thunderstorm:["⛈"],serpent:["⛎","🐍"],snake:["⛎","🐍"],Ophiuchus:["⛎","🐍"],mining:["⛏"],hat:["⛑","🎓","🎩","👒","👲","👷","🤠"],helmet:["⛑","👷","💂"],"rescue worker’s helmet":["⛑"],aid:["⛑"],chains:["⛓"],chain:["⛓"],"do not pass":["⛔"],fail:["⛔","😞","😩"],forbidden:["⛔","📵","🔕","🔞","🙅","🙈","🙉","🙊","🚫","🚭","🚯","🚳","🚷"],no:["⛔","👎","📵","🔕","🔞","😔","🙅","🙈","🙉","🙊","🚫","🚭","🚯","🚳","🚷"],prohibited:["⛔","📵","🔕","🔞","🙅","🙈","🙉","🙊","🚫","🚭","🚯","🚱","🚳","🚷"],traffic:["⛔","🚥","🚦","🚸"],"no entry":["⛔"],"shinto shrine":["⛩"],shinto:["⛩"],shrine:["⛩"],bless:["⛪"],chapel:["⛪","💒"],church:["⛪","👼"],mountain:["⛰","🌄","🌋","🏔","🗻","🚞","🚠","🚵"],
"umbrella on ground":["⛱"],fountain:["⛲","🖋"],golf:["⛳","🏌","🚩"],hole:["⛳","🕳"],"flag in hole":["⛳"],boat:["⛴","⛵","🚢","🚣","🚤","🛥","🛶"],passenger:["⛴","🚢","🛳"],ferry:["⛴"],sailboat:["⛵"],sailing:["⛵"],yacht:["⛵"],ski:["⛷","🎿","🏂"],skier:["⛷"],ice:["⛸","🍧","🍨","🏒"],"ice skate":["⛸"],skate:["⛸"],skating:["⛸"],"ice skating":["⛸"],"person bouncing ball":["⛹"],basketball:["⛹","🏀"],"basketball player":["⛹"],camping:["⛺","🏕"],tent:["⛺","🎪"],fuel:["⛽"],gas:["⛽"],gasoline:["⛽"],pump:["⛽"],"gas station":["⛽"],"fuel pump":["⛽"],cut:["✂"],paper:["✂","📜","📰","🗞"],scissors:["✂"],cutting:["✂"],checked:["✅","✔","🛄"],complete:["✅"],completed:["✅"],fixed:["✅"],checkmark:["✅","✔"],airplane:["✈","🛩","🛫","🛬"],fly:["✈","💸","🕊","😎","😎"],flying:["✈"],jet:["✈"],plane:["✈","🛄","🛩","🛫","🛬"],travel:["✈","🗿","🚀","🚁","🚂","🚃","🚅","🚇","🚢","🚤","🛄"],"e-mail":["✉","📧","📨","📩"],email:["✉","📤","📥","📧","📨","📩"],envelope:["✉","📨","📩"],letter:["✉","💌","📤","📥","📧","📨","📩"],clenched:["✊","👊"],fist:["✊","👊","🤛","🤜"],solidarity:["✊"],"raised fist":["✊"],"high five":["✋","🙏"],"raised hand":["✋"],"victory hand":["✌"],v:["✌"],victory:["✌","🏆"],"writing hand":["✍"],write:["✍"],pencil:["✏","📝"],"black nib":["✒"],nib:["✒","🔏"],pen:["✒","🔏","🖊","🖋"],"heavy check mark":["✔"],multiplication:["✖","❌","❎"],multiply:["✖","❌","❎"],x:["✖","❌","❎"],christ:["✝"],"latin cross":["✝"],david:["✡"],star:["✡","✨","✴","⭐","🌃","🌟","🌠","💫","🔯","👨‍🎤","👩‍🎤"],Jewish:["✡","🕍"],"star of David":["✡"],magic:["✨","🔮"],sparkle:["✨","❇","🌟","🎇","💖"],sparkles:["✨"],"eight-spoked asterisk":["✳"],asterisk:["✳"],"eight-pointed star":["✴"],snowflake:["❄"],"cross mark button":["❎"],"?":["❓","❔"],"question mark":["❓","❔"],"white question mark":["❔"],"!":["❕","❗"],"white exclamation mark":["❕"],"exclamation mark":["❗"],"heavy heart exclamation":["❣"],"red heart":["❤"],math:["➕","➖","➗","📏","📐"],plus:["➕"],"heavy plus sign":["➕"],minus:["➖"],"heavy minus sign":["➖"],division:["➗"],"heavy division sign":["➗"],east:["➡"],cardinal:["➡","⬅","⬆","⬇"],"right arrow":["➡"],curl:["➰","➿","📃"],"curly loop":["➰"],loop:["➰","➿"],"double curly loop":["➿"],"right arrow curving up":["⤴"],"right arrow curving down":["⤵"],"left arrow":["⬅"],west:["⬅"],north:["⬆"],"up arrow":["⬆"],"down arrow":["⬇"],south:["⬇"],"black large square":["⬛"],"white large square":["⬜"],astronomy:["⭐"],stars:["⭐","💫"],"white medium star":["⭐"],"heavy large circle":["⭕"],o:["⭕","🅾"],wavy:["〰"],dash:["〰","💨"],"wavy dash":["〰"],"part alternation mark":["〽"],part:["〽"],Japanese:["㊗","㊙","🈁","🈂","🈚","🈯","🈲","🈳","🈴","🈵","🈶","🈷","🈸","🈹","🈺","🉐","🉑","🍙","🍡","🎋","🎌","🎍","🎎","🎴","🏣","🏮","🏯","👹","👺","🔰"],ideograph:["㊗","㊙","🈚","🈯","🈲","🈳","🈴","🈵","🈶","🈷","🈸","🈹","🈺","🉐","🉑"],"Japanese “congratulations” button":["㊗"],"“congratulations”":["㊗"],"祝":["㊗"],"Japanese “secret” button":["㊙"],"“secret”":["㊙"],"秘":["㊙"],red:["🀄","🌹","🍎","🏮","🔴","🔺","🔻","🔼","🔽","😡"],"mahjong red dragon":["🀄"],mahjong:["🀄"],joker:["🃏"],wildcard:["🃏"],a:["🅰"],"blood type":["🅰","🅱","🅾","🆎"],"B button":["🅱"],b:["🅱"],"O button":["🅾"],parking:["🅿"],p:["🅿"],"P button":["🅿"],"AB button":["🆎"],ab:["🆎"],"CL button":["🆑"],cl:["🆑"],cool:["🆒","😎","😎","😛"],"COOL button":["🆒"],free:["🆓"],"FREE button":["🆓"],"ID button":["🆔"],id:["🆔"],identity:["🆔"],"new":["🆕"],"NEW button":["🆕"],ng:["🆖"],"NG button":["🆖"],ok:["🆗","👌"],okay:["🆗","👌","👍"],OK:["🆗","👌","🙆"],"OK button":["🆗"],help:["🆘","💁"],"SOS button":["🆘"],sos:["🆘"],"UP! button":["🆙"],versus:["🆚"],"VS button":["🆚"],vs:["🆚"],flag:["🇦🇩","🇦🇪","🇦🇫","🇦🇬","🇦🇮","🇦🇱","🇦🇲","🇦🇴","🇦🇶","🇦🇷","🇦🇸","🇦🇹","🇦🇺","🇦🇼","🇦🇽","🇦🇿","🇧🇦","🇧🇧","🇧🇩","🇧🇪","🇧🇫","🇧🇬","🇧🇭","🇧🇮","🇧🇯","🇧🇱","🇧🇲","🇧🇳","🇧🇴","🇧🇶","🇧🇷","🇧🇸","🇧🇹","🇧🇼","🇧🇾","🇧🇿","🇨🇦","🇨🇨","🇨🇩","🇨🇫","🇨🇬","🇨🇭","🇨🇮","🇨🇰","🇨🇱","🇨🇲","🇨🇳","🇨🇴","🇨🇷","🇨🇺","🇨🇻","🇨🇼","🇨🇽","🇨🇾","🇨🇿","🇩🇪","🇩🇯","🇩🇰","🇩🇲","🇩🇴","🇩🇿","🇪🇨","🇪🇪","🇪🇬","🇪🇭","🇪🇷","🇪🇸","🇪🇹","🇪🇺","🇫🇮","🇫🇯","🇫🇰","🇫🇲","🇫🇴","🇫🇷","🇬🇦","🇬🇧","🇬🇩","🇬🇪","🇬🇫","🇬🇬","🇬🇭","🇬🇮","🇬🇱","🇬🇲","🇬🇳","🇬🇵","🇬🇶","🇬🇷","🇬🇸","🇬🇹","🇬🇺","🇬🇼","🇬🇾","🇭🇰","🇭🇳","🇭🇷","🇭🇹","🇭🇺","🇮🇨","🇮🇩","🇮🇪","🇮🇱","🇮🇲","🇮🇳","🇮🇴","🇮🇶","🇮🇷","🇮🇸","🇮🇹","🇯🇪","🇯🇲","🇯🇴","🇯🇵","🇰🇪","🇰🇬","🇰🇭","🇰🇮","🇰🇲","🇰🇳","🇰🇵","🇰🇷","🇰🇼","🇰🇾","🇰🇿","🇱🇦","🇱🇧","🇱🇨","🇱🇮","🇱🇰","🇱🇷","🇱🇸","🇱🇹","🇱🇺","🇱🇻","🇱🇾","🇲🇦","🇲🇨","🇲🇩","🇲🇪","🇲🇬","🇲🇭","🇲🇰","🇲🇱","🇲🇲","🇲🇳","🇲🇴","🇲🇵","🇲🇶","🇲🇷","🇲🇸","🇲🇹","🇲🇺","🇲🇻","🇲🇼","🇲🇽","🇲🇾","🇲🇿","🇳🇦","🇳🇨","🇳🇪","🇳🇫","🇳🇬","🇳🇮","🇳🇱","🇳🇴","🇳🇵","🇳🇷","🇳🇺","🇳🇿","🇴🇲","🇵🇦","🇵🇪","🇵🇫","🇵🇬","🇵🇭","🇵🇰","🇵🇱","🇵🇲","🇵🇳","🇵🇷","🇵🇸","🇵🇹","🇵🇼","🇵🇾","🇶🇦","🇷🇪","🇷🇴","🇷🇸","🇷🇺","🇷🇼","🇸🇦","🇸🇧","🇸🇨","🇸🇩","🇸🇪","🇸🇬","🇸🇭","🇸🇮","🇸🇰","🇸🇱","🇸🇲","🇸🇳","🇸🇴","🇸🇷","🇸🇸","🇸🇹","🇸🇻","🇸🇽","🇸🇾","🇸🇿","🇹🇨","🇹🇩","🇹🇫","🇹🇬","🇹🇭","🇹🇯","🇹🇰","🇹🇱","🇹🇲","🇹🇳","🇹🇴","🇹🇷","🇹🇹","🇹🇻","🇹🇼","🇹🇿","🇺🇦","🇺🇬","🇺🇸","🇺🇾","🇺🇿","🇻🇦","🇻🇨","🇻🇪","🇻🇬","🇻🇮","🇻🇳","🇻🇺","🇼🇫","🇼🇸","🇽🇰","🇾🇪","🇾🇹","🇿🇦","🇿🇲","🇿🇼","🏁","🚩"],Andorra:["🇦🇩"],"United Arab Emirates":["🇦🇪"],Afghanistan:["🇦🇫"],"Antigua & Barbuda":["🇦🇬"],Anguilla:["🇦🇮"],Albania:["🇦🇱"],Armenia:["🇦🇲"],Angola:["🇦🇴"],Antarctica:["🇦🇶"],Argentina:["🇦🇷"],"American Samoa":["🇦🇸"],Austria:["🇦🇹"],Australia:["🇦🇺","🌏"],Aruba:["🇦🇼"],"Åland Islands":["🇦🇽"],Azerbaijan:["🇦🇿"],"Bosnia & Herzegovina":["🇧🇦"],Barbados:["🇧🇧"],Bangladesh:["🇧🇩"],Belgium:["🇧🇪"],"Burkina Faso":["🇧🇫"],Bulgaria:["🇧🇬"],Bahrain:["🇧🇭"],Burundi:["🇧🇮"],Benin:["🇧🇯"],"St. Barthélemy":["🇧🇱"],Bermuda:["🇧🇲"],Brunei:["🇧🇳"],Bolivia:["🇧🇴"],"Caribbean Netherlands":["🇧🇶"],Brazil:["🇧🇷"],Bahamas:["🇧🇸"],Bhutan:["🇧🇹"],Botswana:["🇧🇼"],Belarus:["🇧🇾"],Belize:["🇧🇿"],Canada:["🇨🇦"],"Cocos (Keeling) Islands":["🇨🇨"],"Congo Kinshasa":["🇨🇩"],"Central African Republic":["🇨🇫"],"Congo Brazzaville":["🇨🇬"],Switzerland:["🇨🇭"],"Côte d’Ivoire":["🇨🇮"],"Cook Islands":["🇨🇰"],Chile:["🇨🇱"],Cameroon:["🇨🇲"],China:["🇨🇳"],Colombia:["🇨🇴"],"Costa Rica":["🇨🇷"],Cuba:["🇨🇺"],"Cape Verde":["🇨🇻"],"Curaçao":["🇨🇼"],"Christmas Island":["🇨🇽"],Cyprus:["🇨🇾"],"Czech Republic":["🇨🇿"],Germany:["🇩🇪"],Djibouti:["🇩🇯"],Denmark:["🇩🇰"],Dominica:["🇩🇲"],"Dominican Republic":["🇩🇴"],Algeria:["🇩🇿"],Ecuador:["🇪🇨"],Estonia:["🇪🇪"],Egypt:["🇪🇬"],"Western Sahara":["🇪🇭"],Eritrea:["🇪🇷"],Spain:["🇪🇸"],Ethiopia:["🇪🇹"],"European Union":["🇪🇺"],Finland:["🇫🇮"],Fiji:["🇫🇯"],"Falkland Islands":["🇫🇰"],Micronesia:["🇫🇲"],"Faroe Islands":["🇫🇴"],France:["🇫🇷"],Gabon:["🇬🇦"],"United Kingdom":["🇬🇧"],Grenada:["🇬🇩"],Georgia:["🇬🇪"],"French Guiana":["🇬🇫"],Guernsey:["🇬🇬"],Ghana:["🇬🇭"],Gibraltar:["🇬🇮"],Greenland:["🇬🇱"],Gambia:["🇬🇲"],Guinea:["🇬🇳"],Guadeloupe:["🇬🇵"],"Equatorial Guinea":["🇬🇶"],Greece:["🇬🇷"],"South Georgia & South Sandwich Islands":["🇬🇸"],Guatemala:["🇬🇹"],Guam:["🇬🇺"],"Guinea-Bissau":["🇬🇼"],Guyana:["🇬🇾"],"Hong Kong SAR China":["🇭🇰"],Honduras:["🇭🇳"],Croatia:["🇭🇷"],Haiti:["🇭🇹"],Hungary:["🇭🇺"],"Canary Islands":["🇮🇨"],Indonesia:["🇮🇩"],Ireland:["🇮🇪"],Israel:["🇮🇱"],"Isle of Man":["🇮🇲"],India:["🇮🇳"],"British Indian Ocean Territory":["🇮🇴"],Iraq:["🇮🇶"],Iran:["🇮🇷"],Iceland:["🇮🇸"],Italy:["🇮🇹"],Jersey:["🇯🇪"],Jamaica:["🇯🇲"],Jordan:["🇯🇴"],Japan:["🇯🇵","🗾"],Kenya:["🇰🇪"],Kyrgyzstan:["🇰🇬"],Cambodia:["🇰🇭"],Kiribati:["🇰🇮"],Comoros:["🇰🇲"],"St. Kitts & Nevis":["🇰🇳"],"North Korea":["🇰🇵"],"South Korea":["🇰🇷"],Kuwait:["🇰🇼"],"Cayman Islands":["🇰🇾"],Kazakhstan:["🇰🇿"],Laos:["🇱🇦"],Lebanon:["🇱🇧"],"St. Lucia":["🇱🇨"],Liechtenstein:["🇱🇮"],"Sri Lanka":["🇱🇰"],Liberia:["🇱🇷"],Lesotho:["🇱🇸"],Lithuania:["🇱🇹"],Luxembourg:["🇱🇺"],Latvia:["🇱🇻"],Libya:["🇱🇾"],Morocco:["🇲🇦"],Monaco:["🇲🇨"],Moldova:["🇲🇩"],Montenegro:["🇲🇪"],Madagascar:["🇲🇬"],"Marshall Islands":["🇲🇭"],Macedonia:["🇲🇰"],Mali:["🇲🇱"],"Myanmar (Burma)":["🇲🇲"],Mongolia:["🇲🇳"],"Macau SAR China":["🇲🇴"],"Northern Mariana Islands":["🇲🇵"],Martinique:["🇲🇶"],Mauritania:["🇲🇷"],Montserrat:["🇲🇸"],Malta:["🇲🇹"],Mauritius:["🇲🇺"],Maldives:["🇲🇻"],Malawi:["🇲🇼"],Mexico:["🇲🇽"],Malaysia:["🇲🇾"],Mozambique:["🇲🇿"],Namibia:["🇳🇦"],"New Caledonia":["🇳🇨"],Niger:["🇳🇪"],"Norfolk Island":["🇳🇫"],Nigeria:["🇳🇬"],Nicaragua:["🇳🇮"],Netherlands:["🇳🇱"],Norway:["🇳🇴"],Nepal:["🇳🇵"],Nauru:["🇳🇷"],Niue:["🇳🇺"],"New Zealand":["🇳🇿"],Oman:["🇴🇲"],Panama:["🇵🇦"],Peru:["🇵🇪"],"French Polynesia":["🇵🇫"],"Papua New Guinea":["🇵🇬"],Philippines:["🇵🇭"],Pakistan:["🇵🇰"],Poland:["🇵🇱"],"St. Pierre & Miquelon":["🇵🇲"],"Pitcairn Islands":["🇵🇳"],"Puerto Rico":["🇵🇷"],"Palestinian Territories":["🇵🇸"],Palestine:["🇵🇸"],Portugal:["🇵🇹"],Palau:["🇵🇼"],Paraguay:["🇵🇾"],Qatar:["🇶🇦"],"Réunion":["🇷🇪"],Romania:["🇷🇴"],Serbia:["🇷🇸"],Russia:["🇷🇺"],Rwanda:["🇷🇼"],"Saudi Arabia":["🇸🇦"],"Solomon Islands":["🇸🇧"],Seychelles:["🇸🇨"],Sudan:["🇸🇩"],Sweden:["🇸🇪"],Singapore:["🇸🇬"],"St. Helena":["🇸🇭"],Slovenia:["🇸🇮"],Slovakia:["🇸🇰"],"Sierra Leone":["🇸🇱"],"San Marino":["🇸🇲"],Senegal:["🇸🇳"],Somalia:["🇸🇴"],Suriname:["🇸🇷"],"South Sudan":["🇸🇸"],"São Tomé & Príncipe":["🇸🇹"],"El Salvador":["🇸🇻"],"Sint Maarten":["🇸🇽"],Syria:["🇸🇾"],Swaziland:["🇸🇿"],"Turks & Caicos Islands":["🇹🇨"],Chad:["🇹🇩"],"French Southern Territories":["🇹🇫"],Togo:["🇹🇬"],Thailand:["🇹🇭"],Tajikistan:["🇹🇯"],Tokelau:["🇹🇰"],"Timor-Leste":["🇹🇱"],Turkmenistan:["🇹🇲"],Tunisia:["🇹🇳"],Tonga:["🇹🇴"],Turkey:["🇹🇷"],"Trinidad & Tobago":["🇹🇹"],Tuvalu:["🇹🇻"],Taiwan:["🇹🇼"],Tanzania:["🇹🇿"],Ukraine:["🇺🇦"],Uganda:["🇺🇬"],"United States":["🇺🇸"],Uruguay:["🇺🇾"],Uzbekistan:["🇺🇿"],"Vatican City":["🇻🇦"],"St. Vincent & Grenadines":["🇻🇨"],Venezuela:["🇻🇪"],"British Virgin Islands":["🇻🇬"],"U.S. Virgin Islands":["🇻🇮"],Vietnam:["🇻🇳"],Vanuatu:["🇻🇺"],"Wallis & Futuna":["🇼🇫"],Samoa:["🇼🇸"],Kosovo:["🇽🇰"],Yemen:["🇾🇪"],Mayotte:["🇾🇹"],"South Africa":["🇿🇦"],Zambia:["🇿🇲"],Zimbabwe:["🇿🇼"],"Japanese “here” button":["🈁"],"“here”":["🈁"],katakana:["🈁","🈂"],"ココ":["🈁"],"Japanese “service charge” button":["🈂"],"“service charge”":["🈂"],"サ":["🈂"],"Japanese “free of charge” button":["🈚"],"“free of charge”":["🈚"],"無":["🈚"],"Japanese “reserved” button":["🈯"],"“reserved”":["🈯"],"指":["🈯"],"Japanese “prohibited” button":["🈲"],"“prohibited”":["🈲"],"禁":["🈲"],"Japanese “vacancy” button":["🈳"],"“vacancy”":["🈳"],"空":["🈳"],"Japanese “passing grade” button":["🈴"],"passing grade":["🈴"],"合":["🈴"],"Japanese “no vacancy” button":["🈵"],"no vacancy":["🈵"],"満":["🈵"],"Japanese “not free of charge” button":["🈶"],"not free of charge":["🈶"],"有":["🈶"],"Japanese “monthly amount” button":["🈷"],"monthly amount":["🈷"],"月":["🈷"],"Japanese “application” button":["🈸"],"“application”":["🈸"],"申":["🈸"],"Japanese “discount” button":["🈹"],"“discount”":["🈹"],"割":["🈹"],"Japanese “open for business” button":["🈺"],"open for business":["🈺"],"営":["🈺"],"Japanese “bargain” button":["🉐"],"“bargain”":["🉐"],"得":["🉐"],"Japanese “acceptable” button":["🉑"],"“acceptable”":["🉑"],"可":["🉑"],cyclone:["🌀"],dizzy:["🌀","💫","😵"],twister:["🌀"],typhoon:["🌀"],fog:["🌁","🌫"],foggy:["🌁"],"closed umbrella":["🌂"],night:["🌃","🌉","🌟","🌠","😘","😙"],"night with stars":["🌃"],sunrise:["🌄","🌅"],"sunrise over mountains":["🌄"],building:["🌆","🌇","🏠","🏡","🏢","🏣","🏤","🏥","🏦","🏨","🏩","🏪","🏫","🏬","🏭","🏯","🏰"],city:["🌆","🏙","🏢"],dusk:["🌆","🌇"],evening:["🌆"],sunset:["🌆","🌇"],pride:["🌈"],rainbow:["🌈"],bridge:["🌉"],"bridge at night":["🌉"],ocean:["🌊","🏄","🐋","🐙","🐬","🐳"],surf:["🌊"],surfer:["🌊","🏄"],surfing:["🌊","🏄"],wave:["🌊","👋"],"water wave":["🌊"],eruption:["🌋"],volcano:["🌋"],"milky way":["🌌"],earth:["🌍","🌎","🌏","🌐"],europe:["🌍"],globe:["🌍","🌎","🌏","🌐"],world:["🌍","🌎","🌏","🌐","🗺"],"globe showing Europe-Africa":["🌍"],Africa:["🌍"],Europe:["🌍"],"globe showing Americas":["🌎"],Americas:["🌎"],"globe showing Asia-Australia":["🌏"],Asia:["🌏"],meridians:["🌐"],"globe with meridians":["🌐"],moon:["🌑","🌒","🌓","🌔","🌕","🌖","🌗","🌘","🌙","🌚","🌛","🌜","🌝","🎑"],dark:["🌑","🕶"],"new moon":["🌑"],crescent:["🌒","🌘","🌙"],dreams:["🌒","🌜","💭"],"waxing crescent moon":["🌒"],waxing:["🌒","🌔"],"first quarter moon":["🌓"],quarter:["🌓","🌗","🌛","🌜"],"waxing gibbous moon":["🌔"],gibbous:["🌔","🌖"],full:["🌕","💯","😋"],"full moon":["🌕"],"waning gibbous moon":["🌖"],waning:["🌖","🌘"],"last quarter moon":["🌗"],"waning crescent moon":["🌘"],"crescent moon":["🌙"],"new moon face":["🌚"],"first quarter moon with face":["🌛"],"last quarter moon with face":["🌜"],"full moon with face":["🌝"],beach:["🌞","🌴","🏄","🏖","🐋","🐚","🐬","🐳","👙","😎"],day:["🌞"],heat:["🌞","😳"],shine:["🌞"],sunshine:["🌞"],"sun with face":["🌞"],glittery:["🌟"],glow:["🌟"],shining:["🌟","💫"],win:["🌟","🏁","🏆","👑","💰","😎"],"glowing star":["🌟"],shooting:["🌠"],falling:["🌠","🍁","🍂"],"shooting star":["🌠","💫"],thermometer:["🌡","🤒"],"sun behind small cloud":["🌤"],"sun behind large cloud":["🌥"],"sun behind rain cloud":["🌦"],"cloud with rain":["🌧"],"cloud with snow":["🌨"],"cloud with lightning":["🌩"],tornado:["🌪"],whirlwind:["🌪"],blow:["🌬","🍃"],wind:["🌬","🍃","🎐"],"wind face":["🌬"],"hot dog":["🌭"],frankfurter:["🌭"],hotdog:["🌭"],sausage:["🌭"],taco:["🌮"],mexican:["🌮","🌯"],burrito:["🌯"],wrap:["🌯"],chestnut:["🌰"],almond:["🌰"],sapling:["🌱"],seedling:["🌱"],sprout:["🌱"],young:["🌱","👦","👧","👶"],"christmas tree":["🌲"],evergreen:["🌲"],forest:["🌲","🌳"],"pine tree":["🌲"],tree:["🌲","🌳","🌴","🎄","🎋"],"evergreen tree":["🌲"],deciduous:["🌳"],green:["🌳","🍏","💚","📗","🔰","🥗"],habitat:["🌳"],"deciduous tree":["🌳"],shedding:["🌳"],palm:["🌴"],tropical:["🌴","🍍","🍹","🐠"],"palm tree":["🌴"],cactus:["🌵"],desert:["🌵","🏜","🏝","🐫"],drought:["🌵"],"hot pepper":["🌶"],pepper:["🌶"],blossom:["🌷","🌸","🌼"],flower:["🌷","🌸","🌹","🌺","🌻","🌼","🎴","💐","💮","🥀"],growth:["🌷","💹","📈"],tulip:["🌷"],cherry:["🌸","🍒"],spring:["🌸","🐝"],springtime:["🌸"],"cherry blossom":["🌸"],beauty:["🌹","👄","💇"],elegant:["🌹","💃"],love:["🌹","🏩","💌","💏","💐","💑","💓","💕","💘","💙","💚","💛","💜","😍","😗","😘","😙","😻"],rose:["🌹"],hibiscus:["🌺"],outdoors:["🌻"],sunflower:["🌻"],buttercup:["🌼"],dandelion:["🌼"],corn:["🌽"],crops:["🌽"],farm:["🌽","🐂","🐄","🐎","🐐","🐑","🐖","🐮","🐴","🐷","🐽"],maize:["🌽"],maze:["🌽"],"ear of corn":["🌽"],grain:["🌾","🍞"],grains:["🌾"],rice:["🌾","🍘","🍙","🍚","🍛"],"sheaf of rice":["🌾"],herb:["🌿"],leaf:["🌿","🍀","🍁","🍂","🍃","🔰"],clover:["🍀"],lucky:["🍀"],"four leaf clover":["🍀"],maple:["🍁"],"maple leaf":["🍁"],autumn:["🍂"],fall:["🍂"],"fallen leaf":["🍂"],"leaf fluttering in wind":["🍃"],flutter:["🍃"],fungus:["🍄"],mario:["🍄"],mushroom:["🍄"],toadstool:["🍄"],food:["🍅","🍎","🍔","🍕","🍘","🍙","🍚","🍛","🍜","🍝","🍞","🍟","🍠","🍢","🍣","🍥","🍦","🍨","🍩","🍭","🍯","🍱","🍲","🍴","😋","🦐","🦑","🥝","🥑","🥔","🥕","🥒","🥜","🥐","🥖","🥞","🥓","🥙","🥚","🥘","🥗"],fruit:["🍅","🍇","🍈","🍉","🍊","🍋","🍌","🍍","🍎","🍏","🍐","🍑","🍒","🍓","🥝","🥑"],tomato:["🍅"],vegetable:["🍅","🍆","🥔","🥕","🥒","🥜"],aubergine:["🍆"],eggplant:["🍆"],dionyses:["🍇"],grape:["🍇"],grapes:["🍇"],cantaloupe:["🍈"],melon:["🍈"],watermelon:["🍉"],citrus:["🍊","🍋","🍍"],nectarine:["🍊"],orange:["🍊","📙","🔶","🔸"],tangerine:["🍊"],"vitamin c":["🍊"],lemon:["🍋"],sour:["🍋"],banana:["🍌","🐒","🐵"],potassium:["🍌"],colada:["🍍"],pina:["🍍"],pineapple:["🍍"],apple:["🍎","🍏"],diet:["🍎"],health:["🍎"],ripe:["🍎"],"red apple":["🍎"],"green apple":["🍏"],pear:["🍐"],peach:["🍑"],cherries:["🍒"],berry:["🍓"],strawberry:["🍓"],burger:["🍔"],eat:["🍔","🍴"],"fast food":["🍔","🍟"],hamburger:["🍔"],hungry:["🍔","🍕","🍗","🍴","😋","😩"],pepperoni:["🍕"],pizza:["🍕"],slice:["🍕","🍰"],cheese:["🍕","🧀"],bone:["🍖","🍗"],meat:["🍖","🥓"],"meat on bone":["🍖"],chicken:["🍗","🐔"],poultry:["🍗"],drumstick:["🍗"],turkey:["🍗","🦃"],"poultry leg":["🍗"],leg:["🍗"],"rice cracker":["🍘"],cracker:["🍘"],"rice ball":["🍙"],"cooked rice":["🍚"],curry:["🍛"],"curry rice":["🍛"],bowl:["🍜"],noodle:["🍜"],pho:["🍜"],chopsticks:["🍜"],ramen:["🍜"],"steaming bowl":["🍜"],italian:["🍝"],meatballs:["🍝"],pasta:["🍝"],restaurant:["🍝","🍞","🍢","🍥","🍦","🍧","🍨","🍬","🍭","🍳","🍴","🍶","🍷","🏮"],spaghetti:["🍝"],bread:["🍞","🥐","🥖"],carbs:["🍞"],loaf:["🍞"],toast:["🍞"],wheat:["🍞"],fries:["🍟"],french:["🍟","🥐","🥖"],"french fries":["🍟"],sweet:["🍠","🍡","🍦","🍧","🍨","🍩","🍪","🍫","🍬","🍭","🍮","🍯","🍰","🎂"],potato:["🍠","🥔"],roasted:["🍠"],"roasted sweet potato":["🍠"],dango:["🍡"],dessert:["🍡","🍦","🍧","🍨","🍩","🍪","🍬","🍭","🍮","🍰","🎂"],skewer:["🍡","🍢"],stick:["🍡","🍢","🏑","🏒"],kebab:["🍢","🥙"],oden:["🍢"],seafood:["🍢"],sushi:["🍣"],fried:["🍤"],prawn:["🍤"],shrimp:["🍤","🦐"],tempura:["🍤"],"fried shrimp":["🍤"],cake:["🍥","🍰","🎂"],pastry:["🍥","🍰","🎂"],"fish cake with swirl":["🍥"],swirl:["🍥"],cream:["🍦","🍨"],"ice cream":["🍦","🍨"],"soft serve":["🍦"],"soft ice cream":["🍦"],"shaved ice":["🍧"],shaved:["🍧"],donut:["🍩"],doughnut:["🍩"],cookie:["🍪"],"chocolate chip":["🍪"],bar:["🍫","🍶","🍷","🍸","🍹","🍺","🍻","🍾","🏮","📊","📶"],candy:["🍫","🍬","🍭"],chocolate:["🍫"],halloween:["🍫","🍬","🎃","👻"],"sweet tooth":["🍫","🍬"],"chocolate bar":["🍫"],cavities:["🍬"],wrapper:["🍬"],confectionary:["🍭"],lollipop:["🍭"],"willy wonka":["🍭"],custard:["🍮"],pudding:["🍮"],barrel:["🍯"],bear:["🍯","🐨","🐻"],honey:["🍯","🐝","🐻"],"honey jar":["🍯"],honeypot:["🍯"],jar:["🍯"],pooh:["🍯"],"winnie the pooh":["🍯"],pot:["🍯","🍲"],"honey pot":["🍯"],shortcake:["🍰"],bento:["🍱"],"bento box":["🍱"],stew:["🍲"],"pot of food":["🍲"],breakfast:["🍳","🍴"],cooking:["🍳","🍴","🍽","🏺","🔪"],egg:["🍳","🐣","🥚"],fry:["🍳"],frying:["🍳"],"over easy":["🍳"],pan:["🍳","🥘"],"sunny side up":["🍳"],breaky:["🍴"],dinner:["🍴","🍽","🐟"],feed:["🍴"],fork:["🍴","🍽"],knife:["🍴","🍽","🔪","🗡"],lunch:["🍴"],"fork and knife":["🍴"],oolong:["🍵"],teacup:["🍵"],"teacup without handle":["🍵"],cup:["🍵","🍶"],bottle:["🍶","🍼","🍾"],sake:["🍶"],alcohol:["🍷","🍸","🍹","🍺","🍻"],booze:["🍷","🍸","🍹","🍺","🍻"],drinking:["🍷","🍸","🍹","🍺","🍻","🚰"],drinks:["🍷","🍸","🍹","🍺","🍻"],glass:["🍷","🍸","🔍","🔎","🥛","🥂","🥃"],wine:["🍷"],"wine glass":["🍷"],cocktail:["🍸","🍹"],"mad men":["🍸"],martini:["🍸"],"cocktail glass":["🍸"],drunk:["🍹"],"mai tai":["🍹"],party:["🍹","🎉","🎊","👯","😛","😜"],tropics:["🍹"],"tropical drink":["🍹"],beer:["🍺","🍻"],germany:["🍺"],octoberfest:["🍺"],oktoberfest:["🍺"],pint:["🍺"],stein:["🍺"],"summer ale":["🍺"],"beer mug":["🍺"],"bottoms up":["🍻"],cheers:["🍻"],clink:["🍻","🥂"],"clinking beer mugs":["🍻"],babies:["🍼","👶"],baby:["🍼","🐣","🐤","🐥","👶","👼","🚼"],birth:["🍼"],born:["🍼"],infant:["🍼","👶"],milk:["🍼","🐄","🐐","🐮","🥛"],newborn:["🍼","🐥","👶"],"baby bottle":["🍼"],"fork and knife with plate":["🍽"],plate:["🍽"],"bottle with popping cork":["🍾"],cork:["🍾"],popping:["🍾"],popcorn:["🍿"],movie:["🍿","🎞","🎥","🎦","🎬","📽"],celebration:["🎀","🎁","🎂","🎄","🎅","🎆","🎇","🎈","🎉","🎊","🎋","🎑","🎖","🎗","🙌","🤶"],ribbon:["🎀","🎗","💝"],gift:["🎁"],present:["🎁"],wrapped:["🎁"],"wrapped gift":["🎁"],birthday:["🎂","🎈","🎉","💐"],"birthday cake":["🎂"],jack:["🎃"],pumpkin:["🎃"],lantern:["🎃","🏮"],"jack-o-lantern":["🎃"],christmas:["🎄","🎅"],Christmas:["🎄","🎅","🤶"],"Christmas tree":["🎄"],"fairy tale":["🎅","🐉","🐲","👸","👹","👻","👼","👽","👾","👿","💀","🔮","😇","😈"],fantasy:["🎅","👸","👹","👺","👻","👼","👽","👾","👿","📖","📗","📘","📙","📚","🔮","😇","😈"],santa:["🎅","🤶"],"Santa Claus":["🎅"],claus:["🎅","🤶"],father:["🎅"],boom:["🎆","🎇","👊","💣","💥"],entertainment:["🎆","🎠","🎣","🎨","🎭","🎮","🎯","🎲","📻"],fireworks:["🎆","🎇"],sparkler:["🎇"],balloon:["🎈","💬","💭","🗯"],celebrate:["🎈","🎉","🎊","👯","🥂"],awesome:["🎉","👌","👍","👏","😃","😎","😛"],excited:["🎉","👏","👻","💖","💗","😅"],popper:["🎉"],tada:["🎉"],"party popper":["🎉"],hooray:["🎉","🙌"],confetti:["🎊"],"confetti ball":["🎊"],banner:["🎋"],"tanabata tree":["🎋"],"crossed flags":["🎌"],bamboo:["🎍","🐼"],pine:["🎍"],"pine decoration":["🎍"],"Japanese dolls":["🎎"],doll:["🎎"],festival:["🎎"],streamer:["🎏"],"carp streamer":["🎏"],carp:["🎏"],bell:["🎐","🔔","🔕","🛎"],"wind chime":["🎐"],chime:["🎐"],"moon viewing ceremony":["🎑"],ceremony:["🎑"],backpack:["🎒"],bag:["🎒","👜","👝","💰","🛍"],bookbag:["🎒"],education:["🎒","🎓","📔","📕","📖","📗","📘","📙","📚"],satchel:["🎒"],school:["🎒","🏫","📔","📚","🚌"],"school backpack":["🎒"],cap:["🎓"],clothing:["🎓","🎩","👑","👒","👓","👔","👕","👖","👗","👘","👙","👚","👛","👜","👝","👞","👟","👠","👢","👣","📿"],graduation:["🎓"],"graduation cap":["🎓"],scholar:["🎓"],"military medal":["🎖"],medal:["🎖","🏅","🥇","🥈","🥉"],military:["🎖"],award:["🎖","🏅"],"reminder ribbon":["🎗"],reminder:["🎗"],mic:["🎙","🎤"],microphone:["🎙","🎤"],music:["🎙","🎚","🎛","🎤","🎵","🎶","🎷","🎸","🎹","🎺","🎻","🎼","🔊","🥁"],"studio microphone":["🎙"],studio:["🎙"],"level slider":["🎚"],level:["🎚"],slider:["🎚"],"control knobs":["🎛"],control:["🎛","🛂"],knobs:["🎛"],cinema:["🎞","🎥","🎦","📽"],film:["🎞","🎥","🎦","📽"],"film frames":["🎞"],frames:["🎞"],admission:["🎟","🎫"],ticket:["🎟","🎫"],"admission tickets":["🎟"],carousel:["🎠"],horse:["🎠","🏇","🐎","🐴"],"carousel horse":["🎠"],"amusement park":["🎡","🎢"],ferris:["🎡"],"ferris wheel":["🎡"],amusementpark:["🎡","🎢"],coaster:["🎢"],"roller coaster":["🎢"],roller:["🎢"],pole:["🎣","💈"],"fishing pole":["🎣"],karaoke:["🎤"],sing:["🎤"],sound:["🎤","🎧","🎵","🎶","👂","📢","📣","🔇","🔈","🔉","🔊","🔔","🔕"],camera:["🎥","🎦","📷","📸","📹","🤳"],hollywood:["🎥"],bollywood:["🎥"],"movie camera":["🎥"],earbud:["🎧"],headphone:["🎧"],art:["🎨","🎭","🖼"],arty:["🎨"],artsy:["🎨"],colorful:["🎨"],creative:["🎨"],museum:["🎨","🖼"],painter:["🎨"],painting:["🎨","🖌","🖼"],palette:["🎨","👨‍🎨","👩‍🎨"],"artist palette":["🎨"],abraham:["🎩"],clothes:["🎩","👒","👕","👖","👗","👚","👛","👜","👝","👞","👟","👠","👢"],fancy:["🎩","👗","👛"],formal:["🎩","🤵"],hats:["🎩","👒"],lincoln:["🎩"],top:["🎩","🔝"],tophat:["🎩"],"top hat":["🎩"],circus:["🎪"],"circus tent":["🎪"],stub:["🎫"],action:["🎬"],"clapper board":["🎬"],clapper:["🎬"],actor:["🎭","👨‍🎤","👩‍🎤"],actress:["🎭"],mask:["🎭","👹","👺","😷"],performing:["🎭"],shakespeare:["🎭"],theater:["🎭"],theatre:["🎭"],thesbian:["🎭"],"performing arts":["🎭"],controller:["🎮"],xbox:["🎮"],playstation:["🎮"],"video game":["🎮"],bullseye:["🎯"],dart:["🎯"],eye:["🎯","👀","👁","👓","🕶","😁","😄","😊","😍","😎","😙","😚","😜","😝","😸","😻","😽"],target:["🎯"],"direct hit":["🎯"],hit:["🎯"],casino:["🎰"],gamble:["🎰"],gambling:["🎰"],slot:["🎰"],slots:["🎰"],"slot machine":["🎰"],"8 ball":["🎱"],billiard:["🎱"],"pool 8 ball":["🎱"],"8ball":["🎱"],dice:["🎲"],"game die":["🎲"],die:["🎲"],bowling:["🎳"],strike:["🎳"],"flower playing cards":["🎴"],playing:["🎴"],"musical note":["🎵"],note:["🎵","🎶","🎼","💴","💵","💶","💷","💸","🗒"],notes:["🎶","📋","📝"],"musical notes":["🎶"],instrument:["🎷","🎸","🎹","🎺","🎻"],sax:["🎷"],saxophone:["🎷"],guitar:["🎸"],strat:["🎸"],stratocaster:["🎸"],piano:["🎹"],"musical keyboard":["🎹"],trumpet:["🎺"],stradivarius:["🎻"],violin:["🎻"],score:["🎼","💯"],"musical score":["🎼"],running:["🎽","🏃","👟","💨"],sash:["🎽"],shirt:["🎽","👔","👕","👚"],"running shirt":["🎽"],athletics:["🎽"],tennis:["🎾","👟"],racquet:["🎾","🏸"],skis:["🎿"],hoop:["🏀"],checkered:["🏁"],chequered:["🏁"],finish:["🏁"],flags:["🏁"],nascar:["🏁"],race:["🏁"],racing:["🏁","🏇","🏍","🏎","🐎"],"chequered flag":["🏁"],snowboard:["🏂"],snowboarder:["🏂"],hurry:["🏃"],coming:["🏃"],marathon:["🏃"],quick:["🏃"],runner:["🏃"],rush:["🏃"],speed:["🏃","🚄","🚅"],"person running":["🏃"],waves:["🏄"],"person surfing":["🏄"],winner:["🏅"],"sports medal":["🏅"],gold:["🏅","🥇"],prize:["🏆"],slay:["🏆","😎"],trophy:["🏆"],winning:["🏆","😎"],champs:["🏆"],champion:["🏆"],jockey:["🏇"],racehorse:["🏇","🐎"],riding:["🏇","🚴","🚵"],"horse racing":["🏇"],"triple crown":["🏇","🐎"],"american football":["🏈"],american:["🏈"],"super bowl":["🏈"],rugby:["🏉"],"rugby football":["🏉"],swim:["🏊","👙"],swimming:["🏊"],swimmer:["🏊"],"person swimming":["🏊"],"person lifting weights":["🏋"],lifter:["🏋"],"driving range":["🏌"],"person golfing":["🏌"],motorcycle:["🏍"],car:["🏎","🚃","🚋","🚓","🚔","🚕","🚗","🚘","🚙","🚚","🚛","🚞","🚡","🚨"],zoom:["🏎"],"racing car":["🏎"],bat:["🏏","🏓","🦇"],cricket:["🏏"],volleyball:["🏐"],"field hockey":["🏑"],field:["🏑"],hockey:["🏑","🏒"],"ice hockey":["🏒"],puck:["🏒"],"ping pong":["🏓"],paddle:["🏓"],pingpong:["🏓"],tabletennis:["🏓"],"snow-capped mountain":["🏔"],"beach with umbrella":["🏖"],construction:["🏗","👷","🚧","🚩"],"building construction":["🏗"],house:["🏘","🏚","🏠","🏡"],cityscape:["🏙"],home:["🏚","🏠","🏡"],"derelict house":["🏚"],derelict:["🏚"],"classical building":["🏛"],classical:["🏛"],"desert island":["🏝"],island:["🏝"],"national park":["🏞"],park:["🏞"],stadium:["🏟"],"country home":["🏠","🏡"],ranch:["🏠","🏡"],"settle down":["🏠","🏡"],"simple home":["🏠","🏡"],suburban:["🏠","🏡"],suburbia:["🏠","🏡"],"where the heart is":["🏠","🏡"],garden:["🏡","🐌","🐛","🐜","🐞"],"house with garden":["🏡"],cubical:["🏢"],job:["🏢"],office:["🏢","💻","💼","👨‍💼","👩‍💼"],"office building":["🏢"],"Japanese post office":["🏣"],post:["🏣","🏤","📯","🚩"],"post office":["🏤"],European:["🏤","🏰"],doctor:["🏥","💉","💊","😷"],hospital:["🏥"],medicine:["🏥","💉","💊","😷","⚕"],bank:["🏦","🏧","💰","💱","💳","💴","💵","💶","💷","💸","💹"],atm:["🏧"],automated:["🏧"],cash:["🏧","💰","💲","💳","💷","💸"],"ATM sign":["🏧"],money:["🏧","💎","💰","💱","💲","💳","💴","💵","💶","💷","💸","💹","🤑"],teller:["🏧"],hotel:["🏨","🏩","🛋","🛌","🛍","🛎","🛏"],"love hotel":["🏩"],convenience:["🏪"],"24 hours":["🏪"],store:["🏪","🏬"],"convenience store":["🏪"],department:["🏬"],"department store":["🏬"],factory:["🏭","👨‍🏭","👩‍🏭"],light:["🏮","💡","🔆","🔦","🕯","🚥","🚦","🚨"],"red paper lantern":["🏮"],castle:["🏯","🏰"],"Japanese castle":["🏯"],waving:["🏳","🏴","👋"],"white flag":["🏳"],"black flag":["🏴"],rosette:["🏵"],label:["🏷"],badminton:["🏸"],birdie:["🏸"],shuttlecock:["🏸"],bow:["🏹","🙇","🙏"],"bow and arrow":["🏹"],archery:["🏹"],amphora:["🏺"],jug:["🏺"],"light skin tone":["🏻"],skintone:["🏻","🏼","🏽","🏾","🏿"],"type1–2":["🏻"],"medium-light skin tone":["🏼"],type3:["🏼"],"medium skin tone":["🏽"],type4:["🏽"],"medium-dark skin tone":["🏾"],type5:["🏾"],"dark skin tone":["🏿"],type6:["🏿"],animal:["🐀","🐁","🐂","🐃","🐄","🐅","🐆","🐇","🐈","🐉","🐊","🐋","🐌","🐍","🐎","🐏","🐐","🐑","🐒","🐓","🐔","🐕","🐖","🐗","🐘","🐙","🐚","🐛","🐜","🐝","🐞","🐟","🐠","🐡","🐢","🐣","🐤","🐥","🐦","🐧","🐨","🐩","🐪","🐫","🐬","🐭","🐮","🐯","🐰","🐱","🐲","🐳","🐴","🐵","🐶","🐷","🐸","🐹","🐺","🐻","🐼","🐽","😸","😹","😺","😻","😼","😽","😾","😿","🙀","🙈","🙉","🙊","🦁","🦍","🦊","🦌","🦏","🦇","🦅","🦆","🦉","🦎","🦈","🦑"],rat:["🐀"],animals:["🐁","🐂","🐃","🐄","🐅","🐆","🐇","🐈","🐊","🐏","🐐","🐓","🐕","🐖"],mouse:["🐁","🐭"],taurus:["🐂"],buffalo:["🐃"],zoo:["🐃","🐅","🐆","🐊","🐏"],"water buffalo":["🐃"],cow:["🐄","🐮"],moo:["🐄","🐮"],"big cat":["🐅","🐆","🐯"],predator:["🐅","🐆","🐯"],tiger:["🐅","🐯"],leopard:["🐆"],bunny:["🐇","🐰","👯"],pet:["🐇","🐈","🐕","🐰","🐱","🐶","🐹"],rabbit:["🐇","🐰"],cat:["🐈","🐱","😸","😹","😺","😻","😼","😽","😾","😿","🙀"],cats:["🐈"],kitten:["🐈","🐱"],dragon:["🐉","🐲"],"game of thrones":["🐉","🐗","👑"],fairytale:["🐉","🐲","👸","👹","👺","👻","👼","👽","👾","👿","💀","🔮","😇","😈"],crocodile:["🐊"],dundy:["🐊"],florida:["🐊"],whale:["🐋","🐳"],escargot:["🐌"],slug:["🐌"],snail:["🐌"],"belmont stakes":["🐎"],"kentucky derby":["🐎"],preakness:["🐎"],equestrian:["🐎"],aries:["🐏"],horns:["🐏","😈","🤘"],sheep:["🐏","🐑"],baa:["🐑"],ewe:["🐑"],fluffy:["🐑","🐩"],wool:["🐑"],monkey:["🐒","🐵","🙈","🙉","🙊"],birds:["🐓"],rooster:["🐓"],dog:["🐕","🐩","🐶"],dogs:["🐕"],bacon:["🐖","🐷","🥓"],fat:["🐖"],pig:["🐖","🐗","🐷","🐽"],pork:["🐖","🐷"],sow:["🐖"],boar:["🐗"],elephant:["🐘"],creature:["🐙","👹","👺","👻","👽","👾"],octopus:["🐙"],conch:["🐚"],shell:["🐚"],spiral:["🐚","🗒","🗓"],"sea shell":["🐚"],"spiral shell":["🐚"],bug:["🐛"],insect:["🐛","🐜","🐝","🐞","🕷","🦋"],ant:["🐜"],bee:["🐝"],bumblebee:["🐝"],honeybee:["🐝"],beetle:["🐞"],"lady beetle":["🐞"],ladybird:["🐞"],ladybug:["🐞"],fishes:["🐟","🐠"],fishing:["🐟","🚣"],"tropical fish":["🐠"],blowfish:["🐡"],turtle:["🐢"],turtles:["🐢"],terrapin:["🐢"],tortoise:["🐢"],bird:["🐣","🐤","🐦","🕊","🦅","🦆","🦉"],hatching:["🐣"],"hatching chick":["🐣"],chick:["🐣","🐤","🐥"],"baby chick":["🐤"],"front-facing baby chick":["🐥"],ornithology:["🐦"],antartica:["🐧"],"happy feet":["🐧"],penguin:["🐧"],australia:["🐨"],"down under":["🐨"],koala:["🐨"],poodle:["🐩"],"water dog":["🐩"],camel:["🐪","🐫"],desrt:["🐪"],dromedary:["🐪"],hump:["🐪","🐫"],"one hump":["🐪"],bactrian:["🐫"],"two hump":["🐫"],"two-hump camel":["🐫"],dolphin:["🐬"],flipper:["🐬"],"mouse face":["🐭"],"cow face":["🐮"],"tiger face":["🐯"],"rabbit face":["🐰"],kitty:["🐱"],"cat face":["🐱"],"dragon face":["🐲"],spouting:["🐳"],"spouting whale":["🐳"],dressage:["🐴"],equine:["🐴"],horses:["🐴"],"horse face":["🐴"],"curious george":["🐵"],"monkey face":["🐵"],adorbs:["🐶","💘","💞","😘"],puppies:["🐶"],puppy:["🐶"],"dog face":["🐶"],wilbur:["🐷"],"pig face":["🐷"],frog:["🐸"],princess:["🐸","👸"],"frog face":["🐸"],hamster:["🐹"],"hamster face":["🐹"],wolf:["🐺"],"wolf face":["🐺"],grizzly:["🐻"],growl:["🐻"],yosemite:["🐻"],"bear face":["🐻"],panda:["🐼"],"panda face":["🐼"],nose:["🐽","👃"],smel:["🐽"],snout:["🐽"],"pig nose":["🐽"],feet:["🐾","👞"],paw:["🐾"],paws:["🐾"],print:["🐾","👣"],"paw prints":["🐾"],chipmunk:["🐿"],body:["👀","👁","👂","👃","👄","👅","💀","💪"],peep:["👀"],googley:["👀"],look:["👀"],looking:["👀"],omg:["👀","😑","😝","😮","😯","😲","🙆","🙈"],see:["👀","🙈"],seeing:["👀"],eyes:["👀","🙄"],"one eye":["👁"],"1 eye":["👁"],ear:["👂"],ears:["👂"],hear:["👂","🙉"],hearing:["👂"],listen:["👂","🙉"],listening:["👂"],noses:["👃"],nosey:["👃"],odor:["👃"],smell:["👃"],smells:["👃"],kiss:["👄","💋","💏","💑","😗","😘","😙","😚","😽"],kissing:["👄","💋","😗"],lips:["👄","💋"],lipstick:["👄","💄"],mouth:["👄","😃","😄","😆","😦","😮","😰","😶","😺","🤐","🤑"],lick:["👅"],slurp:["👅"],tongue:["👅","😛","😜","😝"],backhand:["👆","👇","👈","👉","🤚"],"backhand index pointing up":["👆"],"backhand index pointing down":["👇"],"backhand index pointing left":["👈"],"backhand index pointing right":["👉"],absolutely:["👊"],agree:["👊","💯"],bro:["👊","👨","💪","😎"],bruh:["👊","💯"],bump:["👊"],correct:["👊"],knuckle:["👊"],punch:["👊"],rock:["👊","👨‍🎤","👩‍🎤"],ttyl:["👊","👋"],"oncoming fist":["👊"],cya:["👋"],felicia:["👋"],g2g:["👋"],gtg:["👋"],later:["👋"],outtie:["👋"],ttfn:["👋"],"waving hand":["👋"],bye:["👋"],hi:["👋"],hey:["👋"],yo:["👋"],"u there?":["👋"],dope:["👌","👍"],fleek:["👌","👍"],gotcha:["👌","👍"],legit:["👌","👍"],bet:["👌","💰"],"got it":["👌"],three:["👌","🕒","🕞"],pinch:["👌"],rad:["👌","👍","😎"],"OK hand":["👌"],"+1":["👍"],good:["👍"],great:["👍","👏"],like:["👍"],thumb:["👍","👎"],"thumbs up":["👍"],tubular:["👍"],yeah:["👍","😎"],yes:["👍"],"-1":["👎"],bad:["👎","😐","😑"],dislike:["👎"],"no good":["👎"],nope:["👎","🙅"],"thumbs down":["👎"],applause:["👏"],approval:["👏"],
clap:["👏"],congrats:["👏"],congratulations:["👏"],homie:["👏","💯","🔝","😏"],nice:["👏","😀","😁","😛"],prayed:["👏"],yay:["👏","😃"],"clapping hands":["👏"],"well done":["👏"],"good job":["👏"],"jazz hands":["👐"],open:["👐","📂","📖","📬","📭","🔓","😃","😄","😅","😆","😦","😮","😰","😺"],"open hands":["👐"],hug:["👐","🤗"],swerve:["👐"],crown:["👑","👸"],king:["👑"],lebron:["👑"],medieval:["👑"],queen:["👑","👸"],royal:["👑"],"royal family":["👑"],royalty:["👑"],"garden party":["👒"],woman:["👒","👚","👠","👡","👢","👨‍👩‍👦‍👦","👨‍👩‍👧","👨‍👩‍👧‍👦","👨‍👩‍👧‍👧","👩","👩‍👦","👩‍👦‍👦","👩‍👧","👩‍👧‍👦","👩‍👧‍👧","👩‍👩‍👦","👩‍👩‍👦‍👦","👩‍👩‍👧","👩‍👩‍👧‍👦","👩‍👩‍👧‍👧","👫","👭","👵","💃","🚺","👩‍🎓","👩‍🏫","👩‍🌾","👩‍🍳","👩‍🔧","👩‍🏭","👩‍💼","👩‍🔬","👩‍💻","👩‍🎤","👩‍🎨","👩‍🚀","👩‍🚒","🤰"],"woman’s hat":["👒"],eyeglasses:["👓"],eyewear:["👓","🕶","😎"],glasses:["👓","🕶","😎"],employed:["👔"],necktie:["👔"],serious:["👔"],blue:["👕","👖","💙","📘","🔵","🔷","🔹","😰"],casual:["👕","👖"],collar:["👕","👚"],dressed:["👕","👖","👗","👚"],shopping:["👕","👖","👗","👚","👛","👜","👞","👟","👠","👢","🛍","🛒"],tshirt:["👕"],weekend:["👕","👖"],"t-shirt":["👕"],denim:["👖"],jeans:["👖"],pants:["👖"],trousers:["👖"],dress:["👗","👚","👛","👜","👝","👠","👢"],comfortable:["👘"],kimono:["👘"],"bathing suit":["👙"],bikini:["👙"],pool:["👙"],blouse:["👚"],lady:["👚","👜","👧","👩","👵"],"woman’s clothes":["👚"],handbag:["👛","👜","👝"],purse:["👛","👜","👝"],coin:["👛"],"clutch bag":["👝"],pouch:["👝"],brown:["👞"],foot:["👞"],kick:["👞","👟","🛴"],man:["👞","👨","👨‍👦","👨‍👦‍👦","👨‍👧","👨‍👧‍👦","👨‍👧‍👧","👨‍👨‍👦","👨‍👨‍👦‍👦","👨‍👨‍👧","👨‍👨‍👧‍👦","👨‍👨‍👧‍👧","👨‍👩‍👦‍👦","👨‍👩‍👧","👨‍👩‍👧‍👦","👨‍👩‍👧‍👧","👫","👬","👲","👴","🕴","🚹","👨‍🎓","👨‍🏫","👨‍🌾","👨‍🍳","👨‍🔧","👨‍🏭","👨‍💼","👨‍🔬","👨‍💻","👨‍🎤","👨‍🎨","👨‍🚀","👨‍🚒","🤵","🕺"],shoe:["👞","👟","👠","👡","👢"],shoes:["👞","👟","👠","👢"],"man’s shoe":["👞"],athletic:["👟"],sneaker:["👟"],"running shoe":["👟"],heel:["👠"],heels:["👠"],fashion:["👠"],"high-heeled shoe":["👠"],stilletto:["👠"],sandal:["👡"],"woman’s sandal":["👡"],boot:["👢"],"woman’s boot":["👢"],footprint:["👣"],omw:["👣","🔜"],walk:["👣","🚶"],footprints:["👣"],barefoot:["👣"],bust:["👤","👥"],shadow:["👤"],silhouette:["👤","👥","🗣"],"bust in silhouette":["👤"],mysterious:["👤"],bff:["👥","👭","👯"],everyone:["👥","👫","👬","👭"],friend:["👥","👨","👫","👬","👭"],friends:["👥","👫","👬","👭"],"busts in silhouette":["👥"],boy:["👦","👨","👨‍👦","👨‍👦‍👦","👨‍👧‍👦","👨‍👨‍👦","👨‍👨‍👦‍👦","👨‍👨‍👧‍👦","👨‍👩‍👦‍👦","👨‍👩‍👧‍👦","👩‍👦","👩‍👦‍👦","👩‍👧‍👦","👩‍👩‍👦","👩‍👩‍👦‍👦","👩‍👩‍👧‍👦"],kid:["👦"],bangs:["👧"],"bright-eyed":["👧"],daughter:["👧"],girl:["👧","👨‍👧","👨‍👧‍👦","👨‍👧‍👧","👨‍👨‍👧","👨‍👨‍👧‍👦","👨‍👨‍👧‍👧","👨‍👩‍👧","👨‍👩‍👧‍👦","👨‍👩‍👧‍👧","👩‍👧","👩‍👧‍👦","👩‍👧‍👧","👩‍👩‍👧","👩‍👩‍👧‍👦","👩‍👩‍👧‍👧"],pigtails:["👧"],boyfriend:["👨"],family:["👨‍👦","👨‍👦‍👦","👨‍👧","👨‍👧‍👦","👨‍👧‍👧","👨‍👨‍👦","👨‍👨‍👦‍👦","👨‍👨‍👧","👨‍👨‍👧‍👦","👨‍👨‍👧‍👧","👨‍👩‍👦‍👦","👨‍👩‍👧","👨‍👩‍👧‍👦","👨‍👩‍👧‍👧","👩‍👦","👩‍👦‍👦","👩‍👧","👩‍👧‍👦","👩‍👧‍👧","👩‍👩‍👦","👩‍👩‍👦‍👦","👩‍👩‍👧","👩‍👩‍👧‍👦","👩‍👩‍👧‍👧","👪"],blonde:["👩","👱"],blondie:["👩","👱","👵"],haircut:["👩","💇","💈"],child:["👪","🚸"],bae:["👫","👬","👭","💏","💑","😍","😘","😚"],couple:["👫","👬","👭","💏","💑"],dating:["👫","👬","👭","💋","💕","😗","😙","😚"],flirt:["👫","😉","😏","😗","😘","😙","😚"],"man and woman holding hands":["👫"],hold:["👫","👬","👭"],"in love":["👫","😍"],boys:["👬"],"two men holding hands":["👬"],bestfriend:["👭"],bestfriends:["👭"],bestie:["👭"],bond:["👭"],bonding:["👭"],daughters:["👭"],friendship:["👭"],girls:["👭"],girly:["👭"],ladies:["👭"],sis:["👭"],sister:["👭"],sisters:["👭"],"two women holding hands":["👭"],cop:["👮"],officer:["👮"],policeman:["👮"],"po po":["👮"],police:["👮","🚓","🚔","🚨"],popo:["👮"],"police officer":["👮"],dancer:["👯","💃"],twinsies:["👯"],"girl's night out":["👯"],woohoo:["👯"],"people with bunny ears partying":["👯"],bunnyear:["👯"],partying:["👯"],bride:["👰"],wedding:["👰","💍","💎","💒"],"bride with veil":["👰"],veil:["👰"],blond:["👱","👵"],dude:["👱"],"flat top":["👱"],"blond-haired person":["👱"],"man with Chinese cap":["👲"],guapimao:["👲"],"person wearing turban":["👳"],turban:["👳"],bald:["👴"],elderly:["👴"],"losing hair":["👴"],"old man":["👴"],"old dude":["👴"],grandpa:["👴"],grandfather:["👴"],wise:["👴","👵","🦉"],old:["👴","👵","🗝"],"bad haircut":["👵"],granny:["👵"],grandma:["👵"],grandmother:["👵"],"old woman":["👵"],"goo goo":["👶"],pregnant:["👶","🤰"],hardhat:["👷"],worker:["👷","👨‍🏭","👩‍🏭"],"construction worker":["👷"],work:["👷"],ogre:["👹"],devil:["👹","👿"],scary:["👹","👻","😦","😧"],goblin:["👺"],angry:["👺","💢","🗯","😠","😡","😤"],mean:["👺"],ghost:["👻"],haunting:["👻"],silly:["👻"],boo:["👻"],snapchat:["👻"],snap:["👻","📷"],ghostface:["👻"],angel:["👼","😇"],"baby angel":["👼"],alien:["👽","👾"],extraterrestrial:["👽","👾"],skrillex:["👽"],ufo:["👽","👾"],games:["👾"],gamer:["👾"],pixellated:["👾"],"space invaders":["👾"],"alien monster":["👾"],evil:["👿","🙈","🙉","🙊","🖤"],imp:["👿"],shade:["👿","😈","😏","😐","😠","😡"],mischievous:["👿"],"angry face with horns":["👿"],demon:["👿"],"i'm dead":["💀"],lmao:["💀","😂","🤣"],diva:["💁"],fetch:["💁"],gossip:["💁"],sassy:["💁"],"person tipping hand":["💁"],tipping:["💁"],whatever:["💁","💅","😐","😑","😒","😝","😴","🙄"],sarcastic:["💁"],sarcasm:["💁"],"hair flip":["💁"],"hair flick":["💁"],guard:["💂"],guardsman:["💂"],flair:["💃"],groove:["💃"],tango:["💃"],flamenco:["💃"],salsa:["💃"],dance:["💃","🕺"],festive:["💃"],"let's dance":["💃"],"woman dancing":["💃"],dancing:["💃","🕺"],cosmetics:["💄","💅"],date:["💄","💏","💐","💕","💘","📅","😗","😙","😚"],makeup:["💄","💅"],manicure:["💅"],nail:["💅"],polish:["💅"],"nail polish":["💅"],care:["💅"],bored:["💅","😒","😔"],"i'm done":["💅"],massage:["💆"],soothe:["💆"],"person getting massage":["💆"],salon:["💆"],headache:["💆","😓","😣"],tension:["💆"],relaxing:["💆"],relax:["💆"],barber:["💇","💈"],hair:["💇"],"person getting haircut":["💇"],parlor:["💇"],"barber pole":["💈"],"fresh cut":["💈"],"flu shot":["💉"],needle:["💉"],shot:["💉","🥃"],sick:["💉","💊","😵","😷","🤒","🤢"],syringe:["💉"],vaccination:["💉"],vaccinatoins:["💉"],drugs:["💊"],pill:["💊"],pills:["💊"],medicated:["💊"],vitamin:["💊"],romance:["💋","💌","💍","💎","💏","💐","💑","💒","💘","💙","😍","😘"],sexy:["💋","😉"],"kiss mark":["💋"],mail:["💌","📤","📥","📧","📨","📩","📪","📫","📬","📭","📮"],valentine:["💌","💘","💝"],"love letter":["💌"],beyonce:["💍"],engaged:["💍"],engagement:["💍","💎"],ring:["💍"],married:["💍"],shiny:["💍"],sparkling:["💍","💖"],gem:["💎"],jewel:["💎"],"gem stone":["💎"],anniversary:["💏","💐","💑","💕","💝","💞"],bouquet:["💐"],"couple with heart":["💑"],hitched:["💒"],nuptuals:["💒"],cardio:["💓"],heartbeat:["💓"],ily:["💓","💕","💖","💗","💘","💙","💚","💛","💜","💝","😍","😗","😘","😙","😚"],pulsating:["💓"],pulse:["💓","💗"],"beating heart":["💓"],beating:["💓"],"break":["💔"],broken:["💔"],crushed:["💔"],lonely:["💔"],"broken heart":["💔"],kisses:["💕","💖","💗","💝","😍","😗","😘","😙","😚"],loving:["💕","😍"],xoxo:["💕","💖","💗","💝","😍","😗","😘","😚"],"two hearts":["💕"],"good night":["💖","😴"],"sparkling heart":["💖"],growing:["💗"],heartpulse:["💗"],muah:["💗","😘"],nervous:["💗","😅","😓","😟","😰"],"growing heart":["💗"],cupid:["💘"],"heart with arrow":["💘"],"blue heart":["💙"],romantic:["💚","😍","😘"],"green heart":["💚"],cardiac:["💛"],"yellow heart":["💛"],yellow:["💛","🔰"],bestest:["💜"],purple:["💜"],"purple heart":["💜"],"heart with ribbon":["💝"],"revolving hearts":["💞"],revolving:["💞","🚨"],"heart decoration":["💟"],comic:["💠","💡","💢","💣","💤","💥","💦","💧","💨","💩","💪","💫","💬","💭"],"diamond with a dot":["💠"],inside:["💠"],bulb:["💡"],idea:["💡","💭"],"light bulb":["💡"],mad:["💢","🗯","😖","😠","😡","😤","😩"],"anger symbol":["💢"],bomb:["💣","💥"],dangerous:["💣"],explosion:["💣"],sleep:["💤","😪","😴","🛌","🛏"],sleeping:["💤","😪","😴"],sleepy:["💤","😩"],tired:["💤","😩","😪","😫","😴","😵"],zz:["💤"],zzz:["💤","😴"],zzzz:["💤"],collide:["💥"],collision:["💥"],explode:["💥"],droplet:["💦","💧"],droplets:["💦"],splashing:["💦"],sweat:["💦","💧","😅","😓","😥","😰"],"work out":["💦"],workout:["💦"],"sweat droplets":["💦"],tear:["💧","😂","😢","😭","😹","😿"],fart:["💨"],gone:["💨","💨"],"gotta go":["💨"],"dashing away":["💨"],smoke:["💨","🚫","🚭"],"doo doo":["💩"],dung:["💩"],fml:["💩"],poo:["💩"],poop:["💩"],turd:["💩"],smelly:["💩"],smh:["💩","😒","🙈"],"pile of poo":["💩"],stinks:["💩"],stinky:["💩"],stink:["💩"],beast:["💪"],"bench press":["💪"],biceps:["💪"],curls:["💪"],flex:["💪"],gym:["💪","💪"],flexing:["💪"],bodybuilder:["💪"],gains:["💪"],jacked:["💪"],muscle:["💪"],ripped:["💪"],strong:["💪"],weightlift:["💪"],weightlifter:["💪"],"flexed biceps":["💪"],dialog:["💬","🗨"],message:["💬"],sms:["💬"],speech:["💬","🗨"],talk:["💬"],text:["💬"],typing:["💬"],"speech balloon":["💬"],bubble:["💬","💭","🗯"],cartoon:["💭"],daydream:["💭"],decisions:["💭"],dream:["💭"],invent:["💭"],invention:["💭"],realize:["💭"],think:["💭"],thinking:["💭","🤔"],thought:["💭"],thoughts:["💭"],wonder:["💭"],"thought balloon":["💭"],"white flower":["💮"],"a+":["💯"],clearly:["💯"],faithful:["💯"],hbd:["💯"],hundred:["💯"],kidding:["💯","😏"],"perfect score":["💯"],"hundred points":["💯"],"true":["💯"],truth:["💯"],"on point":["💯"],yup:["💯"],"keep it 100":["💯"],definitely:["💯"],billion:["💰","💲","💷","💸"],cost:["💰","😑","😫","😲"],dollar:["💰","💲","💵","💸"],million:["💰","💲","💸"],moneybag:["💰"],paid:["💰","🤑"],paying:["💰"],"cash out":["💰"],"pot of gold":["💰"],rich:["💰","💶"],scrooge:["💰"],"money bag":["💰"],currency:["💱","💲","💴","💵","💶","💷","💹"],exchange:["💱"],"currency exchange":["💱"],charge:["💲","💳"],pay:["💲","💳","💸"],"heavy dollar sign":["💲"],"charge it":["💳"],credit:["💳"],"credit card":["💳"],banknote:["💴","💵","💶","💷","💸"],bill:["💴","💵","💶","💷","💸"],yen:["💴","💹"],"yen banknote":["💴"],"dollar banknote":["💵"],euro:["💶"],"euro banknote":["💶"],pounds:["💷"],"pound banknote":["💷"],"money with wings":["💸"],wings:["💸"],chart:["💹","📈","📉","📊"],graph:["💹","📈","📉","📊"],"chart increasing with yen":["💹"],market:["💹"],rise:["💹"],trend:["💹","📈","📉"],upward:["💹","📈"],chair:["💺"],seat:["💺"],"laptop computer":["💻"],pc:["💻"],personal:["💻"],briefcase:["💼"],minidisk:["💽"],"computer disk":["💽"],disk:["💽","💾","💿","📀"],optical:["💽","💿","📀"],floppy:["💾"],"floppy disk":["💾"],"blu-ray":["💿","📀"],cd:["💿","📀"],dvd:["💿","📀"],"optical disk":["💿"],file:["📁","📂","🗃","🗄"],folder:["📁","📂"],"file folder":["📁"],"open file folder":["📂"],document:["📃","📄"],page:["📃","📄"],"page with curl":["📃"],"page facing up":["📄"],calendar:["📅","📆","🗓"],"tear-off calendar":["📆"],"old school":["📇","📼"],rolodex:["📇"],"card index":["📇"],data:["📈","📉","📊"],"up and to the right":["📈"],"chart increasing":["📈"],downward:["📉"],negative:["📉"],"chart decreasing":["📉"],"bar chart":["📊"],clipboard:["📋"],"to do list":["📋"],collage:["📌"],pin:["📌","📍"],pushpin:["📌","📍"],location:["📍"],map:["📍","🗺","🗾"],"round pushpin":["📍"],paperclip:["📎","🖇"],angle:["📏","📐"],ruler:["📏","📐"],"straight edge":["📏"],"straight ruler":["📏"],straightedge:["📏"],"slide rule":["📐"],"triangular ruler":["📐"],set:["📐"],bookmark:["📑","🔖"],"bookmark tabs":["📑"],marker:["📑"],tabs:["📑"],ledger:["📒"],notebook:["📒","📓","📔"],book:["📔","📕","📖","📗","📘","📙","📚"],cover:["📔"],decorated:["📔"],writing:["📔"],"notebook with decorative cover":["📔"],closed:["📕","📪","📫","🔐","🔒","😚"],"closed book":["📕"],knowledge:["📖","📚"],library:["📖","📗","📘","📙","📚"],novels:["📖","📚"],reading:["📖","📗","📘","📙","📚"],"open book":["📖"],"green book":["📗"],"blue book":["📘"],"orange book":["📙"],books:["📚"],study:["📚"],badge:["📛"],name:["📛"],"name badge":["📛"],scroll:["📜"],communication:["📝","📞","📟","📠","📢","📦","📩","📫","📰","📱","📲","📳","📶"],media:["📝"],memo:["📝"],voip:["📞"],"telephone receiver":["📞"],receiver:["📞"],pager:["📟"],fax:["📠"],"fax machine":["📠"],aliens:["📡"],antenna:["📡","📶"],contact:["📡","🔎","🔭"],dish:["📡"],satellite:["📡","🛰"],science:["📡","🔍","🔎","🔬","🔭"],"satellite antenna":["📡"],loud:["📢","🔊"],loudspeaker:["📢"],"public address":["📢"],publicaddress:["📢"],megaphone:["📣"],cheering:["📣"],outbox:["📤"],sent:["📤","📨","📩"],"outbox tray":["📤"],tray:["📤","📥"],inbox:["📥"],"inbox zero":["📥"],receive:["📥","📨","📲"],"inbox tray":["📥"],delivery:["📦","🚚"],"package":["📦"],parcel:["📦"],shipping:["📦"],delivering:["📨"],incoming:["📨"],"incoming envelope":["📨"],outgoing:["📩"],send:["📩"],"envelope with arrow":["📩"],mailbox:["📪","📫","📬","📭","📮"],postbox:["📪","📫","📬","📭","📮"],"closed mailbox with lowered flag":["📪"],lowered:["📪","📭"],"closed mailbox with raised flag":["📫"],"open mailbox with raised flag":["📬"],"open mailbox with lowered flag":["📭"],horn:["📯"],"postal horn":["📯"],postal:["📯"],news:["📰","🗞"],newspaper:["📰","🗞"],cell:["📱","📲","📳","📴","📵","📶"],mobile:["📱","📲","📳","📴","📵","📶"],"mobile phone":["📱"],build:["📲"],whatsapp:["📲"],call:["📲","🤙"],"mobile phone with arrow":["📲"],"vibration mode":["📳"],mode:["📳"],vibration:["📳"],off:["📴"],"mobile phone off":["📴"],not:["📵","🔕","🔞","🙅","🙈","🙉","🙊","🚫","🚭","🚯","🚳","🚷"],"no mobile phones":["📵"],bars:["📶"],signal:["📶","🚥","🚦"],"antenna bars":["📶"],instagram:["📷"],photo:["📷"],selfie:["📷","🤳"],tbt:["📷","📹","📻"],trip:["📷","🚞","🛄"],video:["📷","📸","📹","📺","📻","📼","📽"],"camera with flash":["📸"],flash:["📸"],camcorder:["📹"],"video camera":["📹"],television:["📺"],tv:["📺"],radio:["📻","🔘"],tape:["📼"],vhs:["📼"],videocassette:["📼"],"film projector":["📽"],projector:["📽"],"prayer beads":["📿"],beads:["📿"],necklace:["📿"],prayer:["📿"],"shuffle tracks button":["🔀"],clockwise:["🔁","🔂","🔃"],repeat:["🔁"],"repeat button":["🔁"],"repeat single button":["🔂"],once:["🔂"],refresh:["🔃","🔄"],"clockwise vertical arrows":["🔃"],reload:["🔃"],again:["🔄"],dejavu:["🔄"],"anticlockwise arrows button":["🔄"],anticlockwise:["🔄"],counterclockwise:["🔄"],withershins:["🔄"],brightness:["🔅","🔆"],dim:["🔅"],"dim button":["🔅"],low:["🔅"],"bright button":["🔆"],mute:["🔇","🔕","😶"],quiet:["🔇","🔕","😶","🙊"],silent:["🔇","🔕","😶","😶"],"muted speaker":["🔇"],speaker:["🔇"],soft:["🔈"],"speaker low volume":["🔈"],"speaker medium volume":["🔉"],medium:["🔉"],high:["🔊"],"speaker high volume":["🔊"],battery:["🔋"],plug:["🔌"],"electric plug":["🔌"],lab:["🔍","🔎","🔬"],magnifying:["🔍","🔎"],search:["🔍","🔎"],"left-pointing magnifying glass":["🔍"],"right-pointing magnifying glass":["🔎"],ink:["🔏"],lock:["🔏","🔐","🔑","🔒","🔓","🗝"],"locked with pen":["🔏"],privacy:["🔏"],"bike lock":["🔐"],key:["🔐","🔑","🗝"],locked:["🔐","🔒"],"locked with key":["🔐"],secure:["🔐"],keys:["🔑"],"major key":["🔑"],password:["🔑"],unlock:["🔑","🔓"],"private":["🔒"],cracked:["🔓"],unlocked:["🔓"],"bell with slash":["🔕"],link:["🔗","🖇"],links:["🔗"],button:["🔘","🔲","🔳","🔼","🔽"],"radio button":["🔘"],back:["🔙"],"BACK arrow":["🔙"],end:["🔚"],"END arrow":["🔚"],"ON! arrow":["🔛"],on:["🔛"],brb:["🔜"],"SOON arrow":["🔜"],soon:["🔜"],"TOP arrow":["🔝"],underage:["🔞"],"no one under eighteen":["🔞"],agerestriction:["🔞"],eighteen:["🔞"],"keycap 10":["🔟"],keycap10:["🔟"],"input latin uppercase":["🔠"],ABCD:["🔠"],input:["🔠","🔡","🔢","🔣","🔤"],latin:["🔠","🔡","🔤"],letters:["🔠","🔡","🔤"],uppercase:["🔠"],abcd:["🔡"],lowercase:["🔡"],"input latin lowercase":["🔡"],numbers:["🔢"],"input numbers":["🔢"],"input symbols":["🔣"],"〒♪&%":["🔣"],abc:["🔤"],alphabet:["🔤"],"input latin letters":["🔤"],burn:["🔥"],fire:["🔥","🚒"],flame:["🔥"],lit:["🔥"],flashlight:["🔦"],torch:["🔦"],"home improvement":["🔧","🔨","🔩"],wrench:["🔧","🛠"],spanner:["🔧","🛠"],repairs:["🔨"],bolt:["🔩"],nut:["🔩","🥜"],"nut and bolt":["🔩"],chef:["🔪","👨‍🍳","👩‍🍳"],"kitchen knife":["🔪"],hocho:["🔪"],gun:["🔫"],pistol:["🔫"],revolver:["🔫"],handgun:["🔫"],experiment:["🔬"],microscope:["🔬"],"e.t.":["🔭"],telescope:["🔭"],fortune:["🔮","🔯"],future:["🔮"],"crystal ball":["🔮"],crystal:["🔮"],"dotted six-pointed star":["🔯"],"Japanese symbol for beginner":["🔰"],beginner:["🔰"],chevron:["🔰"],poseidon:["🔱"],trident:["🔱"],"trident emblem":["🔱"],emblem:["🔱"],"black square button":["🔲"],"white square button":["🔳"],"red circle":["🔴"],"blue circle":["🔵"],"large orange diamond":["🔶"],"large blue diamond":["🔷"],"small orange diamond":["🔸"],"small blue diamond":["🔹"],"red triangle pointed up":["🔺"],"red triangle pointed down":["🔻"],"up button":["🔼"],"down button":["🔽"],om:["🕉"],Hindu:["🕉"],dove:["🕊"],hajj:["🕋"],umrah:["🕋"],kaaba:["🕋"],mosque:["🕌"],masjid:["🕌"],synagogue:["🕍"],Jew:["🕍"],temple:["🕍"],menorah:["🕎"],candelabrum:["🕎"],candlestick:["🕎"],"1:00":["🕐"],"00":["🕐","🕑","🕒","🕓","🕔","🕕","🕖","🕗","🕘","🕙","🕚","🕛"],"o’clock":["🕐","🕑","🕒","🕓","🕔","🕕","🕖","🕗","🕘","🕙","🕚","🕛"],"one o’clock":["🕐"],"2:00":["🕑"],"two o’clock":["🕑"],"3:00":["🕒"],"three o’clock":["🕒"],"4:00":["🕓"],"four o’clock":["🕓"],"5:00":["🕔"],"five o’clock":["🕔"],"6:00":["🕕"],"six o’clock":["🕕"],"7:00":["🕖"],"seven o’clock":["🕖"],"8:00":["🕗"],"eight o’clock":["🕗"],"9:00":["🕘"],"nine o’clock":["🕘"],"10:00":["🕙"],"ten o’clock":["🕙"],ten:["🕙","🕥"],"11:00":["🕚"],eleven:["🕚","🕦"],"eleven o’clock":["🕚"],"12:00":["🕛"],twelve:["🕛","🕧"],"twelve o’clock":["🕛"],"1:30":["🕜"],thirty:["🕜","🕝","🕞","🕟","🕠","🕡","🕢","🕣","🕤","🕥","🕦","🕧"],"one-thirty":["🕜"],"2:30":["🕝"],"two-thirty":["🕝"],"3:30":["🕞"],"three-thirty":["🕞"],"4:30":["🕟"],"four-thirty":["🕟"],"5:30":["🕠"],"five-thirty":["🕠"],"6:30":["🕡"],"six-thirty":["🕡"],"7:30":["🕢"],"seven-thirty":["🕢"],"8:30":["🕣"],"eight-thirty":["🕣"],"9:30":["🕤"],"nine-thirty":["🕤"],"10:30":["🕥"],"ten-thirty":["🕥"],"11:30":["🕦"],"eleven-thirty":["🕦"],"12:30":["🕧"],"twelve-thirty":["🕧"],candle:["🕯"],"mantelpiece clock":["🕰"],business:["🕴","👨‍💼","👩‍💼"],"man in business suit levitating":["🕴"],suit:["🕴"],detective:["🕵"],sleuth:["🕵"],spy:["🕵"],sunglasses:["🕶","😎"],spider:["🕷","🕸"],"spider web":["🕸"],web:["🕸"],joystick:["🕹"],videogame:["🕹"],"linked paperclips":["🖇"],ballpoint:["🖊"],"fountain pen":["🖋"],paintbrush:["🖌"],crayon:["🖍"],"raised hand with fingers splayed":["🖐"],splayed:["🖐"],"middle finger":["🖕"],hands:["🖖","🙋"],spock:["🖖"],"star trek":["🖖"],vulcan:["🖖"],"vulcan salute":["🖖"],"desktop computer":["🖥"],monitor:["🖥"],desktop:["🖥"],printer:["🖨"],"computer mouse":["🖱"],trackball:["🖲"],"framed picture":["🖼"],frame:["🖼"],picture:["🖼"],"card index dividers":["🗂"],dividers:["🗂"],"card file box":["🗃"],"file cabinet":["🗄"],cabinet:["🗄"],filing:["🗄"],wastebasket:["🗑"],"spiral notepad":["🗒"],pad:["🗒","🗓"],"spiral calendar":["🗓"],clamp:["🗜"],compress:["🗜"],vice:["🗜"],"old key":["🗝"],clue:["🗝"],"rolled-up newspaper":["🗞"],rolled:["🗞"],dagger:["🗡"],speak:["🗣","🙊"],"speaking head":["🗣"],head:["🗣"],speaking:["🗣"],"left speech bubble":["🗨"],"right anger bubble":["🗯"],"ballot box with ballot":["🗳"],"world map":["🗺"],fuji:["🗻"],"mount fuji":["🗻"],tokyo:["🗼"],tower:["🗼"],"Tokyo tower":["🗼"],Tokyo:["🗼"],liberty:["🗽"],statue:["🗽","🗿"],"Statue of Liberty":["🗽"],"map of Japan":["🗾"],stoneface:["🗿"],moyai:["🗿"],moai:["🗿"],cheerful:["😀"],cheery:["😀"],grin:["😀","😁","😃","😄","😸"],laugh:["😀","😂","😄","😆","🤣"],teeth:["😀","😁","😃"],"grinning face":["😀"],"grinning face with smiling eyes":["😁"],crying:["😂","😢","😩","😪","😭"],feels:["😂","😍","😓","😖","😠","😡","😢","😤","😩","😫","😵"],haha:["😂","😆"],hehe:["😂","🙃"],laughing:["😂"],laughter:["😂"],lol:["😂","😄","😆","🤣"],lolol:["😂"],lololol:["😂"],lmfao:["😂"],roflmao:["😂"],rofl:["😂","😆"],tears:["😂"],"face with tears of joy":["😂"],"crying laughing":["😂"],funny:["😂","😜"],joy:["😂","😹"],"smiling face with open mouth":["😃"],"smiling face with open mouth & smiling eyes":["😄"],dejected:["😅","😔","😞"],stress:["😅","😟"],stressed:["😅","😟","😧"],"smiling face with open mouth & cold sweat":["😅"],satisfied:["😆","😊"],"smiling face with open mouth & closed eyes":["😆"],angelic:["😇"],angels:["😇"],bible:["😇"],blessed:["😇","🙏"],halo:["😇"],innocent:["😇"],spirit:["😇"],"smiling face with halo":["😇"],pissed:["😈","😒"],"smiling face with horns":["😈"],heartbreaker:["😉"],slide:["😉","😏"],tease:["😉"],wink:["😉","😏","😜"],winking:["😉"],winks:["😉"],"winking face":["😉"],blush:["😊","😚"],glad:["😊"],"smiling face with smiling eyes":["😊"],delicious:["😋"],savour:["😋"],savouring:["😋"],yum:["😋"],yummy:["😋"],tasty:["😋"],"face savouring delicious food":["😋"],um:["😋"],calm:["😌"],relief:["😌"],relieved:["😌","😥"],zen:["😌"],"relieved face":["😌"],"smiling face with heart-eyes":["😍"],driving:["😎","🚗"],frat:["😎"],goose:["😎"],maverick:["😎"],stunner:["😎"],style:["😎"],swag:["😎","😏"],swagger:["😎","😏","🚶"],"smiling face with sunglasses":["😎"],boss:["😏"],dapper:["😏"],eyebrows:["😏"],leer:["😏"],slick:["😏"],smirk:["😏"],suspicious:["😏"],sly:["😏"],smug:["😏"],snicker:["😏"],suave:["😏"],"smirking face":["😏"],awk:["😐","😑","😬","😳"],awkward:["😐","😑","😬","😳","😶"],basic:["😐","😑"],deadpan:["😐"],jealous:["😐","😑","😒"],jel:["😐","😑","😒"],jelly:["😐","😑","😒"],neutral:["😐"],expressionless:["😐","😑","😶"],blank:["😐","😶"],"not impressed":["😐"],unimpressed:["😐"],"not amused":["😐"],unamused:["😐","😒"],"not funny":["😐"],"not laughing":["😐"],uh:["😐","😑"],"uh oh":["😐","😑"],"neutral face":["😐"],unhappy:["😑","😒","😞","😠","😡","😢","😤","😧","😩","😭"],fine:["😑","😒"],inexpressive:["😑"],unexpressive:["😑"],wtf:["😑","😒","😲"],"expressionless face":["😑"],"...":["😒"],coolstorybro:["😒"],ugh:["😒","😒"],weird:["😒"],uhh:["😒"],"unamused face":["😒"],scared:["😓","😦","😧","😨","😰","😱","🙈"],"that was close":["😓"],yikes:["😓","😰"],"face with cold sweat":["😓"],awful:["😔","😞","😢"],died:["😔"],losing:["😔","😔","😞"],pensive:["😔"],sucks:["😔"],lost:["😔"],"pensive face":["😔"],befuddled:["😕"],confused:["😕","😖"],confusing:["😕"],"not sure":["😕"],sorry:["😕","🙇"],"i dunno":["😕"],dunno:["😕"],hm:["😕"],"confused face":["😕"],confounded:["😖"],distraught:["😖"],frustrated:["😖","😠"],"confounded face":["😖"],"love you":["😗","😘"],smooch:["😗","😘"],smooches:["😗","😘","😚"],"kissing face":["😗"],lover:["😘"],"miss you":["😘"],"face blowing a kiss":["😘"],"closed eyes":["😙"],"kissing face with smiling eyes":["😙"],"under the tuscan sun":["😚"],"kissing face with closed eyes":["😚"],"face with stuck-out tongue":["😛"],crazy:["😜"],epic:["😜","😯","😱"],fun:["😜"],joke:["😜"],loopy:["😜"],nutty:["😜"],wacky:["😜"],weirdo:["😜"],"face with stuck-out tongue & winking eye":["😜"],gross:["😝"],horrible:["😝"],"face with stuck-out tongue & closed eyes":["😝"],taste:["😝"],blame:["😞","😠","😨","😳"],disappointed:["😞","😥"],"disappointed face":["😞"],anxious:["😟","😥","😨"],butterflies:["😟"],nerves:["😟"],surprised:["😟","😮","😯","🙀"],worried:["😟","😨"],worry:["😟"],"worried face":["😟"],anger:["😠","😡","😤"],maddening:["😠","😡"],rage:["😠","😡"],"angry face":["😠"],pouting:["😡","😾","🙎"],"pouting face":["😡"],cry:["😢","😭","😿"],miss:["😢"],triste:["😢"],"crying face":["😢"],concentrate:["😣"],concentration:["😣"],focus:["😣"],persevere:["😣"],"persevering face":["😣"],steam:["😤","🚂"],"face with steam from nose":["😤"],"close call":["😥"],complicated:["😥"],"not this time":["😥"],"disappointed but relieved face":["😥"],whew:["😥"],"caught off guard":["😦"],wow:["😦","😧","😮","😳"],what:["😦","😧","😳"],suprise:["😦","😧"],"frowning face with open mouth":["😦"],anguished:["😧"],forgot:["😧","😮","🙈"],"anguished face":["😧"],afraid:["😨"],fear:["😨","😱"],fearful:["😨","😱"],"fearful face":["😨"],nooo:["😩"],weary:["😩","🙀"],"weary face":["😩"],"sleepy face":["😪"],nap:["😫","😴"],sneeze:["😫","🤧"],"tired face":["😫"],dentist:["😬","😷"],grinning:["😬"],nothing:["😬"],grimace:["😬"],"grimacing face":["😬"],bawling:["😭"],sob:["😭"],"loudly crying face":["😭"],"i dont believe you":["😮"],woah:["😮","😯"],whoa:["😮","😯"],shocked:["😮","😲","😲"],unreal:["😮"],unbelievable:["😮"],"face with open mouth":["😮"],sympathy:["😮"],hushed:["😯"],stunned:["😯"],"hushed face":["😯"],eek:["😰"],rushed:["😰"],"face with open mouth & cold sweat":["😰"],scream:["😱"],screamer:["😱"],"face screaming in fear":["😱"],munch:["😱"],astonished:["😲"],"no way":["😲"],gtfo:["😲"],omfg:["😲"],totally:["😲"],"astonished face":["😲"],dazed:["😳"],disbelief:["😳"],embarassed:["😳","🙈"],exercise:["😳","🙆"],flushed:["😳"],geez:["😳"],jeez:["😳"],"that's crazy":["😳"],amazed:["😳"],impressed:["😳"],"flushed face":["😳"],bed:["😴","🛏"],bedtime:["😴"],"sleeping face":["😴"],"dizzy face":["😵"],"cant even":["😶"],secret:["😶","🙈","🙉","🙊","🤐"],mouthless:["😶"],silence:["😶"],speechless:["😶"],"face without mouth":["😶"],dermatologist:["😷"],dr:["😷"],germs:["😷"],"face with medical mask":["😷"],"grinning cat face with smiling eyes":["😸"],"cat face with tears of joy":["😹"],"smiling cat face with open mouth":["😺"],"smiling cat face with heart-eyes":["😻"],ironic:["😼"],"cat face with wry smile":["😼"],wry:["😼"],"kissing cat face with closed eyes":["😽"],"pouting cat face":["😾"],"crying cat face":["😿"],oh:["🙀"],"weary cat face":["🙀"],"slightly frowning face":["🙁"],"slightly smiling face":["🙂"],"upside-down face":["🙃"],"upside-down":["🙃"],rolling:["🙄","🤣"],eyeroll:["🙄"],"face with rolling eyes":["🙄"],gesture:["🙅","🙆","🙇","🙈","🙉","🙊","🙋","🙌","🙍","🙎","🙏"],"person gesturing NO":["🙅"],"person gesturing OK":["🙆"],apology:["🙇"],meditate:["🙇"],meditation:["🙇"],"person bowing":["🙇"],"cant watch":["🙈"],hide:["🙈"],nono:["🙈"],"see no evil":["🙈"],"see-no-evil monkey":["🙈"],"hear no evil":["🙉"],shh:["🙉"],tmi:["🙉"],"hear-no-evil monkey":["🙉"],oops:["🙊"],"speak no evil":["🙊"],stealth:["🙊"],"speak-no-evil monkey":["🙊"],"i know":["🙋"],raised:["🙋","🙌","🤚"],"person raising hand":["🙋"],"raising hands":["🙌"],disgruntled:["🙍"],upset:["🙍"],"person frowning":["🙍"],"person pouting":["🙎"],ask:["🙏"],beg:["🙏"],please:["🙏"],pray:["🙏"],thank:["🙏"],thanks:["🙏"],"thank you":["🙏"],appreciate:["🙏"],cmon:["🙏"],thx:["🙏"],"folded hands":["🙏"],folded:["🙏"],launch:["🚀"],rocket:["🚀","👨‍🚀","👩‍🚀"],rockets:["🚀"],helicopter:["🚁"],roflcopter:["🚁"],copter:["🚁"],vehicle:["🚁","🚌","🚐","🚑","🚕","🚗","🚘","🚙","🚚","🚛","🚜","🚝"],caboose:["🚂"],engine:["🚂","🚒"],locomotive:["🚂"],railway:["🚂","🚃","🚄","🚅","🚆","🚈","🚉","🚞","🚟","🛤"],train:["🚂","🚃","🚄","🚅","🚆","🚉","🛤"],trains:["🚂"],tram:["🚃","🚊","🚋","🚎"],trolleybus:["🚃","🚊","🚋","🚎"],"railway car":["🚃"],amtrak:["🚄","🚅"],shinkansen:["🚄","🚅"],"high-speed train":["🚄"],bullet:["🚅"],"high-speed train with bullet nose":["🚅"],arrived:["🚆","🚈","🛄"],"choo choo":["🚆"],metro:["🚇"],subway:["🚇"],bart:["🚈","🚉","🚊"],"light rail":["🚈"],monorail:["🚈","🚝"],station:["🚉"],bus:["🚋","🚌","🚍","🚎","🚏","🚐"],trolley:["🚋","🚎","🛒"],"tram car":["🚋"],cars:["🚍","🚖","🚘"],oncoming:["🚍","🚔","🚖","🚘"],"oncoming bus":["🚍"],busstop:["🚏"],"bus stop":["🚏"],drive:["🚐","🚕","🚙","🚚","🚛"],minibus:["🚐"],van:["🚐"],ambulance:["🚑"],emergency:["🚑","🚨"],truck:["🚒","🚚","🚛"],"fire engine":["🚒"],patrol:["🚓"],"5-0":["🚓"],cops:["🚓"],"police car":["🚓"],"oncoming police car":["🚔"],cab:["🚕","🚖"],cabbie:["🚕","🚖"],taxi:["🚕","🚖"],uber:["🚕","🚖"],"yellow taxi":["🚕","🚖"],drove:["🚖","🚘","🚦"],"hail a cab":["🚖"],"yellow cab":["🚖"],"oncoming taxi":["🚖"],automobile:["🚗","🚘"],"oncoming automobile":["🚘"],"sport utility vehicle":["🚙"],recreational:["🚙"],sportutility:["🚙"],"delivery truck":["🚚"],lorry:["🚛"],move:["🚛"],semi:["🚛"],"articulated lorry":["🚛"],tractor:["🚜"],"mountain railway":["🚞"],"suspension railway":["🚟"],suspension:["🚟"],cable:["🚠","🚡"],gondola:["🚠","🚡"],"ski lift":["🚠"],"mountain cableway":["🚠"],aerial:["🚡"],ropeway:["🚡"],tramway:["🚡"],"aerial tramway":["🚡"],titanic:["🚢"],cruise:["🚣"],lake:["🚣","🚤"],river:["🚣"],row:["🚣"],rowboat:["🚣"],rowing:["🚣"],"person rowing boat":["🚣"],billionaire:["🚤"],luxury:["🚤"],millionaire:["🚤"],speedboat:["🚤"],summer:["🚤"],intersection:["🚥","🚦"],"stop light":["🚥","🚦"],stoplight:["🚥","🚦"],"horizontal traffic light":["🚥"],"vertical traffic light":["🚦"],barrier:["🚧"],"police car light":["🚨"],beacon:["🚨"],"triangular flag":["🚩"],"back door":["🚪"],closet:["🚪","🚾"],door:["🚪"],"front door":["🚪"],entry:["🚫"],cigarette:["🚬"],smoking:["🚬","🚭"],"no smoking":["🚭"],litter:["🚮","🚯"],"litter in bin sign":["🚮"],litterbin:["🚮"],"no littering":["🚯"],"potable water":["🚰"],potable:["🚰"],dry:["🚱"],"non-potable water":["🚱"],"non-drinking":["🚱"],"non-potable":["🚱"],bicycle:["🚲","🚳","🚴","🚵"],bike:["🚲","🚳","🚴","🚵"],"bike gang":["🚲"],cycle:["🚲"],cycling:["🚲"],cyclist:["🚲","🚴","🚵"],ride:["🚲"],"spin class":["🚲"],spinning:["🚲"],"no bicycles":["🚳"],bicyclist:["🚴","🚵"],"person biking":["🚴"],biking:["🚴"],"person mountain biking":["🚵"],amble:["🚶"],hike:["🚶"],pedestrian:["🚶","🚷","🚸"],saunter:["🚶"],stride:["🚶"],stroll:["🚶"],walking:["🚶"],"person walking":["🚶"],"no pedestrians":["🚷"],crossing:["🚸"],"children crossing":["🚸"],lavatory:["🚹","🚺","🚻","🚾"],restroom:["🚹","🚺","🚻","🚾"],wc:["🚹","🚺","🚾"],"men’s room":["🚹"],"women’s room":["🚺"],WC:["🚻"],"baby symbol":["🚼"],changing:["🚼"],bathroom:["🚽"],toilet:["🚽"],"water closet":["🚾"],shower:["🚿"],bath:["🛀","🛁"],bathtub:["🛀","🛁"],tub:["🛀"],"person taking bath":["🛀"],passport:["🛂"],"passport control":["🛂"],customs:["🛃"],packing:["🛃","🛄"],baggage:["🛄","🛅"],bags:["🛄"],"case":["🛄","🛅"],journey:["🛄"],ready:["🛄"],"baggage claim":["🛄"],claim:["🛄"],"left luggage":["🛅"],luggage:["🛅"],locker:["🛅"],"couch and lamp":["🛋"],couch:["🛋"],lamp:["🛋"],"person in bed":["🛌"],"shopping bags":["🛍"],"bellhop bell":["🛎"],bellhop:["🛎"],"place of worship":["🛐"],worship:["🛐"],"hammer and wrench":["🛠"],shield:["🛡"],drum:["🛢","🥁"],"oil drum":["🛢"],oil:["🛢"],motorway:["🛣"],highway:["🛣"],road:["🛣"],"railway track":["🛤"],"motor boat":["🛥"],motorboat:["🛥"],aeroplane:["🛩","🛫","🛬"],"small airplane":["🛩"],"airplane departure":["🛫"],"check-in":["🛫"],departure:["🛫"],departures:["🛫"],"airplane arrival":["🛬"],arrivals:["🛬"],arriving:["🛬"],landing:["🛬"],"passenger ship":["🛳"],"keep my mouth shut":["🤐"],"not telling":["🤐"],"zipper-mouth face":["🤐"],zipper:["🤐"],"money-mouth face":["🤑"],"face with thermometer":["🤒"],ill:["🤒"],"nerd face":["🤓"],dweeb:["🤓"],geek:["🤓"],nerd:["🤓"],hmm:["🤔"],consider:["🤔"],ponder:["🤔"],pondering:["🤔"],"thinking face":["🤔"],"face with head-bandage":["🤕"],bandage:["🤕"],ouch:["🤕"],hurt:["🤕"],injury:["🤕"],"robot face":["🤖"],robot:["🤖"],"hugging face":["🤗"],hugging:["🤗"],h:["🤘"],"h town":["🤘"],"sign of the horns":["🤘"],"rock-on":["🤘"],alpha:["🦁"],"lion face":["🦁"],mane:["🦁"],gobble:["🦃"],thanksgiving:["🦃"],"unicorn face":["🦄"],unicorn:["🦄"],"cheese wedge":["🧀"],floor:["🤣"],drooling:["🤤"],cowboy:["🤠"],cowgirl:["🤠"],clown:["🤡"],lie:["🤥"],pinocchio:["🤥"],liar:["🤥"],nauseated:["🤢"],vomit:["🤢"],gesundheit:["🤧"],flu:["🤧"],fever:["🤧"],graduate:["👨‍🎓","👩‍🎓"],student:["👨‍🎓","👩‍🎓"],instructor:["👨‍🏫","👩‍🏫"],professor:["👨‍🏫","👩‍🏫"],teacher:["👨‍🏫","👩‍🏫"],farmer:["👨‍🌾","👩‍🌾"],gardener:["👨‍🌾","👩‍🌾"],rancher:["👨‍🌾","👩‍🌾"],cook:["👨‍🍳","👩‍🍳"],electrician:["👨‍🔧","👩‍🔧"],
mechanic:["👨‍🔧","👩‍🔧"],plumber:["👨‍🔧","👩‍🔧"],tradesperson:["👨‍🔧","👩‍🔧"],assembly:["👨‍🏭","👩‍🏭"],industrial:["👨‍🏭","👩‍🏭"],architect:["👨‍💼","👩‍💼"],manager:["👨‍💼","👩‍💼"],"white-collar":["👨‍💼","👩‍💼"],biologist:["👨‍🔬","👩‍🔬"],chemist:["👨‍🔬","👩‍🔬"],engineer:["👨‍🔬","👩‍🔬"],mathematician:["👨‍🔬","👩‍🔬"],physicist:["👨‍🔬","👩‍🔬"],scientist:["👨‍🔬","👩‍🔬"],coder:["👨‍💻","👩‍💻"],developer:["👨‍💻","👩‍💻"],inventor:["👨‍💻","👩‍💻"],software:["👨‍💻","👩‍💻"],technologist:["👨‍💻","👩‍💻"],entertainer:["👨‍🎤","👩‍🎤"],singer:["👨‍🎤","👩‍🎤"],artist:["👨‍🎨","👩‍🎨"],astronaut:["👨‍🚀","👩‍🚀"],firefighter:["👨‍🚒","👩‍🚒"],firetruck:["👨‍🚒","👩‍🚒"],mother:["🤶"],"Mrs.":["🤶"],prince:["🤴"],groom:["🤵"],tuxedo:["🤵"],fencer:["🤺"],fencing:["🤺"],sword:["🤺"],luck:["🤞"],"fingers crossed":["🤞"],leftwards:["🤛"],rightwards:["🤜"],agreement:["🤝"],handshake:["🤝"],meeting:["🤝"],shake:["🤝"],deal:["🤝"],black:["🖤"],wicked:["🖤"],gorilla:["🦍"],fox:["🦊"],deer:["🦌"],rhinoceros:["🦏"],eagle:["🦅"],duck:["🦆"],owl:["🦉"],lizard:["🦎"],reptile:["🦎"],shark:["🦈"],shellfish:["🦐"],small:["🦐"],molusc:["🦑"],squid:["🦑"],butterfly:["🦋"],pretty:["🦋"],wilted:["🥀"],dying:["🥀"],kiwi:["🥝"],avocado:["🥑"],carrot:["🥕"],cucumber:["🥒"],pickle:["🥒"],peanut:["🥜"],"crescent roll":["🥐"],croissant:["🥐"],baguette:["🥖"],"crêpe":["🥞"],hotcake:["🥞"],pancake:["🥞"],falafel:["🥙"],flatbread:["🥙"],gyro:["🥙"],stuffed:["🥙"],casserole:["🥘"],paella:["🥘"],shallow:["🥘"],salad:["🥗"],liquor:["🥃"],tumbler:["🥃"],whisky:["🥃"],spoon:["🥄"],tableware:["🥄"],scooter:["🛴","🛵"],motor:["🛵"],octagonal:["🛑"],canoe:["🛶"],first:["🥇"],second:["🥈"],silver:["🥈"],bronze:["🥉"],third:["🥉"],boxing:["🥊"],glove:["🥊"],judo:["🥋"],karate:["🥋"],"martial arts":["🥋"],taekwondo:["🥋"],uniform:["🥋"],goal:["🥅"],net:["🥅"],drumsticks:["🥁"],cart:["🛒"],aesculapius:["⚕"],staff:["⚕"]}},function(e,t,n){e.exports=function(){return new Worker(n.p+"pdf.worker.js")}}]));